<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>SliderPlugin.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">reflection-ui</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">xy.reflect.ui.control.swing.plugin</a> &gt; <span class="el_source">SliderPlugin.java</span></div><h1>SliderPlugin.java</h1><pre class="source lang-java linenums">
package xy.reflect.ui.control.swing.plugin;

import java.awt.Component;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import javax.swing.JSlider;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

import xy.reflect.ui.control.IAdvancedFieldControl;
import xy.reflect.ui.control.IFieldControlData;
import xy.reflect.ui.control.IFieldControlInput;
import xy.reflect.ui.control.plugin.AbstractSimpleCustomizableFieldControlPlugin;
import xy.reflect.ui.control.swing.renderer.SwingRenderer;
import xy.reflect.ui.control.swing.util.SwingRendererUtils;
import xy.reflect.ui.info.ValidationSession;
import xy.reflect.ui.info.menu.MenuModel;
import xy.reflect.ui.util.ClassUtils;
import xy.reflect.ui.util.ConversionUtils;
import xy.reflect.ui.util.ReflectionUIError;
import xy.reflect.ui.util.ReflectionUIUtils;
import xy.reflect.ui.util.ReschedulableTask;

/**
 * Field control plugin that allows to use sliders.
 * 
 * @author olitank
 *
 */
<span class="fc" id="L31">public class SliderPlugin extends AbstractSimpleCustomizableFieldControlPlugin {</span>

	@Override
	public String getControlTitle() {
<span class="nc" id="L35">		return &quot;Slider&quot;;</span>
	}

	@Override
	protected boolean handles(Class&lt;?&gt; javaType) {
<span class="pc bpc" id="L40" title="3 of 6 branches missed.">		return Byte.class.equals(javaType) || byte.class.equals(javaType) || Short.class.equals(javaType)</span>
<span class="pc bpc" id="L41" title="3 of 6 branches missed.">				|| short.class.equals(javaType) || Integer.class.equals(javaType) || int.class.equals(javaType)</span>
<span class="nc bnc" id="L42" title="All 4 branches missed.">				|| Long.class.equals(javaType) || long.class.equals(javaType);</span>
	}

	@Override
	public boolean canDisplayDistinctNullValue() {
<span class="nc" id="L47">		return false;</span>
	}

	@Override
	public AbstractConfiguration getDefaultControlCustomization() {
<span class="nc" id="L52">		return new SliderConfiguration();</span>
	}

	@Override
	public Slider createControl(Object renderer, IFieldControlInput input) {
<span class="nc" id="L57">		return new Slider((SwingRenderer) renderer, input);</span>
	}

<span class="nc" id="L60">	public static class SliderConfiguration extends AbstractConfiguration {</span>
		private static final long serialVersionUID = 1L;
<span class="nc" id="L62">		public int maximum = 100;</span>
<span class="nc" id="L63">		public int minimum = 0;</span>
<span class="nc" id="L64">		public boolean paintTicks = true;</span>
<span class="nc" id="L65">		public boolean paintLabels = true;</span>
<span class="nc" id="L66">		public int minorTickSpacing = 1;</span>
<span class="nc" id="L67">		public int majorTickSpacing = 10;</span>

	}

	public class Slider extends JSlider implements IAdvancedFieldControl {
		private static final long serialVersionUID = 1L;

		protected SwingRenderer swingRenderer;
		protected IFieldControlInput input;
		protected IFieldControlData data;
<span class="nc" id="L77">		protected boolean listenerDisabled = false;</span>
		protected Class&lt;?&gt; numberClass;
		protected ReschedulableTask dataUpdateProcess;

		protected SliderConfiguration controlConfiguration;

<span class="nc" id="L83">		public Slider(SwingRenderer swingRenderer, IFieldControlInput input) {</span>
<span class="nc" id="L84">			this.swingRenderer = swingRenderer;</span>
<span class="nc" id="L85">			this.input = input;</span>
<span class="nc" id="L86">			this.data = input.getControlData();</span>
<span class="nc" id="L87">			this.dataUpdateProcess = createDelayedUpdateProcess();</span>
<span class="nc" id="L88">			setOpaque(false);</span>
			try {
<span class="nc" id="L90">				this.numberClass = swingRenderer.getReflectionUI()</span>
<span class="nc" id="L91">						.getReflectedClass(input.getControlData().getType().getName());</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">				if (this.numberClass.isPrimitive()) {</span>
<span class="nc" id="L93">					this.numberClass = ClassUtils.primitiveToWrapperClass(numberClass);</span>
				}
<span class="nc" id="L95">			} catch (ClassNotFoundException e1) {</span>
<span class="nc" id="L96">				throw new ReflectionUIError(e1);</span>
			}
<span class="nc" id="L98">			addChangeListener(new ChangeListener() {</span>
				@Override
				public void stateChanged(ChangeEvent e) {
					try {
<span class="nc" id="L102">						onSlide();</span>
<span class="nc" id="L103">					} catch (Throwable t) {</span>
<span class="nc" id="L104">						swingRenderer.handleException(Slider.this, t);</span>
					}
<span class="nc" id="L106">				}</span>
			});
<span class="nc" id="L108">			addFocusListener(new FocusListener() {</span>

				@Override
				public void focusLost(FocusEvent e) {
					try {
<span class="nc" id="L113">						onFocusLoss();</span>
<span class="nc" id="L114">					} catch (Throwable t) {</span>
<span class="nc" id="L115">						swingRenderer.handleException(Slider.this, t);</span>
					}
<span class="nc" id="L117">				}</span>

				@Override
				public void focusGained(FocusEvent e) {
<span class="nc" id="L121">				}</span>
			});
<span class="nc" id="L123">			refreshUI(true);</span>
<span class="nc" id="L124">		}</span>

		protected ReschedulableTask createDelayedUpdateProcess() {
<span class="nc" id="L127">			return swingRenderer.createDelayedUpdateProcess(this, new Runnable() {</span>
				@Override
				public void run() {
<span class="nc" id="L130">					Slider.this.commitChanges();</span>
<span class="nc" id="L131">				}</span>
<span class="nc" id="L132">			}, 750);</span>
		}

		@Override
		public boolean refreshUI(boolean refreshStructure) {
<span class="nc" id="L137">			listenerDisabled = true;</span>
			try {
<span class="nc bnc" id="L139" title="All 2 branches missed.">				if (refreshStructure) {</span>
<span class="nc" id="L140">					updateControlConfiguration();</span>
<span class="nc" id="L141">					setMaximum(controlConfiguration.maximum);</span>
<span class="nc" id="L142">					setMinimum(controlConfiguration.minimum);</span>
<span class="nc" id="L143">					setPaintTicks(controlConfiguration.paintTicks);</span>
<span class="nc" id="L144">					setPaintLabels(controlConfiguration.paintLabels);</span>
<span class="nc" id="L145">					setLabelTable(null);</span>
<span class="nc" id="L146">					setMinorTickSpacing(controlConfiguration.minorTickSpacing);</span>
<span class="nc" id="L147">					setMajorTickSpacing(controlConfiguration.majorTickSpacing);</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">					setEnabled(!data.isGetOnly());</span>
<span class="nc" id="L149">					setForeground(SwingRendererUtils.getColor(data.getLabelForegroundColor()));</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">					if (data.getLabelCustomFontResourcePath() != null) {</span>
<span class="nc" id="L151">						setFont(SwingRendererUtils.loadFontThroughCache(data.getLabelCustomFontResourcePath(),</span>
<span class="nc" id="L152">								ReflectionUIUtils.getErrorLogListener(swingRenderer.getReflectionUI()), swingRenderer)</span>
<span class="nc" id="L153">								.deriveFont(getFont().getStyle(), getFont().getSize()));</span>
<span class="nc" id="L154">					} else {</span>
<span class="nc" id="L155">						setFont(new JSlider().getFont());</span>
					}
<span class="nc" id="L157">					SwingRendererUtils.handleComponentSizeChange(this);</span>
				}
<span class="nc bnc" id="L159" title="All 2 branches missed.">				if (dataUpdateProcess.isActive()) {</span>
					/*
					 * If a change is pending, the refresh can then be aborted, as it will be
					 * performed later after the change is committed. Note that refreshing the
					 * control would have deleted the new control value before it was committed.
					 */
<span class="nc" id="L165">					return true;</span>
				}
<span class="nc" id="L167">				Object value = data.getValue();</span>
				final int intValue;
<span class="nc bnc" id="L169" title="All 2 branches missed.">				if (value == null) {</span>
<span class="nc" id="L170">					intValue = getMinimum();</span>
<span class="nc" id="L171">				} else {</span>
<span class="nc" id="L172">					intValue = (Integer) ConversionUtils.convertNumberToTargetClass((Number) value, Integer.class);</span>
				}
<span class="nc bnc" id="L174" title="All 2 branches missed.">				if (intValue &gt; getMaximum()) {</span>
<span class="nc" id="L175">					throw new ReflectionUIError(</span>
<span class="nc" id="L176">							&quot;The value is greater than the maximum value: &quot; + intValue + &quot; &gt; &quot; + getMaximum());</span>
				}
<span class="nc bnc" id="L178" title="All 2 branches missed.">				if (intValue &lt; getMinimum()) {</span>
<span class="nc" id="L179">					throw new ReflectionUIError(</span>
<span class="nc" id="L180">							&quot;The value is less than the minimum value: &quot; + intValue + &quot; &lt; &quot; + getMinimum());</span>
				}
<span class="nc" id="L182">				setValue(intValue);</span>
<span class="nc" id="L183">				setToolTipText(Integer.toString(intValue));</span>
<span class="nc" id="L184">				return true;</span>
			} finally {
<span class="nc" id="L186">				listenerDisabled = false;</span>
			}
		}

		protected void updateControlConfiguration() {
<span class="nc" id="L191">			controlConfiguration = (SliderConfiguration) loadControlCustomization(input);</span>
<span class="nc" id="L192">		}</span>

		@Override
		public boolean displayError(Throwable error) {
<span class="nc" id="L196">			return false;</span>
		}

		@Override
		public boolean showsCaption() {
<span class="nc" id="L201">			return false;</span>
		}

		protected void commitChanges() {
<span class="nc" id="L205">			Object value = ConversionUtils.convertNumberToTargetClass(Slider.this.getValue(), numberClass);</span>
<span class="nc" id="L206">			data.setValue(value);</span>
<span class="nc" id="L207">		}</span>

		protected void onSlide() {
<span class="nc bnc" id="L210" title="All 2 branches missed.">			if (listenerDisabled) {</span>
<span class="nc" id="L211">				return;</span>
			}
<span class="nc" id="L213">			dataUpdateProcess.reschedule();</span>
<span class="nc" id="L214">		}</span>

		protected void onFocusLoss() {
<span class="nc bnc" id="L217" title="All 2 branches missed.">			if (dataUpdateProcess.cancelSchedule()) {</span>
<span class="nc" id="L218">				commitChanges();</span>
			}
<span class="nc" id="L220">		}</span>

		@Override
		public boolean isModificationStackManaged() {
<span class="nc" id="L224">			return false;</span>
		}

		@Override
		public boolean areValueAccessErrorsManaged() {
<span class="nc" id="L229">			return false;</span>
		}

		@Override
		public boolean requestCustomFocus() {
<span class="nc bnc" id="L234" title="All 2 branches missed.">			if (data.isGetOnly()) {</span>
<span class="nc" id="L235">				return false;</span>
			}
<span class="nc bnc" id="L237" title="All 2 branches missed.">			for (Component c : getComponents()) {</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">				if (SwingRendererUtils.requestAnyComponentFocus(c, swingRenderer)) {</span>
<span class="nc" id="L239">					return true;</span>
				}
			}
<span class="nc" id="L242">			return false;</span>
		}

		@Override
		public void validateControlData(ValidationSession session) throws Exception {
<span class="nc" id="L247">		}</span>

		@Override
		public void addMenuContributions(MenuModel menuModel) {
<span class="nc" id="L251">		}</span>

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>