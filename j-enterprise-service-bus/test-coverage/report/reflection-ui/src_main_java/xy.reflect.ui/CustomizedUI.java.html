<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>CustomizedUI.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">reflection-ui</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">xy.reflect.ui</a> &gt; <span class="el_source">CustomizedUI.java</span></div><h1>CustomizedUI.java</h1><pre class="source lang-java linenums">
package xy.reflect.ui;

import java.util.Map;

import xy.reflect.ui.info.app.IApplicationInfo;
import xy.reflect.ui.info.custom.InfoCustomizations;
import xy.reflect.ui.info.field.IFieldInfo;
import xy.reflect.ui.info.method.IMethodInfo;
import xy.reflect.ui.info.parameter.IParameterInfo;
import xy.reflect.ui.info.type.ITypeInfo;
import xy.reflect.ui.info.type.factory.IInfoProxyFactory;
import xy.reflect.ui.info.type.factory.InfoCustomizationsFactory;
import xy.reflect.ui.info.type.factory.InfoProxyFactory;
import xy.reflect.ui.info.type.source.ITypeInfoSource;
import xy.reflect.ui.info.type.source.SpecificitiesIdentifier;
import xy.reflect.ui.util.MiscUtils;
import xy.reflect.ui.util.ReflectionUIError;

/**
 * This is a subclass of {@link ReflectionUI} that adapts its introspection
 * mechanics according to the given {@link InfoCustomizations} instance.
 * 
 * It uses in order the proxy factories returned by
 * {@link #getBeforeInfoCustomizationsFactory()},
 * {@link #getInfoCustomizationsSetupFactory()}, *
 * {@link #getInfoCustomizationsFactory()} and
 * {@link #getAfterInfoCustomizationsFactory()}.
 * 
 * @author olitank
 *
 */
public class CustomizedUI extends ReflectionUI {

	protected static CustomizedUI defaultInstance;

	protected InfoCustomizations infoCustomizations;
<span class="fc" id="L38">	protected Map&lt;ITypeInfo, ITypeInfo&gt; customizedTypeInfoCache = createCustomizedTypeInfoCache();</span>

	private IInfoProxyFactory beforeInfoCustomizationsFactory;
	private IInfoProxyFactory infoCustomizationsSetupFactory;
	private IInfoProxyFactory infoCustomizationsFactory;
	private IInfoProxyFactory afterInfoCustomizationsFactory;

	/**
	 * @return the default instance of this class. This instance is constructed with
	 *         the {@link InfoCustomizations#getDefault()} return value.
	 */
	public static CustomizedUI getDefault() {
<span class="nc bnc" id="L50" title="All 2 branches missed.">		if (defaultInstance == null) {</span>
<span class="nc" id="L51">			defaultInstance = new CustomizedUI(InfoCustomizations.getDefault());</span>
		}
<span class="nc" id="L53">		return defaultInstance;</span>
	}

	/**
	 * Constructs an instance of this class that will use the given customizations.
	 * 
	 * @param infoCustomizations The abstract UI model customizations specification
	 *                           object.
	 */
<span class="fc" id="L62">	public CustomizedUI(InfoCustomizations infoCustomizations) {</span>
<span class="fc" id="L63">		this.infoCustomizations = infoCustomizations;</span>
<span class="fc" id="L64">	}</span>

	/**
	 * Constructs an instance of this class with empty customizations.
	 */
	public CustomizedUI() {
<span class="fc" id="L70">		this(new InfoCustomizations());</span>
<span class="fc" id="L71">	}</span>

	/**
	 * @return the abstract UI model customizations specification.
	 */
	public InfoCustomizations getInfoCustomizations() {
<span class="fc" id="L77">		return infoCustomizations;</span>
	}

	protected Map&lt;ITypeInfo, ITypeInfo&gt; createCustomizedTypeInfoCache() {
<span class="fc" id="L81">		return MiscUtils.newStandardCache(true);</span>
	}

	/**
	 * @return the cache that maps {@link ITypeInfo} base instances to
	 *         {@link ITypeInfo} final instances generated by the customization
	 *         process. Its access should be synchronized on the monitor returned by
	 *         {@link #getTypeCacheMutex()}.
	 */
	public Map&lt;ITypeInfo, ITypeInfo&gt; getCustomizedTypeInfoCache() {
<span class="fc" id="L91">		return customizedTypeInfoCache;</span>
	}

	@Override
	public ITypeInfo getTypeInfo(ITypeInfoSource typeSource) {
<span class="fc" id="L96">		ITypeInfo result = super.getTypeInfo(typeSource);</span>
<span class="fc" id="L97">		synchronized (getTypeCacheMutex()) {</span>
<span class="fc" id="L98">			ITypeInfo customizedTypesCacheKey = result;</span>
<span class="fc" id="L99">			ITypeInfo cachedResult = customizedTypeInfoCache.get(customizedTypesCacheKey);</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">			if (cachedResult != null) {</span>
<span class="fc" id="L101">				result = cachedResult;</span>
<span class="fc" id="L102">			} else {</span>
<span class="fc" id="L103">				result = getBeforeInfoCustomizationsFactory().wrapTypeInfo(result);</span>
<span class="fc" id="L104">				result = getInfoCustomizationsSetupFactory().wrapTypeInfo(result);</span>
<span class="fc" id="L105">				result = getInfoCustomizationsFactory().wrapTypeInfo(result);</span>
<span class="fc" id="L106">				result = getAfterInfoCustomizationsFactory().wrapTypeInfo(result);</span>
<span class="fc" id="L107">				customizedTypeInfoCache.put(customizedTypesCacheKey, result);</span>
			}
		}
<span class="fc" id="L110">		return result;</span>
	}

	@Override
	public IApplicationInfo getApplicationInfo() {
<span class="fc" id="L115">		IApplicationInfo result = super.getApplicationInfo();</span>
<span class="fc" id="L116">		result = getBeforeInfoCustomizationsFactory().wrapApplicationInfo(result);</span>
<span class="fc" id="L117">		result = getInfoCustomizationsSetupFactory().wrapApplicationInfo(result);</span>
<span class="fc" id="L118">		result = getInfoCustomizationsFactory().wrapApplicationInfo(result);</span>
<span class="fc" id="L119">		result = getAfterInfoCustomizationsFactory().wrapApplicationInfo(result);</span>
<span class="fc" id="L120">		return result;</span>
	}

	/**
	 * @return the UI model proxy factory that will be used to customize every UI
	 *         model.
	 */
	public final IInfoProxyFactory getInfoCustomizationsFactory() {
<span class="fc bfc" id="L128" title="All 2 branches covered.">		if (infoCustomizationsFactory == null) {</span>
<span class="fc" id="L129">			infoCustomizationsFactory = createInfoCustomizationsFactory();</span>
		}
<span class="fc" id="L131">		return infoCustomizationsFactory;</span>
	}

	/**
	 * @return the UI model proxy factory that will be used to prepare every UI
	 *         model for customizations.
	 */
	public final IInfoProxyFactory getInfoCustomizationsSetupFactory() {
<span class="fc bfc" id="L139" title="All 2 branches covered.">		if (infoCustomizationsSetupFactory == null) {</span>
<span class="fc" id="L140">			infoCustomizationsSetupFactory = createInfoCustomizationsSetupFactory();</span>
		}
<span class="fc" id="L142">		return infoCustomizationsSetupFactory;</span>
	}

	/**
	 * @return an abstract UI model proxy factory that will be used to eventually
	 *         adapt some type/application information before customizations are
	 *         applied.
	 */
	public final IInfoProxyFactory getBeforeInfoCustomizationsFactory() {
<span class="fc bfc" id="L151" title="All 2 branches covered.">		if (beforeInfoCustomizationsFactory == null) {</span>
<span class="fc" id="L152">			beforeInfoCustomizationsFactory = createBeforeInfoCustomizationsFactory();</span>
		}
<span class="fc" id="L154">		return beforeInfoCustomizationsFactory;</span>
	}

	/**
	 * @return an abstract UI model proxy factory that will be used to eventually
	 *         adapt some type/application information after customizations are
	 *         applied.
	 */
	public final IInfoProxyFactory getAfterInfoCustomizationsFactory() {
<span class="fc bfc" id="L163" title="All 2 branches covered.">		if (afterInfoCustomizationsFactory == null) {</span>
<span class="fc" id="L164">			afterInfoCustomizationsFactory = createAfterInfoCustomizationsFactory();</span>
		}
<span class="fc" id="L166">		return afterInfoCustomizationsFactory;</span>
	}

	protected IInfoProxyFactory createInfoCustomizationsFactory() {
<span class="fc" id="L170">		return new InfoCustomizationsFactory(this) {</span>

			@Override
			public String getIdentifier() {
<span class="fc" id="L174">				return &quot;CustomizationsFactory [of=&quot; + CustomizedUI.this.toString() + &quot;]&quot;;</span>
			}

			@Override
			protected IInfoProxyFactory getInfoCustomizationsSetupFactory() {
<span class="fc" id="L179">				return CustomizedUI.this.getInfoCustomizationsSetupFactory();</span>
			}

			@Override
			protected InfoCustomizations accessInfoCustomizations() {
<span class="fc" id="L184">				return CustomizedUI.this.infoCustomizations;</span>
			}

		};
	}

	protected IInfoProxyFactory createInfoCustomizationsSetupFactory() {
<span class="fc" id="L191">		return new InfoProxyFactory() {</span>

			@Override
			public String getIdentifier() {
<span class="fc" id="L195">				return &quot;CustomizationsSetupFactory [of=&quot; + CustomizedUI.this.toString() + &quot;]&quot;;</span>
			}

			@Override
			protected ITypeInfo getType(IParameterInfo param, IMethodInfo method, ITypeInfo objectType) {
<span class="fc" id="L200">				ITypeInfo result = param.getType();</span>
<span class="fc" id="L201">				ITypeInfoSource source = result.getSource();</span>
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">				if (source.getSpecificitiesIdentifier() != null) {</span>
<span class="nc" id="L203">					throw new ReflectionUIError(</span>
<span class="nc" id="L204">							&quot;Invalid parameter type info: unexpected source specificities identifier: &quot;</span>
<span class="nc" id="L205">									+ source.getSpecificitiesIdentifier() + &quot;, null value expected&quot; + &quot;\n&quot;</span>
<span class="nc" id="L206">									+ &quot;parameter=&quot; + param.getName() + &quot;, method=&quot; + method.getSignature()</span>
<span class="nc" id="L207">									+ &quot;, objectType=&quot; + objectType.getName() + &quot;, typeInfoSource=&quot; + source);</span>
				}
<span class="fc" id="L209">				return result;</span>
			}

			@Override
			protected ITypeInfo getType(IFieldInfo field, ITypeInfo objectType) {
<span class="fc" id="L214">				ITypeInfo result = field.getType();</span>
<span class="fc" id="L215">				ITypeInfoSource source = result.getSource();</span>
<span class="fc" id="L216">				SpecificitiesIdentifier expectedSpecificitiesIdentifier = new SpecificitiesIdentifier(</span>
<span class="fc" id="L217">						objectType.getName(), field.getName());</span>
<span class="pc bpc" id="L218" title="1 of 2 branches missed.">				if (!expectedSpecificitiesIdentifier.equals(source.getSpecificitiesIdentifier())) {</span>
<span class="nc" id="L219">					throw new ReflectionUIError(&quot;Invalid field type info: unexpected source specificities identifier: &quot;</span>
<span class="nc" id="L220">							+ source.getSpecificitiesIdentifier() + &quot;, expected: &quot; + expectedSpecificitiesIdentifier</span>
<span class="nc" id="L221">							+ &quot;\n&quot; + &quot;typeInfoSource=&quot; + source);</span>
				}
<span class="fc" id="L223">				return result;</span>
			}

			@Override
			protected ITypeInfo getReturnValueType(IMethodInfo method, ITypeInfo objectType) {
<span class="fc" id="L228">				ITypeInfo result = method.getReturnValueType();</span>
<span class="fc bfc" id="L229" title="All 2 branches covered.">				if (result == null) {</span>
<span class="fc" id="L230">					return null;</span>
				}
<span class="fc" id="L232">				ITypeInfoSource source = result.getSource();</span>
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">				if (source.getSpecificitiesIdentifier() != null) {</span>
<span class="nc" id="L234">					throw new ReflectionUIError(&quot;Invalid method type info: unexpected source specificities identifier: &quot;</span>
<span class="nc" id="L235">							+ source.getSpecificitiesIdentifier() + &quot;, null value expected&quot; + &quot;\n&quot; + &quot;method=&quot;</span>
<span class="nc" id="L236">							+ method.getName() + &quot;, objectType=&quot; + objectType.getName() + &quot;, typeInfoSource=&quot; + source);</span>
				}
<span class="fc" id="L238">				return result;</span>
			}

		};
	}

	protected IInfoProxyFactory createBeforeInfoCustomizationsFactory() {
<span class="nc" id="L245">		return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
	}

	protected IInfoProxyFactory createAfterInfoCustomizationsFactory() {
<span class="fc" id="L249">		return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
	}

	@Override
	public String toString() {
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">		if (this == defaultInstance) {</span>
<span class="nc" id="L255">			return &quot;CustomizedUI.DEFAULT&quot;;</span>
		} else {
<span class="fc" id="L257">			return super.toString();</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>