<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>ConversionUtils.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">reflection-ui</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">xy.reflect.ui.util</a> &gt; <span class="el_source">ConversionUtils.java</span></div><h1>ConversionUtils.java</h1><pre class="source lang-java linenums">


package xy.reflect.ui.util;

import java.math.BigDecimal;
import java.math.BigInteger;
import java.text.NumberFormat;
import java.text.ParseException;

/**
 * Miscellaneous utility methods for number conversion and parsing.
 * 
 * @author olitank
 *
 */
@SuppressWarnings(&quot;rawtypes&quot;)
<span class="nc" id="L18">public abstract class ConversionUtils {</span>

	/**
	 * Convert the given number into an instance of the given target class.
	 *
	 * @param number      the number to convert
	 * @param targetClass the target class to convert to
	 * @return the converted number
	 * @throws IllegalArgumentException if the target class is not supported (i.e.
	 *                                  not a standard Number subclass as included
	 *                                  in the JDK)
	 * @see java.lang.Byte
	 * @see java.lang.Short
	 * @see java.lang.Integer
	 * @see java.lang.Long
	 * @see java.math.BigInteger
	 * @see java.lang.Float
	 * @see java.lang.Double
	 * @see java.math.BigDecimal
	 */
	public static Number convertNumberToTargetClass(Number number, Class targetClass) throws IllegalArgumentException {
<span class="fc bfc" id="L39" title="All 2 branches covered.">		if (targetClass.isInstance(number)) {</span>
<span class="fc" id="L40">			return number;</span>
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">		} else if (targetClass.equals(Byte.class)) {</span>
<span class="nc" id="L42">			long value = number.longValue();</span>
<span class="nc bnc" id="L43" title="All 4 branches missed.">			if (value &lt; Byte.MIN_VALUE || value &gt; Byte.MAX_VALUE) {</span>
<span class="nc" id="L44">				raiseOverflowException(number, targetClass);</span>
			}
<span class="nc" id="L46">			return number.byteValue();</span>
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">		} else if (targetClass.equals(Short.class)) {</span>
<span class="nc" id="L48">			long value = number.longValue();</span>
<span class="nc bnc" id="L49" title="All 4 branches missed.">			if (value &lt; Short.MIN_VALUE || value &gt; Short.MAX_VALUE) {</span>
<span class="nc" id="L50">				raiseOverflowException(number, targetClass);</span>
			}
<span class="nc" id="L52">			return number.shortValue();</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">		} else if (targetClass.equals(Integer.class)) {</span>
<span class="fc" id="L54">			long value = number.longValue();</span>
<span class="pc bpc" id="L55" title="2 of 4 branches missed.">			if (value &lt; Integer.MIN_VALUE || value &gt; Integer.MAX_VALUE) {</span>
<span class="nc" id="L56">				raiseOverflowException(number, targetClass);</span>
			}
<span class="fc" id="L58">			return number.intValue();</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">		} else if (targetClass.equals(Long.class)) {</span>
<span class="nc" id="L60">			return number.longValue();</span>
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">		} else if (targetClass.equals(Float.class)) {</span>
<span class="nc" id="L62">			return number.floatValue();</span>
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">		} else if (targetClass.equals(Double.class)) {</span>
<span class="fc" id="L64">			return number.doubleValue();</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">		} else if (targetClass.equals(BigInteger.class)) {</span>
<span class="nc" id="L66">			return BigInteger.valueOf(number.longValue());</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">		} else if (targetClass.equals(BigDecimal.class)) {</span>
			// using BigDecimal(String) here, to avoid unpredictability of
			// BigDecimal(double)
			// (see BigDecimal javadoc for details)
<span class="nc" id="L71">			return new BigDecimal(number.toString());</span>
		} else {
<span class="nc" id="L73">			throw new IllegalArgumentException(&quot;Could not convert number [&quot; + number + &quot;] of type [&quot;</span>
<span class="nc" id="L74">					+ number.getClass().getName() + &quot;] to unknown target class [&quot; + targetClass.getName() + &quot;]&quot;);</span>
		}
	}

	/**
	 * Raise an overflow exception for the given number and target class.
	 *
	 * @param number      the number we tried to convert
	 * @param targetClass the target class we tried to convert to
	 */
	private static void raiseOverflowException(Number number, Class targetClass) {
<span class="nc" id="L85">		throw new IllegalArgumentException(&quot;Could not convert number [&quot; + number + &quot;] of type [&quot;</span>
<span class="nc" id="L86">				+ number.getClass().getName() + &quot;] to target class [&quot; + targetClass.getName() + &quot;]: overflow&quot;);</span>
	}

	/**
	 * Parse the given text into a number instance of the given target class, using
	 * the corresponding default &lt;code&gt;decode&lt;/code&gt; methods. Trims the input
	 * &lt;code&gt;String&lt;/code&gt; before attempting to parse the number. Supports numbers
	 * in hex format (with leading 0x) and in octal format (with leading 0).
	 *
	 * @param text        the text to convert
	 * @param targetClass the target class to parse into
	 * @return the parsed number
	 * @throws IllegalArgumentException if the target class is not supported (i.e.
	 *                                  not a standard Number subclass as included
	 *                                  in the JDK)
	 * @see java.lang.Byte#decode
	 * @see java.lang.Short#decode
	 * @see java.lang.Integer#decode
	 * @see java.lang.Long#decode
	 * @see #decodeBigInteger(String)
	 * @see java.lang.Float#valueOf
	 * @see java.lang.Double#valueOf
	 * @see java.math.BigDecimal#BigDecimal(String)
	 */
	public static Number parseNumber(String text, Class targetClass) {
<span class="nc" id="L111">		String trimmed = text.trim();</span>

<span class="nc bnc" id="L113" title="All 2 branches missed.">		if (targetClass.equals(Byte.class)) {</span>
<span class="nc" id="L114">			return Byte.decode(trimmed);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">		} else if (targetClass.equals(Short.class)) {</span>
<span class="nc" id="L116">			return Short.decode(trimmed);</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">		} else if (targetClass.equals(Integer.class)) {</span>
<span class="nc" id="L118">			return Integer.decode(trimmed);</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">		} else if (targetClass.equals(Long.class)) {</span>
<span class="nc" id="L120">			return Long.decode(trimmed);</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">		} else if (targetClass.equals(BigInteger.class)) {</span>
<span class="nc" id="L122">			return decodeBigInteger(trimmed);</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">		} else if (targetClass.equals(Float.class)) {</span>
<span class="nc" id="L124">			return Float.valueOf(trimmed);</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">		} else if (targetClass.equals(Double.class)) {</span>
<span class="nc" id="L126">			return Double.valueOf(trimmed);</span>
<span class="nc bnc" id="L127" title="All 4 branches missed.">		} else if (targetClass.equals(BigDecimal.class) || targetClass.equals(Number.class)) {</span>
<span class="nc" id="L128">			return new BigDecimal(trimmed);</span>
		} else {
<span class="nc" id="L130">			throw new IllegalArgumentException(</span>
<span class="nc" id="L131">					&quot;Cannot convert String [&quot; + text + &quot;] to target class [&quot; + targetClass.getName() + &quot;]&quot;);</span>
		}
	}

	/**
	 * Parse the given text into a number instance of the given target class, using
	 * the given NumberFormat. Trims the input &lt;code&gt;String&lt;/code&gt; before attempting
	 * to parse the number.
	 *
	 * @param text         the text to convert
	 * @param targetClass  the target class to parse into
	 * @param numberFormat the NumberFormat to use for parsing (if
	 *                     &lt;code&gt;null&lt;/code&gt;, this method falls back to
	 *                     &lt;code&gt;parseNumber(String, Class)&lt;/code&gt;)
	 * @return the parsed number
	 * @throws IllegalArgumentException if the target class is not supported (i.e.
	 *                                  not a standard Number subclass as included
	 *                                  in the JDK)
	 * @see java.text.NumberFormat#parse
	 * @see #convertNumberToTargetClass
	 * @see #parseNumber(String,Class)
	 */
	public static Number parseNumber(String text, Class targetClass, NumberFormat numberFormat) {
<span class="nc bnc" id="L154" title="All 2 branches missed.">		if (numberFormat != null) {</span>
			try {
<span class="nc" id="L156">				Number number = numberFormat.parse(text.trim());</span>
<span class="nc" id="L157">				return convertNumberToTargetClass(number, targetClass);</span>
<span class="nc" id="L158">			} catch (ParseException ex) {</span>
<span class="nc" id="L159">				throw new IllegalArgumentException(ex.getMessage());</span>
			}
		} else {
<span class="nc" id="L162">			return parseNumber(text, targetClass);</span>
		}
	}

	/**
	 * Decode a {@link java.math.BigInteger} from a {@link String} value. Supports
	 * decimal, hex and octal notation.
	 *
	 * @see BigInteger#BigInteger(String,int)
	 */
	private static BigInteger decodeBigInteger(String value) {
<span class="nc" id="L173">		int radix = 10;</span>
<span class="nc" id="L174">		int index = 0;</span>
<span class="nc" id="L175">		boolean negative = false;</span>

		// Handle minus sign, if present.
<span class="nc bnc" id="L178" title="All 2 branches missed.">		if (value.startsWith(&quot;-&quot;)) {</span>
<span class="nc" id="L179">			negative = true;</span>
<span class="nc" id="L180">			index++;</span>
		}

		// Handle radix specifier, if present.
<span class="nc bnc" id="L184" title="All 4 branches missed.">		if (value.startsWith(&quot;0x&quot;, index) || value.startsWith(&quot;0X&quot;, index)) {</span>
<span class="nc" id="L185">			index += 2;</span>
<span class="nc" id="L186">			radix = 16;</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">		} else if (value.startsWith(&quot;#&quot;, index)) {</span>
<span class="nc" id="L188">			index++;</span>
<span class="nc" id="L189">			radix = 16;</span>
<span class="nc bnc" id="L190" title="All 4 branches missed.">		} else if (value.startsWith(&quot;0&quot;, index) &amp;&amp; value.length() &gt; 1 + index) {</span>
<span class="nc" id="L191">			index++;</span>
<span class="nc" id="L192">			radix = 8;</span>
		}

<span class="nc" id="L195">		BigInteger result = new BigInteger(value.substring(index), radix);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">		return (negative ? result.negate() : result);</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>