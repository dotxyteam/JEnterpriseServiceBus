<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>EncapsulatedObjectFactory.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">reflection-ui</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">xy.reflect.ui.info.type.factory</a> &gt; <span class="el_source">EncapsulatedObjectFactory.java</span></div><h1>EncapsulatedObjectFactory.java</h1><pre class="source lang-java linenums">
package xy.reflect.ui.info.type.factory;

import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import xy.reflect.ui.ReflectionUI;
import xy.reflect.ui.info.AbstractInfo;
import xy.reflect.ui.info.ColorSpecification;
import xy.reflect.ui.info.ITransaction;
import xy.reflect.ui.info.InfoCategory;
import xy.reflect.ui.info.ResourcePath;
import xy.reflect.ui.info.ValidationSession;
import xy.reflect.ui.info.ValueReturnMode;
import xy.reflect.ui.info.field.IFieldInfo;
import xy.reflect.ui.info.filter.IInfoFilter;
import xy.reflect.ui.info.menu.MenuModel;
import xy.reflect.ui.info.method.IMethodInfo;
import xy.reflect.ui.info.method.InvocationData;
import xy.reflect.ui.info.method.MethodInfoProxy;
import xy.reflect.ui.info.type.ITypeInfo;
import xy.reflect.ui.info.type.ITypeInfo.IValidationJob;
import xy.reflect.ui.info.type.source.ITypeInfoSource;
import xy.reflect.ui.info.type.source.PrecomputedTypeInfoSource;
import xy.reflect.ui.info.type.source.SpecificitiesIdentifier;
import xy.reflect.ui.info.type.source.TypeInfoSourceProxy;
import xy.reflect.ui.util.Accessor;
import xy.reflect.ui.util.ArrayAccessor;
import xy.reflect.ui.util.IDerivedInstance;
import xy.reflect.ui.util.PrecomputedTypeInstanceWrapper;
import xy.reflect.ui.util.ReflectionUIError;
import xy.reflect.ui.util.ReflectionUIUtils;

/**
 * Factory that generates through {@link #getInstance(Accessor)} or
 * {@link #getInstance(Object[])} virtual objects that encapsulate the provided
 * objects. It also generates the virtual object type information.
 * 
 * @author olitank
 *
 */
public class EncapsulatedObjectFactory {

<span class="fc" id="L48">	public static final String ENCAPSULATION_STATUS_PROPERTY_KEY = EncapsulatedObjectFactory.class.getName()</span>
<span class="fc" id="L49">			+ &quot;.IS_ENCAPSULATION_FIELD&quot;;</span>

	protected ReflectionUI reflectionUI;

	protected String typeName;
<span class="fc" id="L54">	protected String typeCaption = &quot;&quot;;</span>
	protected ResourcePath typeIconImagePath;
<span class="fc" id="L56">	protected Map&lt;String, Object&gt; typeSpecificProperties = new HashMap&lt;String, Object&gt;();</span>
<span class="fc" id="L57">	protected boolean typeModificationStackAccessible = true;</span>
	protected String typeOnlineHelp;

<span class="fc" id="L60">	protected String fieldName = &quot;&quot;;</span>
	protected ITypeInfo fieldType;
<span class="fc" id="L62">	protected String fieldCaption = &quot;&quot;;</span>
<span class="fc" id="L63">	protected boolean fieldGetOnly = false;</span>
<span class="fc" id="L64">	protected boolean fieldTransient = false;</span>
<span class="fc" id="L65">	protected boolean fieldNullValueDistinct = false;</span>
<span class="fc" id="L66">	protected ValueReturnMode fieldValueReturnMode = ValueReturnMode.INDETERMINATE;</span>
<span class="fc" id="L67">	protected Map&lt;String, Object&gt; fieldSpecificProperties = new HashMap&lt;String, Object&gt;();</span>
	protected String fieldNullValueLabel;
	protected String fieldOnlineHelp;
	protected InfoCategory fieldCategory;
<span class="fc" id="L71">	protected long fieldAutoUpdatePeriodMilliseconds = -1;</span>
<span class="fc" id="L72">	protected boolean fieldFormControlMandatory = false;</span>
<span class="fc" id="L73">	protected boolean fieldFormControlEmbedded = false;</span>
<span class="fc" id="L74">	protected boolean fieldValueValidityDetectionEnabled = false;</span>
<span class="fc" id="L75">	protected IInfoFilter fieldFormControlFilter = IInfoFilter.DEFAULT;</span>
	protected IInfoProxyFactory fieldTypeSpecificities;

<span class="fc" id="L78">	public EncapsulatedObjectFactory(ReflectionUI reflectionUI, String typeName, ITypeInfo fieldType) {</span>
<span class="fc" id="L79">		this.reflectionUI = reflectionUI;</span>
<span class="fc" id="L80">		this.typeName = typeName;</span>
<span class="fc" id="L81">		this.fieldType = fieldType;</span>
<span class="fc" id="L82">	}</span>

	public EncapsulatedObjectFactory(ReflectionUI reflectionUI, ITypeInfo fieldType, String contextId,
			String typeCaption, String fieldCaption) {
<span class="fc" id="L86">		this(reflectionUI, &quot;Encapsulation [context=&quot; + contextId + &quot;, fieldType=&quot; + fieldType.getName() + &quot;]&quot;,</span>
<span class="fc" id="L87">				fieldType);</span>
<span class="fc" id="L88">		this.fieldCaption = fieldCaption;</span>
<span class="fc" id="L89">		this.typeCaption = typeCaption;</span>
<span class="fc" id="L90">	}</span>

	public Object getInstance(Accessor&lt;Object&gt; fieldValueAccessor) {
<span class="fc" id="L93">		return new PrecomputedTypeInstanceWrapper(new Instance(fieldValueAccessor), new TypeInfo());</span>
	}

	public Object getInstance(Object[] fieldValueHolder) {
<span class="fc" id="L97">		return getInstance(new ArrayAccessor&lt;Object&gt;(fieldValueHolder));</span>
	}

	public String getTypeName() {
<span class="nc" id="L101">		return typeName;</span>
	}

	public void setTypeName(String typeName) {
<span class="nc" id="L105">		this.typeName = typeName;</span>
<span class="nc" id="L106">	}</span>

	public String getTypeCaption() {
<span class="nc" id="L109">		return typeCaption;</span>
	}

	public void setTypeCaption(String typeCaption) {
<span class="fc" id="L113">		this.typeCaption = typeCaption;</span>
<span class="fc" id="L114">	}</span>

	public ResourcePath getTypeIconImagePath() {
<span class="nc" id="L117">		return typeIconImagePath;</span>
	}

	public void setTypeIconImagePath(ResourcePath typeIconImagePath) {
<span class="fc" id="L121">		this.typeIconImagePath = typeIconImagePath;</span>
<span class="fc" id="L122">	}</span>

	public boolean isTypeModificationStackAccessible() {
<span class="nc" id="L125">		return typeModificationStackAccessible;</span>
	}

	public void setTypeModificationStackAccessible(boolean modificationStackAccessible) {
<span class="fc" id="L129">		this.typeModificationStackAccessible = modificationStackAccessible;</span>
<span class="fc" id="L130">	}</span>

	public String getTypeOnlineHelp() {
<span class="nc" id="L133">		return typeOnlineHelp;</span>
	}

	public void setTypeOnlineHelp(String typeOnlineHelp) {
<span class="fc" id="L137">		this.typeOnlineHelp = typeOnlineHelp;</span>
<span class="fc" id="L138">	}</span>

	public Map&lt;String, Object&gt; getTypeSpecificProperties() {
<span class="nc" id="L141">		return typeSpecificProperties;</span>
	}

	public void setTypeSpecificProperties(Map&lt;String, Object&gt; typeSpecificProperties) {
<span class="nc" id="L145">		this.typeSpecificProperties = typeSpecificProperties;</span>
<span class="nc" id="L146">	}</span>

	public String getFieldName() {
<span class="nc" id="L149">		return fieldName;</span>
	}

	public void setFieldName(String fieldName) {
<span class="fc" id="L153">		this.fieldName = fieldName;</span>
<span class="fc" id="L154">	}</span>

	public String getFieldCaption() {
<span class="nc" id="L157">		return fieldCaption;</span>
	}

	public void setFieldCaption(String fieldCaption) {
<span class="fc" id="L161">		this.fieldCaption = fieldCaption;</span>
<span class="fc" id="L162">	}</span>

	public boolean isFieldGetOnly() {
<span class="nc" id="L165">		return fieldGetOnly;</span>
	}

	public void setFieldGetOnly(boolean fieldGetOnly) {
<span class="fc" id="L169">		this.fieldGetOnly = fieldGetOnly;</span>
<span class="fc" id="L170">	}</span>

	public boolean isFieldNullValueDistinct() {
<span class="nc" id="L173">		return fieldNullValueDistinct;</span>
	}

	public void setFieldNullValueDistinct(boolean fieldNullValueDistinct) {
<span class="fc" id="L177">		this.fieldNullValueDistinct = fieldNullValueDistinct;</span>
<span class="fc" id="L178">	}</span>

	public String getFieldNullValueLabel() {
<span class="nc" id="L181">		return fieldNullValueLabel;</span>
	}

	public void setFieldNullValueLabel(String fieldNullValueLabel) {
<span class="nc" id="L185">		this.fieldNullValueLabel = fieldNullValueLabel;</span>
<span class="nc" id="L186">	}</span>

	public String getFieldOnlineHelp() {
<span class="nc" id="L189">		return fieldOnlineHelp;</span>
	}

	public void setFieldOnlineHelp(String fieldOnlineHelp) {
<span class="nc" id="L193">		this.fieldOnlineHelp = fieldOnlineHelp;</span>
<span class="nc" id="L194">	}</span>

	public InfoCategory getFieldCategory() {
<span class="nc" id="L197">		return fieldCategory;</span>
	}

	public void setFieldCategory(InfoCategory fieldCategory) {
<span class="nc" id="L201">		this.fieldCategory = fieldCategory;</span>
<span class="nc" id="L202">	}</span>

	public long getFieldAutoUpdatePeriodMilliseconds() {
<span class="nc" id="L205">		return fieldAutoUpdatePeriodMilliseconds;</span>
	}

	public void setFieldAutoUpdatePeriodMilliseconds(long fieldAutoUpdatePeriodMilliseconds) {
<span class="nc" id="L209">		this.fieldAutoUpdatePeriodMilliseconds = fieldAutoUpdatePeriodMilliseconds;</span>
<span class="nc" id="L210">	}</span>

	public ValueReturnMode getFieldValueReturnMode() {
<span class="nc" id="L213">		return fieldValueReturnMode;</span>
	}

	public void setFieldValueReturnMode(ValueReturnMode fieldValueReturnMode) {
<span class="fc" id="L217">		this.fieldValueReturnMode = fieldValueReturnMode;</span>
<span class="fc" id="L218">	}</span>

	public boolean isFieldFormControlMandatory() {
<span class="nc" id="L221">		return fieldFormControlMandatory;</span>
	}

	public void setFieldFormControlMandatory(boolean fieldFormControlMandatory) {
<span class="fc" id="L225">		this.fieldFormControlMandatory = fieldFormControlMandatory;</span>
<span class="fc" id="L226">	}</span>

	public boolean isFieldFormControlEmbedded() {
<span class="nc" id="L229">		return fieldFormControlEmbedded;</span>
	}

	public void setFieldFormControlEmbedded(boolean fieldFormControlEmbedded) {
<span class="fc" id="L233">		this.fieldFormControlEmbedded = fieldFormControlEmbedded;</span>
<span class="fc" id="L234">	}</span>

	public boolean isFieldValueValidityDetectionEnabled() {
<span class="nc" id="L237">		return fieldValueValidityDetectionEnabled;</span>
	}

	public void setFieldValueValidityDetectionEnabled(boolean fieldValueValidityDetectionEnabled) {
<span class="fc" id="L241">		this.fieldValueValidityDetectionEnabled = fieldValueValidityDetectionEnabled;</span>
<span class="fc" id="L242">	}</span>

	public IInfoFilter getFieldFormControlFilter() {
<span class="nc" id="L245">		return fieldFormControlFilter;</span>
	}

	public void setFieldFormControlFilter(IInfoFilter fieldFormControlFilter) {
<span class="fc" id="L249">		this.fieldFormControlFilter = fieldFormControlFilter;</span>
<span class="fc" id="L250">	}</span>

	public Map&lt;String, Object&gt; getFieldSpecificProperties() {
<span class="nc" id="L253">		return fieldSpecificProperties;</span>
	}

	public void setFieldSpecificProperties(Map&lt;String, Object&gt; fieldSpecificProperties) {
<span class="fc" id="L257">		this.fieldSpecificProperties = fieldSpecificProperties;</span>
<span class="fc" id="L258">	}</span>

	public IInfoProxyFactory getFieldTypeSpecificities() {
<span class="nc" id="L261">		return fieldTypeSpecificities;</span>
	}

	public void setFieldTypeSpecificities(IInfoProxyFactory fieldTypeSpecificities) {
<span class="nc" id="L265">		this.fieldTypeSpecificities = fieldTypeSpecificities;</span>
<span class="nc" id="L266">	}</span>

	public ITypeInfo getFieldType() {
<span class="nc" id="L269">		return fieldType;</span>
	}

	protected IFieldInfo createValueField() {
<span class="fc" id="L273">		return new ValueFieldInfo();</span>
	}

	protected boolean hasFieldValueOptions() {
<span class="fc" id="L277">		return false;</span>
	}

	protected Object[] getFieldValueOptions() {
<span class="nc" id="L281">		return null;</span>
	}

	protected Runnable getFieldCustomUndoUpdateJob(Object object, Object value) {
<span class="nc" id="L285">		return null;</span>
	}

	@Override
	public int hashCode() {
<span class="fc" id="L290">		final int prime = 31;</span>
<span class="fc" id="L291">		int result = 1;</span>
<span class="fc" id="L292">		result = prime * result</span>
<span class="fc" id="L293">				+ (int) (fieldAutoUpdatePeriodMilliseconds ^ (fieldAutoUpdatePeriodMilliseconds &gt;&gt;&gt; 32));</span>
<span class="pc bpc" id="L294" title="1 of 2 branches missed.">		result = prime * result + ((fieldCaption == null) ? 0 : fieldCaption.hashCode());</span>
<span class="pc bpc" id="L295" title="1 of 2 branches missed.">		result = prime * result + ((fieldCategory == null) ? 0 : fieldCategory.hashCode());</span>
<span class="fc bfc" id="L296" title="All 2 branches covered.">		result = prime * result + (fieldFormControlEmbedded ? 1231 : 1237);</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">		result = prime * result + (fieldValueValidityDetectionEnabled ? 1231 : 1237);</span>
<span class="pc bpc" id="L298" title="1 of 2 branches missed.">		result = prime * result + ((fieldFormControlFilter == null) ? 0 : fieldFormControlFilter.hashCode());</span>
<span class="fc bfc" id="L299" title="All 2 branches covered.">		result = prime * result + (fieldFormControlMandatory ? 1231 : 1237);</span>
<span class="fc bfc" id="L300" title="All 2 branches covered.">		result = prime * result + (fieldGetOnly ? 1231 : 1237);</span>
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">		result = prime * result + ((fieldName == null) ? 0 : fieldName.hashCode());</span>
<span class="pc bpc" id="L302" title="1 of 2 branches missed.">		result = prime * result + (fieldNullValueDistinct ? 1231 : 1237);</span>
<span class="pc bpc" id="L303" title="1 of 2 branches missed.">		result = prime * result + ((fieldNullValueLabel == null) ? 0 : fieldNullValueLabel.hashCode());</span>
<span class="pc bpc" id="L304" title="1 of 2 branches missed.">		result = prime * result + ((fieldOnlineHelp == null) ? 0 : fieldOnlineHelp.hashCode());</span>
<span class="pc bpc" id="L305" title="1 of 2 branches missed.">		result = prime * result + ((fieldSpecificProperties == null) ? 0 : fieldSpecificProperties.hashCode());</span>
<span class="pc bpc" id="L306" title="1 of 2 branches missed.">		result = prime * result + (fieldTransient ? 1231 : 1237);</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">		result = prime * result + ((fieldType == null) ? 0 : fieldType.hashCode());</span>
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">		result = prime * result + ((fieldTypeSpecificities == null) ? 0 : fieldTypeSpecificities.hashCode());</span>
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">		result = prime * result + ((fieldValueReturnMode == null) ? 0 : fieldValueReturnMode.hashCode());</span>
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">		result = prime * result + ((typeCaption == null) ? 0 : typeCaption.hashCode());</span>
<span class="fc bfc" id="L311" title="All 2 branches covered.">		result = prime * result + (typeModificationStackAccessible ? 1231 : 1237);</span>
<span class="pc bpc" id="L312" title="1 of 2 branches missed.">		result = prime * result + ((typeName == null) ? 0 : typeName.hashCode());</span>
<span class="pc bpc" id="L313" title="1 of 2 branches missed.">		result = prime * result + ((typeOnlineHelp == null) ? 0 : typeOnlineHelp.hashCode());</span>
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">		result = prime * result + ((typeSpecificProperties == null) ? 0 : typeSpecificProperties.hashCode());</span>
<span class="fc" id="L315">		return result;</span>
	}

	@Override
	public boolean equals(Object obj) {
<span class="fc bfc" id="L320" title="All 2 branches covered.">		if (this == obj)</span>
<span class="fc" id="L321">			return true;</span>
<span class="pc bpc" id="L322" title="1 of 2 branches missed.">		if (obj == null)</span>
<span class="nc" id="L323">			return false;</span>
<span class="pc bpc" id="L324" title="1 of 2 branches missed.">		if (getClass() != obj.getClass())</span>
<span class="nc" id="L325">			return false;</span>
<span class="fc" id="L326">		EncapsulatedObjectFactory other = (EncapsulatedObjectFactory) obj;</span>
<span class="pc bpc" id="L327" title="1 of 2 branches missed.">		if (fieldAutoUpdatePeriodMilliseconds != other.fieldAutoUpdatePeriodMilliseconds)</span>
<span class="nc" id="L328">			return false;</span>
<span class="pc bpc" id="L329" title="1 of 2 branches missed.">		if (fieldCaption == null) {</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">			if (other.fieldCaption != null)</span>
<span class="nc" id="L331">				return false;</span>
<span class="pc bpc" id="L332" title="1 of 2 branches missed.">		} else if (!fieldCaption.equals(other.fieldCaption))</span>
<span class="nc" id="L333">			return false;</span>
<span class="pc bpc" id="L334" title="1 of 2 branches missed.">		if (fieldCategory == null) {</span>
<span class="pc bpc" id="L335" title="1 of 2 branches missed.">			if (other.fieldCategory != null)</span>
<span class="nc" id="L336">				return false;</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">		} else if (!fieldCategory.equals(other.fieldCategory))</span>
<span class="nc" id="L338">			return false;</span>
<span class="pc bpc" id="L339" title="1 of 2 branches missed.">		if (fieldFormControlEmbedded != other.fieldFormControlEmbedded)</span>
<span class="nc" id="L340">			return false;</span>
<span class="pc bpc" id="L341" title="1 of 2 branches missed.">		if (fieldValueValidityDetectionEnabled != other.fieldValueValidityDetectionEnabled)</span>
<span class="nc" id="L342">			return false;</span>
<span class="pc bpc" id="L343" title="1 of 2 branches missed.">		if (fieldFormControlFilter == null) {</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">			if (other.fieldFormControlFilter != null)</span>
<span class="nc" id="L345">				return false;</span>
<span class="pc bpc" id="L346" title="1 of 2 branches missed.">		} else if (!fieldFormControlFilter.equals(other.fieldFormControlFilter))</span>
<span class="nc" id="L347">			return false;</span>
<span class="pc bpc" id="L348" title="1 of 2 branches missed.">		if (fieldFormControlMandatory != other.fieldFormControlMandatory)</span>
<span class="nc" id="L349">			return false;</span>
<span class="pc bpc" id="L350" title="1 of 2 branches missed.">		if (fieldGetOnly != other.fieldGetOnly)</span>
<span class="nc" id="L351">			return false;</span>
<span class="pc bpc" id="L352" title="1 of 2 branches missed.">		if (fieldName == null) {</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">			if (other.fieldName != null)</span>
<span class="nc" id="L354">				return false;</span>
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">		} else if (!fieldName.equals(other.fieldName))</span>
<span class="nc" id="L356">			return false;</span>
<span class="pc bpc" id="L357" title="1 of 2 branches missed.">		if (fieldNullValueDistinct != other.fieldNullValueDistinct)</span>
<span class="nc" id="L358">			return false;</span>
<span class="pc bpc" id="L359" title="1 of 2 branches missed.">		if (fieldNullValueLabel == null) {</span>
<span class="pc bpc" id="L360" title="1 of 2 branches missed.">			if (other.fieldNullValueLabel != null)</span>
<span class="nc" id="L361">				return false;</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">		} else if (!fieldNullValueLabel.equals(other.fieldNullValueLabel))</span>
<span class="nc" id="L363">			return false;</span>
<span class="pc bpc" id="L364" title="1 of 2 branches missed.">		if (fieldOnlineHelp == null) {</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">			if (other.fieldOnlineHelp != null)</span>
<span class="nc" id="L366">				return false;</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">		} else if (!fieldOnlineHelp.equals(other.fieldOnlineHelp))</span>
<span class="nc" id="L368">			return false;</span>
<span class="pc bpc" id="L369" title="1 of 2 branches missed.">		if (fieldSpecificProperties == null) {</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">			if (other.fieldSpecificProperties != null)</span>
<span class="nc" id="L371">				return false;</span>
<span class="pc bpc" id="L372" title="1 of 2 branches missed.">		} else if (!fieldSpecificProperties.equals(other.fieldSpecificProperties))</span>
<span class="nc" id="L373">			return false;</span>
<span class="pc bpc" id="L374" title="1 of 2 branches missed.">		if (fieldTransient != other.fieldTransient)</span>
<span class="nc" id="L375">			return false;</span>
<span class="pc bpc" id="L376" title="1 of 2 branches missed.">		if (fieldType == null) {</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">			if (other.fieldType != null)</span>
<span class="nc" id="L378">				return false;</span>
<span class="pc bpc" id="L379" title="1 of 2 branches missed.">		} else if (!fieldType.equals(other.fieldType))</span>
<span class="nc" id="L380">			return false;</span>
<span class="pc bpc" id="L381" title="1 of 2 branches missed.">		if (fieldTypeSpecificities == null) {</span>
<span class="pc bpc" id="L382" title="1 of 2 branches missed.">			if (other.fieldTypeSpecificities != null)</span>
<span class="nc" id="L383">				return false;</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">		} else if (!fieldTypeSpecificities.equals(other.fieldTypeSpecificities))</span>
<span class="nc" id="L385">			return false;</span>
<span class="pc bpc" id="L386" title="1 of 2 branches missed.">		if (fieldValueReturnMode != other.fieldValueReturnMode)</span>
<span class="nc" id="L387">			return false;</span>
<span class="pc bpc" id="L388" title="1 of 2 branches missed.">		if (typeCaption == null) {</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">			if (other.typeCaption != null)</span>
<span class="nc" id="L390">				return false;</span>
<span class="pc bpc" id="L391" title="1 of 2 branches missed.">		} else if (!typeCaption.equals(other.typeCaption))</span>
<span class="nc" id="L392">			return false;</span>
<span class="pc bpc" id="L393" title="1 of 2 branches missed.">		if (typeModificationStackAccessible != other.typeModificationStackAccessible)</span>
<span class="nc" id="L394">			return false;</span>
<span class="pc bpc" id="L395" title="1 of 2 branches missed.">		if (typeName == null) {</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">			if (other.typeName != null)</span>
<span class="nc" id="L397">				return false;</span>
<span class="pc bpc" id="L398" title="1 of 2 branches missed.">		} else if (!typeName.equals(other.typeName))</span>
<span class="nc" id="L399">			return false;</span>
<span class="pc bpc" id="L400" title="1 of 2 branches missed.">		if (typeOnlineHelp == null) {</span>
<span class="pc bpc" id="L401" title="1 of 2 branches missed.">			if (other.typeOnlineHelp != null)</span>
<span class="nc" id="L402">				return false;</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">		} else if (!typeOnlineHelp.equals(other.typeOnlineHelp))</span>
<span class="nc" id="L404">			return false;</span>
<span class="pc bpc" id="L405" title="1 of 2 branches missed.">		if (typeSpecificProperties == null) {</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">			if (other.typeSpecificProperties != null)</span>
<span class="nc" id="L407">				return false;</span>
<span class="pc bpc" id="L408" title="1 of 2 branches missed.">		} else if (!typeSpecificProperties.equals(other.typeSpecificProperties))</span>
<span class="nc" id="L409">			return false;</span>
<span class="fc" id="L410">		return true;</span>
	}

	@Override
	public String toString() {
<span class="fc" id="L415">		return EncapsulatedObjectFactory.class.getSimpleName() + &quot; [typeCaption=&quot; + typeCaption + &quot;, fieldType=&quot;</span>
<span class="fc" id="L416">				+ fieldType + &quot;, fieldCaption=&quot; + fieldCaption + &quot;]&quot;;</span>
	}

<span class="fc" id="L419">	public class TypeInfo extends AbstractInfo implements ITypeInfo {</span>

		protected IFieldInfo valueField;
		protected List&lt;IMethodInfo&gt; constructors;

		@Override
		public ITypeInfo getParent() {
<span class="nc" id="L426">			return null;</span>
		}

		@Override
		public ITypeInfoSource getSource() {
<span class="fc" id="L431">			return new PrecomputedTypeInfoSource(TypeInfo.this, null);</span>
		}

		@Override
		public boolean isValidationRequired() {
<span class="fc" id="L436">			return false;</span>
		}

		@Override
		public ITransaction createTransaction(Object object) {
<span class="fc" id="L441">			return null;</span>
		}

		@Override
		public void onFormRefresh(Object object) {
<span class="fc" id="L446">		}</span>

		@Override
		public Runnable getLastFormRefreshStateRestorationJob(Object object) {
<span class="fc" id="L450">			return null;</span>
		}

		@Override
		public CategoriesStyle getCategoriesStyle() {
<span class="nc" id="L455">			return CategoriesStyle.getDefault(reflectionUI, reflectionUI.getTypeInfo(getSource()));</span>
		}

		@Override
		public ResourcePath getFormBackgroundImagePath() {
<span class="fc" id="L460">			return null;</span>
		}

		@Override
		public ColorSpecification getFormBackgroundColor() {
<span class="fc" id="L465">			return null;</span>
		}

		@Override
		public ColorSpecification getFormForegroundColor() {
<span class="fc" id="L470">			return null;</span>
		}

		@Override
		public ColorSpecification getFormBorderColor() {
<span class="fc" id="L475">			return null;</span>
		}

		@Override
		public ColorSpecification getFormButtonBackgroundColor() {
<span class="fc" id="L480">			return null;</span>
		}

		@Override
		public ColorSpecification getFormButtonForegroundColor() {
<span class="fc" id="L485">			return null;</span>
		}

		@Override
		public ResourcePath getFormButtonBackgroundImagePath() {
<span class="fc" id="L490">			return null;</span>
		}

		@Override
		public ColorSpecification getFormButtonBorderColor() {
<span class="fc" id="L495">			return null;</span>
		}

		@Override
		public ColorSpecification getCategoriesBackgroundColor() {
<span class="nc" id="L500">			return null;</span>
		}

		@Override
		public ColorSpecification getCategoriesForegroundColor() {
<span class="nc" id="L505">			return null;</span>
		}

		@Override
		public ColorSpecification getFormEditorForegroundColor() {
<span class="fc" id="L510">			return null;</span>
		}

		@Override
		public ColorSpecification getFormEditorBackgroundColor() {
<span class="fc" id="L515">			return null;</span>
		}

		@Override
		public int getFormPreferredWidth() {
<span class="fc" id="L520">			return -1;</span>
		}

		@Override
		public int getFormPreferredHeight() {
<span class="fc" id="L525">			return -1;</span>
		}

		@Override
		public int getFormSpacing() {
<span class="fc" id="L530">			return ITypeInfo.DEFAULT_FORM_SPACING;</span>
		}

		@Override
		public void onFormVisibilityChange(Object object, boolean visible) {
<span class="fc" id="L535">		}</span>

		@Override
		public void onFormCreation(Object object, boolean beforeOrAFter) {
<span class="fc" id="L539">		}</span>

		@Override
		public boolean canPersist() {
<span class="nc" id="L543">			return false;</span>
		}

		@Override
		public void save(Object object, File outputFile) {
<span class="nc" id="L548">			throw new UnsupportedOperationException();</span>
		}

		@Override
		public void load(Object object, File inputFile) {
<span class="nc" id="L553">			throw new UnsupportedOperationException();</span>
		}

		@Override
		public String getName() {
<span class="fc" id="L558">			return typeName;</span>
		}

		@Override
		public String getCaption() {
<span class="fc" id="L563">			return typeCaption;</span>
		}

		@Override
		public FieldsLayout getFieldsLayout() {
<span class="fc" id="L568">			return FieldsLayout.VERTICAL_FLOW;</span>
		}

		@Override
		public MethodsLayout getMethodsLayout() {
<span class="nc" id="L573">			return MethodsLayout.HORIZONTAL_FLOW;</span>
		}

		@Override
		public MenuModel getMenuModel() {
<span class="fc" id="L578">			return new MenuModel();</span>
		}

		@Override
		public ResourcePath getIconImagePath(Object object) {
<span class="fc" id="L583">			return typeIconImagePath;</span>
		}

		@Override
		public String getOnlineHelp() {
<span class="fc" id="L588">			return typeOnlineHelp;</span>
		}

		@Override
		public Map&lt;String, Object&gt; getSpecificProperties() {
<span class="fc" id="L593">			return typeSpecificProperties;</span>
		}

		@Override
		public boolean isPrimitive() {
<span class="nc" id="L598">			return false;</span>
		}

		@Override
		public boolean isImmutable() {
<span class="nc" id="L603">			return false;</span>
		}

		@Override
		public boolean isConcrete() {
<span class="fc" id="L608">			return fieldType.isConcrete();</span>
		}

		@Override
		public boolean isModificationStackAccessible() {
<span class="fc" id="L613">			return typeModificationStackAccessible;</span>
		}

		@Override
		public List&lt;IMethodInfo&gt; getConstructors() {
<span class="pc bpc" id="L618" title="1 of 2 branches missed.">			if (constructors == null) {</span>
<span class="fc" id="L619">				constructors = new ArrayList&lt;IMethodInfo&gt;();</span>
<span class="fc bfc" id="L620" title="All 2 branches covered.">				for (IMethodInfo ctor : fieldType.getConstructors()) {</span>
<span class="fc" id="L621">					constructors.add(new MethodInfoProxy(ctor) {</span>

						@Override
						public Object invoke(Object ignore, InvocationData invocationData) {
<span class="nc" id="L625">							return getInstance(Accessor.returning(super.invoke(ignore, invocationData), true));</span>
						}

						@Override
						public ITypeInfo getReturnValueType() {
<span class="fc" id="L630">							return reflectionUI.getTypeInfo(TypeInfo.this.getSource());</span>
						}

						@Override
						public String getSignature() {
<span class="fc" id="L635">							return ReflectionUIUtils.buildMethodSignature(this);</span>
						}

					});
				}
			}
<span class="fc" id="L641">			return constructors;</span>
		}

		@Override
		public List&lt;IFieldInfo&gt; getFields() {
<span class="pc bpc" id="L646" title="1 of 2 branches missed.">			if (valueField == null) {</span>
<span class="fc" id="L647">				valueField = createValueField();</span>
			}
<span class="fc" id="L649">			return Collections.&lt;IFieldInfo&gt;singletonList(valueField);</span>
		}

		@Override
		public List&lt;IMethodInfo&gt; getMethods() {
<span class="fc" id="L654">			return Collections.emptyList();</span>
		}

		@Override
		public boolean supports(Object object) {
<span class="pc bpc" id="L659" title="1 of 2 branches missed.">			if (!(object instanceof Instance)) {</span>
<span class="nc" id="L660">				return false;</span>
			}
<span class="pc bpc" id="L662" title="1 of 2 branches missed.">			if (!getFactory().equals(((Instance) object).getFactory())) {</span>
<span class="nc" id="L663">				return false;</span>
			}
<span class="fc" id="L665">			return true;</span>
		}

		@Override
		public List&lt;ITypeInfo&gt; getPolymorphicInstanceSubTypes() {
<span class="nc" id="L670">			return Collections.emptyList();</span>
		}

		@Override
		public boolean isPolymorphicInstanceAbstractTypeOptionAllowed() {
<span class="fc" id="L675">			return false;</span>
		}

		@Override
		public boolean canCopy(Object object) {
<span class="nc" id="L680">			Instance instance = (Instance) object;</span>
<span class="nc" id="L681">			return ReflectionUIUtils.canCopy(reflectionUI, instance.getValue());</span>
		}

		@Override
		public Object copy(Object object) {
<span class="nc" id="L686">			Instance instance = (Instance) object;</span>
<span class="nc" id="L687">			Object instanceValueCopy = ReflectionUIUtils.copy(reflectionUI, instance.getValue());</span>
<span class="nc" id="L688">			return getInstance(new Object[] { instanceValueCopy });</span>
		}

		@Override
		public void validate(Object object, ValidationSession session) throws Exception {
<span class="fc" id="L693">		}</span>

		public EncapsulatedObjectFactory getFactory() {
<span class="fc" id="L696">			return EncapsulatedObjectFactory.this;</span>
		}

		@Override
		public String toString(Object object) {
<span class="nc" id="L701">			Instance instance = (Instance) object;</span>
<span class="nc" id="L702">			return ReflectionUIUtils.toString(reflectionUI, instance.getValue());</span>
		}

		@Override
		public int hashCode() {
<span class="fc" id="L707">			final int prime = 31;</span>
<span class="fc" id="L708">			int result = 1;</span>
<span class="fc" id="L709">			result = prime * result + getFactory().hashCode();</span>
<span class="fc" id="L710">			return result;</span>
		}

		@Override
		public boolean equals(Object obj) {
<span class="fc bfc" id="L715" title="All 2 branches covered.">			if (this == obj)</span>
<span class="fc" id="L716">				return true;</span>
<span class="pc bpc" id="L717" title="1 of 2 branches missed.">			if (obj == null)</span>
<span class="nc" id="L718">				return false;</span>
<span class="pc bpc" id="L719" title="1 of 2 branches missed.">			if (getClass() != obj.getClass())</span>
<span class="nc" id="L720">				return false;</span>
<span class="fc" id="L721">			TypeInfo other = (TypeInfo) obj;</span>
<span class="pc bpc" id="L722" title="1 of 2 branches missed.">			if (!getFactory().equals(other.getFactory()))</span>
<span class="nc" id="L723">				return false;</span>
<span class="fc" id="L724">			return true;</span>
		}

		@Override
		public String toString() {
<span class="fc" id="L729">			return &quot;TypeInfo [of=&quot; + getFactory() + &quot;]&quot;;</span>
		}

	}

	public class Instance implements IDerivedInstance {
		protected Accessor&lt;Object&gt; fieldValueAccessor;

		public Instance(final Object[] fieldValueHolder) {
<span class="nc" id="L738">			this(new ArrayAccessor&lt;Object&gt;(fieldValueHolder));</span>
<span class="nc" id="L739">		}</span>

<span class="fc" id="L741">		public Instance(Accessor&lt;Object&gt; fieldValueAccessor) {</span>
<span class="fc" id="L742">			this.fieldValueAccessor = fieldValueAccessor;</span>
<span class="fc" id="L743">		}</span>

		@Override
		public Object getBaseInstance() {
			/**
			 * The fieldValueAccessor (not fieldValueAccessor.get())is returned because this
			 * instance is actually derived (can be recreated only) from the encapsulated
			 * value source, not from the value itself.
			 *
			 */
<span class="fc" id="L753">			return fieldValueAccessor;</span>
		}

		protected void checkValue(Object value) {
<span class="pc bpc" id="L757" title="2 of 4 branches missed.">			if ((value != null) &amp;&amp; !fieldType.supports(value)) {</span>
<span class="nc" id="L758">				throw new ReflectionUIError(&quot;Type '&quot; + fieldType.getName() + &quot;' does not support (&quot;</span>
<span class="nc" id="L759">						+ value.getClass().getName() + &quot;) value '&quot; + value + &quot;'&quot;);</span>
			}
<span class="fc" id="L761">		}</span>

		public Object getValue() {
<span class="fc" id="L764">			Object value = fieldValueAccessor.get();</span>
<span class="fc" id="L765">			checkValue(value);</span>
<span class="fc" id="L766">			return value;</span>
		}

		public void setValue(Object value) {
<span class="fc" id="L770">			checkValue(value);</span>
<span class="fc" id="L771">			fieldValueAccessor.set(value);</span>
<span class="fc" id="L772">		}</span>

		public EncapsulatedObjectFactory getFactory() {
<span class="fc" id="L775">			return EncapsulatedObjectFactory.this;</span>
		}

		@Override
		public int hashCode() {
<span class="fc" id="L780">			final int prime = 31;</span>
<span class="fc" id="L781">			int result = 1;</span>
<span class="fc" id="L782">			result = prime * result + getFactory().hashCode();</span>
<span class="pc bpc" id="L783" title="1 of 2 branches missed.">			result = prime * result + ((fieldValueAccessor == null) ? 0 : fieldValueAccessor.hashCode());</span>
<span class="fc" id="L784">			return result;</span>
		}

		@Override
		public boolean equals(Object obj) {
<span class="nc bnc" id="L789" title="All 2 branches missed.">			if (this == obj)</span>
<span class="nc" id="L790">				return true;</span>
<span class="nc bnc" id="L791" title="All 2 branches missed.">			if (obj == null)</span>
<span class="nc" id="L792">				return false;</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">			if (getClass() != obj.getClass())</span>
<span class="nc" id="L794">				return false;</span>
<span class="nc" id="L795">			Instance other = (Instance) obj;</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">			if (!getFactory().equals(other.getFactory()))</span>
<span class="nc" id="L797">				return false;</span>
<span class="nc bnc" id="L798" title="All 2 branches missed.">			if (fieldValueAccessor == null) {</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">				if (other.fieldValueAccessor != null)</span>
<span class="nc" id="L800">					return false;</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">			} else if (!fieldValueAccessor.equals(other.fieldValueAccessor))</span>
<span class="nc" id="L802">				return false;</span>
<span class="nc" id="L803">			return true;</span>
		}

		@Override
		public String toString() {
<span class="fc" id="L808">			return &quot;Encapsulated [fieldValueAccessor=&quot; + fieldValueAccessor + &quot;, factory=&quot; + getFactory() + &quot;]&quot;;</span>
		}

	}

<span class="fc" id="L813">	public class ValueFieldInfo extends AbstractInfo implements IFieldInfo {</span>

		@Override
		public String getName() {
<span class="fc" id="L817">			return fieldName;</span>
		}

		@Override
		public double getDisplayAreaHorizontalWeight() {
<span class="fc" id="L822">			return 1.0;</span>
		}

		@Override
		public double getDisplayAreaVerticalWeight() {
<span class="fc" id="L827">			return 0.0;</span>
		}

		@Override
		public boolean isDisplayAreaHorizontallyFilled() {
<span class="fc" id="L832">			return true;</span>
		}

		@Override
		public boolean isDisplayAreaVerticallyFilled() {
<span class="fc" id="L837">			return false;</span>
		}

		@Override
		public void onControlVisibilityChange(Object object, boolean visible) {
<span class="fc" id="L842">		}</span>

		@Override
		public boolean isHidden() {
<span class="fc" id="L846">			return false;</span>
		}

		@Override
		public boolean isRelevant(Object object) {
<span class="fc" id="L851">			return true;</span>
		}

		@Override
		public String getCaption() {
<span class="fc" id="L856">			return fieldCaption;</span>
		}

		@Override
		public void setValue(Object object, Object value) {
<span class="fc" id="L861">			Instance instance = (Instance) object;</span>
<span class="fc" id="L862">			instance.setValue(value);</span>
<span class="fc" id="L863">		}</span>

		@Override
		public boolean isGetOnly() {
<span class="fc" id="L867">			return fieldGetOnly;</span>
		}

		@Override
		public boolean isTransient() {
<span class="fc" id="L872">			return fieldTransient;</span>
		}

		@Override
		public boolean isNullValueDistinct() {
<span class="fc" id="L877">			return fieldNullValueDistinct;</span>
		}

		@Override
		public String getNullValueLabel() {
<span class="nc" id="L882">			return fieldNullValueLabel;</span>
		}

		@Override
		public boolean isFormControlMandatory() {
<span class="fc" id="L887">			return fieldFormControlMandatory;</span>
		}

		@Override
		public boolean isFormControlEmbedded() {
<span class="fc" id="L892">			return fieldFormControlEmbedded;</span>
		}

		@Override
		public boolean isControlValueValiditionEnabled() {
<span class="fc" id="L897">			return fieldValueValidityDetectionEnabled;</span>
		}

		@Override
		public IInfoFilter getFormControlFilter() {
<span class="fc" id="L902">			return fieldFormControlFilter;</span>
		}

		@Override
		public IValidationJob getValueAbstractFormValidationJob(Object object) {
<span class="nc" id="L907">			return null;</span>
		}

		@Override
		public Map&lt;String, Object&gt; getSpecificProperties() {
<span class="fc" id="L912">			Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(fieldSpecificProperties);</span>
<span class="fc" id="L913">			result.put(ENCAPSULATION_STATUS_PROPERTY_KEY, true);</span>
<span class="fc" id="L914">			return result;</span>
		}

		@Override
		public Object getValue(Object object) {
<span class="fc" id="L919">			Instance instance = (Instance) object;</span>
<span class="fc" id="L920">			return instance.getValue();</span>
		}

		@Override
		public ITypeInfo getType() {
<span class="fc" id="L925">			return reflectionUI.getTypeInfo(new TypeInfoSourceProxy(fieldType.getSource()) {</span>
				@Override
				public SpecificitiesIdentifier getSpecificitiesIdentifier() {
<span class="fc" id="L928">					return new SpecificitiesIdentifier(typeName, ValueFieldInfo.this.getName());</span>
				}

				@Override
				protected String getTypeInfoProxyFactoryIdentifier() {
<span class="fc" id="L933">					return &quot;FieldValueTypeInfoProxyFactory [of=&quot; + getClass().getName() + &quot;, objectType=&quot; + typeName</span>
<span class="fc" id="L934">							+ &quot;]&quot;;</span>
				}
			});
		}

		@Override
		public List&lt;IMethodInfo&gt; getAlternativeConstructors(Object object) {
<span class="fc" id="L941">			return null;</span>
		}

		@Override
		public List&lt;IMethodInfo&gt; getAlternativeListItemConstructors(Object object) {
<span class="fc" id="L946">			return null;</span>
		}

		@Override
		public String getOnlineHelp() {
<span class="fc" id="L951">			return fieldOnlineHelp;</span>
		}

		@Override
		public boolean hasValueOptions(Object object) {
<span class="fc" id="L956">			return hasFieldValueOptions();</span>
		}

		@Override
		public Object[] getValueOptions(Object object) {
<span class="nc" id="L961">			return getFieldValueOptions();</span>
		}

		@Override
		public Runnable getNextUpdateCustomUndoJob(Object object, Object value) {
<span class="fc" id="L966">			return null;</span>
		}

		@Override
		public Runnable getPreviousUpdateCustomRedoJob(Object object, Object newValue) {
<span class="nc" id="L971">			return null;</span>
		}

		@Override
		public ValueReturnMode getValueReturnMode() {
<span class="fc" id="L976">			return fieldValueReturnMode;</span>
		}

		@Override
		public InfoCategory getCategory() {
<span class="fc" id="L981">			return fieldCategory;</span>
		}

		@Override
		public long getAutoUpdatePeriodMilliseconds() {
<span class="fc" id="L986">			return fieldAutoUpdatePeriodMilliseconds;</span>
		}

		public EncapsulatedObjectFactory getFactory() {
<span class="fc" id="L990">			return EncapsulatedObjectFactory.this;</span>
		}

		@Override
		public int hashCode() {
<span class="nc" id="L995">			return getFactory().hashCode();</span>
		}

		@Override
		public boolean equals(Object obj) {
<span class="pc bpc" id="L1000" title="1 of 2 branches missed.">			if (!(obj instanceof ValueFieldInfo)) {</span>
<span class="nc" id="L1001">				return false;</span>
			}
<span class="fc" id="L1003">			ValueFieldInfo other = (ValueFieldInfo) obj;</span>
<span class="pc bpc" id="L1004" title="1 of 2 branches missed.">			if (!getFactory().equals(other.getFactory())) {</span>
<span class="nc" id="L1005">				return false;</span>
			}
<span class="fc" id="L1007">			return true;</span>
		}

		@Override
		public String toString() {
<span class="fc" id="L1012">			return &quot;ValueField [of=&quot; + getFactory() + &quot;]&quot;;</span>
		}

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>