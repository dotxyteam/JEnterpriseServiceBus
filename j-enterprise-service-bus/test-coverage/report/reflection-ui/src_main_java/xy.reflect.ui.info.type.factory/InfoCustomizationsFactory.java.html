<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>InfoCustomizationsFactory.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">reflection-ui</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">xy.reflect.ui.info.type.factory</a> &gt; <span class="el_source">InfoCustomizationsFactory.java</span></div><h1>InfoCustomizationsFactory.java</h1><pre class="source lang-java linenums">
package xy.reflect.ui.info.type.factory;

import java.awt.Dimension;
import java.io.File;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import xy.reflect.ui.ReflectionUI;
import xy.reflect.ui.info.ColorSpecification;
import xy.reflect.ui.info.ITransaction;
import xy.reflect.ui.info.InfoCategory;
import xy.reflect.ui.info.ResourcePath;
import xy.reflect.ui.info.ValidationSession;
import xy.reflect.ui.info.ValueReturnMode;
import xy.reflect.ui.info.app.IApplicationInfo;
import xy.reflect.ui.info.custom.InfoCustomizations;
import xy.reflect.ui.info.custom.InfoCustomizations.AbstractVirtualFieldDeclaration;
import xy.reflect.ui.info.custom.InfoCustomizations.ApplicationCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.CustomizationCategory;
import xy.reflect.ui.info.custom.InfoCustomizations.EnumerationCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.EnumerationItemCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.FieldCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.FieldTypeSpecificities;
import xy.reflect.ui.info.custom.InfoCustomizations.FormSizeCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.FormSizeUnit;
import xy.reflect.ui.info.custom.InfoCustomizations.ITypeInfoFinder;
import xy.reflect.ui.info.custom.InfoCustomizations.ImplicitListFieldDeclaration;
import xy.reflect.ui.info.custom.InfoCustomizations.ImportedFieldDeclaration;
import xy.reflect.ui.info.custom.InfoCustomizations.ImportedMethodDeclaration;
import xy.reflect.ui.info.custom.InfoCustomizations.ListCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.ListItemFieldShortcut;
import xy.reflect.ui.info.custom.InfoCustomizations.ListItemMethodShortcut;
import xy.reflect.ui.info.custom.InfoCustomizations.MethodCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.ParameterCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.TextualStorage;
import xy.reflect.ui.info.custom.InfoCustomizations.TransactionalRole;
import xy.reflect.ui.info.custom.InfoCustomizations.TreeStructureDiscoverySettings;
import xy.reflect.ui.info.custom.InfoCustomizations.TypeCustomization;
import xy.reflect.ui.info.custom.InfoCustomizations.VirtualFieldDeclaration;
import xy.reflect.ui.info.field.MembersCapsuleFieldInfo;
import xy.reflect.ui.info.field.ChangedTypeFieldInfo;
import xy.reflect.ui.info.field.DelegatingFieldInfo;
import xy.reflect.ui.info.field.ExportedNullStatusFieldInfo;
import xy.reflect.ui.info.field.FieldInfoProxy;
import xy.reflect.ui.info.field.GetterFieldInfo;
import xy.reflect.ui.info.field.HiddenFieldInfoProxy;
import xy.reflect.ui.info.field.IFieldInfo;
import xy.reflect.ui.info.field.ImplicitListFieldInfo;
import xy.reflect.ui.info.field.ImportedFieldInfo;
import xy.reflect.ui.info.field.ImportedNullStatusFieldInfo;
import xy.reflect.ui.info.field.MethodReturnValueAsFieldInfo;
import xy.reflect.ui.info.field.NullReplacementFieldInfo;
import xy.reflect.ui.info.field.ParameterAsFieldInfo;
import xy.reflect.ui.info.field.SubFieldInfo;
import xy.reflect.ui.info.field.ValueAsListFieldInfo;
import xy.reflect.ui.info.field.VirtualFieldInfo;
import xy.reflect.ui.info.filter.IInfoFilter;
import xy.reflect.ui.info.menu.IMenuElementInfo;
import xy.reflect.ui.info.menu.IMenuElementPosition;
import xy.reflect.ui.info.menu.MenuModel;
import xy.reflect.ui.info.menu.MethodActionMenuItemInfo;
import xy.reflect.ui.info.method.DefaultMethodInfo;
import xy.reflect.ui.info.method.FieldAsGetterInfo;
import xy.reflect.ui.info.method.FieldAsSetterInfo;
import xy.reflect.ui.info.method.HiddenMethodInfoProxy;
import xy.reflect.ui.info.method.IMethodInfo;
import xy.reflect.ui.info.method.ImportedMethodInfo;
import xy.reflect.ui.info.method.InvocationData;
import xy.reflect.ui.info.method.LoadFromFileMethod;
import xy.reflect.ui.info.method.MethodInfoProxy;
import xy.reflect.ui.info.method.ParameterizedFieldsMethodInfo;
import xy.reflect.ui.info.method.PresetInvocationDataMethodInfo;
import xy.reflect.ui.info.method.SaveToFileMethod;
import xy.reflect.ui.info.method.SubMethodInfo;
import xy.reflect.ui.info.parameter.IParameterInfo;
import xy.reflect.ui.info.parameter.ParameterInfoProxy;
import xy.reflect.ui.info.type.ITypeInfo;
import xy.reflect.ui.info.type.ITypeInfo.CategoriesStyle;
import xy.reflect.ui.info.type.ITypeInfo.FieldsLayout;
import xy.reflect.ui.info.type.ITypeInfo.MethodsLayout;
import xy.reflect.ui.info.type.enumeration.EnumerationItemInfoProxy;
import xy.reflect.ui.info.type.enumeration.IEnumerationItemInfo;
import xy.reflect.ui.info.type.enumeration.IEnumerationTypeInfo;
import xy.reflect.ui.info.type.iterable.IListTypeInfo;
import xy.reflect.ui.info.type.iterable.IListTypeInfo.ItemCreationMode;
import xy.reflect.ui.info.type.iterable.IListTypeInfo.ToolsLocation;
import xy.reflect.ui.info.type.iterable.item.IListItemDetailsAccessMode;
import xy.reflect.ui.info.type.iterable.item.ItemPosition;
import xy.reflect.ui.info.type.iterable.structure.CustomizedListStructuralInfo;
import xy.reflect.ui.info.type.iterable.structure.IListStructuralInfo;
import xy.reflect.ui.info.type.iterable.util.AbstractDynamicListAction;
import xy.reflect.ui.info.type.iterable.util.AbstractDynamicListProperty;
import xy.reflect.ui.info.type.iterable.util.IDynamicListAction;
import xy.reflect.ui.info.type.iterable.util.IDynamicListProperty;
import xy.reflect.ui.info.type.source.JavaTypeInfoSource;
import xy.reflect.ui.info.type.source.SpecificitiesIdentifier;
import xy.reflect.ui.info.type.source.TypeInfoSourceProxy;
import xy.reflect.ui.undo.ListModificationFactory;
import xy.reflect.ui.undo.ModificationStack;
import xy.reflect.ui.util.Filter;
import xy.reflect.ui.util.IOUtils;
import xy.reflect.ui.util.Mapper;
import xy.reflect.ui.util.MiscUtils;
import xy.reflect.ui.util.Pair;
import xy.reflect.ui.util.ReflectionUIError;
import xy.reflect.ui.util.ReflectionUIUtils;

/**
 * Factory that generates proxying and virtual type information objects
 * according to the given {@link InfoCustomizations} object.
 * 
 * @author olitank
 *
 */
public abstract class InfoCustomizationsFactory extends InfoProxyFactory {

<span class="fc" id="L125">	protected static final String ACTIVE_CUSTOMIZATIONS_KEY = InfoCustomizations.class.getName() + &quot;.active&quot;;</span>
<span class="fc" id="L126">	protected static final String ITEM_TYPE_CHANGED = InfoCustomizations.class.getName() + &quot;.itemTypeChanged&quot;;</span>
<span class="fc" id="L127">	protected static final String ORIGINAL_ITEM_TYPE = InfoCustomizations.class.getName() + &quot;.originalItemType&quot;;</span>

	protected ReflectionUI reflectionUI;
<span class="fc" id="L130">	protected Map&lt;Pair&lt;String, String&gt;, TypeInheritanceFactory&gt; typeInheritanceFactoryCache = new HashMap&lt;Pair&lt;String, String&gt;, TypeInheritanceFactory&gt;();</span>

	protected abstract InfoCustomizations accessInfoCustomizations();

	protected abstract IInfoProxyFactory getInfoCustomizationsSetupFactory();

	public abstract String getIdentifier();

<span class="fc" id="L138">	public InfoCustomizationsFactory(ReflectionUI reflectionUI) {</span>
<span class="fc" id="L139">		this.reflectionUI = reflectionUI;</span>
<span class="fc" id="L140">	}</span>

	public ReflectionUI getReflectionUI() {
<span class="nc" id="L143">		return reflectionUI;</span>
	}

	protected void traceActiveCustomizations(Map&lt;String, Object&gt; specificProperties) {
		@SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L148">		List&lt;InfoCustomizations&gt; trace = (List&lt;InfoCustomizations&gt;) specificProperties.get(ACTIVE_CUSTOMIZATIONS_KEY);</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">		if (trace == null) {</span>
<span class="fc" id="L150">			trace = new ArrayList&lt;InfoCustomizations&gt;();</span>
<span class="fc" id="L151">			specificProperties.put(ACTIVE_CUSTOMIZATIONS_KEY, trace);</span>
		}
<span class="fc" id="L153">		trace.add(accessInfoCustomizations());</span>
<span class="fc" id="L154">	}</span>

	public static boolean areCustomizationsActive(InfoCustomizations infoCustomizations,
			Map&lt;String, Object&gt; specificProperties) {
		@SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L159">		List&lt;InfoCustomizations&gt; trace = (List&lt;InfoCustomizations&gt;) specificProperties.get(ACTIVE_CUSTOMIZATIONS_KEY);</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">		if (trace == null) {</span>
<span class="nc" id="L161">			return false;</span>
		}
<span class="nc" id="L163">		return trace.contains(infoCustomizations);</span>
	}

	protected void traceListItemTypeChange(Map&lt;String, Object&gt; specificProperties, ITypeInfoFinder customItemTypeFinder,
			ITypeInfo itemType) {
<span class="nc" id="L168">		specificProperties.put(ITEM_TYPE_CHANGED + &quot;.&quot; + accessInfoCustomizations().toString(), Boolean.TRUE);</span>
<span class="nc" id="L169">		specificProperties.put(ORIGINAL_ITEM_TYPE + &quot;.&quot; + accessInfoCustomizations(), itemType);</span>
<span class="nc" id="L170">	}</span>

	public static boolean isItemTypeChanged(InfoCustomizations infoCustomizations,
			Map&lt;String, Object&gt; specificProperties) {
<span class="nc" id="L174">		return Boolean.TRUE.equals(specificProperties.get(ITEM_TYPE_CHANGED + &quot;.&quot; + infoCustomizations.toString()));</span>
	}

	public static ITypeInfo getOriginalItemType(InfoCustomizations infoCustomizations,
			Map&lt;String, Object&gt; specificProperties) {
<span class="nc" id="L179">		return (ITypeInfo) specificProperties.get(ORIGINAL_ITEM_TYPE + &quot;.&quot; + infoCustomizations);</span>
	}

	@Override
	public ITypeInfo wrapTypeInfo(ITypeInfo type) {
<span class="fc bfc" id="L184" title="All 2 branches covered.">		for (TypeCustomization tc : new ArrayList&lt;TypeCustomization&gt;(</span>
<span class="fc" id="L185">				accessInfoCustomizations().getTypeCustomizations())) {</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">			if (tc.getBaseTypeName() != null) {</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">				if (MiscUtils.containsWord(type.getName(), tc.getTypeName())) {</span>
<span class="fc" id="L188">					type = getTypeInheritanceFactory(tc.getTypeName(), tc.getBaseTypeName()).wrapTypeInfo(type);</span>
				}
			}
		}
<span class="fc" id="L192">		type = super.wrapTypeInfo(type);</span>
<span class="fc" id="L193">		SpecificitiesIdentifier specificitiesIdentifier = type.getSource().getSpecificitiesIdentifier();</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">		if (specificitiesIdentifier != null) {</span>
<span class="fc" id="L195">			type = getSpecificitiesFactory(specificitiesIdentifier).wrapTypeInfo(type);</span>
		}
<span class="fc" id="L197">		return type;</span>
	}

	@Override
	public ITypeInfo unwrapTypeInfo(ITypeInfo type) {
<span class="nc" id="L202">		SpecificitiesIdentifier specificitiesIdentifier = type.getSource().getSpecificitiesIdentifier();</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">		if (specificitiesIdentifier != null) {</span>
<span class="nc" id="L204">			type = getSpecificitiesFactory(specificitiesIdentifier).unwrapTypeInfo(type);</span>
		}
<span class="nc" id="L206">		type = super.unwrapTypeInfo(type);</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">		for (TypeCustomization tc : MiscUtils.getReverse(accessInfoCustomizations().getTypeCustomizations())) {</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">			if (tc.getBaseTypeName() != null) {</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">				if (MiscUtils.containsWord(type.getName(), tc.getTypeName())) {</span>
<span class="nc" id="L210">					type = getTypeInheritanceFactory(tc.getTypeName(), tc.getBaseTypeName()).unwrapTypeInfo(type);</span>
				}
			}
		}
<span class="nc" id="L214">		return type;</span>
	}

	protected IInfoProxyFactory getSpecificitiesFactory(final SpecificitiesIdentifier specificitiesIdentifier) {
<span class="fc" id="L218">		return new SpecificitiesFactory(specificitiesIdentifier);</span>
	}

	protected IInfoProxyFactory getTypeInheritanceFactory(String targetTypeName, String baseTypeName) {
<span class="fc" id="L222">		Pair&lt;String, String&gt; cacheKey = new Pair&lt;String, String&gt;(targetTypeName, baseTypeName);</span>
<span class="fc" id="L223">		TypeInheritanceFactory result = typeInheritanceFactoryCache.get(cacheKey);</span>
<span class="fc bfc" id="L224" title="All 2 branches covered.">		if (result == null) {</span>
<span class="fc" id="L225">			result = new TypeInheritanceFactory(targetTypeName, baseTypeName);</span>
<span class="fc" id="L226">			typeInheritanceFactoryCache.put(cacheKey, result);</span>
		}
<span class="fc" id="L228">		return result;</span>
	}

	@Override
	protected FieldsLayout getFieldsLayout(ITypeInfo type) {
<span class="fc" id="L233">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L234" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L235" title="All 2 branches covered.">			if (t.getFieldsLayout() != null) {</span>
<span class="fc" id="L236">				return t.getFieldsLayout();</span>
			}
		}
<span class="fc" id="L239">		return super.getFieldsLayout(type);</span>
	}

	@Override
	protected CategoriesStyle getCategoriesStyle(ITypeInfo type) {
<span class="fc" id="L244">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L245" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L246" title="All 2 branches covered.">			if (t.getCategoriesStyle() != null) {</span>
<span class="fc" id="L247">				return t.getCategoriesStyle();</span>
			}
		}
<span class="fc" id="L250">		return super.getCategoriesStyle(type);</span>
	}

	@Override
	protected MethodsLayout getMethodsLayout(ITypeInfo type) {
<span class="fc" id="L255">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L257" title="1 of 2 branches missed.">			if (t.getMethodsLayout() != null) {</span>
<span class="nc" id="L258">				return t.getMethodsLayout();</span>
			}
		}
<span class="fc" id="L261">		return super.getMethodsLayout(type);</span>
	}

	@Override
	protected IFieldInfo getSelectionTargetField(IListTypeInfo listType, ITypeInfo objectType) {
<span class="fc" id="L266">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L267">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L268" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">			if (l.getSelectionTargetFieldName() != null) {</span>
<span class="fc" id="L271">				IFieldInfo result = ReflectionUIUtils.findInfoByName(objectType.getFields(),</span>
<span class="fc" id="L272">						l.getSelectionTargetFieldName());</span>
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">				if (result == null) {</span>
<span class="nc" id="L274">					throw new ReflectionUIError(&quot;List selection target field not found in type &quot; + objectType.getName()</span>
<span class="nc" id="L275">							+ &quot;: '&quot; + l.getSelectionTargetFieldName() + &quot;'&quot;);</span>
				}
<span class="fc" id="L277">				return result;</span>
			}
		}
<span class="fc" id="L280">		return super.getSelectionTargetField(listType, objectType);</span>
	}

	@Override
	protected boolean isItemNullValueSupported(IListTypeInfo listType) {
<span class="fc" id="L285">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L286">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L287" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">			if (l.isItemNullValueAllowed()) {</span>
<span class="nc" id="L290">				return true;</span>
			}
		}
<span class="fc" id="L293">		return super.isItemNullValueSupported(listType);</span>
	}

	@Override
	protected ItemCreationMode getItemCreationMode(IListTypeInfo listType) {
<span class="fc" id="L298">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L299">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L300" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L302" title="1 of 2 branches missed.">			if (l.getItemCreationMode() != null) {</span>
<span class="fc" id="L303">				return l.getItemCreationMode();</span>
			}
		}
<span class="nc" id="L306">		return super.getItemCreationMode(listType);</span>
	}

	@Override
	protected ToolsLocation getToolsLocation(IListTypeInfo listType) {
<span class="fc" id="L311">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L312">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L313" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc bfc" id="L315" title="All 2 branches covered.">			if (l.getCustomToolsLocation() != null) {</span>
<span class="fc" id="L316">				return l.getCustomToolsLocation();</span>
			}
		}
<span class="fc" id="L319">		return super.getToolsLocation(listType);</span>
	}

	@Override
	protected boolean isItemNodeValidityDetectionEnabled(IListTypeInfo listType, ItemPosition itemPosition) {
<span class="fc" id="L324">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L325">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L326" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L327" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc" id="L328">			TreeStructureDiscoverySettings d = l.getTreeStructureDiscoverySettings();</span>
<span class="fc bfc" id="L329" title="All 2 branches covered.">			if (d != null) {</span>
<span class="fc bfc" id="L330" title="All 2 branches covered.">				if (d.getItemValidabilityStatusFieldNamePattern() != null) {</span>
					try {
<span class="fc" id="L332">						Object item = itemPosition.getItem();</span>
<span class="pc bpc" id="L333" title="1 of 2 branches missed.">						if (item != null) {</span>
<span class="fc" id="L334">							ITypeInfo actualItemType = reflectionUI.getTypeInfo(reflectionUI.getTypeInfoSource(item));</span>
<span class="pc bpc" id="L335" title="1 of 2 branches missed.">							for (IFieldInfo field : actualItemType.getFields()) {</span>
<span class="pc bpc" id="L336" title="1 of 2 branches missed.">								if (d.getItemValidabilityStatusFieldNamePattern().matches(field.getName())) {</span>
<span class="fc" id="L337">									Object fieldValue = field.getValue(item);</span>
<span class="pc bpc" id="L338" title="1 of 2 branches missed.">									if (fieldValue instanceof Boolean) {</span>
<span class="fc" id="L339">										return (Boolean) fieldValue;</span>
									} else {
<span class="nc" id="L341">										throw new ReflectionUIError(</span>
<span class="nc" id="L342">												&quot;Unexpected non-boolean value returned from the field: '&quot; + fieldValue</span>
<span class="nc" id="L343">														+ &quot;'&quot;);</span>
									}
								}
							}
<span class="nc" id="L347">							throw new ReflectionUIError(&quot;Field not found&quot;);</span>
						}
<span class="nc" id="L349">					} catch (Throwable t) {</span>
<span class="nc" id="L350">						throw new ReflectionUIError(</span>
<span class="nc" id="L351">								&quot;Unable to obtain the activation status of item node validity detection from the field designated by '&quot;</span>
<span class="nc" id="L352">										+ d.getItemValidabilityStatusFieldNamePattern() + &quot;': &quot; + t.toString(),</span>
<span class="nc" id="L353">								t);</span>
					}
				}
			}
		}
<span class="fc" id="L358">		return super.isItemNodeValidityDetectionEnabled(listType, itemPosition);</span>
	}

	@Override
	protected ValueReturnMode getItemReturnMode(IListTypeInfo listType) {
<span class="fc" id="L363">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L364">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L366" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L367" title="1 of 2 branches missed.">			if (l.getCustomItemReturnMode() != null) {</span>
<span class="nc" id="L368">				return l.getCustomItemReturnMode();</span>
			}
		}
<span class="fc" id="L371">		return super.getItemReturnMode(listType);</span>
	}

	@Override
	protected boolean isConcrete(ITypeInfo type) {
<span class="fc" id="L376">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L377" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L378" title="1 of 2 branches missed.">			if (t.isAbstractForced()) {</span>
<span class="nc" id="L379">				return false;</span>
			}
		}
<span class="fc" id="L382">		return super.isConcrete(type);</span>
	}

	@Override
	protected boolean isImmutable(ITypeInfo type) {
<span class="fc" id="L387">		final TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L388">				type.getName());</span>
<span class="pc bpc" id="L389" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">			if (t.isImmutableForced()) {</span>
<span class="nc" id="L391">				return true;</span>
			}
		}
<span class="fc" id="L394">		return super.isImmutable(type);</span>
	}

	@Override
	protected boolean isValidationRequired(ITypeInfo type) {
<span class="fc" id="L399">		final TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L400">				type.getName());</span>
<span class="pc bpc" id="L401" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L402" title="1 of 2 branches missed.">			if (t.isValidationRequirementForced()) {</span>
<span class="nc" id="L403">				return true;</span>
			}
		}
<span class="fc" id="L406">		return super.isValidationRequired(type);</span>
	}

	@Override
	protected boolean canPersist(ITypeInfo type) {
<span class="fc" id="L411">		final TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L412">				type.getName());</span>
<span class="pc bpc" id="L413" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L414" title="2 of 4 branches missed.">			if ((t.getSavingMethodName() != null) &amp;&amp; (t.getLoadingMethodName() != null)) {</span>
<span class="fc" id="L415">				return true;</span>
			}
		}
<span class="nc" id="L418">		return super.canPersist(type);</span>
	}

	@Override
	protected void save(ITypeInfo type, Object object, File outputFile) {
<span class="fc" id="L423">		final TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L424">				type.getName());</span>
<span class="pc bpc" id="L425" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L426" title="1 of 2 branches missed.">			if (t.getSavingMethodName() != null) {</span>
				Class&lt;?&gt; javaType;
				try {
<span class="fc" id="L429">					javaType = reflectionUI.getReflectedClass(type.getName());</span>
<span class="fc" id="L430">					Method method = javaType.getMethod(t.getSavingMethodName(), File.class);</span>
<span class="fc" id="L431">					method.invoke(object, outputFile);</span>
<span class="fc" id="L432">					return;</span>
<span class="nc" id="L433">				} catch (InvocationTargetException e) {</span>
<span class="nc" id="L434">					throw new ReflectionUIError(e.getTargetException());</span>
<span class="nc" id="L435">				} catch (Exception e) {</span>
<span class="nc" id="L436">					throw new ReflectionUIError(e);</span>
				}
			}
		}
<span class="nc" id="L440">		super.save(type, object, outputFile);</span>
<span class="nc" id="L441">	}</span>

	@Override
	protected void load(ITypeInfo type, Object object, File inputFile) {
<span class="fc" id="L445">		final TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L446">				type.getName());</span>
<span class="pc bpc" id="L447" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L448" title="1 of 2 branches missed.">			if (t.getLoadingMethodName() != null) {</span>
				Class&lt;?&gt; javaType;
				try {
<span class="fc" id="L451">					javaType = reflectionUI.getReflectedClass(type.getName());</span>
<span class="fc" id="L452">					Method method = javaType.getMethod(t.getLoadingMethodName(), File.class);</span>
<span class="fc" id="L453">					method.invoke(object, inputFile);</span>
<span class="fc" id="L454">					return;</span>
<span class="nc" id="L455">				} catch (InvocationTargetException e) {</span>
<span class="nc" id="L456">					throw new ReflectionUIError(e.getTargetException());</span>
<span class="nc" id="L457">				} catch (Exception e) {</span>
<span class="nc" id="L458">					throw new ReflectionUIError(e);</span>
				}
			}
		}
<span class="nc" id="L462">		super.load(type, object, inputFile);</span>
<span class="nc" id="L463">	}</span>

	@Override
	protected boolean canCopy(ITypeInfo type, Object object) {
<span class="fc" id="L467">		final TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L468">				type.getName());</span>
<span class="pc bpc" id="L469" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L470" title="1 of 2 branches missed.">			if (t.isCopyForbidden()) {</span>
<span class="nc" id="L471">				return false;</span>
			}
<span class="fc bfc" id="L473" title="All 2 branches covered.">			if (super.canCopy(type, object)) {</span>
<span class="fc" id="L474">				return true;</span>
			}
			// if possible use specified persistence methods to implement copy/cut/paste
<span class="pc bpc" id="L477" title="3 of 4 branches missed.">			if ((t.getSavingMethodName() != null) &amp;&amp; (t.getLoadingMethodName() != null)) {</span>
				Class&lt;?&gt; javaType;
				try {
<span class="nc" id="L480">					javaType = reflectionUI.getReflectedClass(type.getName());</span>
<span class="nc" id="L481">				} catch (Exception e) {</span>
<span class="nc" id="L482">					throw new ReflectionUIError(e);</span>
				}
<span class="nc bnc" id="L484" title="All 2 branches missed.">				if (object.getClass().equals(javaType)) {</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">					if (ReflectionUIUtils.canCreateDefaultInstance(wrapTypeInfo(type), false)) {</span>
<span class="nc" id="L486">						return true;</span>
					}
				}
			}
		}
<span class="fc" id="L491">		return super.canCopy(type, object);</span>
	}

	@Override
	protected Object copy(ITypeInfo type, Object object) {
<span class="nc" id="L496">		final TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="nc" id="L497">				type.getName());</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">		if (t != null) {</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">			if (t.isCopyForbidden()) {</span>
<span class="nc" id="L500">				throw new ReflectionUIError();</span>
			}
<span class="nc bnc" id="L502" title="All 2 branches missed.">			if (super.canCopy(type, object)) {</span>
<span class="nc" id="L503">				return super.copy(type, object);</span>
			}
			// if possible use specified persistence methods to implement copy/cut/paste
<span class="nc bnc" id="L506" title="All 4 branches missed.">			if ((t.getSavingMethodName() != null) &amp;&amp; (t.getLoadingMethodName() != null)) {</span>
				Class&lt;?&gt; javaType;
				try {
<span class="nc" id="L509">					javaType = reflectionUI.getReflectedClass(type.getName());</span>
<span class="nc" id="L510">				} catch (Exception e) {</span>
<span class="nc" id="L511">					throw new ReflectionUIError(e);</span>
				}
<span class="nc bnc" id="L513" title="All 2 branches missed.">				if (object.getClass().equals(javaType)) {</span>
<span class="nc bnc" id="L514" title="All 2 branches missed.">					if (ReflectionUIUtils.canCreateDefaultInstance(wrapTypeInfo(type), false)) {</span>
						try {
<span class="nc" id="L516">							File tmpFile = IOUtils.createTemporaryFile();</span>
							try {
								try {
<span class="nc" id="L519">									Method method = javaType.getMethod(t.getSavingMethodName(), File.class);</span>
<span class="nc" id="L520">									method.invoke(object, tmpFile);</span>
<span class="nc" id="L521">								} catch (InvocationTargetException e) {</span>
<span class="nc" id="L522">									throw new ReflectionUIError(e.getTargetException());</span>
<span class="nc" id="L523">								} catch (Exception e) {</span>
<span class="nc" id="L524">									throw new ReflectionUIError(e);</span>
								}
<span class="nc" id="L526">								Object newInstance = ReflectionUIUtils.createDefaultInstance(wrapTypeInfo(type), false);</span>
								try {
<span class="nc" id="L528">									Method method = javaType.getMethod(t.getLoadingMethodName(), File.class);</span>
<span class="nc" id="L529">									method.invoke(newInstance, tmpFile);</span>
<span class="nc" id="L530">								} catch (InvocationTargetException e) {</span>
<span class="nc" id="L531">									throw new ReflectionUIError(e.getTargetException());</span>
<span class="nc" id="L532">								} catch (Exception e) {</span>
<span class="nc" id="L533">									throw new ReflectionUIError(e);</span>
								}
<span class="nc" id="L535">								return newInstance;</span>
							} finally {
<span class="nc" id="L537">								IOUtils.delete(tmpFile);</span>
							}
<span class="nc" id="L539">						} catch (Exception e) {</span>
<span class="nc" id="L540">							throw new ReflectionUIError(e);</span>
						}
					}
				}
			}
		}
<span class="nc" id="L546">		return super.copy(type, object);</span>
	}

	@Override
	protected Object[] toArray(IListTypeInfo listType, Object listValue) {
<span class="fc" id="L551">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L552">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L553" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L554" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L555" title="1 of 2 branches missed.">			if (l.isListSorted()) {</span>
<span class="nc" id="L556">				Object[] result = super.toArray(listType, listValue);</span>
<span class="nc" id="L557">				Arrays.sort(result);</span>
<span class="nc" id="L558">				return result;</span>
			}
		}
<span class="fc" id="L561">		return super.toArray(listType, listValue);</span>
	}

	@Override
	protected Object[] getValues(IEnumerationTypeInfo enumType) {
<span class="fc" id="L566">		EnumerationCustomization e = InfoCustomizations.getEnumerationCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L567">				enumType.getName());</span>
<span class="pc bpc" id="L568" title="1 of 2 branches missed.">		if (e != null) {</span>
<span class="fc" id="L569">			List&lt;Object&gt; result = new ArrayList&lt;Object&gt;();</span>
<span class="fc" id="L570">			List&lt;IEnumerationItemInfo&gt; valueInfos = new ArrayList&lt;IEnumerationItemInfo&gt;();</span>
<span class="fc bfc" id="L571" title="All 2 branches covered.">			for (Object value : super.getValues(enumType)) {</span>
<span class="fc" id="L572">				IEnumerationItemInfo valueInfo = getValueInfo(enumType, value);</span>
<span class="fc" id="L573">				valueInfos.add(valueInfo);</span>
<span class="fc" id="L574">				EnumerationItemCustomization i = InfoCustomizations.getEnumerationItemCustomization(e,</span>
<span class="fc" id="L575">						valueInfo.getName());</span>
<span class="pc bpc" id="L576" title="1 of 2 branches missed.">				if (i != null) {</span>
<span class="fc bfc" id="L577" title="All 2 branches covered.">					if (i.isHidden()) {</span>
<span class="fc" id="L578">						continue;</span>
					}
				}
<span class="fc" id="L581">				result.add(value);</span>
			}

<span class="fc" id="L584">			final List&lt;String&gt; customOrder = e.getItemsCustomOrder();</span>
<span class="fc bfc" id="L585" title="All 2 branches covered.">			if (customOrder != null) {</span>
<span class="fc" id="L586">				final Comparator&lt;IEnumerationItemInfo&gt; valueInfoComparator = ReflectionUIUtils</span>
<span class="fc" id="L587">						.getInfosComparator(customOrder, valueInfos);</span>
<span class="fc" id="L588">				Collections.sort(result, new Comparator&lt;Object&gt;() {</span>
					@Override
					public int compare(Object value1, Object value2) {
<span class="fc" id="L591">						return valueInfoComparator.compare(getValueInfo(enumType, value1),</span>
<span class="fc" id="L592">								getValueInfo(enumType, value2));</span>
					}
				});
			}

<span class="fc" id="L597">			return result.toArray();</span>
		}
<span class="nc" id="L599">		return super.getValues(enumType);</span>
	}

	@Override
	protected boolean isDynamicEnumeration(IEnumerationTypeInfo enumType) {
<span class="fc" id="L604">		EnumerationCustomization e = InfoCustomizations.getEnumerationCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L605">				enumType.getName());</span>
<span class="pc bpc" id="L606" title="1 of 2 branches missed.">		if (e != null) {</span>
<span class="fc bfc" id="L607" title="All 2 branches covered.">			if (e.isDynamicEnumerationForced()) {</span>
<span class="fc" id="L608">				return true;</span>
			}
		}
<span class="fc" id="L611">		return super.isDynamicEnumeration(enumType);</span>
	}

	@Override
	protected IEnumerationItemInfo getValueInfo(IEnumerationTypeInfo enumType, Object object) {
<span class="fc" id="L616">		IEnumerationItemInfo result = super.getValueInfo(enumType, object);</span>
<span class="fc" id="L617">		EnumerationCustomization e = InfoCustomizations.getEnumerationCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L618">				enumType.getName());</span>
<span class="pc bpc" id="L619" title="1 of 2 branches missed.">		if (e != null) {</span>
<span class="fc" id="L620">			final EnumerationItemCustomization i = InfoCustomizations.getEnumerationItemCustomization(e,</span>
<span class="fc" id="L621">					result.getName());</span>
<span class="pc bpc" id="L622" title="1 of 2 branches missed.">			if (i != null) {</span>
<span class="fc" id="L623">				return new EnumerationItemInfoProxy(result) {</span>

					@Override
					public String getCaption() {
<span class="fc bfc" id="L627" title="All 2 branches covered.">						if (i.getCustomCaption() != null) {</span>
<span class="fc" id="L628">							return i.getCustomCaption();</span>
						}
<span class="fc" id="L630">						return super.getCaption();</span>
					}

					@Override
					public String getOnlineHelp() {
<span class="fc bfc" id="L635" title="All 2 branches covered.">						if (i.getOnlineHelp() != null) {</span>
<span class="fc" id="L636">							return i.getOnlineHelp();</span>
						}
<span class="fc" id="L638">						return super.getOnlineHelp();</span>
					}

					@Override
					public ResourcePath getIconImagePath() {
<span class="fc bfc" id="L643" title="All 2 branches covered.">						if (i.getIconImagePath() != null) {</span>
<span class="fc" id="L644">							return i.getIconImagePath();</span>
						}
<span class="fc" id="L646">						return super.getIconImagePath();</span>
					}

				};
			}
		}
<span class="nc" id="L652">		return result;</span>
	}

	@Override
	protected List&lt;IDynamicListProperty&gt; getDynamicProperties(IListTypeInfo listType,
			List&lt;? extends ItemPosition&gt; selection,
			final Mapper&lt;ItemPosition, ListModificationFactory&gt; listModificationFactoryAccessor) {
<span class="fc" id="L659">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L660">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L661" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L662" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc" id="L663">			List&lt;IDynamicListProperty&gt; result = super.getDynamicProperties(listType, selection,</span>
<span class="fc" id="L664">					listModificationFactoryAccessor);</span>
<span class="fc" id="L665">			result = new ArrayList&lt;IDynamicListProperty&gt;(result);</span>
<span class="fc bfc" id="L666" title="All 2 branches covered.">			for (final ListItemFieldShortcut shortcut : l.getAllowedItemFieldShortcuts()) {</span>
<span class="fc" id="L667">				boolean fieldFound = false;</span>
<span class="fc bfc" id="L668" title="All 2 branches covered.">				if (selection.size() == 1) {</span>
<span class="fc" id="L669">					final ItemPosition itemPosition = selection.get(0);</span>
<span class="fc" id="L670">					final Object item = itemPosition.getItem();</span>
<span class="pc bpc" id="L671" title="1 of 2 branches missed.">					if (item != null) {</span>
<span class="fc" id="L672">						final ITypeInfo actualItemType = reflectionUI.getTypeInfo(reflectionUI.getTypeInfoSource(item));</span>
<span class="fc bfc" id="L673" title="All 2 branches covered.">						for (final IFieldInfo itemField : actualItemType.getFields()) {</span>
<span class="fc bfc" id="L674" title="All 2 branches covered.">							if (itemField.getName().equals(shortcut.getFieldName())) {</span>
<span class="fc" id="L675">								AbstractDynamicListProperty property = new AbstractDynamicListProperty() {</span>

<span class="fc" id="L677">									IFieldInfo itemPositionAsField = new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

<span class="fc" id="L679">										ListModificationFactory listModificationFactory = listModificationFactoryAccessor</span>
<span class="fc" id="L680">												.get(itemPosition);</span>

										@Override
										public Object getValue(Object object) {
<span class="nc" id="L684">											return item;</span>
										}

										@Override
										public String getName() {
<span class="nc" id="L689">											return &quot;currentItem&quot;;</span>
										}

										@Override
										public String getCaption() {
<span class="nc" id="L694">											return &quot;Current Item&quot;;</span>
										}

										@Override
										public void setValue(Object object, Object value) {
<span class="nc" id="L699">											listModificationFactory.set(itemPosition.getIndex(), item)</span>
<span class="nc" id="L700">													.applyAndGetOpposite(ModificationStack.DUMMY_MODIFICATION_STACK);</span>
<span class="nc" id="L701">										}</span>

										@Override
										public boolean isGetOnly() {
<span class="nc bnc" id="L705" title="All 2 branches missed.">											return !listModificationFactory.canSet(itemPosition.getIndex());</span>
										}

									};
<span class="fc" id="L709">									SubFieldInfo delegate = new SubFieldInfo(reflectionUI, itemPositionAsField,</span>
<span class="fc" id="L710">											itemField, actualItemType);</span>

									@Override
									public boolean isEnabled() {
<span class="nc" id="L714">										return true;</span>
									}

									@Override
									public String getName() {
<span class="nc" id="L719">										return shortcut.getFieldName();</span>
									}

									@Override
									public DisplayMode getDisplayMode() {
<span class="pc bpc" id="L724" title="1 of 2 branches missed.">										if (shortcut.getDisplayMode() != null) {</span>
<span class="fc" id="L725">											return shortcut.getDisplayMode();</span>
										} else {
<span class="nc" id="L727">											return DisplayMode.getDefault();</span>
										}
									}

									@Override
									public String getCaption() {
<span class="nc bnc" id="L733" title="All 2 branches missed.">										if (shortcut.getCustomFieldCaption() != null) {</span>
<span class="nc" id="L734">											return shortcut.getCustomFieldCaption();</span>
										} else {
<span class="nc" id="L736">											return delegate.getCaption();</span>
										}
									}

									public ITypeInfo getType() {
<span class="nc" id="L741">										return delegate.getType();</span>
									}

									public List&lt;IMethodInfo&gt; getAlternativeConstructors(Object object) {
<span class="nc" id="L745">										return delegate.getAlternativeConstructors(object);</span>
									}

									public List&lt;IMethodInfo&gt; getAlternativeListItemConstructors(Object object) {
<span class="nc" id="L749">										return delegate.getAlternativeListItemConstructors(object);</span>
									}

									public Object getValue(Object object) {
<span class="nc" id="L753">										return delegate.getValue(object);</span>
									}

									@Override
									public boolean hasValueOptions(Object object) {
<span class="nc" id="L758">										return delegate.hasValueOptions(object);</span>
									}

									public Object[] getValueOptions(Object object) {
<span class="nc" id="L762">										return delegate.getValueOptions(object);</span>
									}

									public boolean isGetOnly() {
<span class="nc" id="L766">										return delegate.isGetOnly();</span>
									}

									public boolean isTransient() {
<span class="nc" id="L770">										return delegate.isTransient();</span>
									}

									public void setValue(Object object, Object subFieldValue) {
<span class="nc" id="L774">										delegate.setValue(object, subFieldValue);</span>
<span class="nc" id="L775">									}</span>

									public Runnable getNextUpdateCustomUndoJob(Object object, Object value) {
<span class="nc" id="L778">										return delegate.getNextUpdateCustomUndoJob(object, value);</span>
									}

									public Runnable getPreviousUpdateCustomRedoJob(Object object, Object value) {
<span class="nc" id="L782">										return delegate.getPreviousUpdateCustomRedoJob(object, value);</span>
									}

									public boolean isNullValueDistinct() {
<span class="nc" id="L786">										return delegate.isNullValueDistinct();</span>
									}

									public String getNullValueLabel() {
<span class="nc" id="L790">										return delegate.getNullValueLabel();</span>
									}

									public ValueReturnMode getValueReturnMode() {
<span class="nc" id="L794">										return delegate.getValueReturnMode();</span>
									}

									public InfoCategory getCategory() {
<span class="nc" id="L798">										return delegate.getCategory();</span>
									}

									public String getOnlineHelp() {
<span class="nc" id="L802">										return delegate.getOnlineHelp();</span>
									}

									public Map&lt;String, Object&gt; getSpecificProperties() {
<span class="nc" id="L806">										return delegate.getSpecificProperties();</span>
									}

									public boolean isFormControlMandatory() {
<span class="nc" id="L810">										return delegate.isFormControlMandatory();</span>
									}

									public boolean isFormControlEmbedded() {
<span class="nc" id="L814">										return delegate.isFormControlEmbedded();</span>
									}

									public IInfoFilter getFormControlFilter() {
<span class="nc" id="L818">										return delegate.getFormControlFilter();</span>
									}

								};
<span class="fc" id="L822">								result.add(property);</span>
<span class="fc" id="L823">								fieldFound = true;</span>
<span class="fc" id="L824">								break;</span>
							}
						}
					}
				}
<span class="fc bfc" id="L829" title="All 4 branches covered.">				if ((!fieldFound) &amp;&amp; shortcut.isAlwaysShown()) {</span>
<span class="fc" id="L830">					AbstractDynamicListProperty property = new AbstractDynamicListProperty() {</span>

						@Override
						public boolean isEnabled() {
<span class="nc" id="L834">							return false;</span>
						}

						@Override
						public String getName() {
<span class="nc" id="L839">							return shortcut.getFieldName();</span>
						}

						@Override
						public String getCaption() {
<span class="nc bnc" id="L844" title="All 2 branches missed.">							if (shortcut.getCustomFieldCaption() != null) {</span>
<span class="nc" id="L845">								return shortcut.getCustomFieldCaption();</span>
							} else {
<span class="nc" id="L847">								return ReflectionUIUtils.identifierToCaption(shortcut.getFieldName());</span>
							}
						}

						@Override
						public void setValue(Object object, Object value) {
<span class="nc" id="L853">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public boolean isNullValueDistinct() {
<span class="nc" id="L858">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public boolean isGetOnly() {
<span class="nc" id="L863">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public boolean isTransient() {
<span class="nc" id="L868">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public ValueReturnMode getValueReturnMode() {
<span class="nc" id="L873">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public Object getValue(Object object) {
<span class="nc" id="L878">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public ITypeInfo getType() {
<span class="nc" id="L883">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public DisplayMode getDisplayMode() {
<span class="pc bpc" id="L888" title="1 of 2 branches missed.">							if (shortcut.getDisplayMode() != null) {</span>
<span class="fc" id="L889">								return shortcut.getDisplayMode();</span>
							} else {
<span class="nc" id="L891">								return DisplayMode.getDefault();</span>
							}
						}
					};
<span class="fc" id="L895">					result.add(property);</span>

				}
			}
<span class="fc" id="L899">			return result;</span>
		}
<span class="nc" id="L901">		return super.getDynamicProperties(listType, selection, listModificationFactoryAccessor);</span>
	}

	@Override
	protected List&lt;IDynamicListAction&gt; getDynamicActions(IListTypeInfo listType, List&lt;? extends ItemPosition&gt; selection,
			final Mapper&lt;ItemPosition, ListModificationFactory&gt; listModificationFactoryAccessor) {
<span class="fc" id="L907">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L908">		final ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L909" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L910" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc" id="L911">			List&lt;IDynamicListAction&gt; result = super.getDynamicActions(listType, selection,</span>
<span class="fc" id="L912">					listModificationFactoryAccessor);</span>
<span class="fc" id="L913">			result = new ArrayList&lt;IDynamicListAction&gt;(result);</span>

<span class="fc bfc" id="L915" title="All 2 branches covered.">			for (final ListItemMethodShortcut shortcut : l.getAllowedItemMethodShortcuts()) {</span>
<span class="fc" id="L916">				final String methodName = ReflectionUIUtils</span>
<span class="fc" id="L917">						.extractMethodNameFromSignature(shortcut.getMethodSignature());</span>
<span class="fc" id="L918">				boolean methodFound = false;</span>
<span class="fc bfc" id="L919" title="All 2 branches covered.">				if (selection.size() == 1) {</span>
<span class="fc" id="L920">					final ItemPosition itemPosition = selection.get(0);</span>
<span class="fc" id="L921">					final Object item = itemPosition.getItem();</span>
<span class="pc bpc" id="L922" title="1 of 2 branches missed.">					if (item != null) {</span>
<span class="fc" id="L923">						final ITypeInfo actualItemType = reflectionUI.getTypeInfo(reflectionUI.getTypeInfoSource(item));</span>
<span class="fc bfc" id="L924" title="All 2 branches covered.">						for (final IMethodInfo itemMethod : actualItemType.getMethods()) {</span>
<span class="fc bfc" id="L925" title="All 2 branches covered.">							if (itemMethod.getSignature().equals(shortcut.getMethodSignature())) {</span>
<span class="fc" id="L926">								AbstractDynamicListAction action = new AbstractDynamicListAction() {</span>

<span class="fc" id="L928">									IFieldInfo itemPositionAsField = new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

<span class="fc" id="L930">										ListModificationFactory listModificationFactory = listModificationFactoryAccessor</span>
<span class="fc" id="L931">												.get(itemPosition);</span>

										@Override
										public Object getValue(Object object) {
<span class="fc" id="L935">											return item;</span>
										}

										@Override
										public String getName() {
<span class="fc" id="L940">											return &quot;currentItem&quot;;</span>
										}

										@Override
										public String getCaption() {
<span class="nc" id="L945">											return &quot;Current Item&quot;;</span>
										}

										@Override
										public void setValue(Object object, Object value) {
<span class="nc" id="L950">											listModificationFactory.set(itemPosition.getIndex(), item)</span>
<span class="nc" id="L951">													.applyAndGetOpposite(ModificationStack.DUMMY_MODIFICATION_STACK);</span>
<span class="nc" id="L952">										}</span>

										@Override
										public boolean isGetOnly() {
<span class="nc bnc" id="L956" title="All 2 branches missed.">											return !listModificationFactory.canSet(itemPosition.getIndex());</span>
										}

									};
<span class="fc" id="L960">									SubMethodInfo delegate = new SubMethodInfo(reflectionUI, itemPositionAsField,</span>
<span class="fc" id="L961">											itemMethod, actualItemType);</span>

									@Override
									public String getName() {
<span class="fc" id="L965">										return methodName;</span>
									}

									@Override
									public boolean isEnabled(Object object) {
<span class="fc" id="L970">										return delegate.isEnabled(object);</span>
									}

									@Override
									public DisplayMode getDisplayMode() {
<span class="pc bpc" id="L975" title="1 of 2 branches missed.">										if (shortcut.getDisplayMode() != null) {</span>
<span class="fc" id="L976">											return shortcut.getDisplayMode();</span>
										} else {
<span class="nc" id="L978">											return DisplayMode.getDefault();</span>
										}
									}

									@Override
									public String getCaption() {
<span class="pc bpc" id="L984" title="1 of 2 branches missed.">										if (shortcut.getCustomMethodCaption() != null) {</span>
<span class="fc" id="L985">											return shortcut.getCustomMethodCaption();</span>
										} else {
<span class="nc" id="L987">											return delegate.getCaption();</span>
										}
									}

									public ResourcePath getIconImagePath() {
<span class="nc bnc" id="L992" title="All 2 branches missed.">										if (shortcut.getCustomIconImagePath() != null) {</span>
<span class="nc" id="L993">											return shortcut.getCustomIconImagePath();</span>
										} else {
<span class="nc" id="L995">											return delegate.getIconImagePath();</span>
										}
									}

									public ITypeInfo getReturnValueType() {
<span class="pc bpc" id="L1000" title="1 of 2 branches missed.">										if (delegate.getReturnValueType() == null) {</span>
<span class="nc" id="L1001">											return null;</span>
										} else {
<span class="fc" id="L1003">											return reflectionUI.getTypeInfo(</span>
<span class="fc" id="L1004">													new TypeInfoSourceProxy(delegate.getReturnValueType().getSource()) {</span>
														@Override
														public SpecificitiesIdentifier getSpecificitiesIdentifier() {
<span class="fc" id="L1007">															return null;</span>
														}

														@Override
														protected String getTypeInfoProxyFactoryIdentifier() {
<span class="fc" id="L1012">															return &quot;DynamicActionReturnValueTypeInfoProxyFactory [of=&quot;</span>
<span class="fc" id="L1013">																	+ getClass().getName() + &quot;, listType=&quot;</span>
<span class="fc" id="L1014">																	+ listType.getName() + &quot;, method=&quot;</span>
<span class="fc" id="L1015">																	+ shortcut.getMethodSignature() + &quot;]&quot;;</span>
														}
													});
										}
									}

									public Object invoke(Object object, InvocationData invocationData) {
<span class="fc" id="L1022">										return delegate.invoke(object, invocationData);</span>
									}

									public boolean isReadOnly() {
<span class="fc" id="L1026">										return delegate.isReadOnly();</span>
									}

									public Runnable getNextInvocationUndoJob(Object object,
											InvocationData invocationData) {
<span class="nc" id="L1031">										return delegate.getNextInvocationUndoJob(object, invocationData);</span>
									}

									public Runnable getPreviousInvocationCustomRedoJob(Object object,
											InvocationData invocationData) {
<span class="nc" id="L1036">										return delegate.getPreviousInvocationCustomRedoJob(object, invocationData);</span>
									}

									public boolean isNullReturnValueDistinct() {
<span class="fc" id="L1040">										return delegate.isNullReturnValueDistinct();</span>
									}

									public String getNullReturnValueLabel() {
<span class="nc" id="L1044">										return delegate.getNullReturnValueLabel();</span>
									}

									public ValueReturnMode getValueReturnMode() {
<span class="fc" id="L1048">										return delegate.getValueReturnMode();</span>
									}

									public InfoCategory getCategory() {
<span class="nc" id="L1052">										return delegate.getCategory();</span>
									}

									public String getOnlineHelp() {
<span class="fc" id="L1056">										return delegate.getOnlineHelp();</span>
									}

									public Map&lt;String, Object&gt; getSpecificProperties() {
<span class="nc" id="L1060">										return delegate.getSpecificProperties();</span>
									}

									public List&lt;IParameterInfo&gt; getParameters() {
<span class="fc" id="L1064">										return delegate.getParameters();</span>
									}

									public void validateParameters(Object object, InvocationData invocationData)
											throws Exception {
<span class="nc" id="L1069">										delegate.validateParameters(object, invocationData);</span>
<span class="nc" id="L1070">									}</span>

									public boolean isReturnValueDetached() {
<span class="fc" id="L1073">										return delegate.isReturnValueDetached();</span>
									}

									public String getSignature() {
<span class="fc" id="L1077">										return delegate.getSignature();</span>
									}

									public String getConfirmationMessage(Object object, InvocationData invocationData) {
<span class="fc" id="L1081">										return delegate.getConfirmationMessage(object, invocationData);</span>
									}

									public boolean isReturnValueIgnored() {
<span class="fc" id="L1085">										return delegate.isReturnValueIgnored();</span>
									}

								};
<span class="fc" id="L1089">								result.add(action);</span>
<span class="fc" id="L1090">								methodFound = true;</span>
<span class="fc" id="L1091">								break;</span>
							}
						}
					}
				}
<span class="fc bfc" id="L1096" title="All 4 branches covered.">				if ((!methodFound) &amp;&amp; shortcut.isAlwaysShown()) {</span>
<span class="fc" id="L1097">					result.add(new AbstractDynamicListAction() {</span>

						@Override
						public boolean isNullReturnValueDistinct() {
<span class="nc" id="L1101">							return false;</span>
						}

						@Override
						public String getName() {
<span class="nc" id="L1106">							return methodName;</span>
						}

						@Override
						public String getCaption() {
<span class="nc bnc" id="L1111" title="All 2 branches missed.">							if (shortcut.getCustomMethodCaption() != null) {</span>
<span class="nc" id="L1112">								return shortcut.getCustomMethodCaption();</span>
							} else {
<span class="nc" id="L1114">								return ReflectionUIUtils.identifierToCaption(methodName);</span>
							}
						}

						public ResourcePath getIconImagePath() {
<span class="nc bnc" id="L1119" title="All 2 branches missed.">							if (shortcut.getCustomIconImagePath() != null) {</span>
<span class="nc" id="L1120">								return shortcut.getCustomIconImagePath();</span>
							} else {
<span class="nc" id="L1122">								return null;</span>
							}
						}

						@Override
						public boolean isEnabled(Object object) {
<span class="nc" id="L1128">							return false;</span>
						}

						@Override
						public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1133">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public ValueReturnMode getValueReturnMode() {
<span class="nc" id="L1138">							throw new UnsupportedOperationException();</span>
						}

						@Override
						public DisplayMode getDisplayMode() {
<span class="pc bpc" id="L1143" title="1 of 2 branches missed.">							if (shortcut.getDisplayMode() != null) {</span>
<span class="fc" id="L1144">								return shortcut.getDisplayMode();</span>
							} else {
<span class="nc" id="L1146">								return DisplayMode.getDefault();</span>
							}
						}

					});
				}
			}
<span class="fc" id="L1153">			return result;</span>
		}
<span class="nc" id="L1155">		return super.getDynamicActions(listType, selection, listModificationFactoryAccessor);</span>
	}

	@Override
	protected IListItemDetailsAccessMode getDetailsAccessMode(IListTypeInfo listType) {
<span class="fc" id="L1160">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1161">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1162" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1163" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc bfc" id="L1164" title="All 2 branches covered.">			if (l.getCustomDetailsAccessMode() != null) {</span>
<span class="fc" id="L1165">				return l.getCustomDetailsAccessMode();</span>
			}
		}
<span class="fc" id="L1168">		return super.getDetailsAccessMode(listType);</span>
	}

	@Override
	protected Object fromArray(IListTypeInfo listType, Object[] array) {
<span class="nc" id="L1173">		ITypeInfo itemType = listType.getItemType();</span>
<span class="nc" id="L1174">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="nc bnc" id="L1175" title="All 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="nc bnc" id="L1176" title="All 2 branches missed.">		if (l != null) {</span>
<span class="nc bnc" id="L1177" title="All 2 branches missed.">			if (l.getEditOptions() != null) {</span>
<span class="nc bnc" id="L1178" title="All 2 branches missed.">				if (l.getEditOptions().getListInstantiationOption() != null) {</span>
					Object newListInstance;
<span class="nc bnc" id="L1180" title="All 2 branches missed.">					if (l.getEditOptions().getListInstantiationOption().getCustomInstanceTypeFinder() != null) {</span>
<span class="nc" id="L1181">						ITypeInfo customInstanceType = l.getEditOptions().getListInstantiationOption()</span>
<span class="nc" id="L1182">								.getCustomInstanceTypeFinder().find(reflectionUI, null);</span>
<span class="nc" id="L1183">						newListInstance = ReflectionUIUtils.createDefaultInstance(customInstanceType);</span>
<span class="nc" id="L1184">					} else {</span>
<span class="nc" id="L1185">						newListInstance = ReflectionUIUtils.createDefaultInstance(listType);</span>
					}
<span class="nc" id="L1187">					super.replaceContent(listType, newListInstance, array);</span>
<span class="nc" id="L1188">					return newListInstance;</span>
				}
			}
		}
<span class="nc" id="L1192">		return super.fromArray(listType, array);</span>
	}

	@Override
	protected boolean canInstantiateFromArray(IListTypeInfo listType) {
<span class="fc" id="L1197">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1198">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1199" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1200" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L1201" title="1 of 2 branches missed.">			if (l.getEditOptions() == null) {</span>
<span class="nc" id="L1202">				return false;</span>
			}
<span class="pc bpc" id="L1204" title="1 of 2 branches missed.">			if (l.getEditOptions().getListInstantiationOption() != null) {</span>
<span class="nc" id="L1205">				return true;</span>
			}
		}
<span class="fc" id="L1208">		return super.canInstantiateFromArray(listType);</span>
	}

	@Override
	protected boolean canReplaceContent(IListTypeInfo listType) {
<span class="fc" id="L1213">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1214">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1215" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1216" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L1217" title="1 of 2 branches missed.">			if (l.getEditOptions() == null) {</span>
<span class="nc" id="L1218">				return false;</span>
			}
<span class="pc bpc" id="L1220" title="1 of 2 branches missed.">			if (l.getEditOptions().getListInstantiationOption() != null) {</span>
<span class="nc" id="L1221">				return false;</span>
			}
		}
<span class="fc" id="L1224">		return super.canReplaceContent(listType);</span>
	}

	@Override
	protected boolean isInsertionAllowed(IListTypeInfo listType) {
<span class="fc" id="L1229">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1230">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1231" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1232" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L1233" title="1 of 4 branches missed.">			if ((l.getEditOptions() == null) || !l.getEditOptions().isItemCreationEnabled()) {</span>
<span class="fc" id="L1234">				return false;</span>
			}
		}
<span class="fc" id="L1237">		return super.isInsertionAllowed(listType);</span>
	}

	@Override
	protected boolean isRemovalAllowed(IListTypeInfo listType) {
<span class="fc" id="L1242">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1243">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1244" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1245" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L1246" title="1 of 4 branches missed.">			if ((l.getEditOptions() == null) || !l.getEditOptions().isItemDeletionEnabled()) {</span>
<span class="fc" id="L1247">				return false;</span>
			}
		}
<span class="fc" id="L1250">		return super.isRemovalAllowed(listType);</span>
	}

	@Override
	protected boolean isMoveAllowed(IListTypeInfo listType) {
<span class="fc" id="L1255">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1256">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1257" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1258" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L1259" title="1 of 4 branches missed.">			if ((l.getEditOptions() == null) || !l.getEditOptions().isItemMoveEnabled()) {</span>
<span class="fc" id="L1260">				return false;</span>
			}
		}
<span class="fc" id="L1263">		return super.isMoveAllowed(listType);</span>
	}

	@Override
	protected boolean areItemsAutomaticallyPositioned(IListTypeInfo listType) {
<span class="fc" id="L1268">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1269">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1270" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1271" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L1272" title="1 of 2 branches missed.">			if (l.isItemAutomaticPositioningManagementForced()) {</span>
<span class="nc" id="L1273">				return true;</span>
			}
<span class="pc bpc" id="L1275" title="1 of 2 branches missed.">			if (l.isListSorted()) {</span>
<span class="nc" id="L1276">				return true;</span>
			}
		}
<span class="fc" id="L1279">		return super.areItemsAutomaticallyPositioned(listType);</span>
	}

	@Override
	protected boolean canViewItemDetails(IListTypeInfo listType) {
<span class="fc" id="L1284">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1285">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1286" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1287" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc bfc" id="L1288" title="All 2 branches covered.">			if (l.isItemDetailsViewDisabled()) {</span>
<span class="fc" id="L1289">				return false;</span>
			}
		}
<span class="fc" id="L1292">		return super.canViewItemDetails(listType);</span>
	}

	@Override
	protected boolean isModificationStackAccessible(ITypeInfo type) {
<span class="fc" id="L1297">		TypeCustomization tc = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1298" title="1 of 2 branches missed.">		if (tc != null) {</span>
<span class="fc bfc" id="L1299" title="All 2 branches covered.">			if (tc.isUndoManagementHidden()) {</span>
<span class="fc" id="L1300">				return false;</span>
			}
		}
<span class="fc" id="L1303">		return super.isModificationStackAccessible(type);</span>
	}

	@Override
	protected List&lt;ITypeInfo&gt; getPolymorphicInstanceSubTypes(ITypeInfo type) {
<span class="fc" id="L1308">		TypeCustomization tc = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1309" title="1 of 2 branches missed.">		if (tc != null) {</span>
<span class="pc bpc" id="L1310" title="1 of 2 branches missed.">			if (tc.getPolymorphicSubTypeFinders() != null) {</span>
<span class="fc" id="L1311">				List&lt;ITypeInfo&gt; result = new ArrayList&lt;ITypeInfo&gt;(super.getPolymorphicInstanceSubTypes(type));</span>
<span class="fc bfc" id="L1312" title="All 2 branches covered.">				for (ITypeInfoFinder finder : tc.getPolymorphicSubTypeFinders()) {</span>
<span class="fc" id="L1313">					ITypeInfo subType = finder.find(reflectionUI, null);</span>
<span class="fc" id="L1314">					result.add(subType);</span>
				}
<span class="fc" id="L1316">				return result;</span>
			}
		}
<span class="nc" id="L1319">		return super.getPolymorphicInstanceSubTypes(type);</span>
	}

	@Override
	protected boolean isPolymorphicInstanceAbstractTypeOptionAllowed(ITypeInfo type) {
<span class="fc" id="L1324">		TypeCustomization tc = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1325" title="1 of 2 branches missed.">		if (tc != null) {</span>
<span class="pc bpc" id="L1326" title="1 of 2 branches missed.">			if (tc.isPolymorphicInstanceAbstractTypeOptionAllowed()) {</span>
<span class="nc" id="L1327">				return true;</span>
			}
		}
<span class="fc" id="L1330">		return super.isPolymorphicInstanceAbstractTypeOptionAllowed(type);</span>
	}

	@Override
	protected IListStructuralInfo getStructuralInfo(IListTypeInfo listType) {
<span class="fc" id="L1335">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1336">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="pc bpc" id="L1337" title="1 of 2 branches missed.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1338" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="fc" id="L1339">			IListStructuralInfo base = super.getStructuralInfo(listType);</span>
<span class="fc" id="L1340">			return new CustomizedListStructuralInfo(reflectionUI, base, listType, l);</span>
		}
<span class="nc" id="L1342">		return super.getStructuralInfo(listType);</span>
	}

	@Override
	protected ITypeInfo getItemType(IListTypeInfo listType) {
<span class="fc" id="L1347">		ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1348">		ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="fc bfc" id="L1349" title="All 2 branches covered.">				listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1350" title="1 of 2 branches missed.">		if (l != null) {</span>
<span class="pc bpc" id="L1351" title="1 of 2 branches missed.">			if (l.getCustomItemTypeFinder() != null) {</span>
<span class="nc" id="L1352">				return l.getCustomItemTypeFinder().find(reflectionUI, null);</span>
			}
		}
<span class="fc" id="L1355">		return super.getItemType(listType);</span>
	}

	@Override
	protected ResourcePath getIconImagePath(ITypeInfo type, Object object) {
<span class="fc" id="L1360">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1361" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc" id="L1362">			ResourcePath result = t.getIconImagePath();</span>
<span class="fc bfc" id="L1363" title="All 2 branches covered.">			if (result != null) {</span>
<span class="pc bpc" id="L1364" title="1 of 2 branches missed.">				if (result.getSpecification().length() &gt; 0) {</span>
<span class="fc" id="L1365">					return result;</span>
				}
			}
		}
<span class="fc" id="L1369">		return super.getIconImagePath(type, object);</span>
	}

	@Override
	protected Map&lt;String, Object&gt; getSpecificProperties(ITypeInfo type) {
<span class="fc" id="L1374">		Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(super.getSpecificProperties(type));</span>
<span class="fc" id="L1375">		traceActiveCustomizations(result);</span>
<span class="fc" id="L1376">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1377" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L1378" title="1 of 2 branches missed.">			if (t.getSpecificProperties() != null) {</span>
<span class="fc bfc" id="L1379" title="All 2 branches covered.">				if (t.getSpecificProperties().size() &gt; 0) {</span>
<span class="fc" id="L1380">					result.putAll(t.getSpecificProperties());</span>
				}
			}
		}
<span class="fc bfc" id="L1384" title="All 2 branches covered.">		if (type instanceof IListTypeInfo) {</span>
<span class="fc" id="L1385">			IListTypeInfo listType = (IListTypeInfo) type;</span>
<span class="fc" id="L1386">			ITypeInfo itemType = listType.getItemType();</span>
<span class="fc" id="L1387">			ListCustomization l = InfoCustomizations.getListCustomization(this.accessInfoCustomizations(),</span>
<span class="fc bfc" id="L1388" title="All 2 branches covered.">					listType.getName(), (itemType == null) ? null : itemType.getName());</span>
<span class="pc bpc" id="L1389" title="1 of 2 branches missed.">			if (l != null) {</span>
<span class="pc bpc" id="L1390" title="1 of 2 branches missed.">				if (l.getCustomItemTypeFinder() != null) {</span>
<span class="nc" id="L1391">					traceListItemTypeChange(result, l.getCustomItemTypeFinder(), itemType);</span>
				}
			}
		}
<span class="fc" id="L1395">		return result;</span>
	}

	@Override
	protected Map&lt;String, Object&gt; getSpecificProperties(IApplicationInfo appInfo) {
<span class="fc" id="L1400">		Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(super.getSpecificProperties(appInfo));</span>
<span class="fc" id="L1401">		traceActiveCustomizations(result);</span>
<span class="fc" id="L1402">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1403" title="1 of 2 branches missed.">		if (appCustomization != null) {</span>
<span class="pc bpc" id="L1404" title="1 of 2 branches missed.">			if (appCustomization.getSpecificProperties() != null) {</span>
<span class="pc bpc" id="L1405" title="1 of 2 branches missed.">				if (appCustomization.getSpecificProperties().size() &gt; 0) {</span>
<span class="nc" id="L1406">					result.putAll(appCustomization.getSpecificProperties());</span>
				}
			}
		}
<span class="fc" id="L1410">		return result;</span>
	}

	@Override
	protected Map&lt;String, Object&gt; getSpecificProperties(IEnumerationItemInfo info,
			IEnumerationTypeInfo parentEnumType) {
<span class="nc" id="L1416">		Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(super.getSpecificProperties(info, parentEnumType));</span>
<span class="nc" id="L1417">		traceActiveCustomizations(result);</span>
<span class="nc" id="L1418">		EnumerationCustomization e = InfoCustomizations.getEnumerationCustomization(this.accessInfoCustomizations(),</span>
<span class="nc" id="L1419">				parentEnumType.getName());</span>
<span class="nc bnc" id="L1420" title="All 2 branches missed.">		if (e != null) {</span>
<span class="nc" id="L1421">			final EnumerationItemCustomization i = InfoCustomizations.getEnumerationItemCustomization(e,</span>
<span class="nc" id="L1422">					info.getName());</span>
<span class="nc bnc" id="L1423" title="All 2 branches missed.">			if (i != null) {</span>
<span class="nc bnc" id="L1424" title="All 2 branches missed.">				if (i.getSpecificProperties() != null) {</span>
<span class="nc bnc" id="L1425" title="All 2 branches missed.">					if (i.getSpecificProperties().size() &gt; 0) {</span>
<span class="nc" id="L1426">						result.putAll(i.getSpecificProperties());</span>
					}
				}
			}
		}
<span class="nc" id="L1431">		return result;</span>
	}

	@Override
	protected List&lt;IMethodInfo&gt; getConstructors(ITypeInfo objectType) {
<span class="fc" id="L1436">		List&lt;IMethodInfo&gt; result = new ArrayList&lt;IMethodInfo&gt;(getMembers(objectType).getOutputConstructors());</span>
<span class="fc" id="L1437">		result = sortMethods(result, objectType);</span>
<span class="fc" id="L1438">		return result;</span>
	}

	@Override
	protected List&lt;IFieldInfo&gt; getFields(final ITypeInfo objectType) {
<span class="fc" id="L1443">		List&lt;IFieldInfo&gt; result = new ArrayList&lt;IFieldInfo&gt;(getMembers(objectType).getOutputFields());</span>
<span class="fc" id="L1444">		result = sortFields(result, objectType);</span>
<span class="fc" id="L1445">		return result;</span>
	}

	@Override
	protected List&lt;IMethodInfo&gt; getMethods(ITypeInfo objectType) {
<span class="fc" id="L1450">		List&lt;IMethodInfo&gt; result = new ArrayList&lt;IMethodInfo&gt;(getMembers(objectType).getOutputMethods());</span>
<span class="fc" id="L1451">		result = sortMethods(result, objectType);</span>
<span class="fc" id="L1452">		return result;</span>
	}

	@Override
	protected MenuModel getMenuModel(ITypeInfo type) {
<span class="fc" id="L1457">		return getMembers(type).getMenuModel();</span>
	}

	protected List&lt;IFieldInfo&gt; sortFields(List&lt;IFieldInfo&gt; fields, ITypeInfo objectType) {
<span class="fc" id="L1461">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L1462">				objectType.getName());</span>
<span class="pc bpc" id="L1463" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L1464" title="1 of 2 branches missed.">			if (t != null) {</span>
<span class="fc" id="L1465">				List&lt;IFieldInfo&gt; result = new ArrayList&lt;IFieldInfo&gt;(fields);</span>
<span class="fc bfc" id="L1466" title="All 2 branches covered.">				if (t.getCustomFieldsOrder() != null) {</span>
<span class="fc" id="L1467">					Collections.sort(result, ReflectionUIUtils.getInfosComparator(t.getCustomFieldsOrder(), result));</span>
				}
<span class="fc" id="L1469">				return result;</span>
			}
		}
<span class="nc" id="L1472">		return fields;</span>
	}

	protected List&lt;IMethodInfo&gt; sortMethods(List&lt;IMethodInfo&gt; methods, ITypeInfo objectType) {
<span class="fc" id="L1476">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(),</span>
<span class="fc" id="L1477">				objectType.getName());</span>
<span class="pc bpc" id="L1478" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc" id="L1479">			List&lt;IMethodInfo&gt; result = new ArrayList&lt;IMethodInfo&gt;(methods);</span>
<span class="fc bfc" id="L1480" title="All 2 branches covered.">			if (t.getCustomMethodsOrder() != null) {</span>
<span class="fc" id="L1481">				Collections.sort(result, ReflectionUIUtils.getInfosComparator(t.getCustomMethodsOrder(), result));</span>
			}
<span class="fc" id="L1483">			return result;</span>
		}
<span class="nc" id="L1485">		return methods;</span>
	}

	@Override
	protected String getCaption(ITypeInfo type) {
<span class="fc" id="L1490">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1491" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1492" title="All 2 branches covered.">			if (t.getCustomTypeCaption() != null) {</span>
<span class="fc" id="L1493">				return t.getCustomTypeCaption();</span>
			}
		}
<span class="fc" id="L1496">		return super.getCaption(type);</span>
	}

	@Override
	protected ResourcePath getFormBackgroundImagePath(ITypeInfo type) {
<span class="fc" id="L1501">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1502" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1503" title="All 2 branches covered.">			if (t.getFormBackgroundImagePath() != null) {</span>
<span class="fc" id="L1504">				return t.getFormBackgroundImagePath();</span>
			}
		}
<span class="fc" id="L1507">		return super.getFormBackgroundImagePath(type);</span>
	}

	@Override
	protected ColorSpecification getFormBackgroundColor(ITypeInfo type) {
<span class="fc" id="L1512">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1513" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1514" title="All 2 branches covered.">			if (t.getFormBackgroundColor() != null) {</span>
<span class="fc" id="L1515">				return t.getFormBackgroundColor();</span>
			}
		}
<span class="fc" id="L1518">		return super.getFormBackgroundColor(type);</span>
	}

	@Override
	protected ColorSpecification getFormForegroundColor(ITypeInfo type) {
<span class="fc" id="L1523">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1524" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1525" title="All 2 branches covered.">			if (t.getFormForegroundColor() != null) {</span>
<span class="fc" id="L1526">				return t.getFormForegroundColor();</span>
			}
		}
<span class="fc" id="L1529">		return super.getFormForegroundColor(type);</span>
	}

	@Override
	protected ColorSpecification getFormBorderColor(ITypeInfo type) {
<span class="fc" id="L1534">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1535" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1536" title="All 2 branches covered.">			if (t.getFormBorderColor() != null) {</span>
<span class="fc" id="L1537">				return t.getFormBorderColor();</span>
			}
		}
<span class="fc" id="L1540">		return super.getFormBorderColor(type);</span>
	}

	@Override
	protected ColorSpecification getFormEditorForegroundColor(ITypeInfo type) {
<span class="fc" id="L1545">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1546" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1547" title="All 2 branches covered.">			if (t.getFormEditorForegroundColor() != null) {</span>
<span class="fc" id="L1548">				return t.getFormEditorForegroundColor();</span>
			}
		}
<span class="fc" id="L1551">		return super.getFormEditorForegroundColor(type);</span>
	}

	@Override
	protected ColorSpecification getFormEditorBackgroundColor(ITypeInfo type) {
<span class="fc" id="L1556">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1557" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1558" title="All 2 branches covered.">			if (t.getFormEditorBackgroundColor() != null) {</span>
<span class="fc" id="L1559">				return t.getFormEditorBackgroundColor();</span>
			}
		}
<span class="fc" id="L1562">		return super.getFormEditorBackgroundColor(type);</span>
	}

	@Override
	protected ColorSpecification getFormButtonBackgroundColor(ITypeInfo type) {
<span class="fc" id="L1567">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1568" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1569" title="All 2 branches covered.">			if (t.getFormButtonBackgroundColor() != null) {</span>
<span class="fc" id="L1570">				return t.getFormButtonBackgroundColor();</span>
			}
		}
<span class="fc" id="L1573">		return super.getFormButtonBackgroundColor(type);</span>
	}

	@Override
	protected ColorSpecification getFormButtonForegroundColor(ITypeInfo type) {
<span class="fc" id="L1578">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1579" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L1580" title="1 of 2 branches missed.">			if (t.getFormButtonForegroundColor() != null) {</span>
<span class="nc" id="L1581">				return t.getFormButtonForegroundColor();</span>
			}
		}
<span class="fc" id="L1584">		return super.getFormButtonForegroundColor(type);</span>
	}

	@Override
	protected ColorSpecification getFormButtonBorderColor(ITypeInfo type) {
<span class="fc" id="L1589">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1590" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1591" title="All 2 branches covered.">			if (t.getFormButtonBorderColor() != null) {</span>
<span class="fc" id="L1592">				return t.getFormButtonBorderColor();</span>
			}
		}
<span class="fc" id="L1595">		return super.getFormButtonBorderColor(type);</span>
	}

	@Override
	protected ResourcePath getFormButtonBackgroundImagePath(ITypeInfo type) {
<span class="fc" id="L1600">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1601" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L1602" title="1 of 2 branches missed.">			if (t.getFormButtonBackgroundImagePath() != null) {</span>
<span class="nc" id="L1603">				return t.getFormButtonBackgroundImagePath();</span>
			}
		}
<span class="fc" id="L1606">		return super.getFormButtonBackgroundImagePath(type);</span>
	}

	@Override
	protected ColorSpecification getCategoriesBackgroundColor(ITypeInfo type) {
<span class="fc" id="L1611">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1612" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L1613" title="1 of 2 branches missed.">			if (t.getCategoriesBackgroundColor() != null) {</span>
<span class="nc" id="L1614">				return t.getCategoriesBackgroundColor();</span>
			}
		}
<span class="fc" id="L1617">		return super.getCategoriesBackgroundColor(type);</span>
	}

	@Override
	protected ColorSpecification getCategoriesForegroundColor(ITypeInfo type) {
<span class="fc" id="L1622">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1623" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L1624" title="1 of 2 branches missed.">			if (t.getCategoriesForegroundColor() != null) {</span>
<span class="nc" id="L1625">				return t.getCategoriesForegroundColor();</span>
			}
		}
<span class="fc" id="L1628">		return super.getCategoriesForegroundColor(type);</span>
	}

	@Override
	protected String getName(IApplicationInfo appInfo) {
<span class="nc" id="L1633">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="nc bnc" id="L1634" title="All 2 branches missed.">		if (appCustomization.getApplicationName() != null) {</span>
<span class="nc" id="L1635">			return appCustomization.getApplicationName();</span>
		}
<span class="nc" id="L1637">		return super.getName(appInfo);</span>
	}

	@Override
	protected String getCaption(IApplicationInfo appInfo) {
<span class="nc" id="L1642">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="nc bnc" id="L1643" title="All 2 branches missed.">		if (appCustomization.getCustomApplicationCaption() != null) {</span>
<span class="nc" id="L1644">			return appCustomization.getCustomApplicationCaption();</span>
		}
<span class="nc" id="L1646">		return super.getCaption(appInfo);</span>
	}

	@Override
	protected ResourcePath getIconImagePath(IApplicationInfo appInfo) {
<span class="fc" id="L1651">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1652" title="All 2 branches covered.">		if (appCustomization.getIconImagePath() != null) {</span>
<span class="fc" id="L1653">			return appCustomization.getIconImagePath();</span>
		}
<span class="fc" id="L1655">		return super.getIconImagePath(appInfo);</span>
	}

	@Override
	protected String getOnlineHelp(IApplicationInfo appInfo) {
<span class="nc" id="L1660">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="nc bnc" id="L1661" title="All 2 branches missed.">		if (appCustomization.getOnlineHelp() != null) {</span>
<span class="nc" id="L1662">			return appCustomization.getOnlineHelp();</span>
		}
<span class="nc" id="L1664">		return super.getOnlineHelp(appInfo);</span>
	}

	@Override
	protected boolean isSystemIntegrationCrossPlatform(IApplicationInfo appInfo) {
<span class="fc" id="L1669">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1670" title="All 2 branches covered.">		if (appCustomization.isSystemIntegrationCrossPlatform()) {</span>
<span class="fc" id="L1671">			return true;</span>
		}
<span class="fc" id="L1673">		return super.isSystemIntegrationCrossPlatform(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainBackgroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1678">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1679" title="All 2 branches covered.">		if (appCustomization.getMainBackgroundColor() != null) {</span>
<span class="fc" id="L1680">			return appCustomization.getMainBackgroundColor();</span>
		}
<span class="fc" id="L1682">		return super.getMainBackgroundColor(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainForegroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1687">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1688" title="All 2 branches covered.">		if (appCustomization.getMainForegroundColor() != null) {</span>
<span class="fc" id="L1689">			return appCustomization.getMainForegroundColor();</span>
		}
<span class="fc" id="L1691">		return super.getMainForegroundColor(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainBorderColor(IApplicationInfo appInfo) {
<span class="fc" id="L1696">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1697" title="All 2 branches covered.">		if (appCustomization.getMainBorderColor() != null) {</span>
<span class="fc" id="L1698">			return appCustomization.getMainBorderColor();</span>
		}
<span class="fc" id="L1700">		return super.getMainBorderColor(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainEditorBackgroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1705">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1706" title="All 2 branches covered.">		if (appCustomization.getMainEditorBackgroundColor() != null) {</span>
<span class="fc" id="L1707">			return appCustomization.getMainEditorBackgroundColor();</span>
		}
<span class="fc" id="L1709">		return super.getMainEditorBackgroundColor(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainEditorForegroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1714">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1715" title="All 2 branches covered.">		if (appCustomization.getMainEditorForegroundColor() != null) {</span>
<span class="fc" id="L1716">			return appCustomization.getMainEditorForegroundColor();</span>
		}
<span class="fc" id="L1718">		return super.getMainEditorForegroundColor(appInfo);</span>
	}

	@Override
	protected ResourcePath getMainBackgroundImagePath(IApplicationInfo appInfo) {
<span class="fc" id="L1723">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1724" title="1 of 2 branches missed.">		if (appCustomization.getMainBackgroundImagePath() != null) {</span>
<span class="nc" id="L1725">			return appCustomization.getMainBackgroundImagePath();</span>
		}
<span class="fc" id="L1727">		return super.getMainBackgroundImagePath(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainButtonBackgroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1732">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1733" title="All 2 branches covered.">		if (appCustomization.getMainButtonBackgroundColor() != null) {</span>
<span class="fc" id="L1734">			return appCustomization.getMainButtonBackgroundColor();</span>
		}
<span class="fc" id="L1736">		return super.getMainButtonBackgroundColor(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainButtonBorderColor(IApplicationInfo appInfo) {
<span class="fc" id="L1741">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1742" title="All 2 branches covered.">		if (appCustomization.getMainButtonBorderColor() != null) {</span>
<span class="fc" id="L1743">			return appCustomization.getMainButtonBorderColor();</span>
		}
<span class="fc" id="L1745">		return super.getMainButtonBorderColor(appInfo);</span>
	}

	@Override
	protected ResourcePath getMainButtonBackgroundImagePath(IApplicationInfo appInfo) {
<span class="fc" id="L1750">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1751" title="All 2 branches covered.">		if (appCustomization.getMainButtonBackgroundImagePath() != null) {</span>
<span class="fc" id="L1752">			return appCustomization.getMainButtonBackgroundImagePath();</span>
		}
<span class="fc" id="L1754">		return super.getMainButtonBackgroundImagePath(appInfo);</span>
	}

	@Override
	protected ResourcePath getButtonCustomFontResourcePath(IApplicationInfo appInfo) {
<span class="fc" id="L1759">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1760" title="1 of 2 branches missed.">		if (appCustomization.getButtonCustomFontResourcePath() != null) {</span>
<span class="nc" id="L1761">			return appCustomization.getButtonCustomFontResourcePath();</span>
		}
<span class="fc" id="L1763">		return super.getButtonCustomFontResourcePath(appInfo);</span>
	}

	@Override
	protected ResourcePath getLabelCustomFontResourcePath(IApplicationInfo appInfo) {
<span class="fc" id="L1768">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1769" title="1 of 2 branches missed.">		if (appCustomization.getLabelCustomFontResourcePath() != null) {</span>
<span class="nc" id="L1770">			return appCustomization.getLabelCustomFontResourcePath();</span>
		}
<span class="fc" id="L1772">		return super.getLabelCustomFontResourcePath(appInfo);</span>
	}

	@Override
	protected ResourcePath getEditorCustomFontResourcePath(IApplicationInfo appInfo) {
<span class="fc" id="L1777">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1778" title="1 of 2 branches missed.">		if (appCustomization.getEditorCustomFontResourcePath() != null) {</span>
<span class="nc" id="L1779">			return appCustomization.getEditorCustomFontResourcePath();</span>
		}
<span class="fc" id="L1781">		return super.getEditorCustomFontResourcePath(appInfo);</span>
	}

	@Override
	protected ResourcePath getTitleCustomFontResourcePath(IApplicationInfo appInfo) {
<span class="fc" id="L1786">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1787" title="1 of 2 branches missed.">		if (appCustomization.getTitleCustomFontResourcePath() != null) {</span>
<span class="nc" id="L1788">			return appCustomization.getTitleCustomFontResourcePath();</span>
		}
<span class="fc" id="L1790">		return super.getEditorCustomFontResourcePath(appInfo);</span>
	}

	@Override
	protected ColorSpecification getMainButtonForegroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1795">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="fc bfc" id="L1796" title="All 2 branches covered.">		if (appCustomization.getMainButtonForegroundColor() != null) {</span>
<span class="fc" id="L1797">			return appCustomization.getMainButtonForegroundColor();</span>
		}
<span class="fc" id="L1799">		return super.getMainButtonForegroundColor(appInfo);</span>
	}

	@Override
	protected ColorSpecification getTitleBackgroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1804">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1805" title="1 of 2 branches missed.">		if (appCustomization.getTitleBackgroundColor() != null) {</span>
<span class="fc" id="L1806">			return appCustomization.getTitleBackgroundColor();</span>
		}
<span class="nc" id="L1808">		return super.getTitleBackgroundColor(appInfo);</span>
	}

	@Override
	protected ColorSpecification getTitleForegroundColor(IApplicationInfo appInfo) {
<span class="fc" id="L1813">		ApplicationCustomization appCustomization = this.accessInfoCustomizations().getApplicationCustomization();</span>
<span class="pc bpc" id="L1814" title="1 of 2 branches missed.">		if (appCustomization.getTitleForegroundColor() != null) {</span>
<span class="fc" id="L1815">			return appCustomization.getTitleForegroundColor();</span>
		}
<span class="nc" id="L1817">		return super.getTitleForegroundColor(appInfo);</span>
	}

	@Override
	protected int getFormPreferredWidth(ITypeInfo type) {
<span class="fc" id="L1822">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1823" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc" id="L1824">			FormSizeCustomization size = t.getFormWidth();</span>
<span class="fc bfc" id="L1825" title="All 2 branches covered.">			if (size != null) {</span>
<span class="pc bpc" id="L1826" title="1 of 2 branches missed.">				if (size.getUnit() == FormSizeUnit.PIXELS) {</span>
<span class="fc" id="L1827">					return size.getValue();</span>
<span class="nc bnc" id="L1828" title="All 2 branches missed.">				} else if (size.getUnit() == FormSizeUnit.SCREEN_PERCENT) {</span>
<span class="nc" id="L1829">					Dimension screenSize = MiscUtils.getDefaultScreenSize();</span>
<span class="nc" id="L1830">					return Math.round((size.getValue() / 100f) * screenSize.width);</span>
				} else {
<span class="nc" id="L1832">					throw new ReflectionUIError();</span>
				}
			}
		}
<span class="fc" id="L1836">		return super.getFormPreferredWidth(type);</span>
	}

	@Override
	protected int getFormPreferredHeight(ITypeInfo type) {
<span class="fc" id="L1841">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1842" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc" id="L1843">			FormSizeCustomization size = t.getFormHeight();</span>
<span class="fc bfc" id="L1844" title="All 2 branches covered.">			if (size != null) {</span>
<span class="pc bpc" id="L1845" title="1 of 2 branches missed.">				if (size.getUnit() == FormSizeUnit.PIXELS) {</span>
<span class="fc" id="L1846">					return size.getValue();</span>
<span class="nc bnc" id="L1847" title="All 2 branches missed.">				} else if (size.getUnit() == FormSizeUnit.SCREEN_PERCENT) {</span>
<span class="nc" id="L1848">					Dimension screenSize = MiscUtils.getDefaultScreenSize();</span>
<span class="nc" id="L1849">					return Math.round((size.getValue() / 100f) * screenSize.height);</span>
				} else {
<span class="nc" id="L1851">					throw new ReflectionUIError();</span>
				}
			}
		}
<span class="fc" id="L1855">		return super.getFormPreferredHeight(type);</span>
	}

	@Override
	protected int getFormSpacing(ITypeInfo type) {
<span class="fc" id="L1860">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1861" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1862" title="All 2 branches covered.">			if (t.getFormSpacing() != null) {</span>
<span class="fc" id="L1863">				return t.getFormSpacing();</span>
			}
		}
<span class="fc" id="L1866">		return super.getFormSpacing(type);</span>
	}

	@Override
	protected void validate(ITypeInfo type, Object object, ValidationSession session) throws Exception {
<span class="fc" id="L1871">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1872" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1873" title="All 2 branches covered.">			for (IMethodInfo method : getMethods(type)) {</span>
<span class="fc" id="L1874">				MethodCustomization m = InfoCustomizations.getMethodCustomization(t, method.getSignature(), false);</span>
<span class="pc bpc" id="L1875" title="1 of 2 branches missed.">				if (m != null) {</span>
<span class="fc bfc" id="L1876" title="All 2 branches covered.">					if (m.isValidating()) {</span>
<span class="pc bpc" id="L1877" title="1 of 2 branches missed.">						if (ReflectionUIUtils.requiresParameterValue(method)) {</span>
<span class="nc" id="L1878">							throw new ReflectionUIError(</span>
<span class="nc" id="L1879">									&quot;Invalid validating method: Parameter value(s) required: &quot; + method.getSignature());</span>
						}
<span class="fc" id="L1881">						method.invoke(object, new InvocationData(object, method));</span>
					}
				}
			}
		}
<span class="fc" id="L1886">		super.validate(type, object, session);</span>
<span class="fc" id="L1887">	}</span>

	@Override
	protected void onFormVisibilityChange(ITypeInfo type, Object object, boolean visible) {
<span class="fc" id="L1891">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1892" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc bfc" id="L1893" title="All 2 branches covered.">			for (IMethodInfo method : getMethods(type)) {</span>
<span class="fc" id="L1894">				MethodCustomization m = InfoCustomizations.getMethodCustomization(t, method.getSignature(), false);</span>
<span class="pc bpc" id="L1895" title="1 of 2 branches missed.">				if (m != null) {</span>
<span class="pc bpc" id="L1896" title="3 of 8 branches missed.">					if ((m.isRunWhenObjectShown() &amp;&amp; visible) || (m.isRunWhenObjectHidden() &amp;&amp; !visible)) {</span>
<span class="pc bpc" id="L1897" title="1 of 2 branches missed.">						if (ReflectionUIUtils.requiresParameterValue(method)) {</span>
<span class="nc" id="L1898">							throw new ReflectionUIError(</span>
<span class="nc" id="L1899">									&quot;Cannot call method on object visibilty change: Parameter value(s) required: &quot;</span>
<span class="nc" id="L1900">											+ method.getSignature());</span>
						}
<span class="fc" id="L1902">						method.invoke(object, new InvocationData(object, method));</span>
					}
				}
			}
		}
<span class="fc" id="L1907">		super.onFormVisibilityChange(type, object, visible);</span>
<span class="fc" id="L1908">	}</span>

	@Override
	protected ITransaction createTransaction(ITypeInfo type, final Object object) {
<span class="fc" id="L1912">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1913" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="fc" id="L1914">			final Map&lt;TransactionalRole, List&lt;IMethodInfo&gt;&gt; transactionMethodsByRole = new HashMap&lt;InfoCustomizations.TransactionalRole, List&lt;IMethodInfo&gt;&gt;();</span>
<span class="fc" id="L1915">			transactionMethodsByRole.put(TransactionalRole.BEGIN, new ArrayList&lt;IMethodInfo&gt;());</span>
<span class="fc" id="L1916">			transactionMethodsByRole.put(TransactionalRole.COMMIT, new ArrayList&lt;IMethodInfo&gt;());</span>
<span class="fc" id="L1917">			transactionMethodsByRole.put(TransactionalRole.ROLLBACK, new ArrayList&lt;IMethodInfo&gt;());</span>
<span class="fc bfc" id="L1918" title="All 2 branches covered.">			for (IMethodInfo method : getMethods(type)) {</span>
<span class="fc" id="L1919">				MethodCustomization m = InfoCustomizations.getMethodCustomization(t, method.getSignature(), false);</span>
<span class="pc bpc" id="L1920" title="1 of 2 branches missed.">				if (m != null) {</span>
<span class="pc bpc" id="L1921" title="1 of 2 branches missed.">					if (m.getTransactionalRole() != null) {</span>
<span class="nc bnc" id="L1922" title="All 2 branches missed.">						if (ReflectionUIUtils.requiresParameterValue(method)) {</span>
<span class="nc" id="L1923">							throw new ReflectionUIError(&quot;Invalid transactional method: Parameter value(s) required: &quot;</span>
<span class="nc" id="L1924">									+ method.getSignature());</span>
						}
<span class="nc" id="L1926">						transactionMethodsByRole.get(m.getTransactionalRole()).add(method);</span>
					}
				}
			}
<span class="pc bpc" id="L1930" title="1 of 2 branches missed.">			if ((transactionMethodsByRole.get(TransactionalRole.BEGIN).size() &gt; 0)</span>
<span class="pc bpc" id="L1931" title="1 of 2 branches missed.">					|| (transactionMethodsByRole.get(TransactionalRole.COMMIT).size() &gt; 0)</span>
<span class="pc bpc" id="L1932" title="1 of 2 branches missed.">					|| (transactionMethodsByRole.get(TransactionalRole.ROLLBACK).size() &gt; 0)) {</span>
<span class="nc" id="L1933">				return new ITransaction() {</span>

					@Override
					public void rollback() {
<span class="nc bnc" id="L1937" title="All 2 branches missed.">						for (IMethodInfo method : transactionMethodsByRole.get(TransactionalRole.ROLLBACK)) {</span>
<span class="nc" id="L1938">							method.invoke(object, new InvocationData(object, method));</span>
						}
<span class="nc" id="L1940">					}</span>

					@Override
					public void commit() {
<span class="nc bnc" id="L1944" title="All 2 branches missed.">						for (IMethodInfo method : transactionMethodsByRole.get(TransactionalRole.COMMIT)) {</span>
<span class="nc" id="L1945">							method.invoke(object, new InvocationData(object, method));</span>
						}
<span class="nc" id="L1947">					}</span>

					@Override
					public void begin() {
<span class="nc bnc" id="L1951" title="All 2 branches missed.">						for (IMethodInfo method : transactionMethodsByRole.get(TransactionalRole.BEGIN)) {</span>
<span class="nc" id="L1952">							method.invoke(object, new InvocationData(object, method));</span>
						}
<span class="nc" id="L1954">					}</span>
				};
			}
		}
<span class="fc" id="L1958">		return super.createTransaction(type, object);</span>
	}

	@Override
	protected String getOnlineHelp(ITypeInfo type) {
<span class="fc" id="L1963">		TypeCustomization t = InfoCustomizations.getTypeCustomization(this.accessInfoCustomizations(), type.getName());</span>
<span class="pc bpc" id="L1964" title="1 of 2 branches missed.">		if (t != null) {</span>
<span class="pc bpc" id="L1965" title="1 of 2 branches missed.">			if (t.getOnlineHelp() != null) {</span>
<span class="nc" id="L1966">				return t.getOnlineHelp();</span>
			}
		}
<span class="fc" id="L1969">		return super.getOnlineHelp(type);</span>
	}

	protected MembersCustomizationsFactory getMembers(ITypeInfo type) {
<span class="fc" id="L1973">		return new MembersCustomizationsFactory(type);</span>
	}

	/**
	 * Helper class that customizes information about the fields and methods of a
	 * specific type according to the related {@link TypeCustomization}.
	 * 
	 * The customization is split into multiple transformations handled by the
	 * sub-classes of {@link AbstractFieldTransformer} and
	 * {@link AbstractMethodTransformer}.
	 * 
	 * Note that the order in which these transformations are executed is important
	 * since they generate proxies that are stacked and impact one another.
	 * 
	 * @author olitank
	 *
	 */
	protected class MembersCustomizationsFactory {

<span class="fc" id="L1992">		protected List&lt;MembersCapsuleFieldInfo&gt; capsuleFields = new ArrayList&lt;MembersCapsuleFieldInfo&gt;();</span>
<span class="fc" id="L1993">		protected List&lt;IFieldInfo&gt; inputFields = new ArrayList&lt;IFieldInfo&gt;();</span>
<span class="fc" id="L1994">		protected List&lt;IMethodInfo&gt; inputMethods = new ArrayList&lt;IMethodInfo&gt;();</span>
<span class="fc" id="L1995">		protected List&lt;IMethodInfo&gt; inputConstructors = new ArrayList&lt;IMethodInfo&gt;();</span>
<span class="fc" id="L1996">		protected List&lt;IFieldInfo&gt; outputFields = new ArrayList&lt;IFieldInfo&gt;();</span>
<span class="fc" id="L1997">		protected List&lt;IMethodInfo&gt; outputMethods = new ArrayList&lt;IMethodInfo&gt;();</span>
<span class="fc" id="L1998">		protected List&lt;IMethodInfo&gt; outputConstructors = new ArrayList&lt;IMethodInfo&gt;();</span>
<span class="fc" id="L1999">		protected MenuModel menuModel = new MenuModel();</span>
		protected ITypeInfo objectType;
		protected TypeCustomization objectTypeCustomization;

<span class="fc" id="L2003">		protected Map&lt;Pair&lt;MethodCustomization, ParameterCustomization&gt;, ParameterAsFieldInfo&gt; methodParameterAsFields = new HashMap&lt;Pair&lt;MethodCustomization, ParameterCustomization&gt;, ParameterAsFieldInfo&gt;();</span>

<span class="fc" id="L2005">		public MembersCustomizationsFactory(ITypeInfo objectType) {</span>
<span class="fc" id="L2006">			this.objectType = objectType;</span>
<span class="fc" id="L2007">			this.objectTypeCustomization = InfoCustomizations.getTypeCustomization(accessInfoCustomizations(),</span>
<span class="fc" id="L2008">					objectType.getName());</span>
<span class="pc bpc" id="L2009" title="1 of 2 branches missed.">			if (objectTypeCustomization != null) {</span>
<span class="fc" id="L2010">				inheritMembers(inputFields, inputMethods, inputConstructors, menuModel);</span>
<span class="fc" id="L2011">				addDeclaredMembers(inputFields, inputMethods, inputConstructors, menuModel);</span>
<span class="fc" id="L2012">				evolveMembers();</span>
<span class="fc" id="L2013">			} else {</span>
<span class="nc" id="L2014">				inheritMembers(outputFields, outputMethods, outputConstructors, menuModel);</span>
			}
<span class="fc" id="L2016">		}</span>

		protected void addDeclaredMembers(List&lt;IFieldInfo&gt; inputFields, List&lt;IMethodInfo&gt; inputMethods,
				List&lt;IMethodInfo&gt; inputConstructors, MenuModel menuModel) {
<span class="pc bpc" id="L2020" title="1 of 2 branches missed.">			if (objectTypeCustomization.isAnyDefaultObjectMemberIncluded()) {</span>
<span class="nc" id="L2021">				addDefaultObjectMembers(inputFields, inputMethods, inputConstructors);</span>
			}
<span class="pc bpc" id="L2023" title="1 of 2 branches missed.">			if (objectTypeCustomization.isAnyPersistenceMemberIncluded()) {</span>
<span class="nc" id="L2024">				addPersistenceMembers(inputFields, inputMethods, inputConstructors);</span>
			}
<span class="fc bfc" id="L2026" title="All 2 branches covered.">			for (AbstractVirtualFieldDeclaration virtualFieldDeclaration : objectTypeCustomization</span>
<span class="fc" id="L2027">					.getVirtualFieldDeclarations()) {</span>
<span class="fc" id="L2028">				IFieldInfo newField = createVirtualField(virtualFieldDeclaration);</span>
<span class="fc" id="L2029">				newField = getInfoCustomizationsSetupFactory().wrapFieldInfo(newField, objectType);</span>
<span class="fc" id="L2030">				inputFields.add(newField);</span>
			}
<span class="fc bfc" id="L2032" title="All 2 branches covered.">			for (ImportedFieldDeclaration importedFieldDeclaration : objectTypeCustomization</span>
<span class="fc" id="L2033">					.getImportedFieldDeclarations()) {</span>
<span class="fc" id="L2034">				IFieldInfo newField = getImportedField(importedFieldDeclaration);</span>
<span class="fc" id="L2035">				newField = getInfoCustomizationsSetupFactory().wrapFieldInfo(newField, objectType);</span>
<span class="fc" id="L2036">				inputFields.add(newField);</span>
			}
<span class="pc bpc" id="L2038" title="1 of 2 branches missed.">			for (ImportedMethodDeclaration importedMethodDeclaration : objectTypeCustomization</span>
<span class="pc" id="L2039">					.getImportedMethodDeclarations()) {</span>
<span class="nc" id="L2040">				IMethodInfo newMethod = getImportedMethod(importedMethodDeclaration);</span>
<span class="nc" id="L2041">				newMethod = getInfoCustomizationsSetupFactory().wrapMethodInfo(newMethod, objectType);</span>
<span class="nc" id="L2042">				inputMethods.add(newMethod);</span>
			}
<span class="fc" id="L2044">			menuModel.importContributions(</span>
<span class="fc" id="L2045">					ReflectionUIUtils.createMenuModel(objectTypeCustomization.getMenuModelCustomization()));</span>
<span class="fc" id="L2046">		}</span>

		protected IFieldInfo createVirtualField(AbstractVirtualFieldDeclaration virtualFieldDeclaration) {
<span class="pc bpc" id="L2049" title="1 of 2 branches missed.">			if (virtualFieldDeclaration instanceof VirtualFieldDeclaration) {</span>
<span class="fc" id="L2050">				VirtualFieldDeclaration basicVirtualFieldDeclaration = (VirtualFieldDeclaration) virtualFieldDeclaration;</span>
				try {
<span class="fc" id="L2052">					ITypeInfo fieldType = basicVirtualFieldDeclaration.getFieldTypeFinder().find(reflectionUI,</span>
<span class="fc" id="L2053">							new SpecificitiesIdentifier(objectType.getName(),</span>
<span class="fc" id="L2054">									basicVirtualFieldDeclaration.getFieldName()));</span>
<span class="fc" id="L2055">					return new VirtualFieldInfo(basicVirtualFieldDeclaration.getFieldName(), fieldType);</span>
<span class="nc" id="L2056">				} catch (Throwable t) {</span>
<span class="nc" id="L2057">					throw new ReflectionUIError(&quot;Type '&quot; + objectType.getName() + &quot;': Failed to create virtual field '&quot;</span>
<span class="nc" id="L2058">							+ basicVirtualFieldDeclaration.getFieldName() + &quot;': &quot; + t.toString(), t);</span>
				}
<span class="nc bnc" id="L2060" title="All 2 branches missed.">			} else if (virtualFieldDeclaration instanceof ImplicitListFieldDeclaration) {</span>
<span class="nc" id="L2061">				ImplicitListFieldDeclaration implicitListFieldDeclaration = (ImplicitListFieldDeclaration) virtualFieldDeclaration;</span>
				try {
<span class="nc" id="L2063">					ITypeInfo itemType = implicitListFieldDeclaration.getItemTypeFinder().find(reflectionUI,</span>
<span class="nc" id="L2064">							new SpecificitiesIdentifier(objectType.getName(),</span>
<span class="nc" id="L2065">									implicitListFieldDeclaration.getFieldName()));</span>
<span class="nc" id="L2066">					return new ImplicitListFieldInfo(reflectionUI, implicitListFieldDeclaration.getFieldName(),</span>
<span class="nc" id="L2067">							objectType, itemType, implicitListFieldDeclaration.getCreateMethodName(),</span>
<span class="nc" id="L2068">							implicitListFieldDeclaration.getGetMethodName(),</span>
<span class="nc" id="L2069">							implicitListFieldDeclaration.getAddMethodName(),</span>
<span class="nc" id="L2070">							implicitListFieldDeclaration.getRemoveMethodName(),</span>
<span class="nc" id="L2071">							implicitListFieldDeclaration.getSizeFieldName());</span>
<span class="nc" id="L2072">				} catch (Throwable t) {</span>
<span class="nc" id="L2073">					throw new ReflectionUIError(</span>
<span class="nc" id="L2074">							&quot;Type '&quot; + objectType.getName() + &quot;': Failed to create implicit list field '&quot;</span>
<span class="nc" id="L2075">									+ implicitListFieldDeclaration.getFieldName() + &quot;': &quot; + t.toString(),</span>
<span class="nc" id="L2076">							t);</span>
				}
			} else {
<span class="nc" id="L2079">				throw new ReflectionUIError();</span>
			}
		}

		protected IFieldInfo getImportedField(ImportedFieldDeclaration importedFieldDeclaration) {
			try {
<span class="fc" id="L2085">				ITypeInfo sourceType = importedFieldDeclaration.getSourceTypeFinder().find(reflectionUI, null);</span>
<span class="fc" id="L2086">				return new ImportedFieldInfo(reflectionUI, sourceType, importedFieldDeclaration.getSourceFieldName(),</span>
<span class="fc" id="L2087">						objectType, importedFieldDeclaration.getTargetFieldName());</span>
<span class="nc" id="L2088">			} catch (Throwable t) {</span>
<span class="nc" id="L2089">				throw new ReflectionUIError(</span>
<span class="nc" id="L2090">						&quot;Type '&quot; + objectType.getName() + &quot;': Failed to import field: &quot; + t.toString(), t);</span>
			}
		}

		protected IMethodInfo getImportedMethod(ImportedMethodDeclaration importedMethodDeclaration) {
			try {
<span class="nc" id="L2096">				ITypeInfo sourceType = importedMethodDeclaration.getSourceTypeFinder().find(reflectionUI, null);</span>
<span class="nc" id="L2097">				return new ImportedMethodInfo(sourceType, importedMethodDeclaration.getSourceMethodSignature(),</span>
<span class="nc" id="L2098">						importedMethodDeclaration.getTargetMethodName());</span>
<span class="nc" id="L2099">			} catch (Throwable t) {</span>
<span class="nc" id="L2100">				throw new ReflectionUIError(</span>
<span class="nc" id="L2101">						&quot;Type '&quot; + objectType.getName() + &quot;': Failed to import method: &quot; + t.toString(), t);</span>
			}
		}

		protected void inheritMembers(List&lt;IFieldInfo&gt; fields, List&lt;IMethodInfo&gt; methods,
				List&lt;IMethodInfo&gt; constructors, MenuModel menuModel) {
<span class="fc" id="L2107">			fields.addAll(InfoCustomizationsFactory.super.getFields(objectType));</span>
<span class="fc" id="L2108">			methods.addAll(InfoCustomizationsFactory.super.getMethods(objectType));</span>
<span class="fc" id="L2109">			constructors.addAll(InfoCustomizationsFactory.super.getConstructors(objectType));</span>
<span class="fc" id="L2110">			menuModel.importContributions(InfoCustomizationsFactory.super.getMenuModel(objectType));</span>
<span class="fc" id="L2111">		}</span>

		protected void addDefaultObjectMembers(List&lt;IFieldInfo&gt; fields, List&lt;IMethodInfo&gt; methods,
				List&lt;IMethodInfo&gt; constructors) {
<span class="nc bnc" id="L2115" title="All 2 branches missed.">			for (Method objectMethod : Object.class.getMethods()) {</span>
<span class="nc bnc" id="L2116" title="All 2 branches missed.">				if (GetterFieldInfo.GETTER_PATTERN.matcher(objectMethod.getName()).matches()) {</span>
<span class="nc" id="L2117">					IFieldInfo newField = new GetterFieldInfo(reflectionUI, objectMethod, Object.class);</span>
<span class="nc" id="L2118">					newField = getInfoCustomizationsSetupFactory().wrapFieldInfo(newField, objectType);</span>
<span class="nc" id="L2119">					fields.add(newField);</span>
<span class="nc" id="L2120">				} else {</span>
<span class="nc" id="L2121">					IMethodInfo newMethod = new DefaultMethodInfo(reflectionUI, objectMethod, Object.class);</span>
<span class="nc bnc" id="L2122" title="All 2 branches missed.">					if (newMethod.getName().equals(&quot;toString&quot;)) {</span>
<span class="nc" id="L2123">						newMethod = new MethodInfoProxy(newMethod) {</span>
							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L2126">								return ReflectionUIUtils.toString(reflectionUI, object);</span>
							}
						};
					}
<span class="nc" id="L2130">					newMethod = getInfoCustomizationsSetupFactory().wrapMethodInfo(newMethod, objectType);</span>
<span class="nc" id="L2131">					methods.add(newMethod);</span>
				}
			}
<span class="nc" id="L2134">		}</span>

		protected void addPersistenceMembers(List&lt;IFieldInfo&gt; fields, List&lt;IMethodInfo&gt; methods,
				List&lt;IMethodInfo&gt; constructors) {
<span class="nc" id="L2138">			methods.add(new SaveToFileMethod(reflectionUI, objectType));</span>
<span class="nc" id="L2139">			methods.add(new LoadFromFileMethod(reflectionUI, objectType));</span>
<span class="nc" id="L2140">		}</span>

		protected void evolveMembers() {

<span class="fc" id="L2144">			List&lt;IFieldInfo&gt; newFields = new ArrayList&lt;IFieldInfo&gt;();</span>
<span class="fc" id="L2145">			List&lt;IMethodInfo&gt; newMethods = new ArrayList&lt;IMethodInfo&gt;();</span>
<span class="fc" id="L2146">			List&lt;IMethodInfo&gt; newConstructors = new ArrayList&lt;IMethodInfo&gt;();</span>

<span class="fc" id="L2148">			List&lt;MembersCapsuleFieldInfo&gt; newCapsuleFields = encapsulateMembers(inputFields, inputMethods);</span>
<span class="fc" id="L2149">			newCapsuleFields = mergeOrAddCapsuleFields(capsuleFields, newCapsuleFields);</span>
<span class="fc" id="L2150">			newFields.addAll(newCapsuleFields);</span>

			try {
<span class="fc" id="L2153">				transformFields(inputFields, outputFields, newFields, newMethods);</span>
<span class="fc" id="L2154">				transformMethods(inputMethods, outputMethods, newFields, newMethods);</span>
<span class="fc" id="L2155">				transformMethods(inputConstructors, outputConstructors, newFields, newConstructors);</span>
<span class="pc" id="L2156">			} catch (final Throwable t) {</span>
<span class="nc" id="L2157">				reflectionUI.logError(t);</span>
<span class="nc" id="L2158">				outputFields.add(createErrorField(new ReflectionUIError(t)));</span>
<span class="nc" id="L2159">				return;</span>
			}

<span class="fc" id="L2162">			checkDuplicates(outputFields, outputMethods, outputConstructors);</span>

<span class="fc bfc" id="L2164" title="All 2 branches covered.">			for (int i = 0; i &lt; newFields.size(); i++) {</span>
<span class="fc" id="L2165">				newFields.set(i, getInfoCustomizationsSetupFactory().wrapFieldInfo(newFields.get(i), objectType));</span>
			}
<span class="fc bfc" id="L2167" title="All 2 branches covered.">			for (int i = 0; i &lt; newMethods.size(); i++) {</span>
<span class="fc" id="L2168">				newMethods.set(i, getInfoCustomizationsSetupFactory().wrapMethodInfo(newMethods.get(i), objectType));</span>
			}
<span class="pc bpc" id="L2170" title="1 of 2 branches missed.">			for (int i = 0; i &lt; newConstructors.size(); i++) {</span>
<span class="nc" id="L2171">				newConstructors.set(i,</span>
<span class="nc" id="L2172">						getInfoCustomizationsSetupFactory().wrapMethodInfo(newConstructors.get(i), objectType));</span>
			}

<span class="fc" id="L2175">			inputFields = newFields;</span>
<span class="fc" id="L2176">			inputMethods = newMethods;</span>
<span class="fc" id="L2177">			inputConstructors = newConstructors;</span>

<span class="pc bpc" id="L2179" title="1 of 6 branches missed.">			if ((inputFields.size() &gt; 0) || (inputMethods.size() &gt; 0) || (inputConstructors.size() &gt; 0)) {</span>
<span class="fc" id="L2180">				evolveMembers();</span>
			}
<span class="fc" id="L2182">		}</span>

		protected IFieldInfo createErrorField(final ReflectionUIError error) {
<span class="nc" id="L2185">			return new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

				@Override
				public Object getValue(Object object) {
<span class="nc" id="L2189">					throw error;</span>

				}

				@Override
				public String getName() {
<span class="nc" id="L2195">					return MembersCustomizationsFactory.class.getName() + &quot;.customizationError&quot;;</span>
				}

				@Override
				public String getCaption() {
<span class="nc" id="L2200">					return &quot;&quot;;</span>
				}

				@Override
				public ITypeInfo getType() {
<span class="nc" id="L2205">					return reflectionUI.getTypeInfo(new JavaTypeInfoSource(Object.class,</span>
<span class="nc" id="L2206">							new SpecificitiesIdentifier(objectType.getName(), &quot;customizationError&quot;)));</span>
				}

			};
		}

		protected void transformFields(List&lt;IFieldInfo&gt; baseFields, List&lt;IFieldInfo&gt; modifiedFields,
				List&lt;IFieldInfo&gt; newFields, List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L2214" title="All 2 branches covered.">			for (IFieldInfo field : new ArrayList&lt;IFieldInfo&gt;(baseFields)) {</span>
				try {
<span class="fc" id="L2216">					FieldCustomization f = InfoCustomizations.getFieldCustomization(objectTypeCustomization,</span>
<span class="fc" id="L2217">							field.getName());</span>
<span class="pc bpc" id="L2218" title="1 of 2 branches missed.">					if (f != null) {</span>
<span class="fc bfc" id="L2219" title="All 2 branches covered.">						for (AbstractFieldTransformer transformer : getFieldTransformers()) {</span>
<span class="fc" id="L2220">							field = transformer.process(field, f, newFields, newMethods);</span>
						}
					}
<span class="pc" id="L2223">				} catch (Throwable t) {</span>
<span class="nc" id="L2224">					throw new ReflectionUIError(&quot;Type '&quot; + objectType.getName() + &quot;': Field '&quot; + field.getName()</span>
<span class="nc" id="L2225">							+ &quot;' customization error: &quot; + t.toString(), t);</span>
				}
<span class="fc" id="L2227">				modifiedFields.add(field);</span>
			}
<span class="fc" id="L2229">		}</span>

		protected void transformMethods(List&lt;IMethodInfo&gt; baseMethods, List&lt;IMethodInfo&gt; modifiedMethods,
				List&lt;IFieldInfo&gt; newFields, List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L2233" title="All 2 branches covered.">			for (IMethodInfo method : new ArrayList&lt;IMethodInfo&gt;(baseMethods)) {</span>
				try {
<span class="fc" id="L2235">					MethodCustomization mc = InfoCustomizations.getMethodCustomization(objectTypeCustomization,</span>
<span class="fc" id="L2236">							method.getSignature());</span>
<span class="pc bpc" id="L2237" title="1 of 2 branches missed.">					if (mc != null) {</span>
<span class="fc bfc" id="L2238" title="All 2 branches covered.">						for (AbstractMethodTransformer transformer : getMethodTransformers()) {</span>
<span class="fc" id="L2239">							method = transformer.process(method, mc, newFields, newMethods);</span>
						}
					}
<span class="pc" id="L2242">				} catch (Throwable t) {</span>
<span class="nc" id="L2243">					throw new ReflectionUIError(&quot;Type '&quot; + objectType.getName() + &quot;': Method '&quot; + method.getSignature()</span>
<span class="nc" id="L2244">							+ &quot;' customization error: &quot; + t.toString(), t);</span>
				}
<span class="fc" id="L2246">				modifiedMethods.add(method);</span>
			}
<span class="fc" id="L2248">		}</span>

		protected List&lt;AbstractFieldTransformer&gt; getFieldTransformers() {
<span class="fc" id="L2251">			List&lt;AbstractFieldTransformer&gt; result = new ArrayList&lt;AbstractFieldTransformer&gt;();</span>
<span class="fc" id="L2252">			result.add(new FieldDuplicateGeneratingTransformer());</span>
<span class="fc" id="L2253">			result.add(new FieldGetterGeneratingTransformer());</span>
<span class="fc" id="L2254">			result.add(new FieldSetterGeneratingTransformer());</span>
<span class="fc" id="L2255">			result.add(new FieldNullStatusExportTransformer());</span>
<span class="fc" id="L2256">			result.add(new FieldNullStatusImportTransformer());</span>
<span class="fc" id="L2257">			result.add(new FieldCustomSetterTransformer());</span>
<span class="fc" id="L2258">			result.add(new FieldNullReplacementTransformer());</span>
<span class="fc" id="L2259">			result.add(new FieldTypeConversionTransformer());</span>
<span class="fc" id="L2260">			result.add(new FieldValueAsListTransformer());</span>
<span class="fc" id="L2261">			result.add(new FieldCommonOptionsTransformer());</span>
<span class="fc" id="L2262">			return result;</span>
		}

		protected List&lt;AbstractMethodTransformer&gt; getMethodTransformers() {
<span class="fc" id="L2266">			List&lt;AbstractMethodTransformer&gt; result = new ArrayList&lt;AbstractMethodTransformer&gt;();</span>
<span class="fc" id="L2267">			result.add(new MethodDuplicateGeneratingTransformer());</span>
<span class="fc" id="L2268">			result.add(new MethodHiddenParametersAndDefaultValuesTransformer());</span>
<span class="fc" id="L2269">			result.add(new MethodPresetsGeneratingTransformer());</span>
<span class="fc" id="L2270">			result.add(new MethodReturnValueFieldGeneratingTransformer());</span>
<span class="fc" id="L2271">			result.add(new MethodExportedParametersGeneratingTransformer());</span>
<span class="fc" id="L2272">			result.add(new MethodImportedParametersTransformer());</span>
<span class="fc" id="L2273">			result.add(new MethodParameterPropertiesTransformer());</span>
<span class="fc" id="L2274">			result.add(new MethodCommonOptionsTransformer());</span>
<span class="fc" id="L2275">			result.add(new MethodMenuItemGeneratingTransformer());</span>
<span class="fc" id="L2276">			return result;</span>
		}

		protected List&lt;MembersCapsuleFieldInfo&gt; encapsulateMembers(List&lt;IFieldInfo&gt; fields, List&lt;IMethodInfo&gt; methods) {
<span class="fc" id="L2280">			Map&lt;String, Pair&lt;List&lt;IFieldInfo&gt;, List&lt;IMethodInfo&gt;&gt;&gt; encapsulatedMembersByCapsuleFieldName = new HashMap&lt;String, Pair&lt;List&lt;IFieldInfo&gt;, List&lt;IMethodInfo&gt;&gt;&gt;();</span>
<span class="fc bfc" id="L2281" title="All 2 branches covered.">			for (IFieldInfo field : new ArrayList&lt;IFieldInfo&gt;(fields)) {</span>
<span class="fc bfc" id="L2282" title="All 2 branches covered.">				if (!field.isHidden()) {</span>
<span class="fc" id="L2283">					FieldCustomization fc = InfoCustomizations.getFieldCustomization(objectTypeCustomization,</span>
<span class="fc" id="L2284">							field.getName());</span>
<span class="pc bpc" id="L2285" title="1 of 2 branches missed.">					if (fc != null) {</span>
<span class="fc bfc" id="L2286" title="All 2 branches covered.">						if (!fc.isHidden()) {</span>
<span class="fc bfc" id="L2287" title="All 2 branches covered.">							if (fc.getEncapsulationFieldName() != null) {</span>
<span class="fc" id="L2288">								Pair&lt;List&lt;IFieldInfo&gt;, List&lt;IMethodInfo&gt;&gt; encapsulatedMembers = encapsulatedMembersByCapsuleFieldName</span>
<span class="fc" id="L2289">										.get(fc.getEncapsulationFieldName());</span>
<span class="fc bfc" id="L2290" title="All 2 branches covered.">								if (encapsulatedMembers == null) {</span>
<span class="fc" id="L2291">									encapsulatedMembers = new Pair&lt;List&lt;IFieldInfo&gt;, List&lt;IMethodInfo&gt;&gt;(</span>
<span class="fc" id="L2292">											new ArrayList&lt;IFieldInfo&gt;(), new ArrayList&lt;IMethodInfo&gt;());</span>
<span class="fc" id="L2293">									encapsulatedMembersByCapsuleFieldName.put(fc.getEncapsulationFieldName(),</span>
<span class="fc" id="L2294">											encapsulatedMembers);</span>
								}
<span class="fc" id="L2296">								encapsulatedMembers.getFirst().add(field);</span>
<span class="fc" id="L2297">								MiscUtils.replaceItem(fields, field, new HiddenFieldInfoProxy(field));</span>
							}
						}
					}
				}
			}

<span class="fc bfc" id="L2304" title="All 2 branches covered.">			for (IMethodInfo method : new ArrayList&lt;IMethodInfo&gt;(methods)) {</span>
<span class="fc" id="L2305">				MethodCustomization mc = InfoCustomizations.getMethodCustomization(objectTypeCustomization,</span>
<span class="fc" id="L2306">						method.getSignature());</span>
<span class="fc bfc" id="L2307" title="All 2 branches covered.">				if (!method.isHidden()) {</span>
<span class="pc bpc" id="L2308" title="1 of 2 branches missed.">					if (mc != null) {</span>
<span class="fc bfc" id="L2309" title="All 2 branches covered.">						if (!mc.isHidden()) {</span>
<span class="fc bfc" id="L2310" title="All 2 branches covered.">							if (mc.getEncapsulationFieldName() != null) {</span>
<span class="fc" id="L2311">								Pair&lt;List&lt;IFieldInfo&gt;, List&lt;IMethodInfo&gt;&gt; encapsulatedMembers = encapsulatedMembersByCapsuleFieldName</span>
<span class="fc" id="L2312">										.get(mc.getEncapsulationFieldName());</span>
<span class="fc bfc" id="L2313" title="All 2 branches covered.">								if (encapsulatedMembers == null) {</span>
<span class="fc" id="L2314">									encapsulatedMembers = new Pair&lt;List&lt;IFieldInfo&gt;, List&lt;IMethodInfo&gt;&gt;(</span>
<span class="fc" id="L2315">											new ArrayList&lt;IFieldInfo&gt;(), new ArrayList&lt;IMethodInfo&gt;());</span>
<span class="fc" id="L2316">									encapsulatedMembersByCapsuleFieldName.put(mc.getEncapsulationFieldName(),</span>
<span class="fc" id="L2317">											encapsulatedMembers);</span>
								}
<span class="fc" id="L2319">								encapsulatedMembers.getSecond().add(method);</span>
<span class="fc" id="L2320">								MiscUtils.replaceItem(methods, method, new HiddenMethodInfoProxy(method));</span>
							}
						}
					}
				}
			}
<span class="fc bfc" id="L2326" title="All 2 branches covered.">			if (encapsulatedMembersByCapsuleFieldName.size() == 0) {</span>
<span class="fc" id="L2327">				return Collections.emptyList();</span>
			}
<span class="fc" id="L2329">			List&lt;MembersCapsuleFieldInfo&gt; result = new ArrayList&lt;MembersCapsuleFieldInfo&gt;();</span>
<span class="fc bfc" id="L2330" title="All 2 branches covered.">			for (String capsuleFieldName : encapsulatedMembersByCapsuleFieldName.keySet()) {</span>
<span class="fc" id="L2331">				Pair&lt;List&lt;IFieldInfo&gt;, List&lt;IMethodInfo&gt;&gt; encapsulatedMembers = encapsulatedMembersByCapsuleFieldName</span>
<span class="fc" id="L2332">						.get(capsuleFieldName);</span>
<span class="fc" id="L2333">				List&lt;IFieldInfo&gt; encapsulatedFields = encapsulatedMembers.getFirst();</span>
<span class="fc" id="L2334">				List&lt;IMethodInfo&gt; encapsulatedMethods = encapsulatedMembers.getSecond();</span>
<span class="fc" id="L2335">				MembersCapsuleFieldInfo capsuleField = new MembersCapsuleFieldInfo(reflectionUI, capsuleFieldName,</span>
<span class="fc" id="L2336">						encapsulatedFields, encapsulatedMethods, objectType);</span>
<span class="fc" id="L2337">				result.add(capsuleField);</span>
			}
<span class="fc" id="L2339">			return result;</span>
		}

		protected List&lt;MembersCapsuleFieldInfo&gt; mergeOrAddCapsuleFields(List&lt;MembersCapsuleFieldInfo&gt; capsuleFields,
				List&lt;MembersCapsuleFieldInfo&gt; toMerge) {
<span class="fc" id="L2344">			List&lt;MembersCapsuleFieldInfo&gt; notMerged = new ArrayList&lt;MembersCapsuleFieldInfo&gt;();</span>
<span class="fc bfc" id="L2345" title="All 2 branches covered.">			for (MembersCapsuleFieldInfo newField : toMerge) {</span>
<span class="fc" id="L2346">				boolean merged = false;</span>
<span class="fc bfc" id="L2347" title="All 2 branches covered.">				for (MembersCapsuleFieldInfo oldField : capsuleFields) {</span>
<span class="fc bfc" id="L2348" title="All 2 branches covered.">					if (newField.getName().equals(oldField.getName())) {</span>
<span class="fc" id="L2349">						oldField.getEncapsulatedFields().addAll(newField.getEncapsulatedFields());</span>
<span class="fc" id="L2350">						oldField.getEncapsulatedMethods().addAll(newField.getEncapsulatedMethods());</span>
<span class="fc" id="L2351">						merged = true;</span>
					}
				}
<span class="fc bfc" id="L2354" title="All 2 branches covered.">				if (!merged) {</span>
<span class="fc" id="L2355">					capsuleFields.add(newField);</span>
<span class="fc" id="L2356">					notMerged.add(newField);</span>
				}
			}
<span class="fc" id="L2359">			return notMerged;</span>
		}

		protected void checkDuplicates(List&lt;IFieldInfo&gt; outputFields, List&lt;IMethodInfo&gt; outputMethods,
				List&lt;IMethodInfo&gt; outputConstructors) {
<span class="fc bfc" id="L2364" title="All 2 branches covered.">			for (int i = 0; i &lt; outputFields.size(); i++) {</span>
<span class="fc bfc" id="L2365" title="All 2 branches covered.">				for (int j = i + 1; j &lt; outputFields.size(); j++) {</span>
<span class="fc" id="L2366">					IFieldInfo field1 = outputFields.get(i);</span>
<span class="fc" id="L2367">					IFieldInfo field2 = outputFields.get(j);</span>
<span class="pc bpc" id="L2368" title="1 of 2 branches missed.">					if (field1.getName().equals(field2.getName())) {</span>
<span class="nc" id="L2369">						IFieldInfo errorField = new FieldInfoProxy(field2) {</span>

							@Override
							public Object getValue(Object object) {
<span class="nc" id="L2373">								throw new ReflectionUIError(&quot;Duplicate field name detected: '&quot; + super.getName()</span>
<span class="nc" id="L2374">										+ &quot;' in type '&quot; + objectType.getName() + &quot;'&quot;);</span>

							}

							@Override
							public String getName() {
<span class="nc" id="L2380">								return super.getName() + &quot;.duplicateError&quot;;</span>
							}

							@Override
							public ITypeInfo getType() {
<span class="nc" id="L2385">								return reflectionUI.getTypeInfo(new JavaTypeInfoSource(Object.class,</span>
<span class="nc" id="L2386">										new SpecificitiesIdentifier(objectType.getName(), getName())));</span>
							}

						};
<span class="nc" id="L2390">						outputFields.set(outputFields.indexOf(field2), errorField);</span>
					}
				}
			}
<span class="fc bfc" id="L2394" title="All 2 branches covered.">			for (int i = 0; i &lt; outputMethods.size(); i++) {</span>
<span class="fc bfc" id="L2395" title="All 2 branches covered.">				for (int j = i + 1; j &lt; outputMethods.size(); j++) {</span>
<span class="fc" id="L2396">					IMethodInfo method1 = outputMethods.get(i);</span>
<span class="fc" id="L2397">					IMethodInfo method2 = outputMethods.get(j);</span>
<span class="pc bpc" id="L2398" title="1 of 2 branches missed.">					if (method1.getSignature().equals(method2.getSignature())) {</span>
<span class="nc" id="L2399">						IMethodInfo errorMethod = new MethodInfoProxy(method2) {</span>

							@Override
							public String getCaption() {
<span class="nc" id="L2403">								return &quot;(Duplicate) &quot; + super.getCaption();</span>
							}

							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L2408">								throw new ReflectionUIError(&quot;Duplicate method name detected: '&quot; + super.getName()</span>
<span class="nc" id="L2409">										+ &quot;' in type '&quot; + objectType.getName() + &quot;'&quot;);</span>
							}

							@Override
							public String getName() {
<span class="nc" id="L2414">								return super.getName() + &quot;.duplicateError&quot;;</span>
							}

							@Override
							public String getSignature() {
<span class="nc" id="L2419">								return ReflectionUIUtils.buildMethodSignature(this);</span>
							}

						};
<span class="nc" id="L2423">						outputMethods.set(outputMethods.indexOf(method2), errorMethod);</span>
					}
				}
			}
<span class="fc bfc" id="L2427" title="All 2 branches covered.">			for (int i = 0; i &lt; outputConstructors.size(); i++) {</span>
<span class="fc bfc" id="L2428" title="All 2 branches covered.">				for (int j = i + 1; j &lt; outputConstructors.size(); j++) {</span>
<span class="fc" id="L2429">					IMethodInfo constructor1 = outputConstructors.get(i);</span>
<span class="fc" id="L2430">					IMethodInfo constructor2 = outputConstructors.get(j);</span>
<span class="pc bpc" id="L2431" title="1 of 2 branches missed.">					if (constructor1.getSignature().equals(constructor2.getSignature())) {</span>
<span class="nc" id="L2432">						IMethodInfo errorConstructor = new MethodInfoProxy(constructor2) {</span>

							@Override
							public String getCaption() {
<span class="nc" id="L2436">								return &quot;(Duplicate) &quot; + super.getCaption();</span>
							}

							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L2441">								throw new ReflectionUIError(&quot;Duplicate constructor name detected: '&quot; + super.getName()</span>
<span class="nc" id="L2442">										+ &quot;' in type '&quot; + objectType.getName() + &quot;'&quot;);</span>
							}

							@Override
							public String getName() {
<span class="nc" id="L2447">								return super.getName() + &quot;.duplicateError&quot;;</span>
							}

							@Override
							public String getSignature() {
<span class="nc" id="L2452">								return ReflectionUIUtils.buildMethodSignature(this);</span>
							}

						};
<span class="nc" id="L2456">						outputConstructors.set(outputConstructors.indexOf(constructor2), errorConstructor);</span>
					}
				}
			}
<span class="fc" id="L2460">		}</span>

		public List&lt;IFieldInfo&gt; getOutputFields() {
<span class="fc" id="L2463">			return outputFields;</span>
		}

		public List&lt;IMethodInfo&gt; getOutputMethods() {
<span class="fc" id="L2467">			return outputMethods;</span>
		}

		public List&lt;IMethodInfo&gt; getOutputConstructors() {
<span class="fc" id="L2471">			return outputConstructors;</span>
		}

		public MenuModel getMenuModel() {
<span class="fc" id="L2475">			return menuModel;</span>
		}

<span class="fc" id="L2478">		protected class MethodParameterPropertiesTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, final MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc" id="L2483">				method = new MethodInfoProxy(method) {</span>

					@Override
					public List&lt;IParameterInfo&gt; getParameters() {
<span class="fc" id="L2487">						List&lt;IParameterInfo&gt; result = new ArrayList&lt;IParameterInfo&gt;();</span>
<span class="fc bfc" id="L2488" title="All 2 branches covered.">						for (IParameterInfo param : super.getParameters()) {</span>
<span class="fc" id="L2489">							final ParameterCustomization pc = InfoCustomizations.getParameterCustomization(mc,</span>
<span class="fc" id="L2490">									param.getName());</span>
<span class="pc bpc" id="L2491" title="1 of 2 branches missed.">							if (pc != null) {</span>
<span class="fc" id="L2492">								param = new ParameterInfoProxy(param) {</span>

									@Override
									public boolean isNullValueDistinct() {
<span class="pc bpc" id="L2496" title="1 of 2 branches missed.">										if (pc.isNullValueDistinctForced()) {</span>
<span class="nc" id="L2497">											return true;</span>
										}
<span class="fc" id="L2499">										return super.isNullValueDistinct();</span>
									}

									@Override
									public Map&lt;String, Object&gt; getSpecificProperties() {
<span class="nc" id="L2504">										Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(</span>
<span class="nc" id="L2505">												super.getSpecificProperties());</span>
<span class="nc" id="L2506">										traceActiveCustomizations(result);</span>
<span class="nc" id="L2507">										result.putAll(pc.getSpecificProperties());</span>
<span class="nc" id="L2508">										return result;</span>
									}

									@Override
									public String getCaption() {
<span class="pc bpc" id="L2513" title="1 of 2 branches missed.">										if (pc.getCustomParameterCaption() != null) {</span>
<span class="nc" id="L2514">											return pc.getCustomParameterCaption();</span>
										}
<span class="fc" id="L2516">										return super.getCaption();</span>
									}

									@Override
									public String getOnlineHelp() {
<span class="pc bpc" id="L2521" title="1 of 2 branches missed.">										if (pc.getOnlineHelp() != null) {</span>
<span class="nc" id="L2522">											return pc.getOnlineHelp();</span>
										}
<span class="fc" id="L2524">										return super.getOnlineHelp();</span>
									}

								};
							}
<span class="fc" id="L2529">							result.add(param);</span>
						}
<span class="fc" id="L2531">						return result;</span>
					}

				};
<span class="fc" id="L2535">				return method;</span>
			}

		}

<span class="fc" id="L2540">		protected class MethodHiddenParametersAndDefaultValuesTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, final MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc" id="L2545">				method = new MethodInfoProxy(method) {</span>

					@Override
					public List&lt;IParameterInfo&gt; getParameters() {
<span class="fc" id="L2549">						List&lt;IParameterInfo&gt; result = new ArrayList&lt;IParameterInfo&gt;();</span>
<span class="fc bfc" id="L2550" title="All 2 branches covered.">						for (IParameterInfo param : super.getParameters()) {</span>
<span class="fc" id="L2551">							final ParameterCustomization pc = InfoCustomizations.getParameterCustomization(mc,</span>
<span class="fc" id="L2552">									param.getName());</span>
<span class="pc bpc" id="L2553" title="1 of 2 branches missed.">							if (pc != null) {</span>
<span class="fc" id="L2554">								param = new ParameterInfoProxy(param) {</span>

									@Override
									public boolean isHidden() {
<span class="pc bpc" id="L2558" title="2 of 4 branches missed.">										if (pc.isHidden() || pc.isDisplayedAsField()) {</span>
<span class="nc" id="L2559">											return true;</span>
										}
<span class="fc" id="L2561">										return super.isHidden();</span>
									}

									@Override
									public Object getDefaultValue(Object object) {
<span class="fc" id="L2566">										ParameterAsFieldInfo methodParameterAsField = MembersCustomizationsFactory.this.methodParameterAsFields</span>
<span class="fc" id="L2567">												.get(new Pair&lt;MethodCustomization, ParameterCustomization&gt;(mc, pc));</span>
<span class="pc bpc" id="L2568" title="1 of 2 branches missed.">										if (methodParameterAsField != null) {</span>
<span class="nc bnc" id="L2569" title="All 2 branches missed.">											if (methodParameterAsField.isInitialized(object)) {</span>
<span class="nc" id="L2570">												return methodParameterAsField.getValue(object);</span>
											}
										}
<span class="fc" id="L2573">										Object defaultValue = pc.getDefaultValue().load(reflectionUI);</span>
<span class="pc bpc" id="L2574" title="1 of 2 branches missed.">										if (defaultValue != null) {</span>
<span class="nc" id="L2575">											return defaultValue;</span>
										}
<span class="fc" id="L2577">										return super.getDefaultValue(object);</span>
									}

								};
							}
<span class="fc" id="L2582">							result.add(param);</span>
						}
<span class="fc" id="L2584">						return result;</span>
					}

				};
<span class="fc" id="L2588">				return method;</span>
			}

		}

<span class="fc" id="L2593">		protected class MethodCommonOptionsTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, final MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc" id="L2598">				method = new MethodInfoProxy(method) {</span>

					@Override
					public boolean isEnabled(Object object) {
<span class="fc bfc" id="L2602" title="All 2 branches covered.">						if (mc.getEnablementStatusFieldName() != null) {</span>
<span class="fc" id="L2603">							IFieldInfo field = ReflectionUIUtils.findInfoByName(outputFields,</span>
<span class="fc" id="L2604">									mc.getEnablementStatusFieldName());</span>
<span class="pc bpc" id="L2605" title="1 of 2 branches missed.">							if (field == null) {</span>
<span class="nc" id="L2606">								throw new ReflectionUIError(&quot;Enablement status field not found: '&quot;</span>
<span class="nc" id="L2607">										+ mc.getEnablementStatusFieldName() + &quot;'&quot;);</span>
							}
<span class="fc" id="L2609">							Object enablementStatus = field.getValue(object);</span>
<span class="pc bpc" id="L2610" title="1 of 2 branches missed.">							if (!(enablementStatus instanceof Boolean)) {</span>
<span class="nc" id="L2611">								throw new ReflectionUIError(</span>
<span class="nc" id="L2612">										&quot;Invalid enablement status field value (boolean expected): '&quot; + enablementStatus</span>
<span class="nc" id="L2613">												+ &quot;'&quot;);</span>
							}
<span class="fc" id="L2615">							return (boolean) enablementStatus;</span>
						}
<span class="fc" id="L2617">						return super.isEnabled(object);</span>
					}

					@Override
					public boolean isHidden() {
<span class="fc bfc" id="L2622" title="All 2 branches covered.">						if (mc.isHidden()) {</span>
<span class="fc" id="L2623">							return true;</span>
						}
<span class="fc" id="L2625">						return super.isHidden();</span>
					}

					@Override
					public boolean isRelevant(Object object) {
<span class="pc bpc" id="L2630" title="1 of 2 branches missed.">						if (mc.getRelevanceStatusFieldName() != null) {</span>
<span class="nc" id="L2631">							IFieldInfo field = ReflectionUIUtils.findInfoByName(outputFields,</span>
<span class="nc" id="L2632">									mc.getRelevanceStatusFieldName());</span>
<span class="nc bnc" id="L2633" title="All 2 branches missed.">							if (field == null) {</span>
<span class="nc" id="L2634">								throw new ReflectionUIError(</span>
<span class="nc" id="L2635">										&quot;Relevance status field not found: '&quot; + mc.getRelevanceStatusFieldName() + &quot;'&quot;);</span>
							}
<span class="nc" id="L2637">							Object relevanceStatus = field.getValue(object);</span>
<span class="nc bnc" id="L2638" title="All 2 branches missed.">							if (!(relevanceStatus instanceof Boolean)) {</span>
<span class="nc" id="L2639">								throw new ReflectionUIError(&quot;Invalid relevance status field value (boolean expected): '&quot;</span>
<span class="nc" id="L2640">										+ relevanceStatus + &quot;'&quot;);</span>
							}
<span class="nc" id="L2642">							return (boolean) relevanceStatus;</span>
						}
<span class="fc" id="L2644">						return super.isRelevant(object);</span>
					}

					@Override
					public String getConfirmationMessage(Object object, InvocationData invocationData) {
<span class="pc bpc" id="L2649" title="1 of 2 branches missed.">						if (mc.getConfirmationMessage() != null) {</span>
<span class="nc" id="L2650">							return mc.getConfirmationMessage();</span>
						}
<span class="fc" id="L2652">						return super.getConfirmationMessage(object, invocationData);</span>
					}

					@Override
					public String getExecutionSuccessMessage() {
<span class="pc bpc" id="L2657" title="1 of 2 branches missed.">						if (mc.getExecutionSuccessMessage() != null) {</span>
<span class="nc" id="L2658">							return mc.getExecutionSuccessMessage();</span>
						}
<span class="fc" id="L2660">						return super.getExecutionSuccessMessage();</span>
					}

					@Override
					public String getParametersValidationCustomCaption() {
<span class="fc bfc" id="L2665" title="All 2 branches covered.">						if (mc.getParametersValidationCustomCaption() != null) {</span>
<span class="fc" id="L2666">							return mc.getParametersValidationCustomCaption();</span>
						}
<span class="fc" id="L2668">						return super.getParametersValidationCustomCaption();</span>
					}

					@Override
					public boolean isReturnValueIgnored() {
<span class="pc bpc" id="L2673" title="1 of 2 branches missed.">						if (mc.isIgnoredReturnValueForced()) {</span>
<span class="nc" id="L2674">							return true;</span>
						}
<span class="fc" id="L2676">						return super.isReturnValueIgnored();</span>
					}

					@Override
					public boolean isReturnValueDetached() {
<span class="pc bpc" id="L2681" title="1 of 2 branches missed.">						if (mc.isDetachedReturnValueForced()) {</span>
<span class="nc" id="L2682">							return true;</span>
						}
<span class="fc" id="L2684">						return super.isReturnValueDetached();</span>
					}

					@Override
					public boolean isControlReturnValueValiditionEnabled() {
<span class="fc bfc" id="L2689" title="All 2 branches covered.">						if (mc.isReturnValueValidityDetectionForced()) {</span>
<span class="fc" id="L2690">							return true;</span>
						}
<span class="fc" id="L2692">						return super.isControlReturnValueValiditionEnabled();</span>
					}

					@Override
					public boolean isLastInvocationDataUsedByDefault() {
<span class="pc bpc" id="L2697" title="1 of 2 branches missed.">						if (mc.isLastInvocationDataUsageDisabled()) {</span>
<span class="nc" id="L2698">							return false;</span>
						}
<span class="fc" id="L2700">						return super.isLastInvocationDataUsedByDefault();</span>
					}

					@Override
					public String getNullReturnValueLabel() {
<span class="nc bnc" id="L2705" title="All 2 branches missed.">						if (mc.getNullReturnValueLabel() != null) {</span>
<span class="nc" id="L2706">							return mc.getNullReturnValueLabel();</span>
						}
<span class="nc" id="L2708">						return super.getNullReturnValueLabel();</span>
					}

					@Override
					public ValueReturnMode getValueReturnMode() {
<span class="fc bfc" id="L2713" title="All 2 branches covered.">						if (mc.getCustomValueReturnMode() != null) {</span>
<span class="fc" id="L2714">							return mc.getCustomValueReturnMode();</span>
						}
<span class="fc" id="L2716">						return super.getValueReturnMode();</span>
					}

					@Override
					public ResourcePath getIconImagePath() {
<span class="fc" id="L2721">						ResourcePath result = mc.getIconImagePath();</span>
<span class="fc bfc" id="L2722" title="All 2 branches covered.">						if (result != null) {</span>
<span class="pc bpc" id="L2723" title="1 of 2 branches missed.">							if (result.getSpecification().length() &gt; 0) {</span>
<span class="fc" id="L2724">								return result;</span>
							}
						}
<span class="fc" id="L2727">						return super.getIconImagePath();</span>
					}

					@Override
					public Map&lt;String, Object&gt; getSpecificProperties() {
<span class="nc" id="L2732">						Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(super.getSpecificProperties());</span>
<span class="nc" id="L2733">						traceActiveCustomizations(result);</span>
<span class="nc" id="L2734">						result.putAll(mc.getSpecificProperties());</span>
<span class="nc" id="L2735">						return result;</span>
					}

					@Override
					public boolean isReadOnly() {
<span class="fc bfc" id="L2740" title="All 2 branches covered.">						if (mc.isReadOnlyForced()) {</span>
<span class="fc" id="L2741">							return true;</span>
						}
<span class="fc" id="L2743">						return super.isReadOnly();</span>
					}

					@Override
					public String getCaption() {
<span class="fc bfc" id="L2748" title="All 2 branches covered.">						if (mc.getCustomMethodCaption() != null) {</span>
<span class="fc" id="L2749">							return mc.getCustomMethodCaption();</span>
						}
<span class="fc" id="L2751">						return super.getCaption();</span>
					}

					@Override
					public InfoCategory getCategory() {
<span class="fc" id="L2756">						String categoryName = mc.getCategoryName();</span>
<span class="fc" id="L2757">						List&lt;CustomizationCategory&gt; categories = objectTypeCustomization.getMemberCategories();</span>
<span class="fc" id="L2758">						int categoryPosition = -1;</span>
<span class="fc" id="L2759">						int i = 0;</span>
<span class="fc bfc" id="L2760" title="All 2 branches covered.">						for (CustomizationCategory c : categories) {</span>
<span class="fc bfc" id="L2761" title="All 2 branches covered.">							if (c.getName().equals(categoryName)) {</span>
<span class="fc" id="L2762">								categoryPosition = i;</span>
<span class="fc" id="L2763">								break;</span>
							}
<span class="fc" id="L2765">							i++;</span>
						}
<span class="fc bfc" id="L2767" title="All 2 branches covered.">						if (categoryPosition != -1) {</span>
<span class="fc" id="L2768">							CustomizationCategory category = categories.get(categoryPosition);</span>
<span class="fc" id="L2769">							return new InfoCategory(category.getCaption(), categoryPosition,</span>
<span class="pc bpc" id="L2770" title="1 of 2 branches missed.">									(category.getIconImagePath() == null) ? null</span>
<span class="nc" id="L2771">											: new ResourcePath(category.getIconImagePath().getSpecification()));</span>
						}
<span class="fc" id="L2773">						return super.getCategory();</span>
					}

					@Override
					public String getOnlineHelp() {
<span class="fc bfc" id="L2778" title="All 2 branches covered.">						if (mc.getOnlineHelp() != null) {</span>
<span class="fc" id="L2779">							return mc.getOnlineHelp();</span>
						}
<span class="fc" id="L2781">						return super.getOnlineHelp();</span>
					}

				};
<span class="fc" id="L2785">				return method;</span>
			}

		}

<span class="fc" id="L2790">		protected class MethodMenuItemGeneratingTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L2795" title="All 2 branches covered.">				if (mc.getMenuLocation() != null) {</span>
<span class="fc" id="L2796">					IMenuElementPosition menuItemContainerPosition = ReflectionUIUtils.getMenuElementPosition(</span>
<span class="fc" id="L2797">							objectTypeCustomization.getMenuModelCustomization(), mc.getMenuLocation());</span>
<span class="fc bfc" id="L2798" title="All 2 branches covered.">					if (menuItemContainerPosition != null) {</span>
<span class="fc" id="L2799">						IMenuElementInfo actionMenuItem = new MethodActionMenuItemInfo(reflectionUI,</span>
<span class="fc" id="L2800">								wrapMethodInfo(method, objectType));</span>
<span class="fc" id="L2801">						menuModel.importContribution(menuItemContainerPosition, actionMenuItem);</span>
					}
				}
<span class="fc" id="L2804">				return method;</span>
			}

		}

<span class="fc" id="L2809">		protected class MethodDuplicateGeneratingTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="pc bpc" id="L2814" title="1 of 2 branches missed.">				if (mc.isDuplicateGenerated()) {</span>
<span class="nc" id="L2815">					newMethods.add(new MethodInfoProxy(method) {</span>

						@Override
						public String getSignature() {
<span class="nc" id="L2819">							return ReflectionUIUtils.buildMethodSignature(this);</span>
						}

						@Override
						public String getName() {
<span class="nc" id="L2824">							return super.getName() + &quot;.duplicate&quot;;</span>
						}

						@Override
						public String getCaption() {
<span class="nc" id="L2829">							return ReflectionUIUtils.composeMessage(super.getCaption(), &quot;Duplicate&quot;);</span>
						}

						@Override
						public boolean isHidden() {
<span class="nc" id="L2834">							return false;</span>
						}
					});
				}
<span class="fc" id="L2838">				return method;</span>
			}

		}

<span class="fc" id="L2843">		protected class MethodReturnValueFieldGeneratingTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L2848" title="All 2 branches covered.">				if (mc.isReturnValueFieldGenerated()) {</span>
<span class="fc" id="L2849">					newFields.add(new MethodReturnValueAsFieldInfo(reflectionUI, method, objectType) {</span>

						@Override
						public boolean isHidden() {
<span class="fc" id="L2853">							return false;</span>
						}
					});
				}
<span class="fc" id="L2857">				return method;</span>
			}

		}

<span class="fc" id="L2862">		protected class MethodImportedParametersTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="pc bpc" id="L2867" title="1 of 2 branches missed.">				if (mc.getParameterizedFieldNames().size() &gt; 0) {</span>
<span class="nc" id="L2868">					List&lt;IFieldInfo&gt; parameterizedFields = new ArrayList&lt;IFieldInfo&gt;();</span>
<span class="nc bnc" id="L2869" title="All 2 branches missed.">					for (final String fieldName : mc.getParameterizedFieldNames()) {</span>
<span class="nc" id="L2870">						IFieldInfo field = new DelegatingFieldInfo() {</span>

							@Override
							protected IFieldInfo getDelegate() {
<span class="nc" id="L2874">								IFieldInfo result = ReflectionUIUtils.findInfoByName(outputFields, fieldName);</span>
<span class="nc bnc" id="L2875" title="All 2 branches missed.">								if (result == null) {</span>
<span class="nc" id="L2876">									return createErrorField(new ReflectionUIError(</span>
<span class="nc" id="L2877">											&quot;Parameterized field not found: '&quot; + fieldName + &quot;'&quot;));</span>
								}
<span class="nc" id="L2879">								return result;</span>
							}

							@Override
							protected Object getDelegateId() {
<span class="nc" id="L2884">								return fieldName;</span>
							}
						};
<span class="nc" id="L2887">						parameterizedFields.add(field);</span>
					}
<span class="nc" id="L2889">					method = new ParameterizedFieldsMethodInfo(reflectionUI, method, parameterizedFields, objectType) {</span>
						/*
						 * The method signature is not modified since it identifies this customization.
						 * Otherwise it will not be possible to disable the customization.
						 */
						@Override
						public String getSignature() {
<span class="nc" id="L2896">							return base.getSignature();</span>
						}
					};
				}
<span class="fc" id="L2900">				return method;</span>
			}

		}

<span class="fc" id="L2905">		protected class MethodExportedParametersGeneratingTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L2910" title="All 2 branches covered.">				for (final IParameterInfo param : method.getParameters()) {</span>
<span class="fc" id="L2911">					final ParameterCustomization pc = InfoCustomizations.getParameterCustomization(mc, param.getName());</span>
<span class="pc bpc" id="L2912" title="1 of 2 branches missed.">					if (pc != null) {</span>
<span class="pc bpc" id="L2913" title="1 of 2 branches missed.">						if (pc.isDisplayedAsField()) {</span>
<span class="nc" id="L2914">							ParameterAsFieldInfo methodParameterAsField = new ParameterAsFieldInfo(reflectionUI, method,</span>
<span class="nc" id="L2915">									param, objectType) {</span>

								@Override
								public String getCaption() {
<span class="nc" id="L2919">									return ReflectionUIUtils.composeMessage(method.getCaption(), param.getCaption());</span>
								}

								@Override
								public boolean isHidden() {
<span class="nc" id="L2924">									return false;</span>
								}
							};
<span class="nc" id="L2927">							MembersCustomizationsFactory.this.methodParameterAsFields.put(</span>
<span class="nc" id="L2928">									new Pair&lt;MethodCustomization, ParameterCustomization&gt;(mc, pc),</span>
<span class="nc" id="L2929">									methodParameterAsField);</span>
<span class="nc" id="L2930">							newFields.add(methodParameterAsField);</span>
						}
					}
				}
<span class="fc" id="L2934">				return method;</span>
			}

		}

<span class="fc" id="L2939">		protected class MethodPresetsGeneratingTransformer extends AbstractMethodTransformer {</span>

			@Override
			public IMethodInfo process(IMethodInfo method, MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L2944" title="All 2 branches covered.">				for (int i = 0; i &lt; mc.getSerializedInvocationDatas().size(); i++) {</span>
<span class="fc" id="L2945">					final TextualStorage invocationDataStorage = mc.getSerializedInvocationDatas().get(i);</span>
<span class="fc" id="L2946">					final int finalI = i;</span>
<span class="fc" id="L2947">					newMethods.add(new PresetInvocationDataMethodInfo(reflectionUI, method,</span>
<span class="fc" id="L2948">							(TextualStorage) ReflectionUIUtils.copy(ReflectionUI.getDefault(), invocationDataStorage)) {</span>

						@Override
						public String getName() {
<span class="fc" id="L2952">							return buildPresetMethodName(base.getSignature(), finalI);</span>
						}

						@Override
						public String getSignature() {
<span class="fc" id="L2957">							return ReflectionUIUtils.buildMethodSignature(this);</span>
						}

						@Override
						public String getCaption() {
<span class="nc" id="L2962">							return ReflectionUIUtils.composeMessage(base.getCaption(), &quot;Preset &quot; + (finalI + 1));</span>
						}

						@Override
						public boolean isHidden() {
<span class="fc" id="L2967">							return false;</span>
						}
					});
				}
<span class="fc" id="L2971">				return method;</span>
			}

		}

<span class="fc" id="L2976">		protected class FieldCommonOptionsTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, final FieldCustomization fc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc" id="L2981">				field = new FieldInfoProxy(field) {</span>

					@Override
					public boolean isHidden() {
<span class="fc bfc" id="L2985" title="All 2 branches covered.">						if (fc.isHidden()) {</span>
<span class="fc" id="L2986">							return true;</span>
						}
<span class="fc" id="L2988">						return super.isHidden();</span>
					}

					@Override
					public boolean isRelevant(Object object) {
<span class="fc bfc" id="L2993" title="All 2 branches covered.">						if (fc.getRelevanceStatusFieldName() != null) {</span>
<span class="fc" id="L2994">							IFieldInfo field = ReflectionUIUtils.findInfoByName(outputFields,</span>
<span class="fc" id="L2995">									fc.getRelevanceStatusFieldName());</span>
<span class="pc bpc" id="L2996" title="1 of 2 branches missed.">							if (field == null) {</span>
<span class="nc" id="L2997">								throw new ReflectionUIError(</span>
<span class="nc" id="L2998">										&quot;Relevance status field not found: '&quot; + fc.getRelevanceStatusFieldName() + &quot;'&quot;);</span>
							}
<span class="fc" id="L3000">							Object relevanceStatus = field.getValue(object);</span>
<span class="pc bpc" id="L3001" title="1 of 2 branches missed.">							if (!(relevanceStatus instanceof Boolean)) {</span>
<span class="nc" id="L3002">								throw new ReflectionUIError(&quot;Invalid relevance status field value (boolean expected): '&quot;</span>
<span class="nc" id="L3003">										+ relevanceStatus + &quot;'&quot;);</span>
							}
<span class="fc" id="L3005">							return (boolean) relevanceStatus;</span>
						}
<span class="fc" id="L3007">						return super.isRelevant(object);</span>
					}

					@Override
					public double getDisplayAreaHorizontalWeight() {
<span class="fc bfc" id="L3012" title="All 2 branches covered.">						if (fc.getDisplayAreaHorizontalWeight() != null) {</span>
<span class="fc" id="L3013">							return fc.getDisplayAreaHorizontalWeight();</span>
						}
<span class="fc" id="L3015">						return super.getDisplayAreaHorizontalWeight();</span>
					}

					@Override
					public double getDisplayAreaVerticalWeight() {
<span class="fc bfc" id="L3020" title="All 2 branches covered.">						if (fc.getDisplayAreaVerticalWeight() != null) {</span>
<span class="fc" id="L3021">							return fc.getDisplayAreaVerticalWeight();</span>
						}
<span class="fc" id="L3023">						return super.getDisplayAreaVerticalWeight();</span>
					}

					@Override
					public boolean isDisplayAreaHorizontallyFilled() {
<span class="fc bfc" id="L3028" title="All 2 branches covered.">						if (fc.getDisplayAreaHorizontalFilling() != null) {</span>
<span class="fc" id="L3029">							return fc.getDisplayAreaHorizontalFilling();</span>
						}
<span class="fc" id="L3031">						return super.isDisplayAreaHorizontallyFilled();</span>
					}

					@Override
					public boolean isDisplayAreaVerticallyFilled() {
<span class="fc bfc" id="L3036" title="All 2 branches covered.">						if (fc.getDisplayAreaVerticalFilling() != null) {</span>
<span class="fc" id="L3037">							return fc.getDisplayAreaVerticalFilling();</span>
						}
<span class="fc" id="L3039">						return super.isDisplayAreaVerticallyFilled();</span>
					}

					@Override
					public boolean isNullValueDistinct() {
<span class="fc bfc" id="L3044" title="All 2 branches covered.">						if (fc.isNullValueDistinctForced()) {</span>
<span class="fc" id="L3045">							return true;</span>
						}
<span class="fc" id="L3047">						return super.isNullValueDistinct();</span>
					}

					@Override
					public boolean isGetOnly() {
<span class="fc bfc" id="L3052" title="All 2 branches covered.">						if (fc.isGetOnlyForced()) {</span>
<span class="fc" id="L3053">							return true;</span>
						}
<span class="fc" id="L3055">						return super.isGetOnly();</span>
					}

					@Override
					public boolean isTransient() {
<span class="pc bpc" id="L3060" title="1 of 2 branches missed.">						if (fc.isTransientForced()) {</span>
<span class="nc" id="L3061">							return true;</span>
						}
<span class="fc" id="L3063">						return super.isTransient();</span>
					}

					@Override
					public ValueReturnMode getValueReturnMode() {
<span class="fc bfc" id="L3068" title="All 2 branches covered.">						if (fc.getCustomValueReturnMode() != null) {</span>
<span class="fc" id="L3069">							return fc.getCustomValueReturnMode();</span>
						}
<span class="fc" id="L3071">						return super.getValueReturnMode();</span>
					}

					@Override
					public String getNullValueLabel() {
<span class="fc bfc" id="L3076" title="All 2 branches covered.">						if (fc.getNullValueLabel() != null) {</span>
<span class="fc" id="L3077">							return fc.getNullValueLabel();</span>
						}
<span class="fc" id="L3079">						return super.getNullValueLabel();</span>
					}

					@Override
					public boolean hasValueOptions(Object object) {
<span class="fc bfc" id="L3084" title="All 2 branches covered.">						if (fc.getValueOptionsFieldName() != null) {</span>
<span class="fc" id="L3085">							return true;</span>
						}
<span class="fc" id="L3087">						return super.hasValueOptions(object);</span>
					}

					@Override
					public Object[] getValueOptions(Object object) {
<span class="fc bfc" id="L3092" title="All 2 branches covered.">						if (fc.getValueOptionsFieldName() != null) {</span>
<span class="fc" id="L3093">							IFieldInfo valueOptionsfield = ReflectionUIUtils.findInfoByName(outputFields,</span>
<span class="fc" id="L3094">									fc.getValueOptionsFieldName());</span>
<span class="pc bpc" id="L3095" title="1 of 2 branches missed.">							if (valueOptionsfield == null) {</span>
<span class="nc" id="L3096">								throw new ReflectionUIError(</span>
<span class="nc" id="L3097">										&quot;Value options field not found: '&quot; + fc.getValueOptionsFieldName() + &quot;'&quot;);</span>
							}
<span class="pc bpc" id="L3099" title="1 of 2 branches missed.">							if (!(valueOptionsfield.getType() instanceof IListTypeInfo)) {</span>
<span class="nc" id="L3100">								throw new ReflectionUIError(&quot;Value options field '&quot; + fc.getValueOptionsFieldName()</span>
<span class="nc" id="L3101">										+ &quot;' type is not a list type: '&quot; + valueOptionsfield.getType().getName() + &quot;'&quot;);</span>
							}
<span class="fc" id="L3103">							IListTypeInfo valueOptionsfieldType = (IListTypeInfo) valueOptionsfield.getType();</span>
<span class="fc" id="L3104">							Object options = valueOptionsfield.getValue(object);</span>
<span class="pc bpc" id="L3105" title="1 of 2 branches missed.">							if (options == null) {</span>
<span class="nc" id="L3106">								throw new ReflectionUIError(&quot;Value options field '&quot; + fc.getValueOptionsFieldName()</span>
<span class="nc" id="L3107">										+ &quot;': returned &lt;null&gt;!&quot;);</span>
							}
<span class="fc" id="L3109">							return valueOptionsfieldType.toArray(options);</span>
						}
<span class="fc" id="L3111">						return super.getValueOptions(object);</span>
					}

					@Override
					public boolean isFormControlMandatory() {
<span class="pc bpc" id="L3116" title="1 of 2 branches missed.">						if (fc.isFormControlCreationForced()) {</span>
<span class="nc" id="L3117">							return true;</span>
						}
<span class="fc" id="L3119">						return super.isFormControlMandatory();</span>
					}

					@Override
					public boolean isFormControlEmbedded() {
<span class="fc bfc" id="L3124" title="All 2 branches covered.">						if (fc.isFormControlEmbeddingForced()) {</span>
<span class="fc" id="L3125">							return true;</span>
						}
<span class="fc" id="L3127">						return super.isFormControlEmbedded();</span>
					}

					@Override
					public long getAutoUpdatePeriodMilliseconds() {
<span class="fc bfc" id="L3132" title="All 2 branches covered.">						if (fc.getAutoUpdatePeriodMilliseconds() != null) {</span>
<span class="fc" id="L3133">							return fc.getAutoUpdatePeriodMilliseconds();</span>
						}
<span class="fc" id="L3135">						return super.getAutoUpdatePeriodMilliseconds();</span>
					}

					@Override
					public boolean isControlValueValiditionEnabled() {
<span class="fc bfc" id="L3140" title="All 2 branches covered.">						if (fc.isValueValidityDetectionForced()) {</span>
<span class="fc" id="L3141">							return true;</span>
						}
<span class="fc" id="L3143">						return super.isControlValueValiditionEnabled();</span>
					}

					@Override
					public Map&lt;String, Object&gt; getSpecificProperties() {
<span class="fc" id="L3148">						Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(super.getSpecificProperties());</span>
<span class="fc" id="L3149">						traceActiveCustomizations(result);</span>
<span class="fc" id="L3150">						result.putAll(fc.getSpecificProperties());</span>
<span class="fc" id="L3151">						return result;</span>
					}

					@Override
					public String getCaption() {
<span class="fc bfc" id="L3156" title="All 2 branches covered.">						if (fc.getCustomFieldCaption() != null) {</span>
<span class="fc" id="L3157">							return fc.getCustomFieldCaption();</span>
						}
<span class="fc" id="L3159">						return super.getCaption();</span>
					}

					@Override
					public InfoCategory getCategory() {
<span class="fc" id="L3164">						String categoryName = fc.getCategoryName();</span>
<span class="fc" id="L3165">						List&lt;CustomizationCategory&gt; categories = objectTypeCustomization.getMemberCategories();</span>
<span class="fc" id="L3166">						int categoryPosition = -1;</span>
<span class="fc" id="L3167">						int i = 0;</span>
<span class="fc bfc" id="L3168" title="All 2 branches covered.">						for (CustomizationCategory c : categories) {</span>
<span class="fc bfc" id="L3169" title="All 2 branches covered.">							if (c.getName().equals(categoryName)) {</span>
<span class="fc" id="L3170">								categoryPosition = i;</span>
<span class="fc" id="L3171">								break;</span>
							}
<span class="fc" id="L3173">							i++;</span>
						}
<span class="fc bfc" id="L3175" title="All 2 branches covered.">						if (categoryPosition != -1) {</span>
<span class="fc" id="L3176">							CustomizationCategory category = categories.get(categoryPosition);</span>
<span class="fc" id="L3177">							return new InfoCategory(category.getCaption(), categoryPosition,</span>
<span class="pc bpc" id="L3178" title="1 of 2 branches missed.">									(category.getIconImagePath() == null) ? null</span>
<span class="nc" id="L3179">											: new ResourcePath(category.getIconImagePath().getSpecification()));</span>
						}
<span class="fc" id="L3181">						return super.getCategory();</span>
					}

					@Override
					public String getOnlineHelp() {
<span class="fc bfc" id="L3186" title="All 2 branches covered.">						if (fc.getOnlineHelp() != null) {</span>
<span class="fc" id="L3187">							return fc.getOnlineHelp();</span>
						}
<span class="fc" id="L3189">						return super.getOnlineHelp();</span>
					}

				};
<span class="fc" id="L3193">				return field;</span>
			}

		}

<span class="fc" id="L3198">		protected class FieldValueAsListTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, FieldCustomization f, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="pc bpc" id="L3203" title="1 of 2 branches missed.">				if (f.isDisplayedAsSingletonList()) {</span>
<span class="nc" id="L3204">					field = new ValueAsListFieldInfo(reflectionUI, field, objectType);</span>
				}
<span class="fc" id="L3206">				return field;</span>
			}

		}

<span class="fc" id="L3211">		protected class FieldNullStatusExportTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, FieldCustomization f, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3216" title="All 2 branches covered.">				if (f.isNullStatusFieldExported()) {</span>
<span class="fc" id="L3217">					newFields.add(new ExportedNullStatusFieldInfo(reflectionUI, field, objectType) {</span>

						@Override
						public boolean isHidden() {
<span class="fc" id="L3221">							return false;</span>
						}
					});
<span class="fc" id="L3224">					field = new FieldInfoProxy(field) {</span>

						@Override
						public boolean isNullValueDistinct() {
<span class="nc" id="L3228">							return false;</span>
						}

					};
				}
<span class="fc" id="L3233">				return field;</span>
			}

		}

<span class="fc" id="L3238">		protected class FieldNullStatusImportTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, final FieldCustomization f, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3243" title="All 2 branches covered.">				if (f.getImportedNullStatusFieldName() != null) {</span>
<span class="fc" id="L3244">					IFieldInfo nullStatusField = new DelegatingFieldInfo() {</span>
						@Override
						protected IFieldInfo getDelegate() {
<span class="fc" id="L3247">							IFieldInfo result = ReflectionUIUtils.findInfoByName(outputFields,</span>
<span class="fc" id="L3248">									f.getImportedNullStatusFieldName());</span>
<span class="pc bpc" id="L3249" title="1 of 2 branches missed.">							if (result == null) {</span>
<span class="nc" id="L3250">								return createErrorField(new ReflectionUIError(</span>
<span class="nc" id="L3251">										&quot;Null status field not found: '&quot; + f.getImportedNullStatusFieldName() + &quot;'&quot;));</span>
							}
<span class="fc" id="L3253">							return result;</span>
						}

						@Override
						protected Object getDelegateId() {
<span class="fc" id="L3258">							return f.getImportedNullStatusFieldName();</span>
						}
					};
<span class="fc" id="L3261">					field = new ImportedNullStatusFieldInfo(reflectionUI, field, nullStatusField, objectType);</span>
				}
<span class="fc" id="L3263">				return field;</span>
			}

		}

<span class="fc" id="L3268">		protected class FieldSetterGeneratingTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, FieldCustomization f, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3273" title="All 2 branches covered.">				if (f.isSetterGenerated()) {</span>
<span class="fc" id="L3274">					newMethods.add(new FieldAsSetterInfo(reflectionUI, field, objectType) {</span>

						@Override
						public boolean isHidden() {
<span class="fc" id="L3278">							return false;</span>
						}
					});
				}
<span class="fc" id="L3282">				return field;</span>
			}

		}

<span class="fc" id="L3287">		protected class FieldDuplicateGeneratingTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, FieldCustomization fc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3292" title="All 2 branches covered.">				if (fc.isDuplicateGenerated()) {</span>
<span class="fc" id="L3293">					IFieldInfo duplicateField = new FieldInfoProxy(field) {</span>

						@Override
						public String getName() {
<span class="fc" id="L3297">							return super.getName() + &quot;.duplicate&quot;;</span>
						}

						@Override
						public String getCaption() {
<span class="fc" id="L3302">							return ReflectionUIUtils.composeMessage(super.getCaption(), &quot;Duplicate&quot;);</span>
						}

						@Override
						public boolean isHidden() {
<span class="fc" id="L3307">							return false;</span>
						}

						@Override
						public ITypeInfo getType() {
<span class="fc" id="L3312">							return reflectionUI.getTypeInfo(new TypeInfoSourceProxy(super.getType().getSource()) {</span>
								@Override
								public SpecificitiesIdentifier getSpecificitiesIdentifier() {
<span class="fc" id="L3315">									return new SpecificitiesIdentifier(objectType.getName(), getName());</span>
								}

								@Override
								protected String getTypeInfoProxyFactoryIdentifier() {
<span class="fc" id="L3320">									return &quot;FieldValueTypeInfoProxyFactory [of=&quot; + getClass().getName() + &quot;, field=&quot;</span>
<span class="fc" id="L3321">											+ getName() + &quot;, objectType=&quot; + objectType.getName() + &quot;]&quot;;</span>
								}
							});
						}
					};
<span class="fc" id="L3326">					newFields.add(duplicateField);</span>
				}
<span class="fc" id="L3328">				return field;</span>
			}

		}

<span class="fc" id="L3333">		protected class FieldCustomSetterTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, final FieldCustomization f, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3338" title="All 2 branches covered.">				if (f.getCustomSetterSignature() != null) {</span>
<span class="fc" id="L3339">					field = new FieldInfoProxy(field) {</span>
						IMethodInfo customSetter;

						protected IMethodInfo getCustomSetter() {
<span class="nc bnc" id="L3343" title="All 2 branches missed.">							if (customSetter == null) {</span>
<span class="nc" id="L3344">								customSetter = ReflectionUIUtils.findMethodBySignature(outputMethods,</span>
<span class="nc" id="L3345">										f.getCustomSetterSignature());</span>
<span class="nc bnc" id="L3346" title="All 2 branches missed.">								if (customSetter == null) {</span>
<span class="nc" id="L3347">									throw new ReflectionUIError(&quot;Field '&quot; + f.getFieldName()</span>
<span class="nc" id="L3348">											+ &quot;': Custom setter not found: '&quot; + f.getCustomSetterSignature() + &quot;'&quot;);</span>
								}
							}
<span class="nc" id="L3351">							return customSetter;</span>
						}

						@Override
						public boolean isGetOnly() {
<span class="fc" id="L3356">							return false;</span>
						}

						@Override
						public void setValue(Object object, Object value) {
<span class="nc" id="L3361">							IMethodInfo customSetter = getCustomSetter();</span>
<span class="nc" id="L3362">							customSetter.invoke(object, new InvocationData(object, customSetter, value));</span>
<span class="nc" id="L3363">						}</span>

						@Override
						public Runnable getNextUpdateCustomUndoJob(Object object, Object value) {
<span class="nc" id="L3367">							IMethodInfo customSetter = getCustomSetter();</span>
<span class="nc" id="L3368">							return customSetter.getNextInvocationUndoJob(object,</span>
<span class="nc" id="L3369">									new InvocationData(object, customSetter, value));</span>
						}

						@Override
						public Runnable getPreviousUpdateCustomRedoJob(Object object, Object value) {
<span class="nc" id="L3374">							IMethodInfo customSetter = getCustomSetter();</span>
<span class="nc" id="L3375">							return customSetter.getPreviousInvocationCustomRedoJob(object,</span>
<span class="nc" id="L3376">									new InvocationData(object, customSetter, value));</span>
						}
					};
				}
<span class="fc" id="L3380">				return field;</span>
			}

		}

<span class="fc" id="L3385">		protected class FieldGetterGeneratingTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, FieldCustomization f, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3390" title="All 2 branches covered.">				if (f.isGetterGenerated()) {</span>
<span class="fc" id="L3391">					newMethods.add(new FieldAsGetterInfo(reflectionUI, field, objectType) {</span>

						@Override
						public boolean isHidden() {
<span class="fc" id="L3395">							return false;</span>
						}
					});
				}
<span class="fc" id="L3399">				return field;</span>
			}

		}

<span class="fc" id="L3404">		protected class FieldTypeConversionTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, FieldCustomization f, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3409" title="All 2 branches covered.">				if (f.getTypeConversion() != null) {</span>
<span class="fc" id="L3410">					ITypeInfo newType = f.getTypeConversion().findNewType(reflectionUI,</span>
<span class="fc" id="L3411">							new SpecificitiesIdentifier(objectType.getName(), field.getName()));</span>
<span class="fc" id="L3412">					Filter&lt;Object&gt; conversionMethod = f.getTypeConversion().buildOverallConversionMethod(reflectionUI);</span>
<span class="fc" id="L3413">					Filter&lt;Object&gt; reverseConversionMethod = f.getTypeConversion()</span>
<span class="fc" id="L3414">							.buildOverallReverseConversionMethod(reflectionUI);</span>
<span class="fc" id="L3415">					boolean nullValueConverted = f.getTypeConversion().isNullValueConverted();</span>
<span class="fc" id="L3416">					field = new ChangedTypeFieldInfo(field, newType, conversionMethod, reverseConversionMethod,</span>
<span class="fc" id="L3417">							nullValueConverted);</span>
				}
<span class="fc" id="L3419">				return field;</span>
			}

		}

		/**
		 * Base class for factories that generate proxies or new members from field
		 * information according to the specified {@link FieldCustomization}.
		 * 
		 * @author olitank
		 *
		 */
<span class="fc" id="L3431">		protected class FieldNullReplacementTransformer extends AbstractFieldTransformer {</span>

			@Override
			public IFieldInfo process(IFieldInfo field, FieldCustomization fc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods) {
<span class="fc bfc" id="L3436" title="All 2 branches covered.">				if (fc.getNullReplacement().getData() != null) {</span>
<span class="fc" id="L3437">					field = new NullReplacementFieldInfo(reflectionUI, field, (TextualStorage) ReflectionUIUtils</span>
<span class="fc" id="L3438">							.copy(ReflectionUI.getDefault(), fc.getNullReplacement()));</span>
				}
<span class="fc" id="L3440">				return field;</span>
			}

		}

		/**
		 * Base class for factories that generate proxies or new members from field
		 * information according to the specified {@link FieldCustomization}.
		 * 
		 * @author olitank
		 *
		 */
<span class="fc" id="L3452">		protected abstract class AbstractFieldTransformer {</span>

			/**
			 * @param field      The field that needs to be transformed.
			 * @param fc         The transformation settings.
			 * @param newFields  The new fields generated during the transformation. Note
			 *                   that they must have unique names compared to the other
			 *                   fields of the same type.
			 * @param newMethods The new methods generated during the transformation. Note
			 *                   that they must have unique signatures compared to the other
			 *                   methods of the same type.
			 * @return the input field or a proxy to this input field. Note that in case of
			 *         a proxy the name of the field must not change.
			 */
			public abstract IFieldInfo process(IFieldInfo field, FieldCustomization fc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods);

		}

		/**
		 * Base class for factories that generate proxies or new members from method
		 * information according to the specified {@link MethodCustomization}.
		 * 
		 * @author olitank
		 *
		 */
<span class="fc" id="L3478">		protected abstract class AbstractMethodTransformer {</span>

			/**
			 * @param method     The method that needs to be transformed.
			 * @param mc         The transformation settings.
			 * @param newFields  The new fields generated during the transformation. Note
			 *                   that they must have unique names compared to the other
			 *                   fields of the same type.
			 * @param newMethods The new methods generated during the transformation. Note
			 *                   that they must have unique signatures compared to the other
			 *                   methods of the same type.
			 * @return the input method or a proxy to this input method. Note that in case
			 *         of a proxy the signature of the method must not change.
			 */
			public abstract IMethodInfo process(IMethodInfo method, MethodCustomization mc, List&lt;IFieldInfo&gt; newFields,
					List&lt;IMethodInfo&gt; newMethods);

		}

	}

	protected class SpecificitiesFactory extends InfoCustomizationsFactory {

		protected SpecificitiesIdentifier specificitiesIdentifier;

<span class="fc" id="L3503">		public SpecificitiesFactory(SpecificitiesIdentifier specificitiesIdentifier) {</span>
<span class="fc" id="L3504">			super(InfoCustomizationsFactory.this.reflectionUI);</span>
<span class="fc" id="L3505">			this.specificitiesIdentifier = specificitiesIdentifier;</span>
<span class="fc" id="L3506">		}</span>

		@Override
		public String getIdentifier() {
<span class="fc" id="L3510">			return &quot;SpecificitiesFactory [specificitiesIdentifier=&quot; + specificitiesIdentifier.toString()</span>
<span class="fc" id="L3511">					+ &quot;, parentFactoryIdentifier=&quot; + InfoCustomizationsFactory.this.getIdentifier() + &quot;]&quot;;</span>
		}

		@Override
		protected IInfoProxyFactory getInfoCustomizationsSetupFactory() {
<span class="nc" id="L3516">			return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
		}

		@Override
		protected InfoCustomizations accessInfoCustomizations() {
<span class="fc" id="L3521">			TypeCustomization typeCustomization = InfoCustomizations.getTypeCustomization(</span>
<span class="fc" id="L3522">					InfoCustomizationsFactory.this.accessInfoCustomizations(),</span>
<span class="fc" id="L3523">					specificitiesIdentifier.getObjectTypeName());</span>
<span class="fc" id="L3524">			FieldCustomization fieldCustomization = InfoCustomizations.getFieldCustomization(typeCustomization,</span>
<span class="fc" id="L3525">					specificitiesIdentifier.getFieldName());</span>
<span class="fc" id="L3526">			FieldTypeSpecificities result = fieldCustomization.getSpecificTypeCustomizations();</span>
<span class="fc" id="L3527">			return result;</span>
		}

		@Override
		public IInfoProxyFactory getSpecificitiesFactory(SpecificitiesIdentifier specificitiesIdentifier) {
<span class="fc" id="L3532">			return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
		}

		@Override
		public ITypeInfo wrapTypeInfo(ITypeInfo type) {
<span class="fc bfc" id="L3537" title="All 2 branches covered.">			for (TypeCustomization tc : new ArrayList&lt;TypeCustomization&gt;(</span>
<span class="fc" id="L3538">					InfoCustomizationsFactory.this.accessInfoCustomizations().getTypeCustomizations())) {</span>
<span class="fc bfc" id="L3539" title="All 2 branches covered.">				if (tc.getBaseTypeName() != null) {</span>
<span class="fc bfc" id="L3540" title="All 2 branches covered.">					if (MiscUtils.containsWord(specificitiesIdentifier.getObjectTypeName(), tc.getTypeName())) {</span>
<span class="fc" id="L3541">						type = new SpecificitiesFactory(</span>
<span class="fc" id="L3542">								new SpecificitiesIdentifier(</span>
<span class="fc" id="L3543">										MiscUtils.replaceWord(specificitiesIdentifier.getObjectTypeName(),</span>
<span class="fc" id="L3544">												tc.getTypeName(), tc.getBaseTypeName()),</span>
<span class="fc" id="L3545">										specificitiesIdentifier.getFieldName()))</span>
<span class="fc" id="L3546">												.getTypeInheritanceFactory(tc.getTypeName(), tc.getBaseTypeName())</span>
<span class="fc" id="L3547">												.wrapTypeInfo(type);</span>
					}
				}
			}
<span class="fc" id="L3551">			type = super.wrapTypeInfo(type);</span>
<span class="fc" id="L3552">			return type;</span>
		}

		@Override
		public ITypeInfo unwrapTypeInfo(ITypeInfo type) {
<span class="nc" id="L3557">			type = super.unwrapTypeInfo(type);</span>
<span class="nc bnc" id="L3558" title="All 2 branches missed.">			for (TypeCustomization tc : MiscUtils</span>
<span class="nc" id="L3559">					.getReverse(InfoCustomizationsFactory.this.accessInfoCustomizations().getTypeCustomizations())) {</span>
<span class="nc bnc" id="L3560" title="All 2 branches missed.">				if (tc.getBaseTypeName() != null) {</span>
<span class="nc bnc" id="L3561" title="All 2 branches missed.">					if (MiscUtils.containsWord(specificitiesIdentifier.getObjectTypeName(), tc.getTypeName())) {</span>
<span class="nc" id="L3562">						type = new SpecificitiesFactory(</span>
<span class="nc" id="L3563">								new SpecificitiesIdentifier(</span>
<span class="nc" id="L3564">										MiscUtils.replaceWord(specificitiesIdentifier.getObjectTypeName(),</span>
<span class="nc" id="L3565">												tc.getTypeName(), tc.getBaseTypeName()),</span>
<span class="nc" id="L3566">										specificitiesIdentifier.getFieldName()))</span>
<span class="nc" id="L3567">												.getTypeInheritanceFactory(tc.getTypeName(), tc.getBaseTypeName())</span>
<span class="nc" id="L3568">												.unwrapTypeInfo(type);</span>
					}
				}
			}
<span class="nc" id="L3572">			return type;</span>
		}
	}

	protected class TypeInheritanceFactory extends InfoCustomizationsFactory {

		protected String targetTypeName;
		protected String baseTypeName;
		protected InfoCustomizations inheritanceInfoCustomizations;

<span class="fc" id="L3582">		public TypeInheritanceFactory(String targetTypeName, String baseTypeName) {</span>
<span class="fc" id="L3583">			super(InfoCustomizationsFactory.this.reflectionUI);</span>
<span class="fc" id="L3584">			this.targetTypeName = targetTypeName;</span>
<span class="fc" id="L3585">			this.baseTypeName = baseTypeName;</span>

<span class="fc" id="L3587">		}</span>

		@Override
		public String getIdentifier() {
<span class="fc" id="L3591">			return &quot;InheritedCustomizationsFactory [targetType=&quot; + targetTypeName + &quot;, inheritedType=&quot; + baseTypeName</span>
<span class="fc" id="L3592">					+ &quot;, parentFactoryIdentifier=&quot; + InfoCustomizationsFactory.this.getIdentifier() + &quot;]&quot;;</span>
		}

		@Override
		protected InfoCustomizations accessInfoCustomizations() {
<span class="fc bfc" id="L3597" title="All 2 branches covered.">			if (inheritanceInfoCustomizations == null) {</span>
<span class="fc" id="L3598">				return InfoCustomizationsFactory.this.accessInfoCustomizations();</span>
			}
<span class="fc" id="L3600">			return inheritanceInfoCustomizations;</span>
		}

		@Override
		protected IInfoProxyFactory getInfoCustomizationsSetupFactory() {
<span class="nc" id="L3605">			return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
		}

		@Override
		protected IInfoProxyFactory getTypeInheritanceFactory(String targetTypeName, String baseTypeName) {
<span class="nc" id="L3610">			return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
		}

		@Override
		public ITypeInfo wrapTypeInfo(ITypeInfo type) {
<span class="fc bfc" id="L3615" title="All 2 branches covered.">			if (inheritanceInfoCustomizations == null) {</span>
<span class="fc bfc" id="L3616" title="All 2 branches covered.">				if (MiscUtils.containsWord(type.getName(), targetTypeName)) {</span>
<span class="fc" id="L3617">					inheritanceInfoCustomizations = createInheritanceInfoCustomizationsFrom(</span>
<span class="fc" id="L3618">							InfoCustomizationsFactory.this.accessInfoCustomizations());</span>
				}
			}
<span class="fc" id="L3621">			return super.wrapTypeInfo(type);</span>
		}

		@Override
		public ITypeInfo unwrapTypeInfo(ITypeInfo type) {
<span class="nc bnc" id="L3626" title="All 2 branches missed.">			if (inheritanceInfoCustomizations == null) {</span>
<span class="nc bnc" id="L3627" title="All 2 branches missed.">				if (MiscUtils.containsWord(type.getName(), targetTypeName)) {</span>
<span class="nc" id="L3628">					inheritanceInfoCustomizations = createInheritanceInfoCustomizationsFrom(</span>
<span class="nc" id="L3629">							InfoCustomizationsFactory.this.accessInfoCustomizations());</span>
				}
			}
<span class="nc" id="L3632">			return super.unwrapTypeInfo(type);</span>
		}

		protected InfoCustomizations createInheritanceInfoCustomizationsFrom(
				InfoCustomizations baseInfoCustomizations) {
			InfoCustomizations result;
			try {
<span class="fc" id="L3639">				result = baseInfoCustomizations.getClass().newInstance();</span>
<span class="pc" id="L3640">			} catch (InstantiationException | IllegalAccessException e) {</span>
<span class="nc" id="L3641">				throw new ReflectionUIError(e);</span>
			}
<span class="fc bfc" id="L3643" title="All 2 branches covered.">			for (TypeCustomization tc : baseInfoCustomizations.getTypeCustomizations()) {</span>
<span class="fc bfc" id="L3644" title="All 2 branches covered.">				if (!MiscUtils.containsWord(tc.getTypeName(), baseTypeName)) {</span>
<span class="fc" id="L3645">					continue;</span>
				}
<span class="fc" id="L3647">				tc = (TypeCustomization) IOUtils.copyThroughSerialization(tc);</span>
<span class="fc" id="L3648">				result.getTypeCustomizations().add(tc);</span>
<span class="fc" id="L3649">				tc.setTypeName(MiscUtils.replaceWord(tc.getTypeName(), baseTypeName, targetTypeName));</span>
<span class="fc bfc" id="L3650" title="All 2 branches covered.">				for (FieldCustomization fc : tc.getFieldsCustomizations()) {</span>
<span class="fc" id="L3651">					fc.setSpecificTypeCustomizations((FieldTypeSpecificities) createInheritanceInfoCustomizationsFrom(</span>
<span class="fc" id="L3652">							fc.getSpecificTypeCustomizations()));</span>
				}
			}
<span class="fc bfc" id="L3655" title="All 2 branches covered.">			for (ListCustomization lc : baseInfoCustomizations.getListCustomizations()) {</span>
<span class="pc bpc" id="L3656" title="1 of 2 branches missed.">				if (!MiscUtils.containsWord(lc.getListTypeName(), baseTypeName)) {</span>
<span class="fc bfc" id="L3657" title="All 2 branches covered.">					if (lc.getItemTypeName() != null) {</span>
<span class="pc bpc" id="L3658" title="1 of 2 branches missed.">						if (!MiscUtils.containsWord(lc.getItemTypeName(), baseTypeName)) {</span>
<span class="fc" id="L3659">							continue;</span>
						}
					}
				}
<span class="fc" id="L3663">				lc = (ListCustomization) IOUtils.copyThroughSerialization(lc);</span>
<span class="fc" id="L3664">				result.getListCustomizations().add(lc);</span>
<span class="fc" id="L3665">				lc.setListTypeName(MiscUtils.replaceWord(lc.getListTypeName(), baseTypeName, targetTypeName));</span>
<span class="pc bpc" id="L3666" title="1 of 2 branches missed.">				if (lc.getItemTypeName() != null) {</span>
<span class="nc" id="L3667">					lc.setItemTypeName(MiscUtils.replaceWord(lc.getItemTypeName(), baseTypeName, targetTypeName));</span>
				}
			}
<span class="fc bfc" id="L3670" title="All 2 branches covered.">			for (EnumerationCustomization ec : baseInfoCustomizations.getEnumerationCustomizations()) {</span>
<span class="pc bpc" id="L3671" title="1 of 2 branches missed.">				if (!MiscUtils.containsWord(ec.getEnumerationTypeName(), baseTypeName)) {</span>
<span class="fc" id="L3672">					continue;</span>
				}
<span class="nc" id="L3674">				ec = (EnumerationCustomization) IOUtils.copyThroughSerialization(ec);</span>
<span class="nc" id="L3675">				ec.setEnumerationTypeName(</span>
<span class="nc" id="L3676">						MiscUtils.replaceWord(ec.getEnumerationTypeName(), baseTypeName, targetTypeName));</span>
			}
<span class="fc" id="L3678">			return result;</span>
		}

		@Override
		public IInfoProxyFactory getSpecificitiesFactory(SpecificitiesIdentifier specificitiesIdentifier) {
<span class="fc" id="L3683">			return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>