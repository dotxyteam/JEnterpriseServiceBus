<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>AbstractModification.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">reflection-ui</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">xy.reflect.ui.undo</a> &gt; <span class="el_source">AbstractModification.java</span></div><h1>AbstractModification.java</h1><pre class="source lang-java linenums">
package xy.reflect.ui.undo;

import xy.reflect.ui.util.ReflectionUIError;

/**
 * This class exists as convenience for creating {@link IModification} objects.
 * 
 * @author olitank
 *
 */
<span class="fc" id="L12">public abstract class AbstractModification implements IModification {</span>

	protected Runnable doJob;
	protected Runnable undoJob;
	protected Runnable redoJob;
	protected static final String UNDO_TITLE_PREFIX = &quot;(Revert) &quot;;

	/**
	 * @return The task that performs the modification for the first time. Must not
	 *         be null.
	 */
	protected abstract Runnable createDoJob();

	/**
	 * @return The task that reverts the modification. Must not be null.
	 */
	protected abstract Runnable createUndoJob();

	/**
	 * @return The task that performs again the modification. Must not be null.
	 */
	protected abstract Runnable createRedoJob();

	@Override
	public boolean isNull() {
<span class="fc" id="L37">		return false;</span>
	}

	@Override
	public boolean isVolatile() {
<span class="fc" id="L42">		return false;</span>
	}

	@Override
	public boolean isComposite() {
<span class="nc" id="L47">		return false;</span>
	}

	@Override
	public IModification applyAndGetOpposite(ModificationStack modificationStack) {
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">		if (doJob == null) {</span>
<span class="fc" id="L53">			doJob = createDoJob();</span>
<span class="pc bpc" id="L54" title="1 of 2 branches missed.">			if (doJob == null) {</span>
<span class="nc" id="L55">				throw new ReflectionUIError();</span>
			}
		}
		try {
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">			if (undoJob == null) {</span>
<span class="fc" id="L60">				undoJob = createUndoJob();</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">				if (undoJob == null) {</span>
<span class="fc" id="L62">					throw new IrreversibleModificationException();</span>
				}
			}
		} finally {
<span class="pc bpc" id="L66" title="1 of 2 branches missed.">			if (redoJob != null) {</span>
<span class="nc" id="L67">				redoJob.run();</span>
<span class="nc" id="L68">			} else {</span>
<span class="fc" id="L69">				doJob.run();</span>
			}
		}
<span class="fc" id="L72">		return new OppositeModification();</span>
	}

	@Override
	public String toString() {
<span class="fc" id="L77">		return &quot;Modification [title=&quot; + getTitle() + &quot;]&quot;;</span>
	}

	public static String getUndoTitle(String title) {
		String result;
<span class="fc bfc" id="L82" title="All 2 branches covered.">		if (title == null) {</span>
<span class="fc" id="L83">			result = null;</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">		} else if (title.startsWith(AbstractModification.UNDO_TITLE_PREFIX)) {</span>
<span class="fc" id="L85">			result = title.substring(AbstractModification.UNDO_TITLE_PREFIX.length());</span>
<span class="fc" id="L86">		} else {</span>
<span class="fc" id="L87">			result = AbstractModification.UNDO_TITLE_PREFIX + title;</span>
		}
<span class="fc" id="L89">		return result;</span>
	}

<span class="fc" id="L92">	public class OppositeModification implements IModification {</span>

		@Override
		public boolean isNull() {
<span class="fc" id="L96">			return getSourceModification().isNull();</span>
		}

		@Override
		public boolean isVolatile() {
<span class="fc" id="L101">			return getSourceModification().isVolatile();</span>
		}

		@Override
		public boolean isComposite() {
<span class="nc" id="L106">			return getSourceModification().isComposite();</span>
		}

		@Override
		public String getTitle() {
<span class="fc" id="L111">			return AbstractModification.getUndoTitle(AbstractModification.this.getTitle());</span>
		}

		public AbstractModification getSourceModification() {
<span class="fc" id="L115">			return AbstractModification.this;</span>
		}

		@Override
		public IModification applyAndGetOpposite(ModificationStack modificationStack) {
<span class="nc bnc" id="L120" title="All 2 branches missed.">			if (redoJob == null) {</span>
<span class="nc" id="L121">				redoJob = createRedoJob();</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">				if (redoJob == null) {</span>
<span class="nc" id="L123">					throw new ReflectionUIError();</span>
				}
			}
<span class="nc" id="L126">			undoJob.run();</span>
<span class="nc" id="L127">			return getSourceModification();</span>
		}

		@Override
		public int hashCode() {
<span class="nc" id="L132">			final int prime = 31;</span>
<span class="nc" id="L133">			int result = 1;</span>
<span class="nc" id="L134">			result = prime * result + getSourceModification().hashCode();</span>
<span class="nc" id="L135">			return result;</span>
		}

		@Override
		public boolean equals(Object obj) {
<span class="nc bnc" id="L140" title="All 2 branches missed.">			if (this == obj)</span>
<span class="nc" id="L141">				return true;</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">			if (obj == null)</span>
<span class="nc" id="L143">				return false;</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">			if (getClass() != obj.getClass())</span>
<span class="nc" id="L145">				return false;</span>
<span class="nc" id="L146">			OppositeModification other = (OppositeModification) obj;</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">			if (!getSourceModification().equals(other.getSourceModification()))</span>
<span class="nc" id="L148">				return false;</span>
<span class="nc" id="L149">			return true;</span>
		}

		@Override
		public String toString() {
<span class="nc" id="L154">			return &quot;OppositeModification [soure=&quot; + getSourceModification() + &quot;]&quot;;</span>
		}

	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>