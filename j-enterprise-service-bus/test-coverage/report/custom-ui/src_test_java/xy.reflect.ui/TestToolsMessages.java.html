<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>TestToolsMessages.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">custom-ui</a> &gt; <a href="../index.html" class="el_bundle">src/test/java</a> &gt; <a href="index.source.html" class="el_package">xy.reflect.ui</a> &gt; <span class="el_source">TestToolsMessages.java</span></div><h1>TestToolsMessages.java</h1><pre class="source lang-java linenums">package xy.reflect.ui;

import java.lang.reflect.Field;
import java.lang.reflect.Modifier;
import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;
import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;

import xy.reflect.ui.control.swing.customizer.CustomizationToolsUI;
import xy.reflect.ui.control.swing.customizer.SwingCustomizer;
import xy.reflect.ui.info.custom.InfoCustomizations;
import xy.reflect.ui.info.custom.InfoCustomizations.ControlSizeCustomization;
import xy.reflect.ui.info.field.MembersCapsuleFieldInfo;
import xy.reflect.ui.info.field.IFieldInfo;
import xy.reflect.ui.info.method.IMethodInfo;
import xy.reflect.ui.info.type.ITypeInfo;
import xy.reflect.ui.info.type.source.JavaTypeInfoSource;
import xy.reflect.ui.util.IOUtils;
import xy.reflect.ui.util.ReflectionUIError;
import xy.reflect.ui.util.ReflectionUIUtils;

<span class="nc" id="L25">public class TestToolsMessages {</span>

	private static String[] englishWords;

	@BeforeClass
	public static void beforeAllTests() throws Exception {
<span class="nc" id="L31">		englishWords = new String(IOUtils.readBinary(TestToolsMessages.class.getResourceAsStream(&quot;words.en&quot;)), &quot;UTF-8&quot;)</span>
<span class="nc" id="L32">				.toLowerCase().split(&quot;[\\n\\r]+&quot;);</span>
<span class="nc" id="L33">	}</span>

	private boolean checkSpell(String sentence, String typeName, String memberName) {
<span class="nc" id="L36">		String[] words = sentence.split(&quot;[^\\p{L}]+&quot;);</span>
<span class="nc" id="L37">		Set&lt;String&gt; misspelledWords = new HashSet&lt;String&gt;();</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">		for (String word : words) {</span>
<span class="nc" id="L39">			word = word.toLowerCase();</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">			if (!Arrays.asList(englishWords).contains(word)) {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">				if (word.length() == 0) {</span>
<span class="nc" id="L42">					continue;</span>
				}
<span class="nc" id="L44">				misspelledWords.add(word);</span>
			}
		}
<span class="nc bnc" id="L47" title="All 2 branches missed.">		if (misspelledWords.size() &gt; 0) {</span>
<span class="nc" id="L48">			String errorMsg = &quot;\n- Incorrect sentence: &quot; + sentence + &quot;\n	=&gt; misspelledWords=&quot; + misspelledWords</span>
<span class="nc" id="L49">					+ &quot;\n	=&gt; context: type=&quot; + typeName + &quot;; member=&quot; + memberName;</span>
<span class="nc" id="L50">			System.err.println(errorMsg);</span>
<span class="nc" id="L51">			return false;</span>
		} else {
<span class="nc" id="L53">			return true;</span>
		}
	}

	@Test
	public void testSpells() throws Exception {
		/*
		 * Good websites: http://itpro.cz/juniconv/ http://french.typeit.org/
		 */
<span class="nc" id="L62">		CustomizationToolsUI toolsUI = SwingCustomizer.getDefault().getCustomizationTools().getToolsUI();</span>
<span class="nc" id="L63">		boolean correctSpells = true;</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">		for (Class&lt;?&gt; c : InfoCustomizations.class.getDeclaredClasses()) {</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">			if (Modifier.isAbstract(c.getModifiers())) {</span>
<span class="nc" id="L66">				continue;</span>
			}
<span class="nc bnc" id="L68" title="All 2 branches missed.">			if (!Modifier.isPublic(c.getModifiers())) {</span>
<span class="nc" id="L69">				continue;</span>
			}
<span class="nc" id="L71">			ITypeInfo typeCustomizationType = toolsUI.getTypeInfo(new JavaTypeInfoSource(c, null));</span>
<span class="nc bnc" id="L72" title="All 4 branches missed.">			correctSpells = testSpells(typeCustomizationType) &amp;&amp; correctSpells;</span>
		}
<span class="nc bnc" id="L74" title="All 2 branches missed.">		if (!correctSpells) {</span>
<span class="nc" id="L75">			Assert.fail(&quot;Incorrect spells detected !&quot;);</span>
		}
<span class="nc" id="L77">	}</span>

	private boolean testSpells(ITypeInfo type) {
<span class="nc" id="L80">		boolean correctSpells = true;</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">		if (!Arrays.asList(ControlSizeCustomization.class.getName()).contains(type.getName())) {</span>
<span class="nc bnc" id="L82" title="All 4 branches missed.">			correctSpells = checkSpell(type.getCaption(), type.getName(), &quot;&lt;caption&gt;&quot;) &amp;&amp; correctSpells;</span>
		}
<span class="nc bnc" id="L84" title="All 2 branches missed.">		if (type.getOnlineHelp() != null) {</span>
<span class="nc bnc" id="L85" title="All 4 branches missed.">			correctSpells = checkSpell(type.getOnlineHelp(), type.getName(), &quot;&lt;onlineHelp&gt;&quot;) &amp;&amp; correctSpells;</span>
		}
<span class="nc bnc" id="L87" title="All 2 branches missed.">		for (IFieldInfo field : type.getFields()) {</span>
<span class="nc bnc" id="L88" title="All 4 branches missed.">			correctSpells = testSpells(field, type) &amp;&amp; correctSpells;</span>
		}
<span class="nc bnc" id="L90" title="All 2 branches missed.">		for (IMethodInfo method : type.getMethods()) {</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">			correctSpells = testSpells(method, type) &amp;&amp; correctSpells;</span>
		}
<span class="nc" id="L93">		return correctSpells;</span>
	}

	private boolean testSpells(IFieldInfo field, ITypeInfo objectType) {
<span class="nc bnc" id="L97" title="All 2 branches missed.">		if (field.isHidden()) {</span>
<span class="nc" id="L98">			return true;</span>
		}
<span class="nc" id="L100">		boolean correctSpells = true;</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">		correctSpells = checkSpell(field.getCaption(), objectType.getName(), field.getName() + &quot;.&lt;caption&gt;&quot;)</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">				&amp;&amp; correctSpells;</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">		if (field.getOnlineHelp() != null) {</span>
<span class="nc" id="L104">			correctSpells = checkSpell(field.getOnlineHelp(), objectType.getName(),</span>
<span class="nc bnc" id="L105" title="All 4 branches missed.">					field.getName() + &quot;.&lt;onlineHelp&gt;&quot;) &amp;&amp; correctSpells;</span>
		}
<span class="nc bnc" id="L107" title="All 2 branches missed.">		if (field.getCategory() != null) {</span>
<span class="nc" id="L108">			correctSpells = checkSpell(field.getCategory().getCaption(), objectType.getName(),</span>
<span class="nc bnc" id="L109" title="All 4 branches missed.">					field.getName() + &quot;.&lt;category&gt;&quot;) &amp;&amp; correctSpells;</span>
		}
<span class="nc" id="L111">		MembersCapsuleFieldInfo capsuleField = getCapsuleField(field);</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">		if (capsuleField != null) {</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">			for (IFieldInfo subField : capsuleField.getType().getFields()) {</span>
<span class="nc bnc" id="L114" title="All 4 branches missed.">				correctSpells = testSpells(subField, capsuleField.getType()) &amp;&amp; correctSpells;</span>
			}
		}
<span class="nc" id="L117">		return correctSpells;</span>
	}

	private boolean testSpells(IMethodInfo method, ITypeInfo objectType) {
<span class="nc bnc" id="L121" title="All 2 branches missed.">		if (method.isHidden()) {</span>
<span class="nc" id="L122">			return true;</span>
		}
<span class="nc" id="L124">		boolean correctSpells = true;</span>
<span class="nc" id="L125">		String methodDescription = ReflectionUIUtils.formatMethodControlTooltipText(method.getCaption(),</span>
<span class="nc" id="L126">				method.getOnlineHelp(), method.getParameters());</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">		if (methodDescription != null) {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">			correctSpells = checkSpell(methodDescription, objectType.getName(), method.getSignature())</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">					&amp;&amp; correctSpells;</span>
		}
<span class="nc bnc" id="L131" title="All 2 branches missed.">		if (method.getCategory() != null) {</span>
<span class="nc" id="L132">			correctSpells = checkSpell(method.getCategory().getCaption(), objectType.getName(),</span>
<span class="nc bnc" id="L133" title="All 4 branches missed.">					method.getSignature() + &quot;.&lt;category&gt;&quot;) &amp;&amp; correctSpells;</span>
		}
<span class="nc" id="L135">		return correctSpells;</span>
	}

	private MembersCapsuleFieldInfo getCapsuleField(IFieldInfo field) {
		while (true) {
			try {
<span class="nc" id="L141">				field = (IFieldInfo) getInaccesibleFieldValue(field.getClass(), field, &quot;base&quot;);</span>
<span class="nc" id="L142">			} catch (Exception e) {</span>
<span class="nc" id="L143">				break;</span>
			}
<span class="nc bnc" id="L145" title="All 2 branches missed.">			if (field instanceof MembersCapsuleFieldInfo) {</span>
<span class="nc" id="L146">				return (MembersCapsuleFieldInfo) field;</span>
			}
<span class="nc bnc" id="L148" title="All 2 branches missed.">			if (field == null) {</span>
				break;
			}
		}
<span class="nc" id="L152">		return null;</span>
	}

	public Object getInaccesibleFieldValue(Class&lt;?&gt; clazz, Object obj, String fieldName) {
		try {
			Field field;
			while (true) {
				try {
<span class="nc" id="L160">					field = clazz.getDeclaredField(fieldName);</span>
<span class="nc" id="L161">					break;</span>
<span class="nc" id="L162">				} catch (NoSuchFieldException e) {</span>
<span class="nc" id="L163">					clazz = clazz.getSuperclass();</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">					if (clazz == null) {</span>
<span class="nc" id="L165">						throw e;</span>
					}
				}
			}
<span class="nc" id="L169">			field.setAccessible(true);</span>
<span class="nc" id="L170">			return field.get(obj);</span>
<span class="nc" id="L171">		} catch (Exception e) {</span>
<span class="nc" id="L172">			throw new ReflectionUIError(e);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>