<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>JesbAPIExample.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">j-enterprise-service-bus</a> &gt; <a href="../index.html" class="el_bundle">unpackaged-src</a> &gt; <a href="index.source.html" class="el_package">com.otk.jesb</a> &gt; <span class="el_source">JesbAPIExample.java</span></div><h1>JesbAPIExample.java</h1><pre class="source lang-java linenums">package com.otk.jesb;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.PrintStream;

import com.otk.jesb.Runner;
import com.otk.jesb.Session;
import com.otk.jesb.Variant;
import com.otk.jesb.activation.builtin.ReadCommandLine;
import com.otk.jesb.instantiation.FieldInitializerFacade;
import com.otk.jesb.instantiation.InstantiationFunction;
import com.otk.jesb.instantiation.RootInstanceBuilderFacade;
import com.otk.jesb.solution.Plan;
import com.otk.jesb.util.InstantiationUtils;
import com.otk.jesb.util.SolutionUtils;
import com.otk.jesb.solution.Solution;

/**
 * This is an example class that demonstrates how JESB processes can be called
 * from any Java code.
 * 
 * @author olitank
 *
 */
<span class="nc" id="L26">public class JesbAPIExample {</span>

	public static void main(String[] args) throws Exception {
		/*
		 * Here we show how to create a solution programmatically, save/load it from the
		 * file system, and execute it.
		 */
<span class="nc" id="L33">		Solution solution = generateHelloCommandSolution();</span>
<span class="nc" id="L34">		File solutionFile = new File(&quot;hello-command-solution.zip&quot;);</span>
		{
<span class="nc" id="L36">			solution.saveToArchiveFile(solutionFile);</span>
<span class="nc" id="L37">			solution.loadFromArchiveFile(solutionFile);</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">			if (!solutionFile.delete()) {</span>
<span class="nc" id="L39">				throw new AssertionError();</span>
			}
		}
<span class="nc bnc" id="L42" title="All 2 branches missed.">		if (!executeHelloPlan(solution, &quot;John&quot;).equals(&quot;Hello John!&quot;)) {</span>
<span class="nc" id="L43">			throw new AssertionError();</span>
		}
<span class="nc bnc" id="L45" title="All 2 branches missed.">		if (!triggerHelloPlan(solution, &quot;John&quot;).contains(&quot;Hello John!&quot;)) {</span>
<span class="nc" id="L46">			throw new AssertionError();</span>
		}
<span class="nc" id="L48">		runSolution(solution);</span>
<span class="nc" id="L49">	}</span>

	/**
	 * @return The example solution.
	 */
	private static Solution generateHelloCommandSolution() {
<span class="nc" id="L55">		Solution solution = Solution.INSTANCE;</span>
<span class="nc" id="L56">		Plan plan = new Plan();</span>
		{
<span class="nc" id="L58">			solution.getContents().add(plan);</span>
<span class="nc" id="L59">			ReadCommandLine activator = new ReadCommandLine();</span>
			{
<span class="nc" id="L61">				plan.setActivator(activator);</span>
<span class="nc" id="L62">				activator.setPromptVariant(new Variant&lt;String&gt;(String.class, &quot;Enter your name&gt; &quot;));</span>
			}
<span class="nc" id="L64">			RootInstanceBuilderFacade intitializationRoot = plan.getOutputBuilder().getFacade();</span>
<span class="nc" id="L65">			FieldInitializerFacade commandOutputInitializer = (FieldInitializerFacade) intitializationRoot.getChildren()</span>
<span class="nc" id="L66">					.get(0).getChildren().get(0);</span>
<span class="nc" id="L67">			commandOutputInitializer.setFieldValue(new InstantiationFunction(</span>
<span class="nc" id="L68">					&quot;return \&quot;Hello \&quot; + &quot; + Plan.INPUT_VARIABLE_NAME + &quot;.inputLine + \&quot;!\&quot;;&quot;));</span>
		}
<span class="nc" id="L70">		return solution;</span>
	}

	/**
	 * Synchronously executes the plan of the given example solution.
	 * 
	 * @param solution       The example solution.
	 * @param parameterValue The value of the the example plan parameter.
	 * @return The result of the example plan execution.
	 * @throws Exception Thrown in case of a problem.
	 */
	private static String executeHelloPlan(Solution solution, String parameterValue) throws Exception {
<span class="nc" id="L82">		try (Session session = Session.openDummySession()) {</span>
<span class="nc" id="L83">			Plan plan = (Plan) SolutionUtils.findAsset(solution, Plan.class::isInstance);</span>
<span class="nc" id="L84">			Object output = SolutionUtils.executePlan(plan, session, inputBuilder -&gt; {</span>
<span class="nc" id="L85">				InstantiationUtils.setChildInitializerValue(inputBuilder, &quot;(inputLine)&quot;, &quot;John&quot;);</span>
<span class="nc" id="L86">			});</span>
<span class="nc" id="L87">			return Expression.evaluateObjectMemberSelection(output, &quot;result&quot;, String.class);</span>
		}
	}

	/**
	 * Activates the plan of the given example solution, triggers it, and
	 * deactivates it.
	 * 
	 * @param solution       The example solution.
	 * @param parameterValue The value of the the example plan parameter.
	 * @return The result of the example plan execution.
	 * @throws Exception Thrown in case of a problem.
	 */
	private static String triggerHelloPlan(Solution solution, String parameterValue) throws Exception {
<span class="nc" id="L101">		try (Session session = Session.openDummySession()) {</span>
<span class="nc" id="L102">			Plan plan = (Plan) SolutionUtils.findAsset(solution, Plan.class::isInstance);</span>
<span class="nc" id="L103">			SolutionUtils.activatePlan(plan, session);</span>
			try {
<span class="nc" id="L105">				PrintStream initialStandardOutput = JESB.getStandardOutput();</span>
				try {
<span class="nc" id="L107">					ByteArrayOutputStream buffer = new ByteArrayOutputStream();</span>
<span class="nc" id="L108">					JESB.setStandardOutput(new PrintStream(buffer));</span>
<span class="nc" id="L109">					JESB.getStandardInputSource().pushLine(parameterValue);</span>
<span class="nc" id="L110">					Thread.sleep(5000);</span>
<span class="nc" id="L111">					return buffer.toString();</span>
				} finally {
<span class="nc" id="L113">					JESB.setStandardOutput(initialStandardOutput);</span>
				}
			} finally {
<span class="nc" id="L116">				SolutionUtils.deactivatePlan(plan);</span>
			}
		}
	}

	/**
	 * Starts the given example solution, waits for a certain period of time and
	 * stops it.
	 * 
	 * @param solution The example solution.
	 * @throws Exception If a problem occurs.
	 */
	private static void runSolution(Solution solution) throws Exception {
<span class="nc" id="L129">		System.out.println(&quot;Starting solution...&quot;);</span>
<span class="nc" id="L130">		try (Runner runner = new Runner(solution)) {</span>
<span class="nc" id="L131">			Thread.sleep(10000);</span>
		}
<span class="nc" id="L133">		System.out.println(&quot;Stopping solution...&quot;);</span>
<span class="nc" id="L134">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>