<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>GUI.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</a> &gt; <a href="../../index.html" class="el_group">j-enterprise-service-bus</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">com.otk.jesb.ui</a> &gt; <span class="el_source">GUI.java</span></div><h1>GUI.java</h1><pre class="source lang-java linenums">package com.otk.jesb.ui;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Component;
import java.awt.Image;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.ArrayDeque;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.Deque;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.WeakHashMap;
import java.util.function.Consumer;
import java.util.function.Function;
import java.util.stream.Collectors;

import javax.swing.DropMode;
import javax.swing.JEditorPane;
import javax.swing.SwingUtilities;
import javax.swing.text.BadLocationException;
import javax.swing.text.JTextComponent;

import com.otk.jesb.Debugger;
import com.otk.jesb.Expression;
import com.otk.jesb.FunctionEditor;
import com.otk.jesb.JESB;
import com.otk.jesb.Log;
import com.otk.jesb.PathOptionsProvider;
import com.otk.jesb.PluginBuilder;
import com.otk.jesb.PotentialError;
import com.otk.jesb.Reference;
import com.otk.jesb.Session;
import com.otk.jesb.Structure;
import com.otk.jesb.PathExplorer.PathNode;
import com.otk.jesb.Structure.Element;
import com.otk.jesb.UnexpectedError;
import com.otk.jesb.VariableDeclaration;
import com.otk.jesb.Variant;
import com.otk.jesb.activation.ActivationHandler;
import com.otk.jesb.activation.Activator;
import com.otk.jesb.activation.ActivatorMetadata;
import com.otk.jesb.activation.ActivatorStructure;
import com.otk.jesb.activation.builtin.HTTPRequestReceiver;
import com.otk.jesb.Debugger.PlanActivation;
import com.otk.jesb.Debugger.PlanExecutor;
import com.otk.jesb.EnvironmentSettings.EnvironmentVariable;
import com.otk.jesb.compiler.CompilationError;
import com.otk.jesb.instantiation.Facade;
import com.otk.jesb.instantiation.FacadeOutline;
import com.otk.jesb.instantiation.FieldInitializer;
import com.otk.jesb.instantiation.FieldInitializerFacade;
import com.otk.jesb.instantiation.InitializationCase;
import com.otk.jesb.instantiation.InitializationCaseFacade;
import com.otk.jesb.instantiation.InitializationSwitch;
import com.otk.jesb.instantiation.InitializationSwitchFacade;
import com.otk.jesb.instantiation.InstanceBuilderFacade;
import com.otk.jesb.instantiation.InstantiationFunction;
import com.otk.jesb.instantiation.InstantiationFunctionCompilationContext;
import com.otk.jesb.instantiation.ListItemInitializer;
import com.otk.jesb.instantiation.ListItemInitializerFacade;
import com.otk.jesb.instantiation.ListItemReplicationFacade;
import com.otk.jesb.instantiation.ParameterInitializer;
import com.otk.jesb.instantiation.ParameterInitializerFacade;
import com.otk.jesb.instantiation.RootInstanceBuilder;
import com.otk.jesb.instantiation.RootInstanceBuilderFacade;
import com.otk.jesb.instantiation.ValueMode;
import com.otk.jesb.meta.Date;
import com.otk.jesb.meta.DateTime;
import com.otk.jesb.operation.Operation;
import com.otk.jesb.operation.OperationBuilder;
import com.otk.jesb.operation.OperationMetadata;
import com.otk.jesb.operation.OperationStructureBuilder;
import com.otk.jesb.resource.Resource;
import com.otk.jesb.resource.ResourceMetadata;
import com.otk.jesb.resource.ResourceStructure;
import com.otk.jesb.resource.builtin.HTTPServer;
import com.otk.jesb.solution.Asset;
import com.otk.jesb.solution.CompositeStep;
import com.otk.jesb.solution.Folder;
import com.otk.jesb.solution.LoopCompositeStep;
import com.otk.jesb.solution.Plan;
import com.otk.jesb.solution.PlanElement;
import com.otk.jesb.solution.Solution;
import com.otk.jesb.solution.Step;
import com.otk.jesb.solution.StepCrossing;
import com.otk.jesb.solution.Transition;
import com.otk.jesb.solution.CompositeStep.CompositeStepMetadata;
import com.otk.jesb.solution.LoopCompositeStep.LoopOperation;
import com.otk.jesb.solution.LoopCompositeStep.LoopOperation.Builder.ResultsCollectionConfigurationEntry;
import com.otk.jesb.ui.diagram.DragIntent;
import com.otk.jesb.util.Accessor;
import com.otk.jesb.util.FadingPanel;
import com.otk.jesb.util.InstantiationUtils;
import com.otk.jesb.util.MiscUtils;
import com.otk.jesb.util.Pair;
import com.otk.jesb.util.SquigglePainter;
import com.otk.jesb.util.UpToDate;
import com.otk.jesb.util.UpToDate.VersionAccessException;

import de.sciss.syntaxpane.syntaxkits.JavaSyntaxKit;
import xy.reflect.ui.ReflectionUI;
import xy.reflect.ui.control.FieldControlDataProxy;
import xy.reflect.ui.control.FieldControlInputProxy;
import xy.reflect.ui.control.IFieldControlData;
import xy.reflect.ui.control.IFieldControlInput;
import xy.reflect.ui.control.IMethodControlInput;
import xy.reflect.ui.control.plugin.IFieldControlPlugin;
import xy.reflect.ui.control.swing.ListControl;
import xy.reflect.ui.control.swing.MethodAction;
import xy.reflect.ui.control.swing.NullableControl;
import xy.reflect.ui.control.swing.TextControl;
import xy.reflect.ui.control.swing.builder.AbstractEditorBuilder;
import xy.reflect.ui.control.swing.builder.AbstractEditorFormBuilder;
import xy.reflect.ui.control.swing.customizer.CustomizationController;
import xy.reflect.ui.control.swing.customizer.CustomizationTools;
import xy.reflect.ui.control.swing.customizer.CustomizationToolsUI;
import xy.reflect.ui.control.swing.customizer.CustomizingFieldControlPlaceHolder;
import xy.reflect.ui.control.swing.customizer.CustomizingForm;
import xy.reflect.ui.control.swing.customizer.CustomizingMethodControlPlaceHolder;
import xy.reflect.ui.control.swing.customizer.MultiSwingCustomizer;
import xy.reflect.ui.control.swing.plugin.DatePickerPlugin;
import xy.reflect.ui.control.swing.plugin.DateTimePickerPlugin;
import xy.reflect.ui.control.swing.plugin.EditorPlugin;
import xy.reflect.ui.control.swing.plugin.StyledTextPlugin;
import xy.reflect.ui.control.swing.plugin.ToggleButtonPlugin;
import xy.reflect.ui.control.swing.plugin.ToggleButtonPlugin.ToggleButtonConfiguration;
import xy.reflect.ui.control.swing.renderer.Form;
import xy.reflect.ui.control.swing.renderer.SwingRenderer;
import xy.reflect.ui.control.swing.util.SwingRendererUtils;
import xy.reflect.ui.info.InfoCategory;
import xy.reflect.ui.info.ResourcePath;
import xy.reflect.ui.info.ValidationSession;
import xy.reflect.ui.info.custom.InfoCustomizations;
import xy.reflect.ui.info.field.MembersCapsuleFieldInfo;
import xy.reflect.ui.info.field.FieldInfoProxy;
import xy.reflect.ui.info.field.IFieldInfo;
import xy.reflect.ui.info.filter.IInfoFilter;
import xy.reflect.ui.info.method.AbstractConstructorInfo;
import xy.reflect.ui.info.method.IMethodInfo;
import xy.reflect.ui.info.method.InvocationData;
import xy.reflect.ui.info.method.MethodInfoProxy;
import xy.reflect.ui.info.parameter.IParameterInfo;
import xy.reflect.ui.info.parameter.ParameterInfoProxy;
import xy.reflect.ui.info.type.ITypeInfo;
import xy.reflect.ui.info.type.ITypeInfo.CategoriesStyle;
import xy.reflect.ui.info.type.ITypeInfo.FieldsLayout;
import xy.reflect.ui.info.type.ITypeInfo.IValidationJob;
import xy.reflect.ui.info.type.factory.EncapsulatedObjectFactory;
import xy.reflect.ui.info.type.factory.GenericEnumerationFactory;
import xy.reflect.ui.info.type.factory.IInfoProxyFactory;
import xy.reflect.ui.info.type.factory.InfoCustomizationsFactory;
import xy.reflect.ui.info.type.factory.InfoProxyFactory;
import xy.reflect.ui.info.type.factory.InfoProxyFactoryChain;
import xy.reflect.ui.info.type.iterable.IListTypeInfo;
import xy.reflect.ui.info.type.iterable.item.BufferedItemPosition;
import xy.reflect.ui.info.type.iterable.item.ItemPosition;
import xy.reflect.ui.info.type.iterable.util.AbstractDynamicListAction;
import xy.reflect.ui.info.type.iterable.util.IDynamicListAction;
import xy.reflect.ui.info.type.source.ITypeInfoSource;
import xy.reflect.ui.info.type.source.JavaTypeInfoSource;
import xy.reflect.ui.info.type.source.PrecomputedTypeInfoSource;
import xy.reflect.ui.info.type.source.SpecificitiesIdentifier;
import xy.reflect.ui.undo.IModification;
import xy.reflect.ui.undo.ListModificationFactory;
import xy.reflect.ui.util.Mapper;
import xy.reflect.ui.util.PrecomputedTypeInstanceWrapper;
import xy.reflect.ui.util.ReflectionUIError;
import xy.reflect.ui.util.ReflectionUIUtils;
import xy.reflect.ui.util.SystemProperties;
import xy.reflect.ui.util.ValidationErrorRegistry;

/**
 * Main graphical user interface rendering class of the application.
 * 
 * @author olitank
 *
 */
public class GUI extends MultiSwingCustomizer {

	public static final String UI_CUSTOMIZATIONS_METHOD_NAME = &quot;customizeUI&quot;;
<span class="fc" id="L190">	public static final String GUI_CUSTOMIZATIONS_RESOURCE_DIRECTORY_PROPERTY_KEY = GUI.class.getPackage().getName()</span>
<span class="fc" id="L191">			+ &quot;.alternateUICustomizationsFileDirectory&quot;;</span>

<span class="fc" id="L193">	private static final String CURRENT_ASSET_KEY = GUI.class.getName() + &quot;.CURRENT_VALIDATION_ASSET_KEY&quot;;</span>
<span class="fc" id="L194">	private static final String CURRENT_PLAN_ELEMENT_KEY = GUI.class.getName() + &quot;.CURRENT_VALIDATION_PLAN_ELEMENT_KEY&quot;;</span>
<span class="fc" id="L195">	private static final String CURRENT_INSTANTIATION_FACADE_KEY = GUI.class.getName()</span>
<span class="fc" id="L196">			+ &quot;.CURRENT_INSTANTIATION_FACADE_KEY&quot;;</span>
<span class="fc" id="L197">	private static final String CURRENT_ACTIVATOR_KEY = GUI.class.getName() + &quot;.CURRENT_VALIDATION_ACTIVATOR_KEY&quot;;</span>

<span class="fc" id="L199">	private static WeakHashMap&lt;RootInstanceBuilder, Object&gt; rootInitializerBackupByBuilder = new WeakHashMap&lt;RootInstanceBuilder, Object&gt;();</span>
<span class="fc" id="L200">	private static WeakHashMap&lt;Plan, DragIntent&gt; diagramDragIntentByPlan = new WeakHashMap&lt;Plan, DragIntent&gt;();</span>

<span class="fc" id="L202">	private static Deque&lt;Asset&gt; stackOfCurrentAssets = new ArrayDeque&lt;Asset&gt;();</span>
<span class="fc" id="L203">	private static Deque&lt;PlanElement&gt; stackOfCurrentPlanElements = new ArrayDeque&lt;PlanElement&gt;();</span>
<span class="fc" id="L204">	private static Deque&lt;Facade&gt; stackOfCurrentInstantiationFacades = new ArrayDeque&lt;Facade&gt;();</span>
<span class="fc" id="L205">	private static Deque&lt;Activator&gt; stackOfCurrentActivators = new ArrayDeque&lt;Activator&gt;();</span>
	private static SidePaneValueName sidePaneValueName;
<span class="fc" id="L207">	private static boolean focusTrackingDisabled = false;</span>
<span class="fc" id="L208">	private static List&lt;Pair&lt;ITypeInfo, Object&gt;&gt; lostFocusWhileTrackingDisabled = new ArrayList&lt;Pair&lt;ITypeInfo, Object&gt;&gt;();</span>
<span class="fc" id="L209">	private static List&lt;Pair&lt;ITypeInfo, Object&gt;&gt; gainedFocusWhileTrackingDisabled = new ArrayList&lt;Pair&lt;ITypeInfo, Object&gt;&gt;();</span>

	static {
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">		if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L213">			System.setProperty(SystemProperties.DEBUG, Boolean.TRUE.toString());</span>
		}
<span class="fc" id="L215">		Preferences.INSTANCE.getTheme().activate();</span>
	}

	public static final String GUI_MAIN_CUSTOMIZATIONS_RESOURCE_NAME = &quot;jesb.icu&quot;;

<span class="fc" id="L220">	public static GUI INSTANCE = new GUI();</span>

<span class="fc" id="L222">	private List&lt;SubSwingCustomizer&gt; builtInSubCustomizers = new ArrayList&lt;SubSwingCustomizer&gt;();</span>

	private GUI() {
<span class="fc" id="L225">		super(null, null);</span>
<span class="fc" id="L226">		this.customizationsIdentifierSelector = new Function&lt;Object, String&gt;() {</span>
			@Override
			public String apply(Object object) {
<span class="fc" id="L229">				return selectSubCustomizationsSwitch(object.getClass());</span>
			}
		};
<span class="fc" id="L232">		preLoadBuiltInCustomizations();</span>
<span class="fc" id="L233">	}</span>

	private void preLoadBuiltInCustomizations() {
<span class="fc" id="L236">		List&lt;Class&lt;?&gt;&gt; mainCustomizionClasses = new ArrayList&lt;Class&lt;?&gt;&gt;();</span>
<span class="fc bfc" id="L237" title="All 2 branches covered.">		for (OperationMetadata&lt;?&gt; metadata : MiscUtils.BUILTIN_OPERATION_METADATAS) {</span>
<span class="fc" id="L238">			mainCustomizionClasses.add(metadata.getOperationBuilderClass());</span>
		}
<span class="fc bfc" id="L240" title="All 2 branches covered.">		for (ActivatorMetadata metadata : MiscUtils.BUILTIN_ACTIVATOR__METADATAS) {</span>
<span class="fc" id="L241">			mainCustomizionClasses.add(metadata.getActivatorClass());</span>
		}
<span class="fc bfc" id="L243" title="All 2 branches covered.">		for (ResourceMetadata metadata : MiscUtils.BUILTIN_RESOURCE_METADATAS) {</span>
<span class="fc" id="L244">			mainCustomizionClasses.add(metadata.getResourceClass());</span>
		}
<span class="fc bfc" id="L246" title="All 2 branches covered.">		for (CompositeStepMetadata metadata : MiscUtils.BUILTIN_COMPOSITE_STEP_METADATAS) {</span>
<span class="fc" id="L247">			mainCustomizionClasses.add(metadata.getCompositeStepClass());</span>
		}
<span class="fc bfc" id="L249" title="All 2 branches covered.">		for (Class&lt;?&gt; customizionClass : mainCustomizionClasses) {</span>
<span class="fc" id="L250">			String customizationsIdentifier = selectSubCustomizationsSwitch(customizionClass);</span>
<span class="fc" id="L251">			SubSwingCustomizer subCustomizer = obtainSubCustomizer(customizationsIdentifier);</span>
<span class="fc" id="L252">			SubCustomizedUI subCustomizedUI = subCustomizer.getCustomizedUI();</span>
<span class="fc" id="L253">			ITypeInfo customizedType = subCustomizedUI.getTypeInfo(subCustomizedUI.getTypeInfoSource(customizionClass));</span>
<span class="fc" id="L254">			customizedType.getName();</span>
<span class="fc" id="L255">			customizedType.getFields();</span>
<span class="fc" id="L256">			customizedType.getMethods();</span>
<span class="fc" id="L257">			customizedType.getConstructors();</span>
<span class="fc" id="L258">			customizedType.getMenuModel();</span>
<span class="fc" id="L259">			builtInSubCustomizers.add(subCustomizer);</span>
		}
<span class="fc" id="L261">	}</span>

	public static WeakHashMap&lt;Plan, DragIntent&gt; getDiagramDragIntentByPlan() {
<span class="fc" id="L264">		return diagramDragIntentByPlan;</span>
	}

	public static void backupRootInstanceBuilderState(RootInstanceBuilder rootInstanceBuilder) {
<span class="fc" id="L268">		Object rootInitializer = rootInstanceBuilder.getRootInstantiationNode();</span>
		Object rootInitializerBackup;
<span class="pc bpc" id="L270" title="1 of 2 branches missed.">		if (rootInitializer != null) {</span>
<span class="fc" id="L271">			rootInitializerBackup = InstantiationUtils.cloneInitializer(rootInitializer);</span>
<span class="fc" id="L272">		} else {</span>
<span class="nc" id="L273">			rootInitializerBackup = null;</span>
		}
<span class="fc" id="L275">		rootInitializerBackupByBuilder.put(rootInstanceBuilder, rootInitializerBackup);</span>
<span class="fc" id="L276">	}</span>

	public static Runnable getRootInstanceBuilderStateRestorationJob(RootInstanceBuilder rootInstanceBuilder) {
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">		if (!rootInitializerBackupByBuilder.containsKey(rootInstanceBuilder)) {</span>
<span class="nc" id="L280">			throw new UnexpectedError();</span>
		}
<span class="fc" id="L282">		final Object rootInitializerBackup = rootInitializerBackupByBuilder.get(rootInstanceBuilder);</span>
<span class="fc" id="L283">		return new Runnable() {</span>
			@Override
			public void run() {
<span class="nc bnc" id="L286" title="All 2 branches missed.">				rootInstanceBuilder.setRootInstantiationNode((rootInitializerBackup == null) ? null</span>
<span class="nc" id="L287">						: InstantiationUtils.cloneInitializer(rootInitializerBackup));</span>
<span class="nc" id="L288">			}</span>
		};
	}

	protected String selectSubCustomizationsSwitch(Class&lt;?&gt; objectClass) {
<span class="fc bfc" id="L293" title="All 2 branches covered.">		if (objectClass == RootInstanceBuilder.class) {</span>
<span class="fc" id="L294">			return GLOBAL_EXCLUSIVE_CUSTOMIZATIONS;</span>
		}
<span class="fc bfc" id="L296" title="All 2 branches covered.">		if (objectClass == Reference.class) {</span>
<span class="fc" id="L297">			return GLOBAL_EXCLUSIVE_CUSTOMIZATIONS;</span>
		}
<span class="fc bfc" id="L299" title="All 2 branches covered.">		if (objectClass == FunctionEditor.class) {</span>
<span class="fc" id="L300">			return GLOBAL_EXCLUSIVE_CUSTOMIZATIONS;</span>
		}
<span class="fc bfc" id="L302" title="All 2 branches covered.">		if (Structure.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L303">			return GLOBAL_EXCLUSIVE_CUSTOMIZATIONS;</span>
		}
<span class="fc bfc" id="L305" title="All 2 branches covered.">		if (objectClass.getEnclosingClass() != null) {</span>
<span class="fc" id="L306">			return selectSubCustomizationsSwitch(objectClass.getEnclosingClass());</span>
		}
<span class="fc bfc" id="L308" title="All 2 branches covered.">		if (Operation.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L309">			return objectClass.getName();</span>
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">		} else if (OperationBuilder.class.isAssignableFrom(objectClass)) {</span>
<span class="nc" id="L311">			return MiscUtils.inferOperationClass(objectClass).getName();</span>
<span class="fc bfc" id="L312" title="All 2 branches covered.">		} else if (Activator.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L313">			return objectClass.getName();</span>
<span class="fc bfc" id="L314" title="All 2 branches covered.">		} else if (Resource.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L315">			return objectClass.getName();</span>
<span class="fc bfc" id="L316" title="All 2 branches covered.">		} else if (CompositeStep.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L317">			return objectClass.getName();</span>
		} else {
<span class="fc" id="L319">			return null;</span>
		}
	}

	protected Class&lt;?&gt; getMainCustomizedClass(String customizationsIdentifier) {
<span class="fc" id="L324">		Class&lt;?&gt; result = MiscUtils.getJESBClass(customizationsIdentifier);</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">		if (Operation.class.isAssignableFrom(result)) {</span>
<span class="fc" id="L326">			result = MiscUtils.findOperationBuilderClass(result.asSubclass(Operation.class));</span>
		}
<span class="fc" id="L328">		return result;</span>
	}

	@Override
	public String getInfoCustomizationsOutputFilePath(String customizationsIdentifier) {
<span class="fc" id="L333">		String customizationsDirectoryPath = System.getProperty(GUI_CUSTOMIZATIONS_RESOURCE_DIRECTORY_PROPERTY_KEY);</span>
<span class="pc bpc" id="L334" title="1 of 2 branches missed.">		if (customizationsDirectoryPath != null) {</span>
<span class="nc" id="L335">			return customizationsDirectoryPath + &quot;/&quot; + getInfoCustomizationsResourceName(customizationsIdentifier);</span>
		} else {
<span class="fc" id="L337">			return null;</span>
		}
	}

	protected String getInfoCustomizationsResourceName(String customizationsIdentifier) {
<span class="fc bfc" id="L342" title="All 2 branches covered.">		return ((customizationsIdentifier != GLOBAL_EXCLUSIVE_CUSTOMIZATIONS) ? (customizationsIdentifier + &quot;-&quot;) : &quot;&quot;)</span>
<span class="fc" id="L343">				+ GUI_MAIN_CUSTOMIZATIONS_RESOURCE_NAME;</span>
	}

	@Override
	protected SubSwingCustomizer createSubCustomizer(String customizationsIdentifier) {
<span class="fc" id="L348">		SubSwingCustomizer result = new JESBSubSwingCustomizer(customizationsIdentifier);</span>
<span class="fc" id="L349">		String customizationsFilePath = getInfoCustomizationsOutputFilePath(customizationsIdentifier);</span>
<span class="pc bpc" id="L350" title="1 of 2 branches missed.">		if (customizationsFilePath != null) {</span>
<span class="nc" id="L351">			result.setInfoCustomizationsOutputFilePath(customizationsFilePath);</span>
<span class="nc" id="L352">		} else {</span>
			try {
<span class="fc" id="L354">				InputStream stream = result.getClassPathResourceLoader()</span>
<span class="fc" id="L355">						.getResourceAsStream(getInfoCustomizationsResourceName(customizationsIdentifier));</span>
<span class="fc bfc" id="L356" title="All 2 branches covered.">				if (stream != null) {</span>
<span class="fc" id="L357">					result.getInfoCustomizations().loadFromStream(stream, null);</span>
				}
<span class="pc" id="L359">			} catch (IOException e) {</span>
<span class="nc" id="L360">				throw new UnexpectedError(e);</span>
			}
		}
<span class="fc" id="L363">		return result;</span>
	}

	@Override
	protected SubCustomizedUI createSubCustomizedUI(String switchIdentifier) {
<span class="fc" id="L368">		return new JESBSubCustomizedUI(switchIdentifier);</span>
	}

	private void setFocusTrackingDisabled(boolean b) {
<span class="nc" id="L372">		focusTrackingDisabled = b;</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">		if (!b) {</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">			while (gainedFocusWhileTrackingDisabled.size() &gt; 0) {</span>
<span class="nc" id="L375">				Pair&lt;ITypeInfo, Object&gt; pair = gainedFocusWhileTrackingDisabled.remove(0);</span>
<span class="nc" id="L376">				handleFocusEvent(pair.getFirst(), pair.getSecond(), true);</span>
			}
<span class="nc bnc" id="L378" title="All 2 branches missed.">			while (lostFocusWhileTrackingDisabled.size() &gt; 0) {</span>
<span class="nc" id="L379">				Pair&lt;ITypeInfo, Object&gt; pair = lostFocusWhileTrackingDisabled.remove(0);</span>
<span class="nc" id="L380">				handleFocusEvent(pair.getFirst(), pair.getSecond(), false);</span>
			}
		}
<span class="nc" id="L383">	}</span>

	private boolean handleFocusEvent(ITypeInfo type, Object object, boolean focusGainedOrLost) {
<span class="pc bpc" id="L386" title="1 of 2 branches missed.">		if (focusTrackingDisabled) {</span>
<span class="nc" id="L387">			Pair&lt;ITypeInfo, Object&gt; pair = new Pair&lt;ITypeInfo, Object&gt;(type, object);</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">			if (focusGainedOrLost) {</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">				if (!lostFocusWhileTrackingDisabled.remove(pair)) {</span>
<span class="nc" id="L390">					gainedFocusWhileTrackingDisabled.add(pair);</span>
				}
<span class="nc" id="L392">			} else {</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">				if (!gainedFocusWhileTrackingDisabled.remove(pair)) {</span>
<span class="nc" id="L394">					lostFocusWhileTrackingDisabled.add(pair);</span>
				}
			}
<span class="nc" id="L397">			return false;</span>
		}
<span class="fc bfc" id="L399" title="All 2 branches covered.">		if (focusGainedOrLost) {</span>
<span class="fc bfc" id="L400" title="All 2 branches covered.">			if (object instanceof Asset) {</span>
<span class="fc" id="L401">				stackOfCurrentAssets.push((Asset) object);</span>
<span class="fc" id="L402">				return true;</span>
<span class="fc bfc" id="L403" title="All 2 branches covered.">			} else if (object instanceof PlanElement) {</span>
<span class="fc" id="L404">				stackOfCurrentPlanElements.push((PlanElement) object);</span>
<span class="fc" id="L405">				return true;</span>
<span class="fc bfc" id="L406" title="All 2 branches covered.">			} else if (object instanceof Activator) {</span>
<span class="fc" id="L407">				stackOfCurrentActivators.push((Activator) object);</span>
<span class="fc" id="L408">				return true;</span>
<span class="fc bfc" id="L409" title="All 2 branches covered.">			} else if (object instanceof Facade) {</span>
<span class="fc" id="L410">				stackOfCurrentInstantiationFacades.push((Facade) object);</span>
<span class="fc" id="L411">				return true;</span>
			}
		} else {
<span class="fc" id="L414">			Consumer&lt;Deque&lt;?&gt;&gt; handler = new Consumer&lt;Deque&lt;?&gt;&gt;() {</span>
				@Override
				public void accept(Deque&lt;?&gt; stack) {
					Object peeked;
<span class="fc bfc" id="L418" title="All 2 branches covered.">					if ((peeked = stack.peek()) != object) {</span>
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L420">							Log.get().error(new UnexpectedError(&quot;The user interface may become unstable because &quot;</span>
<span class="nc" id="L421">									+ object + &quot; was abnormally hidden before &quot; + peeked));</span>
						}
					}
<span class="pc bpc" id="L424" title="1 of 2 branches missed.">					if (!stack.remove(object)) {</span>
<span class="nc" id="L425">						throw new UnexpectedError();</span>
					}
<span class="fc" id="L427">				}</span>
			};
<span class="fc bfc" id="L429" title="All 2 branches covered.">			if (object instanceof Asset) {</span>
<span class="fc" id="L430">				handler.accept(stackOfCurrentAssets);</span>
<span class="fc" id="L431">				return true;</span>
<span class="fc bfc" id="L432" title="All 2 branches covered.">			} else if (object instanceof PlanElement) {</span>
<span class="fc" id="L433">				handler.accept(stackOfCurrentPlanElements);</span>
<span class="fc" id="L434">				return true;</span>
<span class="fc bfc" id="L435" title="All 2 branches covered.">			} else if (object instanceof Activator) {</span>
<span class="fc" id="L436">				handler.accept(stackOfCurrentActivators);</span>
<span class="fc" id="L437">				return true;</span>
<span class="fc bfc" id="L438" title="All 2 branches covered.">			} else if (object instanceof Facade) {</span>
<span class="fc" id="L439">				handler.accept(stackOfCurrentInstantiationFacades);</span>
<span class="fc" id="L440">				return true;</span>
			}
		}
<span class="fc" id="L443">		return false;</span>
	}

	private static boolean isConstantInstanceBuilder(RootInstanceBuilderFacade rootInstanceBuilderFacade) {
<span class="fc" id="L447">		Accessor&lt;String&gt; rootInstanceDynamicTypeNameAccessor = rootInstanceBuilderFacade.getUnderlying()</span>
<span class="fc" id="L448">				.getRootInstanceDynamicTypeNameAccessor();</span>
<span class="fc bfc" id="L449" title="All 2 branches covered.">		if (rootInstanceDynamicTypeNameAccessor != null) {</span>
<span class="fc" id="L450">			if (rootInstanceDynamicTypeNameAccessor.getClass().getName()</span>
<span class="fc bfc" id="L451" title="All 2 branches covered.">					.startsWith(Debugger.PlanActivation.class.getName())) {</span>
<span class="fc" id="L452">				return true;</span>
			}
		}
<span class="fc" id="L455">		return false;</span>
	}

	private class JESBSubSwingCustomizer extends SubSwingCustomizer {

<span class="fc" id="L460">		public JESBSubSwingCustomizer(String switchIdentifier) {</span>
<span class="fc" id="L461">			super(switchIdentifier);</span>
<span class="fc" id="L462">		}</span>

		@Override
		public List&lt;IFieldControlPlugin&gt; getFieldControlPlugins() {
<span class="fc" id="L466">			List&lt;IFieldControlPlugin&gt; result = new ArrayList&lt;IFieldControlPlugin&gt;(super.getFieldControlPlugins());</span>
<span class="fc" id="L467">			result.add(new JESDDatePickerPlugin());</span>
<span class="fc" id="L468">			result.add(new JESDDateTimePickerPlugin());</span>
<span class="fc" id="L469">			return result;</span>
		}

		@Override
		protected CustomizationController createCustomizationController() {
<span class="nc" id="L474">			return new CustomizationController(this) {</span>

				@Override
				protected void recustomizeAllForms() {
<span class="nc" id="L478">					setFocusTrackingDisabled(true);</span>
					try {
<span class="nc" id="L480">						super.recustomizeAllForms();</span>
<span class="nc" id="L481">					} finally {</span>
<span class="nc" id="L482">						setFocusTrackingDisabled(false);</span>
					}
<span class="nc" id="L484">				}</span>
			};
		}

		@Override
		protected CustomizationTools createCustomizationTools() {
<span class="fc" id="L490">			return new CustomizationTools(this) {</span>

				@Override
				protected CustomizationToolsUI createToolsUI() {
<span class="fc" id="L494">					return new CustomizationToolsUI(super.createToolsUI().getInfoCustomizations(), swingCustomizer) {</span>

						@Override
						public ITypeInfo getTypeInfo(ITypeInfoSource typeSource) {
<span class="fc" id="L498">							typeSource = adaptTypeInfoSource(typeSource);</span>
<span class="fc" id="L499">							return super.getTypeInfo(typeSource);</span>
						}

						@Override
						public ITypeInfoSource getTypeInfoSource(Object object) {
<span class="fc" id="L504">							ITypeInfoSource result = super.getTypeInfoSource(object);</span>
<span class="fc" id="L505">							result = adaptTypeInfoSource(result);</span>
<span class="fc" id="L506">							return result;</span>
						}

						ITypeInfoSource adaptTypeInfoSource(ITypeInfoSource typeSource) {
<span class="fc bfc" id="L510" title="All 2 branches covered.">							if (typeSource instanceof JavaTypeInfoSource) {</span>
<span class="fc" id="L511">								JavaTypeInfoSource javaTypeInfoSource = (JavaTypeInfoSource) typeSource;</span>
<span class="pc bpc" id="L512" title="1 of 2 branches missed.">								if (CustomizationController.class.isAssignableFrom(javaTypeInfoSource.getJavaType())) {</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">									if (CustomizationController.class != javaTypeInfoSource.getJavaType()) {</span>
<span class="nc" id="L514">										typeSource = new JavaTypeInfoSource(CustomizationController.class,</span>
<span class="nc" id="L515">												javaTypeInfoSource.getSpecificitiesIdentifier());</span>
									}
								}
							}
<span class="fc" id="L519">							return typeSource;</span>
						}
					};
				}
			};
		}

		@Override
		public CustomizingForm subCreateForm(final Object object, IInfoFilter infoFilter) {
<span class="fc bfc" id="L528" title="All 2 branches covered.">			if (object instanceof xy.reflect.ui.control.plugin.AbstractSimpleCustomizableFieldControlPlugin.AbstractConfiguration) {</span>
<span class="fc" id="L529">				return new CustomizingForm(getCustomizationTools().getToolsRenderer(), object, infoFilter);</span>
			}
<span class="fc" id="L531">			return new CustomizingForm(this, object, infoFilter) {</span>

				private static final long serialVersionUID = 1L;

				{
<span class="fc bfc" id="L536" title="All 2 branches covered.">					if (object instanceof FacadeOutline) {</span>
<span class="fc" id="L537">						List&lt;Form&gt; rootInstanceBuilderFacadeForms = SwingRendererUtils.findDescendantFormsOfType(this,</span>
<span class="fc" id="L538">								RootInstanceBuilderFacade.class.getName(), swingRenderer);</span>
<span class="fc" id="L539">						InstanceBuilderInitializerTreeControl initializerTreeControl = (InstanceBuilderInitializerTreeControl) rootInstanceBuilderFacadeForms</span>
<span class="fc" id="L540">								.get(1).getFieldControlPlaceHolder(&quot;children&quot;).getFieldControl();</span>
<span class="fc" id="L541">						initializerTreeControl.visitItems(new ListControl.IItemsVisitor() {</span>
							@Override
							public VisitStatus visitItem(BufferedItemPosition itemPosition) {
<span class="fc" id="L544">								Facade targetFacade = ((FacadeOutline) object).getFacade();</span>
<span class="fc" id="L545">								Facade currentFacade = (Facade) itemPosition.getItem();</span>
<span class="fc bfc" id="L546" title="All 2 branches covered.">								if (targetFacade.equals(currentFacade)) {</span>
<span class="fc" id="L547">									initializerTreeControl.setSingleSelection(itemPosition);</span>
<span class="fc" id="L548">									return VisitStatus.TREE_VISIT_INTERRUPTED;</span>
								}
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">								if (!Facade.getAncestors(targetFacade).contains(currentFacade)) {</span>
<span class="nc" id="L551">									return VisitStatus.SUBTREE_VISIT_INTERRUPTED;</span>
								}
<span class="fc" id="L553">								return VisitStatus.VISIT_NOT_INTERRUPTED;</span>
							}
						});
					}
				}

				@Override
				public void refresh(boolean refreshStructure) {
<span class="fc" id="L561">					handleFocusEvent(filteredObjectType, object, true);</span>
					try {
<span class="fc" id="L563">						super.refresh(refreshStructure);</span>
<span class="fc" id="L564">					} finally {</span>
<span class="fc" id="L565">						handleFocusEvent(filteredObjectType, object, false);</span>
					}
<span class="fc" id="L567">				}</span>

				@Override
				protected CustomizingFieldControlPlaceHolder createFieldControlPlaceHolder(IFieldInfo field) {
<span class="fc" id="L571">					return new CustomizingFieldControlPlaceHolder(this, field) {</span>

						private static final long serialVersionUID = 1L;

<span class="fc" id="L575">						FadingPanel transparentPanel = new FadingPanel();</span>
						Object lastValue;
<span class="fc" id="L577">						boolean fadingEnabled = false;</span>

						boolean mayFade() {
<span class="pc bpc" id="L580" title="1 of 2 branches missed.">							if (!Preferences.INSTANCE.isFadingTransitioningEnabled()) {</span>
<span class="nc" id="L581">								return false;</span>
							}
<span class="fc bfc" id="L583" title="All 2 branches covered.">							if (getObject() instanceof PrecomputedTypeInstanceWrapper) {</span>
<span class="fc" id="L584">								ITypeInfo precomputedType = ((PrecomputedTypeInstanceWrapper) getObject())</span>
<span class="fc" id="L585">										.getPrecomputedType();</span>
<span class="fc bfc" id="L586" title="All 2 branches covered.">								if (precomputedType instanceof EncapsulatedObjectFactory.TypeInfo) {</span>
<span class="fc" id="L587">									EncapsulatedObjectFactory factory = ((EncapsulatedObjectFactory.TypeInfo) precomputedType)</span>
<span class="fc" id="L588">											.getFactory();</span>
<span class="fc bfc" id="L589" title="All 2 branches covered.">									if (factory instanceof AbstractEditorBuilder.EditorEncapsulation) {</span>
<span class="fc" id="L590">										AbstractEditorFormBuilder builder = ((AbstractEditorFormBuilder.EditorEncapsulation) factory)</span>
<span class="fc" id="L591">												.getBuilder();</span>
<span class="fc bfc" id="L592" title="All 2 branches covered.">										if (builder.getClass().getEnclosingClass() == ListControl.class) {</span>
<span class="fc" id="L593">											return true;</span>
										}
									}
								}
							}
<span class="fc" id="L598">							return false;</span>
						}

						boolean prepareToFade() {
<span class="fc bfc" id="L602" title="All 2 branches covered.">							if (fadingEnabled != mayFade()) {</span>
<span class="pc bpc" id="L603" title="1 of 2 branches missed.">								if (fieldControl != null) {</span>
<span class="nc" id="L604">									destroyFieldControl();</span>
								}
<span class="fc" id="L606">								fadingEnabled = mayFade();</span>
<span class="fc" id="L607">								super.refreshUI(false);</span>
							}
<span class="fc bfc" id="L609" title="All 2 branches covered.">							if (!fadingEnabled) {</span>
<span class="fc" id="L610">								return false;</span>
							}
<span class="fc" id="L612">							Object newValue = field.getValue(getObject());</span>
<span class="fc bfc" id="L613" title="All 2 branches covered.">							if (MiscUtils.equalsOrBothNull(lastValue, newValue)) {</span>
<span class="fc" id="L614">								return false;</span>
							}
<span class="fc" id="L616">							lastValue = newValue;</span>
<span class="fc bfc" id="L617" title="All 2 branches covered.">							if (!isDisplayable()) {</span>
<span class="fc" id="L618">								return false;</span>
							}
<span class="fc" id="L620">							return true;</span>
						}

						@Override
						protected void layoutFieldControl() {
<span class="fc" id="L625">							super.layoutFieldControl();</span>
<span class="fc bfc" id="L626" title="All 2 branches covered.">							if (fadingEnabled) {</span>
<span class="fc" id="L627">								remove(fieldControl);</span>
<span class="fc" id="L628">								add(transparentPanel, BorderLayout.CENTER);</span>
<span class="fc" id="L629">								transparentPanel.add(fieldControl, BorderLayout.CENTER);</span>
							}
<span class="fc" id="L631">						}</span>

						@Override
						protected void destroyFieldControl() {
<span class="fc bfc" id="L635" title="All 2 branches covered.">							if (fadingEnabled) {</span>
<span class="fc" id="L636">								transparentPanel.remove(fieldControl);</span>
<span class="fc" id="L637">								remove(transparentPanel);</span>
<span class="fc" id="L638">								add(fieldControl, BorderLayout.CENTER);</span>
							}
<span class="fc" id="L640">							super.destroyFieldControl();</span>
<span class="fc" id="L641">						}</span>

						@Override
						public void refreshUI(boolean refreshStructure) {
<span class="fc bfc" id="L645" title="All 4 branches covered.">							boolean mustFade = isVisible() &amp;&amp; prepareToFade();</span>
<span class="fc bfc" id="L646" title="All 2 branches covered.">							if (mustFade) {</span>
<span class="fc" id="L647">								transparentPanel.fade(+1, 0.0);</span>
							}
<span class="fc" id="L649">							super.refreshUI(refreshStructure);</span>
<span class="fc bfc" id="L650" title="All 2 branches covered.">							if (mustFade) {</span>
<span class="fc" id="L651">								SwingRendererUtils.handleComponentSizeChange(this);</span>
<span class="fc" id="L652">								SwingUtilities.invokeLater(new Runnable() {</span>
									@Override
									public void run() {
<span class="fc" id="L655">										transparentPanel.fade(-1, 1.0);</span>
<span class="fc" id="L656">									}</span>
								});
							}
<span class="fc bfc" id="L659" title="All 2 branches covered.">							if (object instanceof InstanceBuilderFacade) {</span>
<span class="fc bfc" id="L660" title="All 2 branches covered.">								if (field.getName().equals(&quot;constructorGroup&quot;)) {</span>
<span class="fc" id="L661">									setVisible(((InstanceBuilderFacade) object).getConstructorSignatureOptions()</span>
<span class="pc bpc" id="L662" title="1 of 2 branches missed.">											.size() &gt; 1);</span>
								}
<span class="fc bfc" id="L664" title="All 2 branches covered.">								if (field.getName().equals(&quot;typeGroup&quot;)) {</span>
<span class="fc" id="L665">									setVisible(((InstanceBuilderFacade) object).getUnderlying()</span>
<span class="pc bpc" id="L666" title="1 of 2 branches missed.">											.getDynamicTypeNameAccessor() == null);</span>
								}
							}
<span class="fc" id="L669">						}</span>

						@Override
						public Component createFieldControl() {
<span class="fc bfc" id="L673" title="All 2 branches covered.">							if (field.getType().getName().equals(PlanDiagram.Source.class.getName())) {</span>
<span class="fc" id="L674">								return new PlanDiagram(swingRenderer, this);</span>
							}
<span class="fc bfc" id="L676" title="All 2 branches covered.">							if (field.getType().getName().equals(PlanDiagramPalette.Source.class.getName())) {</span>
<span class="fc" id="L677">								return new PlanDiagramPalette(swingRenderer, this);</span>
							}
<span class="fc bfc" id="L679" title="All 2 branches covered.">							if (field.getType().getName().equals(DebugPlanDiagram.Source.class.getName())) {</span>
<span class="fc" id="L680">								return new DebugPlanDiagram(swingRenderer, this);</span>
							}
<span class="pc bpc" id="L682" title="1 of 4 branches missed.">							if (field.getName().equals(&quot;children&quot;) &amp;&amp; (field.getType() instanceof IListTypeInfo)</span>
<span class="pc bpc" id="L683" title="1 of 2 branches missed.">									&amp;&amp; (((IListTypeInfo) field.getType()).getItemType() != null)</span>
<span class="fc" id="L684">									&amp;&amp; ((IListTypeInfo) field.getType()).getItemType().getName()</span>
<span class="pc bpc" id="L685" title="1 of 2 branches missed.">											.equals(Facade.class.getName())) {</span>
<span class="fc" id="L686">								return new InstanceBuilderInitializerTreeControl(swingRenderer, this);</span>
							}
<span class="pc bpc" id="L688" title="1 of 4 branches missed.">							if (field.getName().equals(&quot;data&quot;) &amp;&amp; (field.getType() instanceof IListTypeInfo)</span>
<span class="pc bpc" id="L689" title="1 of 2 branches missed.">									&amp;&amp; (((IListTypeInfo) field.getType()).getItemType() != null)</span>
<span class="fc" id="L690">									&amp;&amp; ((IListTypeInfo) field.getType()).getItemType().getName()</span>
<span class="pc bpc" id="L691" title="1 of 2 branches missed.">											.equals(PathNode.class.getName())) {</span>
<span class="fc" id="L692">								return new InstanceBuilderVariableTreeControl(swingRenderer, this);</span>
							}
<span class="pc bpc" id="L694" title="1 of 4 branches missed.">							if (field.getName().equals(&quot;rootPathNodes&quot;) &amp;&amp; (field.getType() instanceof IListTypeInfo)</span>
<span class="pc bpc" id="L695" title="1 of 2 branches missed.">									&amp;&amp; (((IListTypeInfo) field.getType()).getItemType() != null)</span>
<span class="fc" id="L696">									&amp;&amp; ((IListTypeInfo) field.getType()).getItemType().getName()</span>
<span class="pc bpc" id="L697" title="1 of 2 branches missed.">											.equals(PathNode.class.getName())) {</span>
<span class="fc" id="L698">								return new FunctionEditorVariableTreeControl(swingRenderer, this);</span>
							}
<span class="fc bfc" id="L700" title="All 2 branches covered.">							if (field.getName().equals(&quot;functionBody&quot;)</span>
<span class="pc bpc" id="L701" title="1 of 2 branches missed.">									&amp;&amp; (field.getType().getName().equals(String.class.getName()))) {</span>
<span class="fc" id="L702">								return new EditorPlugin().new EditorControl(swingRenderer, this) {</span>

									private static final long serialVersionUID = 1L;

									@Override
									protected JTextComponent createTextComponent() {
<span class="fc" id="L708">										JEditorPane result = (JEditorPane) super.createTextComponent();</span>
<span class="fc" id="L709">										JavaSyntaxKit editorKit = new JavaSyntaxKit();</span>
<span class="fc" id="L710">										editorKit.getConfig().put(JavaSyntaxKit.CONFIG_ENABLE_WORD_WRAP,</span>
<span class="fc" id="L711">												Boolean.TRUE.toString());</span>
<span class="fc" id="L712">										result.setEditorKit(editorKit);</span>
<span class="fc" id="L713">										result.setTransferHandler(</span>
<span class="fc" id="L714">												new FunctionEditorVariableTreeControl.PathImportTransferHandler());</span>
<span class="fc" id="L715">										result.setDropMode(DropMode.INSERT);</span>
<span class="fc" id="L716">										return result;</span>
									}

								};
							}
<span class="fc bfc" id="L721" title="All 2 branches covered.">							if (field.getName().equals(&quot;facadeOutlineChildren&quot;)</span>
<span class="pc bpc" id="L722" title="1 of 2 branches missed.">									&amp;&amp; (field.getType() instanceof IListTypeInfo)</span>
<span class="pc bpc" id="L723" title="1 of 2 branches missed.">									&amp;&amp; (((IListTypeInfo) field.getType()).getItemType() != null)</span>
<span class="fc" id="L724">									&amp;&amp; ((IListTypeInfo) field.getType()).getItemType().getName()</span>
<span class="pc bpc" id="L725" title="1 of 2 branches missed.">											.equals(FacadeOutline.class.getName())) {</span>
<span class="fc" id="L726">								return new InstanceBuilderOutlineTreeControl(swingRenderer, this);</span>
							}
<span class="fc bfc" id="L728" title="All 2 branches covered.">							if (field.getType().getName().equals(MappingsControl.Source.class.getName())) {</span>
<span class="fc" id="L729">								return new MappingsControl(swingRenderer, this);</span>
							}
<span class="fc" id="L731">							if (filteredObjectType.getName().equals(</span>
<span class="fc" id="L732">									&quot;CapsuleFieldType [context=EncapsulationContext [objectType=CapsuleFieldType [context=EncapsulationContext [objectType=&quot;</span>
<span class="fc" id="L733">											+ FieldInitializerFacade.class.getName()</span>
<span class="fc bfc" id="L734" title="All 2 branches covered.">											+ &quot;], fieldName=valueGroup]], fieldName=valueBox]&quot;)) {</span>
<span class="pc bpc" id="L735" title="1 of 2 branches missed.">								if (field.getName().equals(&quot;fieldValue&quot;)) {</span>
<span class="fc" id="L736">									return new NullableControl(this.swingRenderer, this) {</span>

										private static final long serialVersionUID = 1L;

										@Override
										protected Object getNewValue() {
<span class="nc" id="L742">											FieldInitializerFacade facade = (FieldInitializerFacade) ((MembersCapsuleFieldInfo.Value) ((PrecomputedTypeInstanceWrapper) ((MembersCapsuleFieldInfo.Value) ((PrecomputedTypeInstanceWrapper) getObject())</span>
<span class="nc" id="L743">													.getInstance()).getObject()).getInstance()).getObject();</span>
<span class="nc bnc" id="L744" title="All 2 branches missed.">											if (((facade.getFieldValueMode() == null)</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">													|| (facade.getFieldValueMode() == ValueMode.PLAIN))</span>
<span class="nc bnc" id="L746" title="All 2 branches missed.">													&amp;&amp; !Object.class.getName().equals(facade.getFieldTypeName())) {</span>
<span class="nc" id="L747">												return facade.createDefaultFieldValue();</span>
											} else {
<span class="nc" id="L749">												return super.getNewValue();</span>
											}
										}

									};
								}
							}
<span class="fc" id="L756">							if (filteredObjectType.getName().equals(</span>
<span class="fc" id="L757">									&quot;CapsuleFieldType [context=EncapsulationContext [objectType=CapsuleFieldType [context=EncapsulationContext [objectType=&quot;</span>
<span class="fc" id="L758">											+ ParameterInitializerFacade.class.getName()</span>
<span class="fc bfc" id="L759" title="All 2 branches covered.">											+ &quot;], fieldName=valueGroup]], fieldName=valueBox]&quot;)) {</span>
<span class="pc bpc" id="L760" title="1 of 2 branches missed.">								if (field.getName().equals(&quot;parameterValue&quot;)) {</span>
<span class="fc" id="L761">									return new NullableControl(this.swingRenderer, this) {</span>

										private static final long serialVersionUID = 1L;

										@Override
										protected Object getNewValue() {
<span class="nc" id="L767">											ParameterInitializerFacade facade = (ParameterInitializerFacade) ((MembersCapsuleFieldInfo.Value) ((PrecomputedTypeInstanceWrapper) ((MembersCapsuleFieldInfo.Value) ((PrecomputedTypeInstanceWrapper) getObject())</span>
<span class="nc" id="L768">													.getInstance()).getObject()).getInstance()).getObject();</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">											if ((facade.getParameterValueMode() == ValueMode.PLAIN)</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">													&amp;&amp; !Object.class.getName().equals(facade.getParameterTypeName())) {</span>
<span class="nc" id="L771">												return facade.createDefaultParameterValue();</span>
											} else {
<span class="nc" id="L773">												return super.getNewValue();</span>
											}
										}

									};
								}
							}
<span class="fc" id="L780">							if (filteredObjectType.getName().equals(</span>
<span class="fc" id="L781">									&quot;CapsuleFieldType [context=EncapsulationContext [objectType=CapsuleFieldType [context=EncapsulationContext [objectType=&quot;</span>
<span class="fc" id="L782">											+ ListItemInitializerFacade.class.getName()</span>
<span class="pc bpc" id="L783" title="1 of 2 branches missed.">											+ &quot;], fieldName=valueGroup]], fieldName=valueBox]&quot;)) {</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">								if (field.getName().equals(&quot;itemValue&quot;)) {</span>
<span class="nc" id="L785">									return new NullableControl(this.swingRenderer, this) {</span>

										private static final long serialVersionUID = 1L;

										@Override
										protected Object getNewValue() {
<span class="nc" id="L791">											ListItemInitializerFacade facade = (ListItemInitializerFacade) ((MembersCapsuleFieldInfo.Value) ((PrecomputedTypeInstanceWrapper) ((MembersCapsuleFieldInfo.Value) ((PrecomputedTypeInstanceWrapper) getObject())</span>
<span class="nc" id="L792">													.getInstance()).getObject()).getInstance()).getObject();</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">											if (((facade.getItemValueMode() == null)</span>
<span class="nc bnc" id="L794" title="All 2 branches missed.">													|| (facade.getItemValueMode() == ValueMode.PLAIN))</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">													&amp;&amp; !Object.class.getName().equals(facade.getItemTypeName())) {</span>
<span class="nc" id="L796">												return facade.createDefaultItemValue();</span>
											} else {
<span class="nc" id="L798">												return super.getNewValue();</span>
											}
										}

									};
								}
							}
<span class="fc bfc" id="L805" title="All 2 branches covered.">							if (filteredObjectType.getName().equals(CompilationError.class.getName())) {</span>
<span class="fc bfc" id="L806" title="All 2 branches covered.">								if (field.getName().equals(&quot;sourceCode&quot;)) {</span>
<span class="fc" id="L807">									final EditorPlugin editorPlugin = new EditorPlugin();</span>
<span class="fc" id="L808">									final EditorPlugin.EditorConfiguration pluginConfiguration = new EditorPlugin.EditorConfiguration();</span>
									{
<span class="fc" id="L810">										pluginConfiguration.syntaxImplementationClassName = JavaSyntaxKit.class</span>
<span class="fc" id="L811">												.getName();</span>
<span class="fc" id="L812">										pluginConfiguration.height = new StyledTextPlugin.StyledTextConfiguration.ControlDimensionSpecification();</span>
<span class="fc" id="L813">										pluginConfiguration.height.value = 350;</span>
									}
<span class="fc" id="L815">									EditorPlugin.EditorControl result = editorPlugin.new EditorControl(swingRenderer,</span>
<span class="fc" id="L816">											new FieldControlInputProxy(this) {</span>
												@Override
												public IFieldControlData getControlData() {
<span class="fc" id="L819">													return new FieldControlDataProxy(super.getControlData()) {</span>
														@Override
														public ITypeInfo getType() {
<span class="fc" id="L822">															return new InfoProxyFactory() {</span>
																@Override
																protected Map&lt;String, Object&gt; getSpecificProperties(
																		ITypeInfo type) {
<span class="fc" id="L826">																	Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(</span>
<span class="fc" id="L827">																			super.getSpecificProperties(type));</span>
<span class="fc" id="L828">																	ReflectionUIUtils.updateFieldControlPluginValues(</span>
<span class="fc" id="L829">																			result, editorPlugin.getIdentifier(),</span>
<span class="fc" id="L830">																			pluginConfiguration);</span>
<span class="fc" id="L831">																	return result;</span>
																}
<span class="fc" id="L833">															}.wrapTypeInfo(super.getType());</span>
														}
													};
												}
											});
<span class="fc" id="L838">									final JEditorPane editorPane = (JEditorPane) result.getTextComponent();</span>
<span class="fc" id="L839">									final CompilationError compilationError = (CompilationError) getObject();</span>
<span class="fc" id="L840">									SwingUtilities.invokeLater(new Runnable() {</span>
										@Override
										public void run() {
<span class="pc bpc" id="L843" title="1 of 2 branches missed.">											int errorStart = (compilationError.getStartPosition() == -1) ? 0</span>
<span class="fc" id="L844">													: compilationError.getStartPosition();</span>
<span class="pc bpc" id="L845" title="1 of 2 branches missed.">											int errorEnd = (compilationError.getEndPosition() == -1)</span>
<span class="nc" id="L846">													? editorPane.getText().length()</span>
<span class="fc" id="L847">													: compilationError.getEndPosition();</span>
											try {
<span class="fc" id="L849">												editorPane.getHighlighter().addHighlight(errorStart, errorEnd,</span>
<span class="fc" id="L850">														new SquigglePainter(Color.RED));</span>
<span class="pc" id="L851">											} catch (BadLocationException e) {</span>
<span class="nc" id="L852">												throw new UnexpectedError(e);</span>
											}
<span class="fc" id="L854">											editorPane.getCaret().setSelectionVisible(true);</span>
<span class="fc" id="L855">											editorPane.setSelectionStart(errorStart);</span>
<span class="fc" id="L856">											editorPane.setSelectionEnd(errorEnd);</span>
<span class="fc" id="L857">										}</span>
									});
<span class="fc" id="L859">									return result;</span>
								}
							}
<span class="fc" id="L862">							return super.createFieldControl();</span>
						}

					};

				}

				@Override
				protected CustomizingMethodControlPlaceHolder createMethodControlPlaceHolder(IMethodInfo method) {
<span class="fc" id="L871">					final CustomizingForm thisForm = this;</span>
<span class="fc bfc" id="L872" title="All 2 branches covered.">					if (method.getName().equals(&quot;insertSelectedPathNodeExpression&quot;)) {</span>
<span class="fc" id="L873">						method = new MethodInfoProxy(method) {</span>

							@Override
							public List&lt;IParameterInfo&gt; getParameters() {
<span class="fc" id="L877">								return Collections.emptyList();</span>
							}

							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L882">								Form functionEditorForm = SwingRendererUtils.findAncestorFormOfType(thisForm,</span>
<span class="nc" id="L883">										FunctionEditor.class.getName(), swingRenderer);</span>
<span class="nc" id="L884">								TextControl textControl = (TextControl) SwingRendererUtils</span>
<span class="nc" id="L885">										.findDescendantFieldControlPlaceHolder(functionEditorForm, &quot;functionBody&quot;,</span>
<span class="nc" id="L886">												swingRenderer)</span>
<span class="nc" id="L887">										.getFieldControl();</span>
<span class="nc" id="L888">								invocationData.getProvidedParameterValues().put(0,</span>
<span class="nc" id="L889">										textControl.getTextComponent().getSelectionStart());</span>
<span class="nc" id="L890">								invocationData.getProvidedParameterValues().put(1,</span>
<span class="nc" id="L891">										textControl.getTextComponent().getSelectionEnd());</span>
<span class="nc" id="L892">								return super.invoke(object, invocationData);</span>
							}

						};
					}
<span class="fc bfc" id="L897" title="All 2 branches covered.">					if (method.getName().equals(&quot;executePlan&quot;)) {</span>
<span class="fc" id="L898">						method = new MethodInfoProxy(method) {</span>
							Throwable error;

							@Override
							public Object invoke(final Object object, InvocationData invocationData) {
								try {
<span class="fc" id="L904">									return super.invoke(object, invocationData);</span>
<span class="nc" id="L905">								} catch (Throwable t) {</span>
<span class="nc" id="L906">									error = t;</span>
<span class="nc" id="L907">									throw new RuntimeException(t);</span>
								} finally {
<span class="pc bpc" id="L909" title="1 of 2 branches missed.">									if (error == null) {</span>
<span class="fc" id="L910">										SwingUtilities.invokeLater(new Runnable() {</span>
											@Override
											public void run() {
<span class="fc" id="L913">												postSelectNewPlanExecutor();</span>
<span class="fc" id="L914">											}</span>
										});
									}
								}
							}

							private void postSelectNewPlanExecutor() {
<span class="fc" id="L921">								Form debuggerForm = SwingRendererUtils.findAncestorFormOfType(thisForm,</span>
<span class="fc" id="L922">										Debugger.class.getName(), swingRenderer);</span>
<span class="fc" id="L923">								ListControl planActivationsControl = (ListControl) SwingRendererUtils</span>
<span class="fc" id="L924">										.findDescendantFieldControlPlaceHolder(debuggerForm, &quot;planActivations&quot;,</span>
<span class="fc" id="L925">												swingRenderer)</span>
<span class="fc" id="L926">										.getFieldControl();</span>
<span class="fc" id="L927">								planActivationsControl.refreshUI(false);</span>
<span class="fc" id="L928">								Form currentPlanActivatorForm = SwingRendererUtils.findAncestorFormOfType(thisForm,</span>
<span class="fc" id="L929">										PlanActivation.class.getName(), swingRenderer);</span>
<span class="fc" id="L930">								PlanActivation currentPlanActivator = (PlanActivation) currentPlanActivatorForm</span>
<span class="fc" id="L931">										.getObject();</span>
<span class="fc" id="L932">								BufferedItemPosition planActivatorPosition = planActivationsControl</span>
<span class="fc" id="L933">										.findItemPositionByReference(currentPlanActivator);</span>
<span class="fc" id="L934">								BufferedItemPosition lastPlanExecutorPosition = planActivatorPosition</span>
<span class="fc" id="L935">										.getSubItemPositions()</span>
<span class="fc" id="L936">										.get(planActivatorPosition.getSubItemPositions().size() - 1);</span>
<span class="fc" id="L937">								planActivationsControl.setSingleSelection(lastPlanExecutorPosition);</span>
<span class="fc" id="L938">							}</span>

						};
					}
<span class="fc" id="L942">					return super.createMethodControlPlaceHolder(method);</span>
				}

				@Override
				public void validateForm(ValidationSession session) throws Exception {
<span class="fc bfc" id="L947" title="All 2 branches covered.">					if (object instanceof Asset) {</span>
<span class="fc" id="L948">						session.put(CURRENT_ASSET_KEY, object);</span>
					}
<span class="fc bfc" id="L950" title="All 2 branches covered.">					if (object instanceof PlanElement) {</span>
<span class="fc" id="L951">						session.put(CURRENT_PLAN_ELEMENT_KEY, object);</span>
					}
<span class="fc bfc" id="L953" title="All 2 branches covered.">					if (object instanceof Facade) {</span>
<span class="fc" id="L954">						session.put(CURRENT_INSTANTIATION_FACADE_KEY, object);</span>
					}
<span class="fc bfc" id="L956" title="All 2 branches covered.">					if (object instanceof Activator) {</span>
<span class="fc" id="L957">						session.put(CURRENT_ACTIVATOR_KEY, object);</span>
					}
<span class="fc bfc" id="L959" title="All 2 branches covered.">					if (object instanceof FunctionEditor) {</span>
<span class="fc" id="L960">						TextControl textControl = (TextControl) SwingRendererUtils</span>
<span class="fc" id="L961">								.findDescendantFieldControlPlaceHolder(this, &quot;functionBody&quot;, swingRenderer)</span>
<span class="fc" id="L962">								.getFieldControl();</span>
<span class="fc" id="L963">						JTextComponent textComponent = textControl.getTextComponent();</span>
<span class="fc" id="L964">						textComponent.getHighlighter().removeAllHighlights();</span>
						try {
<span class="fc" id="L966">							((FunctionEditor) object).validate();</span>
<span class="pc" id="L967">						} catch (CompilationError e) {</span>
<span class="nc bnc" id="L968" title="All 2 branches missed.">							if (textComponent.getText() != null) {</span>
<span class="nc" id="L969">								textComponent.getHighlighter().addHighlight(</span>
<span class="nc bnc" id="L970" title="All 2 branches missed.">										(e.getStartPosition() == -1) ? 0 : e.getStartPosition(),</span>
<span class="nc bnc" id="L971" title="All 2 branches missed.">										(e.getEndPosition() == -1) ? textComponent.getText().length()</span>
<span class="nc" id="L972">												: e.getEndPosition(),</span>
<span class="nc" id="L973">										new SquigglePainter(Color.RED));</span>
							}
<span class="nc" id="L975">							throw e;</span>
						}
					} else {
<span class="fc" id="L978">						super.validateForm(session);</span>
					}
<span class="fc" id="L980">				}</span>

			};
		}

		@Override
		public MethodAction createMethodAction(IMethodControlInput input) {
<span class="fc" id="L987">			return new MethodAction(this, input) {</span>

				private static final long serialVersionUID = 1L;

				/*
				 * Fix (for forms not refreshing when an invoked method is read-only) in
				 * reflection-ui-6.0.1.
				 */

				@Override
				public void invokeAndObtainReturnValue(InvocationData invocationData, Component activatorComponent) {
					try {
<span class="fc" id="L999">						super.invokeAndObtainReturnValue(invocationData, activatorComponent);</span>
<span class="fc" id="L1000">					} finally {</span>
<span class="fc bfc" id="L1001" title="All 2 branches covered.">						if (data.isReadOnly()) {</span>
<span class="fc" id="L1002">							modificationStack.apply(IModification.VOLATILE_MODIFICATION);</span>
						}
					}
<span class="fc" id="L1005">				}</span>

			};
		}

		@Override
		public Image getIconImage(ResourcePath path) {
<span class="fc" id="L1012">			Image result = super.getIconImage(path);</span>
<span class="pc bpc" id="L1013" title="1 of 2 branches missed.">			if (result == null) {</span>
<span class="nc" id="L1014">				return null;</span>
			}
<span class="fc" id="L1016">			return SwingRendererUtils.scalePreservingRatio(result, 16, 16, Image.SCALE_SMOOTH);</span>
		}

		@Override
		public void openErrorDetailsDialog(Component activatorComponent, Throwable error) {
<span class="fc" id="L1021">			openObjectDialog(activatorComponent, new ExceptionTree(error), null, null, false);</span>
<span class="fc" id="L1022">		}</span>

		@Override
		public ClassLoader getClassPathResourceLoader() {
<span class="fc" id="L1026">			return MiscUtils.getJESBResourceLoader();</span>
		}

	}

	public static class ExceptionTree {
		private Throwable exception;

<span class="fc" id="L1034">		public ExceptionTree(Throwable exception) {</span>
<span class="fc" id="L1035">			this.exception = exception;</span>
<span class="fc" id="L1036">		}</span>

		public ExceptionNode[] getRoot() {
<span class="fc" id="L1039">			return new ExceptionNode[] { new ExceptionNode(null, exception) };</span>
		}

		@Override
		public String toString() {
<span class="nc" id="L1044">			return exception.toString();</span>
		}

		public static class ExceptionNode {

			private ExceptionNode parent;
			private Throwable exception;

<span class="fc" id="L1052">			public ExceptionNode(ExceptionNode parent, Throwable exception) {</span>
<span class="fc" id="L1053">				this.parent = parent;</span>
<span class="fc" id="L1054">				this.exception = exception;</span>
<span class="fc" id="L1055">			}</span>

			public Throwable getException() {
<span class="fc" id="L1058">				return exception;</span>
			}

			public ExceptionNode[] getChild() {
<span class="fc bfc" id="L1062" title="All 2 branches covered.">				if (exception.getCause() == null) {</span>
<span class="fc" id="L1063">					return null;</span>
				}
<span class="fc" id="L1065">				return new ExceptionNode[] { new ExceptionNode(this, exception.getCause()) };</span>
			}

			public void printStackTrace() {
<span class="nc" id="L1069">				Log.get().error(exception);</span>
<span class="nc" id="L1070">			}</span>

			public StackTraceElement[] getStackTrace() {
<span class="nc" id="L1073">				return exception.getStackTrace();</span>
			}

			private List&lt;ExceptionNode&gt; listtAncestors() {
<span class="fc" id="L1077">				List&lt;ExceptionNode&gt; result = new ArrayList&lt;GUI.ExceptionTree.ExceptionNode&gt;();</span>
<span class="fc bfc" id="L1078" title="All 2 branches covered.">				if (parent != null) {</span>
<span class="fc" id="L1079">					result.add(parent);</span>
<span class="fc" id="L1080">					result.addAll(parent.listtAncestors());</span>
				}
<span class="fc" id="L1082">				return result;</span>
			}

			@Override
			public String toString() {
<span class="fc" id="L1087">				List&lt;ExceptionNode&gt; similarAncestors = listtAncestors().stream()</span>
<span class="pc bpc" id="L1088" title="1 of 2 branches missed.">						.filter(node -&gt; node.getException().getClass() == exception.getClass())</span>
<span class="fc" id="L1089">						.collect(Collectors.toList());</span>
<span class="fc" id="L1090">				return ReflectionUIUtils.identifierToCaption(exception.getClass().getSimpleName())</span>
<span class="pc bpc" id="L1091" title="1 of 2 branches missed.">						+ ((similarAncestors.size() &gt; 0) ? (&quot; [&quot; + similarAncestors.size() + &quot;]&quot;) : &quot;&quot;);</span>
			}

		}
	}

	private class JESBSubCustomizedUI extends SubCustomizedUI {

<span class="fc" id="L1099">		private UpToDate&lt;InfoCustomizations&gt; upToDateSubInfoCustomizations = new UpToDate&lt;InfoCustomizations&gt;() {</span>

			@Override
			protected Object retrieveLastVersionIdentifier() {
<span class="fc bfc" id="L1103" title="All 2 branches covered.">				if (getCustomizationsIdentifier() == null) {</span>
<span class="fc" id="L1104">					return null;</span>
				}
<span class="fc" id="L1106">				return getMainCustomizedClass(getCustomizationsIdentifier());</span>
			}

			@Override
			protected InfoCustomizations obtainLatest(Object versionIdentifier) throws VersionAccessException {
<span class="fc" id="L1111">				InfoCustomizations result = new InfoCustomizations();</span>
<span class="fc" id="L1112">				Class&lt;?&gt; mainCustomizedClass = (Class&lt;?&gt;) versionIdentifier;</span>
<span class="fc bfc" id="L1113" title="All 2 branches covered.">				if (mainCustomizedClass != null) {</span>
					Method uiCustomizationsMethod;
					try {
<span class="fc" id="L1116">						uiCustomizationsMethod = mainCustomizedClass.getMethod(GUI.UI_CUSTOMIZATIONS_METHOD_NAME,</span>
<span class="fc" id="L1117">								InfoCustomizations.class);</span>
<span class="fc" id="L1118">					} catch (NoSuchMethodException e) {</span>
<span class="fc" id="L1119">						uiCustomizationsMethod = null;</span>
					}
<span class="fc bfc" id="L1121" title="All 2 branches covered.">					if (uiCustomizationsMethod != null) {</span>
						try {
<span class="fc" id="L1123">							uiCustomizationsMethod.invoke(null, result);</span>
<span class="pc" id="L1124">						} catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L1125">							throw new UnexpectedError(e);</span>
						}
					}
<span class="fc" id="L1128">					getCustomizedTypeInfoCache().clear();</span>
				}
<span class="fc" id="L1130">				return result;</span>
			}

		};

<span class="fc" id="L1135">		public JESBSubCustomizedUI(String switchIdentifier) {</span>
<span class="fc" id="L1136">			super(switchIdentifier);</span>
<span class="fc" id="L1137">		}</span>

		@Override
		public Class&lt;?&gt; getReflectedClass(String name) throws ClassNotFoundException {
			try {
<span class="fc" id="L1142">				return MiscUtils.getJESBClass(name);</span>
<span class="nc" id="L1143">			} catch (PotentialError e) {</span>
<span class="nc" id="L1144">				throw new ClassNotFoundException(name, e);</span>
			}
		}

		@Override
		protected IInfoProxyFactory getSubInfoCustomizationsFactory() {
<span class="fc" id="L1150">			InfoProxyFactoryChain result = new InfoProxyFactoryChain();</span>
<span class="fc" id="L1151">			result.accessFactories().add(new InfoCustomizationsFactory(this) {</span>

				@Override
				public String getIdentifier() {
<span class="fc" id="L1155">					return &quot;MethodBasedSubInfoCustomizationsFactory [of=&quot; + customizationsIdentifier + &quot;]&quot;;</span>
				}

				@Override
				protected IInfoProxyFactory getInfoCustomizationsSetupFactory() {
<span class="nc" id="L1160">					return IInfoProxyFactory.NULL_INFO_PROXY_FACTORY;</span>
				}

				@Override
				public InfoCustomizations accessInfoCustomizations() {
					try {
<span class="fc" id="L1166">						return upToDateSubInfoCustomizations.get();</span>
<span class="nc" id="L1167">					} catch (VersionAccessException e) {</span>
<span class="nc" id="L1168">						throw new UnexpectedError(e);</span>
					}
				}
			});
<span class="fc" id="L1172">			result.accessFactories().add(super.getSubInfoCustomizationsFactory());</span>
<span class="fc" id="L1173">			return result;</span>
		}

		@Override
		protected IInfoProxyFactory createBeforeInfoCustomizationsFactory() {
<span class="fc" id="L1178">			return new InfoProxyFactory() {</span>

				boolean isResourceNoteField(IFieldInfo field, ITypeInfo objectType) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L1183">						objectClass = MiscUtils.getJESBClass(objectType.getName());</span>
<span class="fc" id="L1184">					} catch (Exception e) {</span>
<span class="fc" id="L1185">						objectClass = null;</span>
					}
<span class="fc bfc" id="L1187" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Resource.class.isAssignableFrom(objectClass)) {</span>
<span class="fc bfc" id="L1188" title="All 2 branches covered.">						if (field.getName().equals(&quot;note&quot;)) {</span>
<span class="fc" id="L1189">							return true;</span>
						}
					}
<span class="fc" id="L1192">					return false;</span>
				}

				@Override
				protected InfoCategory getCategory(IFieldInfo field, ITypeInfo objectType) {
<span class="fc bfc" id="L1197" title="All 2 branches covered.">					if (isResourceNoteField(field, objectType)) {</span>
<span class="fc" id="L1198">						return new InfoCategory(&quot;Note&quot;, 0, null);</span>
					}
<span class="fc" id="L1200">					return super.getCategory(field, objectType);</span>
				}

				@Override
				protected String getCaption(IFieldInfo field, ITypeInfo objectType) {
<span class="fc bfc" id="L1205" title="All 2 branches covered.">					if (isResourceNoteField(field, objectType)) {</span>
<span class="fc" id="L1206">						return &quot;&quot;;</span>
					}
<span class="fc" id="L1208">					return super.getCaption(field, objectType);</span>
				}

				@Override
				protected double getDisplayAreaVerticalWeight(IFieldInfo field, ITypeInfo objectType) {
<span class="fc bfc" id="L1213" title="All 2 branches covered.">					if (isResourceNoteField(field, objectType)) {</span>
<span class="fc" id="L1214">						return 1.0;</span>
					}
<span class="fc" id="L1216">					return super.getDisplayAreaVerticalWeight(field, objectType);</span>
				}

				@Override
				protected boolean isDisplayAreaVerticallyFilled(IFieldInfo field, ITypeInfo objectType) {
<span class="fc bfc" id="L1221" title="All 2 branches covered.">					if (isResourceNoteField(field, objectType)) {</span>
<span class="fc" id="L1222">						return true;</span>
					}
<span class="fc" id="L1224">					return super.isDisplayAreaVerticallyFilled(field, objectType);</span>
				}

				@Override
				protected void setValue(IFieldInfo field, Object object, Object value, ITypeInfo objectType) {
<span class="pc bpc" id="L1229" title="1 of 2 branches missed.">					if (object == Preferences.INSTANCE) {</span>
<span class="nc bnc" id="L1230" title="All 2 branches missed.">						if (field.getName().equals(&quot;theme&quot;)) {</span>
<span class="nc" id="L1231">							SwingUtilities.invokeLater(new Runnable() {</span>
								@Override
								public void run() {
<span class="nc" id="L1234">									GUI.INSTANCE.openInformationDialog(null,</span>
<span class="nc" id="L1235">											&quot;Restart the application to apply the change.&quot;, null);</span>
<span class="nc" id="L1236">								}</span>
							});
						}
					}
<span class="fc" id="L1240">					super.setValue(field, object, value, objectType);</span>
<span class="fc" id="L1241">				}</span>

				@Override
				protected CategoriesStyle getCategoriesStyle(ITypeInfo type) {
<span class="fc" id="L1245">					return CategoriesStyle.STANDARD;</span>
				}

				@Override
				protected boolean isFormControlEmbedded(IFieldInfo field, ITypeInfo objectType) {
					Class&lt;?&gt; fieldClass;
					try {
<span class="fc" id="L1252">						fieldClass = MiscUtils.getJESBClass(field.getType().getName());</span>
<span class="fc" id="L1253">					} catch (Exception e) {</span>
<span class="fc" id="L1254">						fieldClass = null;</span>
					}
<span class="fc bfc" id="L1256" title="All 4 branches covered.">					if ((fieldClass != null) &amp;&amp; OperationStructureBuilder.class.isAssignableFrom(fieldClass)) {</span>
<span class="fc" id="L1257">						return true;</span>
					}
<span class="fc" id="L1259">					return super.isFormControlEmbedded(field, objectType);</span>
				}

				@Override
				protected boolean canCopy(ITypeInfo type, Object object) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L1266">						objectClass = MiscUtils.getJESBClass(type.getName());</span>
<span class="pc" id="L1267">					} catch (Exception e) {</span>
<span class="nc" id="L1268">						objectClass = null;</span>
					}
<span class="pc bpc" id="L1270" title="1 of 4 branches missed.">					if ((objectClass != null) &amp;&amp; Asset.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L1271">						return true;</span>
					}
<span class="fc" id="L1273">					return super.canCopy(type, object);</span>
				}

				@Override
				protected Object copy(ITypeInfo type, Object object) {
					Class&lt;?&gt; objectClass;
					try {
<span class="nc" id="L1280">						objectClass = MiscUtils.getJESBClass(type.getName());</span>
<span class="nc" id="L1281">					} catch (Exception e) {</span>
<span class="nc" id="L1282">						objectClass = null;</span>
					}
<span class="nc bnc" id="L1284" title="All 4 branches missed.">					if ((objectClass != null) &amp;&amp; Asset.class.isAssignableFrom(objectClass)) {</span>
<span class="nc" id="L1285">						return MiscUtils.copy(object);</span>
					} else {
<span class="nc" id="L1287">						return super.copy(type, object);</span>
					}
				}

				@Override
				protected void onFormRefresh(ITypeInfo type, Object object) {
<span class="fc bfc" id="L1293" title="All 2 branches covered.">					if (object instanceof RootInstanceBuilderFacade) {</span>
<span class="fc" id="L1294">						backupRootInstanceBuilderState(((RootInstanceBuilderFacade) object).getUnderlying());</span>
					}
<span class="fc" id="L1296">					super.onFormRefresh(type, object);</span>
<span class="fc" id="L1297">				}</span>

				@Override
				protected Runnable getLastFormRefreshStateRestorationJob(ITypeInfo type, Object object) {
<span class="fc bfc" id="L1301" title="All 2 branches covered.">					if (object instanceof RootInstanceBuilderFacade) {</span>
<span class="fc" id="L1302">						return getRootInstanceBuilderStateRestorationJob(</span>
<span class="fc" id="L1303">								((RootInstanceBuilderFacade) object).getUnderlying());</span>
					}
<span class="fc" id="L1305">					return super.getLastFormRefreshStateRestorationJob(type, object);</span>
				}

				@Override
				protected Runnable getNextInvocationUndoJob(IMethodInfo method, ITypeInfo objectType,
						final Object object, InvocationData invocationData) {
<span class="pc bpc" id="L1311" title="1 of 2 branches missed.">					if (object instanceof FunctionEditor) {</span>
<span class="nc bnc" id="L1312" title="All 2 branches missed.">						if (method.getName().equals(&quot;insertSelectedPathNodeExpression&quot;)) {</span>
<span class="nc" id="L1313">							final String oldExpression = ((FunctionEditor) object).getFunctionBody();</span>
<span class="nc" id="L1314">							return new Runnable() {</span>
								@Override
								public void run() {
<span class="nc" id="L1317">									((FunctionEditor) object).setFunctionBody(oldExpression);</span>
<span class="nc" id="L1318">								}</span>
							};
						}
					}
<span class="fc" id="L1322">					return super.getNextInvocationUndoJob(method, objectType, object, invocationData);</span>
				}

				@Override
				protected List&lt;IMethodInfo&gt; getAlternativeConstructors(IFieldInfo field, Object object,
						ITypeInfo objectType) {
<span class="pc bpc" id="L1328" title="1 of 2 branches missed.">					if (object instanceof ListItemInitializerFacade) {</span>
<span class="nc bnc" id="L1329" title="All 2 branches missed.">						if (field.getName().equals(&quot;itemReplicationFacade&quot;)) {</span>
<span class="nc" id="L1330">							return Collections.singletonList(new MethodInfoProxy(IMethodInfo.NULL_METHOD_INFO) {</span>

								@Override
								public String getSignature() {
<span class="nc" id="L1334">									return ReflectionUIUtils.buildMethodSignature(this);</span>
								}

								@Override
								public String getName() {
<span class="nc" id="L1339">									return &quot;&quot;;</span>
								}

								@Override
								public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1344">									return new ListItemReplicationFacade((ListItemInitializerFacade) object);</span>
								}

							});
						}
					}
<span class="fc" id="L1350">					return super.getAlternativeConstructors(field, object, objectType);</span>
				}

				@Override
				protected List&lt;IMethodInfo&gt; getAlternativeListItemConstructors(IFieldInfo field, Object object,
						ITypeInfo objectType) {
<span class="pc bpc" id="L1356" title="1 of 2 branches missed.">					if (objectType.getName().equals(InitializationSwitchFacade.class.getName())) {</span>
<span class="nc bnc" id="L1357" title="All 2 branches missed.">						if (field.getName().equals(&quot;children&quot;)) {</span>
<span class="nc" id="L1358">							return Collections.singletonList(new MethodInfoProxy(IMethodInfo.NULL_METHOD_INFO) {</span>

								@Override
								public String getSignature() {
<span class="nc" id="L1362">									return ReflectionUIUtils.buildMethodSignature(this);</span>
								}

								@Override
								public String getName() {
<span class="nc" id="L1367">									return &quot;&quot;;</span>
								}

								@Override
								public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1372">									InitializationSwitchFacade switchFacade = (InitializationSwitchFacade) object;</span>
<span class="nc" id="L1373">									InstantiationFunction condition = InitializationCase.createDefaultCondition();</span>
<span class="nc" id="L1374">									InitializationCase initializationCase = new InitializationCase();</span>
<span class="nc" id="L1375">									return new InitializationCaseFacade(switchFacade, condition, initializationCase);</span>
								}

							});
						}
					}
<span class="fc" id="L1381">					return super.getAlternativeListItemConstructors(field, object, objectType);</span>
				}

				@Override
				protected List&lt;IDynamicListAction&gt; getDynamicActions(IListTypeInfo listType,
						List&lt;? extends ItemPosition&gt; selection,
						Mapper&lt;ItemPosition, ListModificationFactory&gt; listModificationFactoryAccessor) {
<span class="fc" id="L1388">					List&lt;IDynamicListAction&gt; result = new ArrayList&lt;IDynamicListAction&gt;(</span>
<span class="fc" id="L1389">							super.getDynamicActions(listType, selection, listModificationFactoryAccessor));</span>
<span class="fc bfc" id="L1390" title="All 2 branches covered.">					if (selection.size() &gt; 0) {</span>
<span class="fc" id="L1391">						final ItemPosition firstItemPosition = selection.get(0);</span>
<span class="fc bfc" id="L1392" title="All 2 branches covered.">						if (&quot;Data&quot;.equals(firstItemPosition.getRoot().getContainingListTitle())</span>
<span class="fc" id="L1393">								&amp;&amp; selection.stream().allMatch(</span>
<span class="fc bfc" id="L1394" title="All 2 branches covered.">										itemPosition -&gt; ((itemPosition.getItem() instanceof ParameterInitializerFacade)</span>
<span class="pc bpc" id="L1395" title="1 of 2 branches missed.">												|| (itemPosition.getItem() instanceof FieldInitializerFacade)</span>
<span class="nc bnc" id="L1396" title="All 2 branches missed.">												|| (itemPosition.getItem() instanceof ListItemInitializerFacade)</span>
<span class="nc bnc" id="L1397" title="All 2 branches missed.">												|| (itemPosition.getItem() instanceof InitializationSwitchFacade))</span>
<span class="fc" id="L1398">												&amp;&amp; MiscUtils.equalsOrBothNull(itemPosition.getParentItemPosition(),</span>
<span class="pc bpc" id="L1399" title="2 of 4 branches missed.">														firstItemPosition.getParentItemPosition()))) {</span>
<span class="fc" id="L1400">							final Facade parentFacade = ((Facade) firstItemPosition.getItem()).getParent();</span>
<span class="fc" id="L1401">							result.add(new AbstractDynamicListAction() {</span>

								@Override
								public String getName() {
<span class="nc" id="L1405">									return &quot;insertSwitchCasesParent&quot;;</span>
								}

								@Override
								public String getCaption() {
<span class="nc" id="L1410">									return &quot;Insert Switch/Cases Parent...&quot;;</span>
								}

								@Override
								public String getParametersValidationCustomCaption() {
<span class="nc" id="L1415">									return &quot;OK&quot;;</span>
								}

								@Override
								public DisplayMode getDisplayMode() {
<span class="fc" id="L1420">									return DisplayMode.CONTEXT_MENU;</span>
								}

								@Override
								public List&lt;IParameterInfo&gt; getParameters() {
<span class="nc" id="L1425">									return Collections</span>
<span class="nc" id="L1426">											.singletonList(new ParameterInfoProxy(IParameterInfo.NULL_PARAMETER_INFO) {</span>

												@Override
												public String getName() {
<span class="nc" id="L1430">													return &quot;caseCount&quot;;</span>
												}

												@Override
												public String getCaption() {
<span class="nc" id="L1435">													return &quot;Number Of Cases&quot;;</span>
												}

												@Override
												public ITypeInfo getType() {
<span class="nc" id="L1440">													return getTypeInfo(new JavaTypeInfoSource(int.class, null));</span>
												}

												@Override
												public Object getDefaultValue(Object object) {
<span class="nc" id="L1445">													return 2;</span>
												}

												@Override
												public int getPosition() {
<span class="nc" id="L1450">													return 0;</span>
												}

											});
								}

								@Override
								public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1458">									List&lt;Facade&gt; initializerFacades = selection.stream()</span>
<span class="nc" id="L1459">											.map(itemPosition -&gt; (Facade) itemPosition.getItem())</span>
<span class="nc" id="L1460">											.collect(Collectors.toList());</span>
<span class="nc" id="L1461">									int caseCount = (int) invocationData.getParameterValue(0);</span>
<span class="nc" id="L1462">									InitializationSwitchFacade.install(parentFacade, caseCount, initializerFacades);</span>
<span class="nc" id="L1463">									return null;</span>
								}

							});
<span class="fc" id="L1467">							List&lt;? extends Facade&gt; siblingSwitchFacades = parentFacade.getChildren().stream().filter(</span>
<span class="pc bpc" id="L1468" title="1 of 2 branches missed.">									facade -&gt; (facade instanceof InitializationSwitchFacade) &amp;&amp; !selection.stream()</span>
<span class="nc bnc" id="L1469" title="All 2 branches missed.">											.anyMatch(itemPosition -&gt; ((Facade) itemPosition.getItem())</span>
<span class="pc bnc" id="L1470" title="All 2 branches missed.">													.getUnderlying() == facade.getUnderlying()))</span>
<span class="fc" id="L1471">									.collect(Collectors.toList());</span>
<span class="pc bpc" id="L1472" title="1 of 2 branches missed.">							if (siblingSwitchFacades.size() &gt; 0) {</span>
<span class="nc" id="L1473">								result.add(new AbstractDynamicListAction() {</span>

									@Override
									public String getName() {
<span class="nc" id="L1477">										return &quot;moveIntoSiblingSwitchCases&quot;;</span>
									}

									@Override
									public String getCaption() {
<span class="nc" id="L1482">										return &quot;Move Into Sibling Switch/Cases...&quot;;</span>
									}

									@Override
									public String getParametersValidationCustomCaption() {
<span class="nc" id="L1487">										return &quot;OK&quot;;</span>
									}

									@Override
									public DisplayMode getDisplayMode() {
<span class="nc" id="L1492">										return DisplayMode.CONTEXT_MENU;</span>
									}

									@Override
									public List&lt;IParameterInfo&gt; getParameters() {
<span class="nc" id="L1497">										return Collections.singletonList(</span>
<span class="nc" id="L1498">												new ParameterInfoProxy(IParameterInfo.NULL_PARAMETER_INFO) {</span>

													@Override
													public String getName() {
<span class="nc" id="L1502">														return &quot;siblingSwitchFacade&quot;;</span>
													}

													@Override
													public String getCaption() {
<span class="nc" id="L1507">														return &quot;Sibling Swith/Cases&quot;;</span>
													}

													@Override
													public ITypeInfo getType() {
<span class="nc" id="L1512">														return getTypeInfo(new JavaTypeInfoSource(</span>
<span class="nc" id="L1513">																InitializationSwitchFacade.class, null));</span>
													}

													@Override
													public Object getDefaultValue(Object object) {
<span class="nc" id="L1518">														return siblingSwitchFacades.get(0);</span>
													}

													@Override
													public int getPosition() {
<span class="nc" id="L1523">														return 0;</span>
													}

													@Override
													public boolean hasValueOptions(Object object) {
<span class="nc" id="L1528">														return true;</span>
													}

													@Override
													public Object[] getValueOptions(Object object) {
<span class="nc" id="L1533">														return siblingSwitchFacades.toArray();</span>
													}

												});
									}

									@Override
									public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1541">										List&lt;Facade&gt; initializerFacades = selection.stream()</span>
<span class="nc" id="L1542">												.map(itemPosition -&gt; (Facade) itemPosition.getItem())</span>
<span class="nc" id="L1543">												.collect(Collectors.toList());</span>
<span class="nc" id="L1544">										InitializationSwitchFacade selectedSwitchFacade = (InitializationSwitchFacade) invocationData</span>
<span class="nc" id="L1545">												.getParameterValue(0);</span>
<span class="nc" id="L1546">										selectedSwitchFacade.importInitializerFacades(initializerFacades);</span>
<span class="nc" id="L1547">										return null;</span>
									}
								});
							}
<span class="pc bpc" id="L1551" title="1 of 2 branches missed.">							if (parentFacade instanceof InitializationCaseFacade) {</span>
<span class="nc" id="L1552">								final ItemPosition parentCasePosition = firstItemPosition.getParentItemPosition();</span>
<span class="nc" id="L1553">								final ItemPosition switchPosition = parentCasePosition.getParentItemPosition();</span>
<span class="nc" id="L1554">								final ItemPosition destinationPosition = switchPosition.getParentItemPosition();</span>
<span class="nc" id="L1555">								final InitializationSwitchFacade switchFacade = (InitializationSwitchFacade) switchPosition</span>
<span class="nc" id="L1556">										.getItem();</span>
<span class="nc" id="L1557">								final Facade destinationFacade = switchFacade.getParent();</span>
<span class="nc" id="L1558">								final String firstInitializerFacadeString = ((Facade) firstItemPosition.getItem())</span>
<span class="nc" id="L1559">										.toString();</span>
<span class="nc" id="L1560">								result.add(new AbstractDynamicListAction() {</span>

									@Override
									public String getName() {
<span class="nc" id="L1564">										return &quot;moveOutOfParentSwitchCases&quot;;</span>
									}

									@Override
									public String getCaption() {
<span class="nc" id="L1569">										return &quot;Move Out Of Parent Switch/Cases&quot;;</span>
									}

									@Override
									public DisplayMode getDisplayMode() {
<span class="nc" id="L1574">										return DisplayMode.CONTEXT_MENU;</span>
									}

									@Override
									public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1579">										List&lt;Facade&gt; initializerFacades = selection.stream()</span>
<span class="nc" id="L1580">												.map(itemPosition -&gt; (Facade) itemPosition.getItem())</span>
<span class="nc" id="L1581">												.collect(Collectors.toList());</span>
<span class="nc" id="L1582">										List&lt;Facade&gt; managedFacades = switchFacade.getManagedInitializerFacades();</span>
<span class="nc" id="L1583">										InitializationCase destination = (InitializationCase) destinationFacade</span>
<span class="nc" id="L1584">												.getUnderlying();</span>
<span class="nc bnc" id="L1585" title="All 2 branches missed.">										for (Facade initializerFacade : initializerFacades) {</span>
<span class="nc bnc" id="L1586" title="All 2 branches missed.">											if (initializerFacade instanceof ParameterInitializerFacade) {</span>
<span class="nc" id="L1587">												ParameterInitializer initializer = ((ParameterInitializerFacade) initializerFacade)</span>
<span class="nc" id="L1588">														.getUnderlying();</span>
<span class="nc" id="L1589">												destination.getParameterInitializers().add(initializer);</span>
<span class="nc bnc" id="L1590" title="All 2 branches missed.">											} else if (initializerFacade instanceof FieldInitializerFacade) {</span>
<span class="nc" id="L1591">												((FieldInitializerFacade) initializerFacade).setConcrete(true);</span>
<span class="nc" id="L1592">												FieldInitializer initializer = ((FieldInitializerFacade) initializerFacade)</span>
<span class="nc" id="L1593">														.getUnderlying();</span>
<span class="nc" id="L1594">												destination.getFieldInitializers().add(initializer);</span>
<span class="nc bnc" id="L1595" title="All 2 branches missed.">											} else if (initializerFacade instanceof ListItemInitializerFacade) {</span>
<span class="nc" id="L1596">												((ListItemInitializerFacade) initializerFacade).setConcrete(true);</span>
<span class="nc" id="L1597">												ListItemInitializer initializer = ((ListItemInitializerFacade) initializerFacade)</span>
<span class="nc" id="L1598">														.getUnderlying();</span>
<span class="nc" id="L1599">												destination.getListItemInitializers().add(initializer);</span>
<span class="nc bnc" id="L1600" title="All 2 branches missed.">											} else if (initializerFacade instanceof InitializationSwitchFacade) {</span>
<span class="nc" id="L1601">												InitializationSwitch initializer = ((InitializationSwitchFacade) initializerFacade)</span>
<span class="nc" id="L1602">														.getUnderlying();</span>
<span class="nc" id="L1603">												destination.getInitializationSwitches().add(initializer);</span>
<span class="nc" id="L1604">											} else {</span>
<span class="nc" id="L1605">												throw new UnexpectedError();</span>
											}
<span class="nc bnc" id="L1607" title="All 2 branches missed.">											if (!managedFacades.remove(initializerFacade)) {</span>
<span class="nc" id="L1608">												throw new UnexpectedError();</span>
											}
										}
<span class="nc" id="L1611">										switchFacade.setManagedInitializerFacades(managedFacades);</span>
<span class="nc" id="L1612">										return null;</span>
									}

									@Override
									public List&lt;ItemPosition&gt; getPostSelection() {
<span class="nc" id="L1617">										return destinationPosition.getSubItemPositions().stream()</span>
<span class="nc" id="L1618">												.filter(itemPosition -&gt; ((Facade) itemPosition.getItem()).toString()</span>
<span class="nc" id="L1619">														.equals(firstInitializerFacadeString))</span>
<span class="nc" id="L1620">												.collect(Collectors.toList());</span>
									}

								});
							}
						}
					}
<span class="pc bpc" id="L1627" title="1 of 2 branches missed.">					if ((listType.getItemType() != null)</span>
<span class="fc bfc" id="L1628" title="All 2 branches covered.">							&amp;&amp; listType.getItemType().getName().equals(PlanElement.class.getName())) {</span>
<span class="fc bfc" id="L1629" title="All 2 branches covered.">						final ItemPosition singleSelection = (selection.size() == 1) ? selection.get(0) : null;</span>
<span class="fc" id="L1630">						final Plan plan = getCurrentPlan(null);</span>
<span class="pc bpc" id="L1631" title="1 of 4 branches missed.">						if ((singleSelection != null) &amp;&amp; singleSelection.getItem() instanceof Step) {</span>
<span class="fc" id="L1632">							final Step currentStep = (Step) singleSelection.getItem();</span>
<span class="fc" id="L1633">							result.add(new AbstractDynamicListAction() {</span>

								Transition newTransition;

								@Override
								public String getName() {
<span class="fc" id="L1639">									return &quot;connectTo&quot;;</span>
								}

								@Override
								public String getCaption() {
<span class="fc" id="L1644">									return &quot;Connect To...&quot;;</span>
								}

								@Override
								public DisplayMode getDisplayMode() {
<span class="fc" id="L1649">									return DisplayMode.CONTEXT_MENU;</span>
								}

								@Override
								public List&lt;IParameterInfo&gt; getParameters() {
<span class="fc" id="L1654">									List&lt;IParameterInfo&gt; result = new ArrayList&lt;IParameterInfo&gt;();</span>
<span class="fc" id="L1655">									result.add(new ParameterInfoProxy(IParameterInfo.NULL_PARAMETER_INFO) {</span>

										@Override
										public String getName() {
<span class="fc" id="L1659">											return &quot;otherStep&quot;;</span>
										}

										@Override
										public String getCaption() {
<span class="fc" id="L1664">											return &quot;Step&quot;;</span>
										}

										@Override
										public ITypeInfo getType() {
<span class="fc" id="L1669">											return getTypeInfo(new JavaTypeInfoSource(Step.class, null));</span>
										}

										@Override
										public boolean hasValueOptions(Object object) {
<span class="fc" id="L1674">											return true;</span>
										}

										@Override
										public Object[] getValueOptions(Object object) {
<span class="fc bfc" id="L1679" title="All 2 branches covered.">											return plan.getSteps().stream().filter(step -&gt; (step != currentStep)</span>
<span class="pc bpc" id="L1680" title="1 of 2 branches missed.">													&amp;&amp; (step.getParent() == currentStep.getParent())).toArray();</span>
										}

									});
<span class="fc" id="L1684">									return result;</span>
								}

								@Override
								public Object invoke(Object object, InvocationData invocationData) {
<span class="fc" id="L1689">									Step otherStep = (Step) invocationData.getParameterValue(0);</span>
<span class="pc bpc" id="L1690" title="1 of 2 branches missed.">									if (otherStep == null) {</span>
<span class="nc" id="L1691">										throw new NullPointerException();</span>
									}
<span class="fc" id="L1693">									newTransition = new Transition();</span>
<span class="fc" id="L1694">									newTransition.setStartStep(currentStep);</span>
<span class="fc" id="L1695">									newTransition.setEndStep(otherStep);</span>
<span class="fc" id="L1696">									plan.getTransitions().add(newTransition);</span>
<span class="fc" id="L1697">									return null;</span>
								}

								@Override
								public List&lt;ItemPosition&gt; getPostSelection() {
<span class="fc" id="L1702">									return null;</span>
								}

								@Override
								public Runnable getNextInvocationUndoJob(Object object, InvocationData invocationData) {
<span class="fc" id="L1707">									return new Runnable() {</span>
										@Override
										public void run() {
<span class="nc" id="L1710">											plan.getTransitions().remove(newTransition);</span>
<span class="nc" id="L1711">										}</span>
									};
								}
							});
						}
<span class="pc bpc" id="L1716" title="1 of 4 branches missed.">						if ((singleSelection != null) &amp;&amp; singleSelection.getItem() instanceof Transition)</span>

						{
<span class="nc" id="L1719">							Transition currentTransition = (Transition) singleSelection.getItem();</span>
<span class="nc" id="L1720">							result.add(getTransitionTransferAction(currentTransition, true, plan));</span>
<span class="nc" id="L1721">							result.add(getTransitionTransferAction(currentTransition, false, plan));</span>
						}
					}
<span class="fc" id="L1724">					return result;</span>

				}

				IDynamicListAction getTransitionTransferAction(Transition transition, boolean startElseEnd, Plan plan) {
<span class="nc bnc" id="L1729" title="All 2 branches missed.">					Step oldStep = startElseEnd ? transition.getStartStep() : transition.getEndStep();</span>
<span class="nc bnc" id="L1730" title="All 2 branches missed.">					Step oppositeStep = startElseEnd ? transition.getEndStep() : transition.getStartStep();</span>
<span class="nc" id="L1731">					return new AbstractDynamicListAction() {</span>

						@Override
						public String getName() {
<span class="nc bnc" id="L1735" title="All 2 branches missed.">							return startElseEnd ? &quot;changeStartStep&quot; : &quot;changeEndStep&quot;;</span>
						}

						@Override
						public String getCaption() {
<span class="nc bnc" id="L1740" title="All 2 branches missed.">							return startElseEnd ? &quot;Transition Start...&quot; : &quot;Transition End...&quot;;</span>
						}

						@Override
						public DisplayMode getDisplayMode() {
<span class="nc" id="L1745">							return DisplayMode.CONTEXT_MENU;</span>
						}

						@Override
						public List&lt;IParameterInfo&gt; getParameters() {
<span class="nc" id="L1750">							List&lt;IParameterInfo&gt; result = new ArrayList&lt;IParameterInfo&gt;();</span>
<span class="nc" id="L1751">							result.add(new ParameterInfoProxy(IParameterInfo.NULL_PARAMETER_INFO) {</span>

								@Override
								public String getName() {
<span class="nc" id="L1755">									return &quot;step&quot;;</span>
								}

								@Override
								public String getCaption() {
<span class="nc" id="L1760">									return &quot;Step&quot;;</span>
								}

								@Override
								public ITypeInfo getType() {
<span class="nc" id="L1765">									return getTypeInfo(new JavaTypeInfoSource(Step.class, null));</span>
								}

								@Override
								public boolean hasValueOptions(Object object) {
<span class="nc" id="L1770">									return true;</span>
								}

								@Override
								public Object[] getValueOptions(Object object) {
<span class="nc bnc" id="L1775" title="All 2 branches missed.">									return plan.getSteps().stream().filter(step -&gt; (step != oppositeStep)</span>
<span class="nc bnc" id="L1776" title="All 2 branches missed.">											&amp;&amp; (step.getParent() == oppositeStep.getParent())).toArray();</span>
								}

								@Override
								public Object getDefaultValue(Object object) {
<span class="nc" id="L1781">									return oldStep;</span>
								}

							});
<span class="nc" id="L1785">							return result;</span>
						}

						@Override
						public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1790">							Step newStep = (Step) invocationData.getParameterValue(0);</span>
<span class="nc bnc" id="L1791" title="All 2 branches missed.">							if (newStep == oldStep) {</span>
<span class="nc" id="L1792">								throw new IllegalArgumentException(&quot;No change detected!&quot;);</span>
							}
<span class="nc bnc" id="L1794" title="All 2 branches missed.">							if (startElseEnd) {</span>
<span class="nc" id="L1795">								transition.setStartStep(newStep);</span>
<span class="nc" id="L1796">							} else {</span>
<span class="nc" id="L1797">								transition.setEndStep(newStep);</span>
							}
<span class="nc" id="L1799">							return null;</span>
						}

						@Override
						public List&lt;ItemPosition&gt; getPostSelection() {
<span class="nc" id="L1804">							return null;</span>
						}

						@Override
						public Runnable getNextInvocationUndoJob(Object object, InvocationData invocationData) {
<span class="nc" id="L1809">							return new Runnable() {</span>
								@Override
								public void run() {
<span class="nc bnc" id="L1812" title="All 2 branches missed.">									if (startElseEnd) {</span>
<span class="nc" id="L1813">										transition.setStartStep(oldStep);</span>
<span class="nc" id="L1814">									} else {</span>
<span class="nc" id="L1815">										transition.setEndStep(oldStep);</span>
									}
<span class="nc" id="L1817">								}</span>
							};
						}
					};
				}

				@Override
				protected String toString(ITypeInfo type, Object object) {
<span class="pc bpc" id="L1825" title="1 of 2 branches missed.">					if (object instanceof OperationMetadata) {</span>
<span class="nc" id="L1826">						return ((OperationMetadata&lt;?&gt;) object).getOperationTypeName();</span>
					}
<span class="fc" id="L1828">					return super.toString(type, object);</span>
				}

				@Override
				protected void onFormVisibilityChange(ITypeInfo type, Object object, boolean visible) {
<span class="fc bfc" id="L1833" title="All 2 branches covered.">					if (!handleFocusEvent(type, object, visible)) {</span>
<span class="fc" id="L1834">						super.onFormVisibilityChange(type, object, visible);</span>
					}
<span class="fc bfc" id="L1836" title="All 2 branches covered.">					if (object instanceof Session) {</span>
<span class="fc" id="L1837">						Session session = (Session) object;</span>
<span class="fc bfc" id="L1838" title="All 2 branches covered.">						if (session.isActive() != visible) {</span>
<span class="fc bfc" id="L1839" title="All 2 branches covered.">							if (visible) {</span>
<span class="fc" id="L1840">								session.open();</span>
<span class="fc" id="L1841">							} else {</span>
								try {
<span class="fc" id="L1843">									session.close();</span>
<span class="pc" id="L1844">								} catch (Exception e) {</span>
<span class="nc" id="L1845">									throw new PotentialError(e);</span>
								}
							}
						}
					}
<span class="fc bfc" id="L1850" title="All 2 branches covered.">					if (object instanceof PluginBuilder) {</span>
<span class="fc bfc" id="L1851" title="All 2 branches covered.">						if (!visible) {</span>
<span class="fc" id="L1852">							PluginBuilder pluginBuilder = (PluginBuilder) object;</span>
<span class="pc bpc" id="L1853" title="1 of 2 branches missed.">							if (pluginBuilder.isTestingPrepared()) {</span>
<span class="fc" id="L1854">								pluginBuilder.unprepareTesting();</span>
							}
						}
					}
<span class="fc" id="L1858">				}</span>

				@Override
				protected List&lt;IMethodInfo&gt; getConstructors(ITypeInfo type) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L1864">						objectClass = MiscUtils.getJESBClass(type.getName());</span>
<span class="fc" id="L1865">					} catch (Exception e) {</span>
<span class="fc" id="L1866">						objectClass = null;</span>
					}
<span class="fc bfc" id="L1868" title="All 2 branches covered.">					if (type.getName().equals(Solution.Singleton.class.getName())) {</span>
<span class="fc" id="L1869">						return Collections.singletonList(new AbstractConstructorInfo() {</span>

							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L1873">								return new Solution();</span>
							}

							@Override
							public ITypeInfo getReturnValueType() {
<span class="fc" id="L1878">								return type;</span>
							}
						});
					}
<span class="fc bfc" id="L1882" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Asset.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L1883">						return super.getConstructors(type).stream()</span>
<span class="fc bfc" id="L1884" title="All 2 branches covered.">								.filter(constructor -&gt; constructor.getParameters().size() &gt; 0)</span>
<span class="fc" id="L1885">								.collect(Collectors.toList());</span>
					}
<span class="fc" id="L1887">					return super.getConstructors(type);</span>
				}

				@Override
				protected List&lt;IFieldInfo&gt; getFields(ITypeInfo type) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L1894">						objectClass = MiscUtils.getJESBClass(type.getName());</span>
<span class="fc" id="L1895">					} catch (Exception e) {</span>
<span class="fc" id="L1896">						objectClass = null;</span>
					}
<span class="fc" id="L1898">					List&lt;IFieldInfo&gt; baseResult = super.getFields(type);</span>
<span class="fc bfc" id="L1899" title="All 2 branches covered.">					for (int i = 0; i &lt; baseResult.size(); i++) {</span>
<span class="fc bfc" id="L1900" title="All 2 branches covered.">						if (VariantCustomizations.isVariantField(baseResult.get(i))) {</span>
<span class="fc" id="L1901">							baseResult.set(i, VariantCustomizations.adaptVariantField(JESBSubCustomizedUI.this,</span>
<span class="fc" id="L1902">									baseResult.get(i), type));</span>
						}
					}
<span class="fc bfc" id="L1905" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Solution.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L1906">						List&lt;IFieldInfo&gt; result = new ArrayList&lt;IFieldInfo&gt;(baseResult);</span>
<span class="fc" id="L1907">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

							@Override
							public String getName() {
<span class="fc" id="L1911">								return &quot;preferences&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="fc" id="L1916">								return ReflectionUIUtils.identifierToCaption(getName());</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="nc" id="L1921">								return Preferences.INSTANCE;</span>
							}

							@Override
							public void setValue(Object object, Object value) {
<span class="nc" id="L1926">								Preferences.INSTANCE.persist();</span>
<span class="nc" id="L1927">							}</span>

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L1931">								return getTypeInfo(new JavaTypeInfoSource(Preferences.class,</span>
<span class="fc" id="L1932">										new SpecificitiesIdentifier(Solution.Singleton.class.getName(), getName())));</span>
							}

							@Override
							public boolean isTransient() {
<span class="nc" id="L1937">								return true;</span>
							}

							@Override
							public boolean isGetOnly() {
<span class="nc" id="L1942">								return false;</span>
							}

						});
<span class="fc" id="L1946">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

							@Override
							public String getName() {
<span class="fc" id="L1950">								return &quot;sidePaneValueName&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="fc" id="L1955">								return ReflectionUIUtils.identifierToCaption(getName());</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="fc" id="L1960">								return sidePaneValueName;</span>
							}

							@Override
							public void setValue(Object object, Object value) {
<span class="fc" id="L1965">								sidePaneValueName = (SidePaneValueName) value;</span>
<span class="fc" id="L1966">							}</span>

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L1970">								return getTypeInfo(new JavaTypeInfoSource(SidePaneValueName.class,</span>
<span class="fc" id="L1971">										new SpecificitiesIdentifier(Solution.Singleton.class.getName(), getName())));</span>
							}

							@Override
							public boolean isTransient() {
<span class="fc" id="L1976">								return true;</span>
							}

							@Override
							public boolean isGetOnly() {
<span class="fc" id="L1981">								return false;</span>
							}

						});
<span class="fc" id="L1985">						return result;</span>
<span class="fc bfc" id="L1986" title="All 2 branches covered.">					} else if (type.getName().equals(Plan.class.getName())) {</span>
<span class="fc" id="L1987">						List&lt;IFieldInfo&gt; result = new ArrayList&lt;IFieldInfo&gt;(baseResult);</span>
<span class="fc" id="L1988">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

							@Override
							public String getName() {
<span class="fc" id="L1992">								return &quot;diagram&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L1997">								return &quot;Diagram&quot;;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="fc" id="L2002">								return new PlanDiagram.Source((Plan) object);</span>
							}

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L2007">								return getTypeInfo(new JavaTypeInfoSource(PlanDiagram.Source.class,</span>
<span class="fc" id="L2008">										new SpecificitiesIdentifier(Plan.class.getName(), getName())));</span>
							}

						});
<span class="fc" id="L2012">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>
							@Override
							public String getName() {
<span class="fc" id="L2015">								return &quot;palette&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2020">								return &quot;Palette&quot;;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="nc" id="L2025">								return new PlanDiagramPalette.Source((Plan) object);</span>
							}

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L2030">								return getTypeInfo(new JavaTypeInfoSource(PlanDiagramPalette.Source.class,</span>
<span class="fc" id="L2031">										new SpecificitiesIdentifier(Plan.class.getName(), getName())));</span>
							}

						});
<span class="fc" id="L2035">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>
							@Override
							public String getName() {
<span class="fc" id="L2038">								return &quot;diagramDragIntent&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2043">								return &quot;Diagram Drag Intent&quot;;</span>
							}

							@Override
							public boolean isGetOnly() {
<span class="fc" id="L2048">								return false;</span>
							}

							@Override
							public boolean isTransient() {
<span class="nc" id="L2053">								return true;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="fc" id="L2058">								return (DragIntent) diagramDragIntentByPlan.getOrDefault((Plan) object,</span>
<span class="fc" id="L2059">										DragIntent.MOVE);</span>
							}

							@Override
							public void setValue(Object object, Object value) {
<span class="nc" id="L2064">								diagramDragIntentByPlan.put((Plan) object, (DragIntent) value);</span>
<span class="nc" id="L2065">							}</span>

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L2069">								return getTypeInfo(new JavaTypeInfoSource(DragIntent.class,</span>
<span class="fc" id="L2070">										new SpecificitiesIdentifier(Plan.class.getName(), getName())));</span>
							}

						});
<span class="fc" id="L2074">						return result;</span>
<span class="fc bfc" id="L2075" title="All 2 branches covered.">					} else if (type.getName().equals(PlanExecutor.class.getName())</span>
<span class="pc bpc" id="L2076" title="1 of 2 branches missed.">							|| type.getName().equals(PlanExecutor.SubPlanExecutor.class.getName()))</span>

					{
<span class="fc" id="L2079">						List&lt;IFieldInfo&gt; result = new ArrayList&lt;IFieldInfo&gt;(baseResult);</span>
<span class="fc" id="L2080">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

							@Override
							public String getName() {
<span class="fc" id="L2084">								return &quot;diagram&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2089">								return &quot;Diagram&quot;;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="fc" id="L2094">								return new DebugPlanDiagram.Source(((PlanExecutor) object).getPlan());</span>
							}

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L2099">								return getTypeInfo(new JavaTypeInfoSource(DebugPlanDiagram.Source.class,</span>
<span class="fc" id="L2100">										new SpecificitiesIdentifier(type.getName(), getName())));</span>
							}

						});
<span class="fc" id="L2104">						return result;</span>
<span class="fc bfc" id="L2105" title="All 2 branches covered.">					} else if (type.getName().equals(RootInstanceBuilderFacade.class.getName())) {</span>
<span class="fc" id="L2106">						List&lt;IFieldInfo&gt; result = new ArrayList&lt;IFieldInfo&gt;(baseResult);</span>
<span class="fc" id="L2107">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>
							@Override
							public String getName() {
<span class="fc" id="L2110">								return &quot;data&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2115">								return &quot;Data&quot;;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="fc" id="L2120">								Plan displayedPlan = getCurrentPlan(null);</span>
<span class="pc bpc" id="L2121" title="1 of 2 branches missed.">								if (displayedPlan == null) {</span>
<span class="nc" id="L2122">									return null;</span>
								}
								Step currentStep;
<span class="pc bpc" id="L2125" title="1 of 2 branches missed.">								if (displayedPlan.getOutputBuilder() == ((RootInstanceBuilderFacade) object)</span>
<span class="fc" id="L2126">										.getUnderlying()) {</span>
<span class="nc" id="L2127">									currentStep = null;</span>
<span class="nc" id="L2128">								} else {</span>
<span class="fc" id="L2129">									currentStep = getCurrentStep(null);</span>
								}
<span class="fc" id="L2131">								return new PathOptionsProvider(</span>
<span class="fc" id="L2132">										displayedPlan.getValidationContext(currentStep).getVariableDeclarations())</span>
<span class="fc" id="L2133">												.getRootPathNodes();</span>
							}

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L2138">								return getTypeInfo(new JavaTypeInfoSource(List.class, new Class&lt;?&gt;[] { PathNode.class },</span>
<span class="fc" id="L2139">										new SpecificitiesIdentifier(RootInstanceBuilderFacade.class.getName(),</span>
<span class="fc" id="L2140">												getName())));</span>
							}

						});
<span class="fc" id="L2144">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>
							@Override
							public String getName() {
<span class="fc" id="L2147">								return &quot;mappings&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2152">								return &quot;Mappings&quot;;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="nc" id="L2157">								return new MappingsControl.Source((RootInstanceBuilderFacade) object,</span>
<span class="nc" id="L2158">										getCurrentPlan(null), getCurrentStep(null));</span>
							}

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L2163">								return getTypeInfo(new JavaTypeInfoSource(MappingsControl.Source.class,</span>
<span class="fc" id="L2164">										new SpecificitiesIdentifier(RootInstanceBuilderFacade.class.getName(),</span>
<span class="fc" id="L2165">												getName())));</span>
							}

						});
<span class="fc" id="L2169">						return result;</span>
<span class="pc bpc" id="L2170" title="1 of 2 branches missed.">					} else if (type.getName().equals(ListItemReplicationFacade.class.getName())) {</span>
<span class="nc" id="L2171">						List&lt;IFieldInfo&gt; result = new ArrayList&lt;IFieldInfo&gt;(baseResult);</span>
<span class="nc" id="L2172">						result.add(new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

							@Override
							public String getName() {
<span class="nc" id="L2176">								return &quot;inferredIterationVariableTypeName&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2181">								return &quot;Inferred Iteration Variable Type&quot;;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="nc" id="L2186">								Plan displayedPlan = getCurrentPlan(null);</span>
<span class="nc bnc" id="L2187" title="All 2 branches missed.">								if (displayedPlan == null) {</span>
<span class="nc" id="L2188">									return null;</span>
								}
<span class="nc" id="L2190">								RootInstanceBuilderFacade displayedRootInstanceBuilderFacade = getCurrentRootInstanceBuilderFacade(</span>
<span class="nc" id="L2191">										null);</span>
<span class="nc bnc" id="L2192" title="All 2 branches missed.">								if (displayedRootInstanceBuilderFacade == null) {</span>
<span class="nc" id="L2193">									return null;</span>
								}
								Step currentStep;
<span class="nc bnc" id="L2196" title="All 2 branches missed.">								if (displayedPlan.getOutputBuilder() == displayedRootInstanceBuilderFacade</span>
<span class="nc" id="L2197">										.getUnderlying()) {</span>
<span class="nc" id="L2198">									currentStep = null;</span>
<span class="nc" id="L2199">								} else {</span>
<span class="nc" id="L2200">									currentStep = getCurrentStep(null);</span>
								}
<span class="nc" id="L2202">								ITypeInfo variableType = ((ListItemReplicationFacade) object)</span>
<span class="nc" id="L2203">										.guessIterationVariableTypeInfo(displayedPlan.getValidationContext(currentStep)</span>
<span class="nc" id="L2204">												.getVariableDeclarations());</span>
<span class="nc bnc" id="L2205" title="All 2 branches missed.">								if (variableType != null) {</span>
<span class="nc" id="L2206">									return variableType.getName();</span>
								} else {
<span class="nc" id="L2208">									return Object.class.getName();</span>
								}
							}

							@Override
							public ITypeInfo getType() {
<span class="nc" id="L2214">								return getTypeInfo(new JavaTypeInfoSource(String.class, new SpecificitiesIdentifier(</span>
<span class="nc" id="L2215">										ListItemReplicationFacade.class.getName(), getName())));</span>
							}

						});
<span class="nc" id="L2219">						return result;</span>
					} else {
<span class="fc" id="L2221">						return baseResult;</span>
					}
				}

				@Override
				protected List&lt;IMethodInfo&gt; getMethods(ITypeInfo type) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L2229">						objectClass = MiscUtils.getJESBClass(type.getName());</span>
<span class="fc" id="L2230">					} catch (Exception e) {</span>
<span class="fc" id="L2231">						objectClass = null;</span>
					}
<span class="fc bfc" id="L2233" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Solution.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2234">						List&lt;IMethodInfo&gt; result = new ArrayList&lt;IMethodInfo&gt;(super.getMethods(type));</span>
<span class="fc" id="L2235">						result.add(new MethodInfoProxy(IMethodInfo.NULL_METHOD_INFO) {</span>

							@Override
							public String getSignature() {
<span class="fc" id="L2239">								return ReflectionUIUtils.buildMethodSignature(this);</span>
							}

							@Override
							public String getName() {
<span class="fc" id="L2244">								return &quot;isSidePanelValueSelected&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2249">								return ReflectionUIUtils.formatMethodCaption(this, getName(), 0);</span>
							}

							@Override
							public List&lt;IParameterInfo&gt; getParameters() {
<span class="fc" id="L2254">								return Collections</span>
<span class="fc" id="L2255">										.singletonList(new ParameterInfoProxy(IParameterInfo.NULL_PARAMETER_INFO) {</span>

											@Override
											public String getName() {
<span class="fc" id="L2259">												return &quot;sidePaneValueNameParam&quot;;</span>
											}

											@Override
											public String getCaption() {
<span class="nc" id="L2264">												return ReflectionUIUtils.identifierToCaption(getName());</span>
											}

											@Override
											public ITypeInfo getType() {
<span class="fc" id="L2269">												return getTypeInfo(</span>
<span class="fc" id="L2270">														new JavaTypeInfoSource(SidePaneValueName.class, null));</span>
											}
										});
							}

							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="fc" id="L2277">								SidePaneValueName sidePaneValueNameParam = (SidePaneValueName) invocationData</span>
<span class="fc" id="L2278">										.getParameterValue(0);</span>
<span class="fc bfc" id="L2279" title="All 2 branches covered.">								return sidePaneValueName == sidePaneValueNameParam;</span>
							}

							@Override
							public ITypeInfo getReturnValueType() {
<span class="fc" id="L2284">								return getTypeInfo(new JavaTypeInfoSource(boolean.class, null));</span>
							}

							@Override
							public boolean isReadOnly() {
<span class="nc" id="L2289">								return true;</span>
							}
						});
<span class="fc" id="L2292">						return result;</span>
<span class="fc bfc" id="L2293" title="All 4 branches covered.">					} else if ((objectClass != null) &amp;&amp; com.otk.jesb.Function.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2294">						List&lt;IMethodInfo&gt; result = new ArrayList&lt;IMethodInfo&gt;(super.getMethods(type));</span>
<span class="fc" id="L2295">						result.add(new MethodInfoProxy(IMethodInfo.NULL_METHOD_INFO) {</span>

							@Override
							public String getSignature() {
<span class="fc" id="L2299">								return ReflectionUIUtils.buildMethodSignature(this);</span>
							}

							@Override
							public String getName() {
<span class="fc" id="L2304">								return &quot;edit&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="fc" id="L2309">								return &quot;Edit...&quot;;</span>
							}

							@Override
							public String getOnlineHelp() {
<span class="fc" id="L2314">								return &quot;Open the Expression Editor&quot;;</span>
							}

							@Override
							public ITypeInfo getReturnValueType() {
<span class="fc" id="L2319">								return getTypeInfo(new JavaTypeInfoSource(FunctionEditor.class, null));</span>
							}

							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="fc" id="L2324">								Plan displayedPlan = getCurrentPlan(null);</span>
<span class="fc" id="L2325">								Step displayedStep = getCurrentStep(null);</span>
<span class="fc" id="L2326">								Transition displayedTransition = getCurrentTransition(null);</span>
<span class="fc" id="L2327">								RootInstanceBuilderFacade displayedRootInstanceBuilderFacade = getCurrentRootInstanceBuilderFacade(</span>
<span class="fc" id="L2328">										null);</span>
<span class="pc bpc" id="L2329" title="1 of 2 branches missed.">								if (object instanceof InstantiationFunction) {</span>
<span class="fc" id="L2330">									InstantiationFunction function = (InstantiationFunction) object;</span>
<span class="fc" id="L2331">									Facade parentFacade = displayedRootInstanceBuilderFacade</span>
<span class="fc" id="L2332">											.findInstantiationFunctionParentFacade(function);</span>
									Step currentStep;
<span class="pc bpc" id="L2334" title="1 of 2 branches missed.">									if (displayedPlan.getOutputBuilder() == displayedRootInstanceBuilderFacade</span>
<span class="fc" id="L2335">											.getUnderlying()) {</span>
<span class="nc" id="L2336">										currentStep = null;</span>
<span class="nc" id="L2337">									} else {</span>
<span class="fc" id="L2338">										currentStep = displayedStep;</span>
									}
<span class="fc" id="L2340">									List&lt;VariableDeclaration&gt; baseVariableDeclarations = displayedPlan</span>
<span class="fc" id="L2341">											.getValidationContext(currentStep).getVariableDeclarations();</span>
<span class="fc" id="L2342">									InstantiationFunctionCompilationContext compilationContext = new InstantiationFunctionCompilationContext(</span>
<span class="fc" id="L2343">											baseVariableDeclarations, parentFacade);</span>
<span class="fc" id="L2344">									return new FunctionEditor(function, compilationContext.getPrecompiler(),</span>
<span class="fc" id="L2345">											compilationContext.getVariableDeclarations(function),</span>
<span class="fc" id="L2346">											compilationContext.getFunctionReturnType(function));</span>
<span class="nc bnc" id="L2347" title="All 2 branches missed.">								} else if (object instanceof Transition.IfCondition) {</span>
<span class="nc" id="L2348">									return new FunctionEditor((Transition.IfCondition) object, null,</span>
<span class="nc" id="L2349">											displayedPlan.getTransitionContextVariableDeclarations(displayedTransition),</span>
<span class="nc" id="L2350">											boolean.class);</span>
<span class="nc bnc" id="L2351" title="All 2 branches missed.">								} else if ((displayedStep instanceof LoopCompositeStep)</span>
<span class="nc bnc" id="L2352" title="All 2 branches missed.">										&amp;&amp; (((LoopCompositeStep) displayedStep).getOperationBuilder()</span>
<span class="nc" id="L2353">												.getLoopEndCondition() == object)) {</span>
<span class="nc" id="L2354">									return new FunctionEditor(</span>
<span class="nc" id="L2355">											(com.otk.jesb.Function) object, null, ((LoopCompositeStep) displayedStep)</span>
<span class="nc" id="L2356">													.getLoopEndConditionVariableDeclarations(displayedPlan),</span>
<span class="nc" id="L2357">											boolean.class);</span>
								} else {
<span class="nc" id="L2359">									throw new UnexpectedError();</span>
								}
							}

							@Override
							public boolean isReadOnly() {
<span class="fc" id="L2365">								return true;</span>
							}
						});
<span class="fc" id="L2368">						return result;</span>
<span class="pc bpc" id="L2369" title="1 of 2 branches missed.">					} else if (type.getName().equals(LoopOperation.Builder.class.getName())) {</span>
<span class="nc" id="L2370">						List&lt;IMethodInfo&gt; result = new ArrayList&lt;IMethodInfo&gt;(super.getMethods(type));</span>
<span class="nc" id="L2371">						result.add(new MethodInfoProxy(IMethodInfo.NULL_METHOD_INFO) {</span>

							@Override
							public String getSignature() {
<span class="nc" id="L2375">								return ReflectionUIUtils.buildMethodSignature(this);</span>
							}

							@Override
							public String getName() {
<span class="nc" id="L2380">								return &quot;retrieveResultsCollectionConfigurationEntries&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2385">								return ReflectionUIUtils.identifierToCaption(getName());</span>
							}

							@Override
							public ITypeInfo getReturnValueType() {
<span class="nc" id="L2390">								return getTypeInfo(new JavaTypeInfoSource(List.class,</span>
<span class="nc" id="L2391">										new Class&lt;?&gt;[] { ResultsCollectionConfigurationEntry.class }, null));</span>
							}

							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L2396">								return ((LoopOperation.Builder) object).retrieveResultsCollectionConfigurationEntries(</span>
<span class="nc" id="L2397">										getCurrentPlan(null), getCurrentStep(null));</span>
							}
						});
<span class="nc" id="L2400">						result.add(new MethodInfoProxy(IMethodInfo.NULL_METHOD_INFO) {</span>

							@Override
							public String getSignature() {
<span class="nc" id="L2404">								return ReflectionUIUtils.buildMethodSignature(this);</span>
							}

							@Override
							public String getName() {
<span class="nc" id="L2409">								return &quot;updateResultsCollectionConfigurationEntries&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="nc" id="L2414">								return ReflectionUIUtils.identifierToCaption(getName()) + &quot;...&quot;;</span>
							}

							@Override
							public List&lt;IParameterInfo&gt; getParameters() {
<span class="nc" id="L2419">								return Collections</span>
<span class="nc" id="L2420">										.singletonList(new ParameterInfoProxy(IParameterInfo.NULL_PARAMETER_INFO) {</span>

											@Override
											public String getName() {
<span class="nc" id="L2424">												return &quot;entries&quot;;</span>
											}

											@Override
											public String getCaption() {
<span class="nc" id="L2429">												return ReflectionUIUtils.identifierToCaption(getName());</span>
											}

											@Override
											public ITypeInfo getType() {
<span class="nc" id="L2434">												return getTypeInfo(new JavaTypeInfoSource(List.class,</span>
<span class="nc" id="L2435">														new Class&lt;?&gt;[] { ResultsCollectionConfigurationEntry.class },</span>
<span class="nc" id="L2436">														null));</span>
											}
										});
							}

							@SuppressWarnings(&quot;unchecked&quot;)
							@Override
							public Object invoke(Object object, InvocationData invocationData) {
<span class="nc" id="L2444">								((LoopOperation.Builder) object).updateResultsCollectionConfigurationEntries(</span>
<span class="nc" id="L2445">										(List&lt;ResultsCollectionConfigurationEntry&gt;) invocationData.getParameterValue(0),</span>
<span class="nc" id="L2446">										getCurrentPlan(null), getCurrentStep(null));</span>
<span class="nc" id="L2447">								return null;</span>
							}
						});
<span class="nc" id="L2450">						return result;</span>
					} else {
<span class="fc" id="L2452">						return super.getMethods(type);</span>
					}
				}

				@Override
				protected List&lt;ITypeInfo&gt; getPolymorphicInstanceSubTypes(ITypeInfo type) {
<span class="fc bfc" id="L2458" title="All 2 branches covered.">					if (type.getName().equals(OperationBuilder.class.getName())) {</span>
<span class="fc" id="L2459">						List&lt;ITypeInfo&gt; result = new ArrayList&lt;ITypeInfo&gt;();</span>
<span class="fc bfc" id="L2460" title="All 2 branches covered.">						for (OperationMetadata&lt;?&gt; operationMetadata : MiscUtils.getAllOperationMetadatas()) {</span>
<span class="fc" id="L2461">							result.add(getTypeInfo(</span>
<span class="fc" id="L2462">									new JavaTypeInfoSource(operationMetadata.getOperationBuilderClass(), null)));</span>
						}
<span class="fc" id="L2464">						return result;</span>
<span class="fc bfc" id="L2465" title="All 2 branches covered.">					} else if (type.getName().equals(Resource.class.getName())) {</span>
<span class="fc" id="L2466">						List&lt;ITypeInfo&gt; result = new ArrayList&lt;ITypeInfo&gt;();</span>
<span class="fc bfc" id="L2467" title="All 2 branches covered.">						for (ResourceMetadata resourceMetadata : MiscUtils.getAllResourceMetadatas()) {</span>
<span class="fc" id="L2468">							result.add(getTypeInfo(new JavaTypeInfoSource(resourceMetadata.getResourceClass(), null)));</span>
						}
<span class="fc" id="L2470">						return result;</span>
<span class="fc bfc" id="L2471" title="All 2 branches covered.">					} else if (type.getName().equals(Activator.class.getName())) {</span>
<span class="fc" id="L2472">						List&lt;ITypeInfo&gt; result = new ArrayList&lt;ITypeInfo&gt;();</span>
<span class="fc bfc" id="L2473" title="All 2 branches covered.">						for (ActivatorMetadata activatorMetadata : MiscUtils.getAllActivatorMetadatas()) {</span>
<span class="fc" id="L2474">							result.add(</span>
<span class="fc" id="L2475">									getTypeInfo(new JavaTypeInfoSource(activatorMetadata.getActivatorClass(), null)));</span>
						}
<span class="fc" id="L2477">						return result;</span>
					} else {
<span class="fc" id="L2479">						return super.getPolymorphicInstanceSubTypes(type);</span>
					}
				}

				@Override
				protected String getCaption(ITypeInfo type) {
<span class="pc bpc" id="L2485" title="1 of 2 branches missed.">					if (type.getName().equals(ReflectionUIError.class.getName())) {</span>
<span class="nc" id="L2486">						return &quot;Error&quot;;</span>
					}
<span class="fc bfc" id="L2488" title="All 2 branches covered.">					for (OperationMetadata&lt;?&gt; operationMetadata : MiscUtils.getAllOperationMetadatas()) {</span>
<span class="fc bfc" id="L2489" title="All 2 branches covered.">						if (operationMetadata.getOperationBuilderClass().getName().equals(type.getName())) {</span>
<span class="fc" id="L2490">							return operationMetadata.getOperationTypeName();</span>
						}
					}
<span class="fc bfc" id="L2493" title="All 2 branches covered.">					for (ResourceMetadata resourceMetadata : MiscUtils.getAllResourceMetadatas()) {</span>
<span class="fc bfc" id="L2494" title="All 2 branches covered.">						if (resourceMetadata.getResourceClass().getName().equals(type.getName())) {</span>
<span class="fc" id="L2495">							return resourceMetadata.getResourceTypeName();</span>
						}
					}
<span class="fc bfc" id="L2498" title="All 2 branches covered.">					for (ActivatorMetadata activatorMetadata : MiscUtils.getAllActivatorMetadatas()) {</span>
<span class="fc bfc" id="L2499" title="All 2 branches covered.">						if (activatorMetadata.getActivatorClass().getName().equals(type.getName())) {</span>
<span class="fc" id="L2500">							return activatorMetadata.getActivatorName();</span>
						}
					}
<span class="fc" id="L2503">					return super.getCaption(type);</span>
				}

				@Override
				protected ResourcePath getIconImagePath(ITypeInfo type, Object object) {
<span class="fc bfc" id="L2508" title="All 2 branches covered.">					for (OperationMetadata&lt;?&gt; operationMetadata : MiscUtils.getAllOperationMetadatas()) {</span>
<span class="fc bfc" id="L2509" title="All 2 branches covered.">						if (operationMetadata.getOperationBuilderClass().getName().equals(type.getName())) {</span>
<span class="fc" id="L2510">							return operationMetadata.getOperationIconImagePath();</span>
						}
					}
<span class="fc bfc" id="L2513" title="All 2 branches covered.">					for (ResourceMetadata resourceMetadata : MiscUtils.getAllResourceMetadatas()) {</span>
<span class="fc bfc" id="L2514" title="All 2 branches covered.">						if (resourceMetadata.getResourceClass().getName().equals(type.getName())) {</span>
<span class="fc" id="L2515">							return resourceMetadata.getResourceIconImagePath();</span>
						}
					}
<span class="fc bfc" id="L2518" title="All 2 branches covered.">					for (ActivatorMetadata activatorMetadata : MiscUtils.getAllActivatorMetadatas()) {</span>
<span class="fc bfc" id="L2519" title="All 2 branches covered.">						if (activatorMetadata.getActivatorClass().getName().equals(type.getName())) {</span>
<span class="fc" id="L2520">							return activatorMetadata.getActivatorIconImagePath();</span>
						}
					}
<span class="fc bfc" id="L2523" title="All 2 branches covered.">					if (object instanceof Step) {</span>
<span class="fc" id="L2524">						return MiscUtils.getIconImagePath((Step) object);</span>
					}
<span class="fc bfc" id="L2526" title="All 2 branches covered.">					if (object instanceof StepCrossing) {</span>
<span class="fc" id="L2527">						return MiscUtils.getIconImagePath(((StepCrossing) object).getStep());</span>
					}
<span class="fc bfc" id="L2529" title="All 2 branches covered.">					if (object instanceof PlanActivation) {</span>
<span class="fc" id="L2530">						return ReflectionUIUtils.getIconImagePath(JESBSubCustomizedUI.this,</span>
<span class="fc" id="L2531">								((PlanActivation) object).getPlan());</span>
					}
<span class="fc bfc" id="L2533" title="All 2 branches covered.">					if (object instanceof PlanExecutor) {</span>
<span class="fc" id="L2534">						PlanExecutor executor = (PlanExecutor) object;</span>
<span class="fc bfc" id="L2535" title="All 2 branches covered.">						if (executor.isActive()) {</span>
<span class="fc" id="L2536">							return new ResourcePath(ResourcePath.specifyClassPathResourceLocation(</span>
<span class="fc" id="L2537">									GUI.class.getPackage().getName().replace(&quot;.&quot;, &quot;/&quot;) + &quot;/running.png&quot;));</span>
						} else {
<span class="pc bpc" id="L2539" title="1 of 2 branches missed.">							if (executor.getExecutionError() == null) {</span>
<span class="fc" id="L2540">								return new ResourcePath(ResourcePath.specifyClassPathResourceLocation(</span>
<span class="fc" id="L2541">										GUI.class.getPackage().getName().replace(&quot;.&quot;, &quot;/&quot;) + &quot;/success.png&quot;));</span>
							} else {
<span class="nc" id="L2543">								return new ResourcePath(ResourcePath.specifyClassPathResourceLocation(</span>
<span class="nc" id="L2544">										GUI.class.getPackage().getName().replace(&quot;.&quot;, &quot;/&quot;) + &quot;/failure.png&quot;));</span>
							}
						}
					}
<span class="fc bfc" id="L2548" title="All 2 branches covered.">					if (object instanceof Element) {</span>
<span class="fc bfc" id="L2549" title="All 2 branches covered.">						if (((Element) object).getOptionality() == null) {</span>
<span class="fc" id="L2550">							return getIconImagePath(</span>
<span class="fc" id="L2551">									getTypeInfo(new JavaTypeInfoSource(ParameterInitializerFacade.class, null)), null);</span>
						} else {
<span class="fc" id="L2553">							return getIconImagePath(</span>
<span class="fc" id="L2554">									getTypeInfo(new JavaTypeInfoSource(FieldInitializerFacade.class, null)), null);</span>
						}
					}
<span class="fc" id="L2557">					return super.getIconImagePath(type, object);</span>
				}

				@Override
				protected boolean isHidden(IFieldInfo field, ITypeInfo objectType) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L2564">						objectClass = MiscUtils.getJESBClass(objectType.getName());</span>
<span class="fc" id="L2565">					} catch (Exception e) {</span>
<span class="fc" id="L2566">						objectClass = null;</span>
					}
<span class="fc bfc" id="L2568" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Throwable.class.isAssignableFrom(objectClass)) {</span>
<span class="fc bfc" id="L2569" title="All 2 branches covered.">						if (!field.getName().equals(&quot;message&quot;)) {</span>
<span class="fc bfc" id="L2570" title="All 2 branches covered.">							for (IFieldInfo throwableField : ReflectionUI.getDefault()</span>
<span class="fc" id="L2571">									.getTypeInfo(new JavaTypeInfoSource(Throwable.class, null)).getFields()) {</span>
<span class="fc bfc" id="L2572" title="All 2 branches covered.">								if (field.getName().equals(throwableField.getName())) {</span>
<span class="fc" id="L2573">									return true;</span>
								}
							}
						}
					}
<span class="fc bfc" id="L2578" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Asset.class.isAssignableFrom(objectClass)) {</span>
<span class="fc bfc" id="L2579" title="All 2 branches covered.">						if (field.getName().equals(&quot;fullName&quot;)) {</span>
<span class="fc" id="L2580">							return true;</span>
						}
<span class="fc bfc" id="L2582" title="All 2 branches covered.">						if (field.getName().equals(&quot;fileSystemResourceName&quot;)) {</span>
<span class="fc" id="L2583">							return true;</span>
						}
					}
<span class="fc bfc" id="L2586" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Activator.class.isAssignableFrom(objectClass)) {</span>
<span class="fc bfc" id="L2587" title="All 2 branches covered.">						if (field.getName().equals(&quot;inputClass&quot;)) {</span>
<span class="fc" id="L2588">							return true;</span>
						}
<span class="fc bfc" id="L2590" title="All 2 branches covered.">						if (field.getName().equals(&quot;outputClass&quot;)) {</span>
<span class="fc" id="L2591">							return true;</span>
						}
<span class="fc bfc" id="L2593" title="All 2 branches covered.">						if (field.getName().equals(&quot;automaticTriggerReady&quot;)) {</span>
<span class="fc" id="L2594">							return true;</span>
						}
<span class="fc bfc" id="L2596" title="All 2 branches covered.">						if (field.getName().equals(&quot;automaticallyTriggerable&quot;)) {</span>
<span class="fc" id="L2597">							return true;</span>
						}
					}
<span class="fc" id="L2600">					return super.isHidden(field, objectType);</span>
				}

				@Override
				protected boolean isHidden(IMethodInfo method, ITypeInfo objectType) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L2607">						objectClass = MiscUtils.getJESBClass(objectType.getName());</span>
<span class="fc" id="L2608">					} catch (Exception e) {</span>
<span class="fc" id="L2609">						objectClass = null;</span>
					}
<span class="fc bfc" id="L2611" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Throwable.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2612">						if (getTypeInfo(new JavaTypeInfoSource(Throwable.class, null)).getMethods().stream().anyMatch(</span>
<span class="fc bfc" id="L2613" title="All 2 branches covered.">								throwableMethod -&gt; method.getSignature().equals(throwableMethod.getSignature()))) {</span>
<span class="fc" id="L2614">							return true;</span>
						}
					}
<span class="fc bfc" id="L2617" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Asset.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2618">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="fc bfc" id="L2619" title="All 2 branches covered.">								Arrays.asList(boolean.class.getName())))) {</span>
<span class="fc" id="L2620">							return true;</span>
						}
					}
<span class="fc bfc" id="L2623" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Step.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2624">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="pc bpc" id="L2625" title="1 of 2 branches missed.">								Arrays.asList(boolean.class.getName(), Plan.class.getName())))) {</span>
<span class="fc" id="L2626">							return true;</span>
						}
<span class="pc bpc" id="L2628" title="1 of 4 branches missed.">					} else if ((objectClass != null) &amp;&amp; Transition.class.isAssignableFrom(objectClass)) {</span>
<span class="nc" id="L2629">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="nc bnc" id="L2630" title="All 2 branches missed.">								Arrays.asList(boolean.class.getName(), Plan.class.getName())))) {</span>
<span class="nc" id="L2631">							return true;</span>
						}
<span class="pc bpc" id="L2633" title="1 of 4 branches missed.">					} else if ((objectClass != null) &amp;&amp; Transition.Condition.class.isAssignableFrom(objectClass)) {</span>
<span class="nc" id="L2634">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="nc bnc" id="L2635" title="All 2 branches missed.">								Arrays.asList(List.class.getName())))) {</span>
<span class="nc" id="L2636">							return true;</span>
						}
					}
<span class="fc bfc" id="L2639" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; OperationStructureBuilder.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2640">						if (method.getSignature()</span>
<span class="fc" id="L2641">								.matches(MiscUtils</span>
<span class="fc" id="L2642">										.escapeRegex(ReflectionUIUtils.buildMethodSignature(&quot;&lt;TYPE&gt;&quot;, &quot;build&quot;,</span>
<span class="fc" id="L2643">												Arrays.asList(Plan.ExecutionContext.class.getName(),</span>
<span class="fc" id="L2644">														Plan.ExecutionInspector.class.getName())))</span>
<span class="fc bfc" id="L2645" title="All 2 branches covered.">										.replace(&quot;&lt;TYPE&gt;&quot;, &quot;.*&quot;))) {</span>
<span class="fc" id="L2646">							return true;</span>
						}
<span class="fc" id="L2648">						if (method.getSignature()</span>
<span class="fc" id="L2649">								.equals(ReflectionUIUtils.buildMethodSignature(Class.class.getName(),</span>
<span class="fc" id="L2650">										&quot;getOperationResultClass&quot;,</span>
<span class="fc bfc" id="L2651" title="All 2 branches covered.">										Arrays.asList(Plan.class.getName(), Step.class.getName())))) {</span>
<span class="fc" id="L2652">							return true;</span>
						}
<span class="fc" id="L2654">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="fc bfc" id="L2655" title="All 2 branches covered.">								Arrays.asList(boolean.class.getName(), Plan.class.getName(), Step.class.getName())))) {</span>
<span class="fc" id="L2656">							return true;</span>
						}
					}
<span class="fc bfc" id="L2659" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Facade.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2660">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="fc bfc" id="L2661" title="All 2 branches covered.">								Arrays.asList(boolean.class.getName(), List.class.getName())))) {</span>
<span class="fc" id="L2662">							return true;</span>
						}
					}
<span class="pc bpc" id="L2665" title="1 of 4 branches missed.">					if ((objectClass != null) &amp;&amp; ListItemReplicationFacade.class.isAssignableFrom(objectClass)) {</span>
<span class="nc" id="L2666">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="nc bnc" id="L2667" title="All 2 branches missed.">								Arrays.asList(List.class.getName())))) {</span>
<span class="nc" id="L2668">							return true;</span>
						}
					}
<span class="fc bfc" id="L2671" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Structure.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2672">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="fc bfc" id="L2673" title="All 2 branches covered.">								Arrays.asList(boolean.class.getName())))) {</span>
<span class="fc" id="L2674">							return true;</span>
						}
					}
<span class="fc bfc" id="L2677" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Structure.Element.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2678">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="fc bfc" id="L2679" title="All 2 branches covered.">								Arrays.asList(boolean.class.getName())))) {</span>
<span class="fc" id="L2680">							return true;</span>
						}
					}
<span class="fc bfc" id="L2683" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; ActivatorStructure.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2684">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="fc bfc" id="L2685" title="All 2 branches covered.">								Arrays.asList(boolean.class.getName(), Plan.class.getName())))) {</span>
<span class="fc" id="L2686">							return true;</span>
						}
					}
<span class="fc bfc" id="L2689" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Activator.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2690">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;,</span>
<span class="fc bfc" id="L2691" title="All 2 branches covered.">								&quot;initializeAutomaticTrigger&quot;, Arrays.asList(ActivationHandler.class.getName())))) {</span>
<span class="fc" id="L2692">							return true;</span>
						}
					}
<span class="fc bfc" id="L2695" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Activator.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2696">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;,</span>
<span class="fc bfc" id="L2697" title="All 2 branches covered.">								&quot;finalizeAutomaticTrigger&quot;, Arrays.asList()))) {</span>
<span class="fc" id="L2698">							return true;</span>
						}
					}
<span class="pc bpc" id="L2701" title="1 of 4 branches missed.">					if ((objectClass != null) &amp;&amp; HTTPServer.RequestHandler.class.isAssignableFrom(objectClass)) {</span>
<span class="nc" id="L2702">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="nc bnc" id="L2703" title="All 2 branches missed.">								Arrays.asList(HTTPServer.class.getName())))) {</span>
<span class="nc" id="L2704">							return true;</span>
						}
					}
<span class="fc bfc" id="L2707" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; ResourceStructure.class.isAssignableFrom(objectClass)) {</span>
<span class="fc" id="L2708">						if (method.getSignature().equals(ReflectionUIUtils.buildMethodSignature(&quot;void&quot;, &quot;validate&quot;,</span>
<span class="pc bpc" id="L2709" title="1 of 2 branches missed.">								Arrays.asList(boolean.class.getName())))) {</span>
<span class="nc" id="L2710">							return true;</span>
						}
					}
<span class="fc" id="L2713">					return super.isHidden(method, objectType);</span>
				}

				@Override
				protected boolean isRelevant(IFieldInfo field, Object object, ITypeInfo objectType) {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L2720">						objectClass = MiscUtils.getJESBClass(objectType.getName());</span>
<span class="fc" id="L2721">					} catch (Exception e) {</span>
<span class="fc" id="L2722">						objectClass = null;</span>
					}
<span class="fc bfc" id="L2724" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Throwable.class.isAssignableFrom(objectClass)) {</span>
<span class="fc bfc" id="L2725" title="All 2 branches covered.">						if (field.getName().equals(&quot;message&quot;)) {</span>
<span class="pc bpc" id="L2726" title="1 of 2 branches missed.">							return field.getValue(object) != null;</span>
						}
					}
<span class="fc" id="L2729">					return super.isRelevant(field, object, objectType);</span>
				}

				@Override
				protected void validate(ITypeInfo type, Object object, ValidationSession session) throws Exception {
					Class&lt;?&gt; objectClass;
					try {
<span class="fc" id="L2736">						objectClass = MiscUtils.getJESBClass(type.getName());</span>
<span class="fc" id="L2737">					} catch (Exception e) {</span>
<span class="fc" id="L2738">						objectClass = null;</span>
					}
<span class="fc bfc" id="L2740" title="All 4 branches covered.">					if ((objectClass != null) &amp;&amp; Asset.class.isAssignableFrom(objectClass)) {</span>
<span class="pc bpc" id="L2741" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2742">							checkValidationErrorMapKeyIsCustomOrNot(object, session, false);</span>
						}
<span class="fc bfc" id="L2744" title="All 2 branches covered.">						if (!(object instanceof Folder)) {</span>
<span class="pc bpc" id="L2745" title="1 of 2 branches missed.">							if (Log.isVerbose()) {</span>
<span class="nc" id="L2746">								Log.get().information(&quot;Validating '&quot; + ((Asset) object).getFullName() + &quot;'...&quot;);</span>
							}
						}
<span class="fc" id="L2749">						((Asset) object).validate(false);</span>
<span class="fc bfc" id="L2750" title="All 4 branches covered.">					} else if ((objectClass != null) &amp;&amp; Step.class.isAssignableFrom(objectClass)) {</span>
<span class="pc bpc" id="L2751" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2752">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="pc bpc" id="L2754" title="1 of 2 branches missed.">						if (Log.isVerbose()) {</span>
<span class="nc" id="L2755">							Log.get().information(&quot;Validating plan step '&quot; + ((Step) object).getName() + &quot;'...&quot;);</span>
						}
<span class="fc" id="L2757">						((Step) object).validate(false, getCurrentPlan(session));</span>
<span class="pc bpc" id="L2758" title="1 of 4 branches missed.">					} else if ((objectClass != null) &amp;&amp; Transition.class.isAssignableFrom(objectClass)) {</span>
<span class="nc bnc" id="L2759" title="All 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2760">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="nc bnc" id="L2762" title="All 2 branches missed.">						if (Log.isVerbose()) {</span>
<span class="nc" id="L2763">							Log.get().information(</span>
<span class="nc" id="L2764">									&quot;Validating plan transition '&quot; + ((Transition) object).getSummary() + &quot;'...&quot;);</span>
						}
<span class="nc" id="L2766">						((Transition) object).validate(false, getCurrentPlan(session));</span>
<span class="pc bpc" id="L2767" title="1 of 4 branches missed.">					} else if ((objectClass != null) &amp;&amp; Transition.Condition.class.isAssignableFrom(objectClass)) {</span>
<span class="nc bnc" id="L2768" title="All 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2769">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="nc" id="L2771">						((Transition.Condition) object).validate(getCurrentPlan(session)</span>
<span class="nc" id="L2772">								.getTransitionContextVariableDeclarations(getCurrentTransition(session)));</span>
<span class="pc bfc" id="L2773" title="All 4 branches covered.">					} else if ((objectClass != null) &amp;&amp; OperationStructureBuilder.class.isAssignableFrom(objectClass)) {</span>
<span class="pc bpc" id="L2774" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2775">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="fc" id="L2777">						((OperationStructureBuilder&lt;?&gt;) object).validate(false, getCurrentPlan(session),</span>
<span class="fc" id="L2778">								getCurrentStep(session));</span>
<span class="fc bfc" id="L2779" title="All 4 branches covered.">					} else if ((objectClass != null) &amp;&amp; Facade.class.isAssignableFrom(objectClass)) {</span>
<span class="pc bpc" id="L2780" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2781">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="fc" id="L2783">						RootInstanceBuilderFacade rootInstanceBuilderFacade = (RootInstanceBuilderFacade) Facade</span>
<span class="fc" id="L2784">								.getRoot((Facade) object);</span>
<span class="pc bpc" id="L2785" title="1 of 2 branches missed.">						if (isConstantInstanceBuilder(rootInstanceBuilderFacade)) {</span>
<span class="nc" id="L2786">							((Facade) object).validate(false, Collections.emptyList());</span>
<span class="nc" id="L2787">							return;</span>
						}
<span class="fc" id="L2789">						Step step = getCurrentStep(session);</span>
<span class="fc" id="L2790">						Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L2791" title="1 of 2 branches missed.">						step = (plan.getOutputBuilder() == rootInstanceBuilderFacade.getUnderlying()) ? null : step;</span>
<span class="fc" id="L2792">						((Facade) object).validate(false, plan.getValidationContext(step).getVariableDeclarations());</span>
<span class="pc bpc" id="L2793" title="1 of 4 branches missed.">					} else if ((objectClass != null) &amp;&amp; ListItemReplicationFacade.class.isAssignableFrom(objectClass)) {</span>
<span class="nc bnc" id="L2794" title="All 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2795">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="nc" id="L2797">						RootInstanceBuilderFacade rootInstanceBuilderFacade = (RootInstanceBuilderFacade) Facade</span>
<span class="nc" id="L2798">								.getRoot(((ListItemReplicationFacade) object).getListItemInitializerFacade());</span>
<span class="nc bnc" id="L2799" title="All 2 branches missed.">						if (isConstantInstanceBuilder(rootInstanceBuilderFacade)) {</span>
<span class="nc" id="L2800">							((ListItemReplicationFacade) object).validate(Collections.emptyList());</span>
<span class="nc" id="L2801">							return;</span>
						}
<span class="nc" id="L2803">						Step step = getCurrentStep(session);</span>
<span class="nc" id="L2804">						Plan plan = getCurrentPlan(session);</span>
<span class="nc bnc" id="L2805" title="All 2 branches missed.">						step = (plan.getOutputBuilder() == rootInstanceBuilderFacade.getUnderlying()) ? null : step;</span>
<span class="nc" id="L2806">						((ListItemReplicationFacade) object)</span>
<span class="nc" id="L2807">								.validate(plan.getValidationContext(step).getVariableDeclarations());</span>
<span class="pc bfc" id="L2808" title="All 4 branches covered.">					} else if ((objectClass != null) &amp;&amp; Structure.class.isAssignableFrom(objectClass)) {</span>
<span class="pc bpc" id="L2809" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2810">							checkValidationErrorMapKeyIsCustomOrNot(object, session, false);</span>
						}
<span class="fc" id="L2812">						((Structure) object).validate(false);</span>
<span class="fc bfc" id="L2813" title="All 4 branches covered.">					} else if ((objectClass != null) &amp;&amp; Structure.Element.class.isAssignableFrom(objectClass)) {</span>
<span class="pc bpc" id="L2814" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2815">							checkValidationErrorMapKeyIsCustomOrNot(object, session, false);</span>
						}
<span class="fc" id="L2817">						((Structure.Element) object).validate(false);</span>
<span class="fc bfc" id="L2818" title="All 4 branches covered.">					} else if ((objectClass != null) &amp;&amp; ActivatorStructure.class.isAssignableFrom(objectClass)) {</span>
<span class="pc bpc" id="L2819" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2820">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="fc" id="L2822">						Plan plan = getCurrentPlan(session);</span>
<span class="fc" id="L2823">						((ActivatorStructure) object).validate(false, plan);</span>
<span class="pc bpc" id="L2824" title="1 of 4 branches missed.">					} else if ((objectClass != null) &amp;&amp; HTTPServer.RequestHandler.class.isAssignableFrom(objectClass)) {</span>
<span class="nc bnc" id="L2825" title="All 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2826">							checkValidationErrorMapKeyIsCustomOrNot(object, session, true);</span>
						}
<span class="nc" id="L2828">						HTTPServer server = null;</span>
						{
<span class="nc" id="L2830">							Asset currentAsset = getCurrentAsset(session);</span>
<span class="nc bnc" id="L2831" title="All 2 branches missed.">							if (currentAsset instanceof HTTPServer) {</span>
<span class="nc" id="L2832">								server = (HTTPServer) currentAsset;</span>
<span class="nc" id="L2833">							} else {</span>
<span class="nc" id="L2834">								Activator activator = getCurrentActivator(session);</span>
<span class="nc bnc" id="L2835" title="All 2 branches missed.">								if (activator instanceof HTTPRequestReceiver) {</span>
<span class="nc" id="L2836">									server = ((HTTPRequestReceiver) activator).getServerReference().resolve();</span>
								}
							}
						}
<span class="nc" id="L2840">						((HTTPServer.RequestHandler) object).validate(server);</span>
<span class="pc bpc" id="L2841" title="1 of 4 branches missed.">					} else if ((objectClass != null) &amp;&amp; ResourceStructure.class.isAssignableFrom(objectClass)) {</span>
<span class="nc bnc" id="L2842" title="All 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2843">							checkValidationErrorMapKeyIsCustomOrNot(object, session, false);</span>
						}
<span class="nc" id="L2845">						((ResourceStructure) object).validate(false);</span>
<span class="nc" id="L2846">					} else {</span>
<span class="pc bpc" id="L2847" title="1 of 2 branches missed.">						if (JESB.isDebugModeActive()) {</span>
<span class="nc" id="L2848">							checkValidationErrorMapKeyIsCustomOrNot(object, session, false);</span>
						}
<span class="fc" id="L2850">						super.validate(type, object, session);</span>
					}
<span class="fc" id="L2852">				}</span>

				private void checkValidationErrorMapKeyIsCustomOrNot(Object object, ValidationSession session,
						boolean custom) {
<span class="nc bnc" id="L2856" title="All 4 branches missed.">					if (custom != (object != getValidationErrorRegistry().getValidationErrorMapKey(object, session))) {</span>
<span class="nc" id="L2857">						throw new UnexpectedError();</span>
					}
<span class="nc" id="L2859">				}</span>

				@Override
				protected IValidationJob getValueAbstractFormValidationJob(IFieldInfo field, Object object,
						ITypeInfo objectType) {
<span class="nc bnc" id="L2864" title="All 2 branches missed.">					if (field.getType().getName().equals(RootInstanceBuilder.class.getName())) {</span>
<span class="nc" id="L2865">						return (session) -&gt; {</span>
<span class="nc" id="L2866">							Object value = field.getValue(object);</span>
<span class="nc" id="L2867">							Step step = getCurrentStep(session);</span>
<span class="nc" id="L2868">							Plan plan = getCurrentPlan(session);</span>
<span class="nc" id="L2869">							RootInstanceBuilderFacade rootInstanceBuilderFacade = ((RootInstanceBuilder) value)</span>
<span class="nc" id="L2870">									.getFacade();</span>
<span class="nc bnc" id="L2871" title="All 2 branches missed.">							step = (plan.getOutputBuilder() == rootInstanceBuilderFacade.getUnderlying()) ? null : step;</span>
<span class="nc" id="L2872">							rootInstanceBuilderFacade.validate(true,</span>
<span class="nc" id="L2873">									plan.getValidationContext(step).getVariableDeclarations());</span>
<span class="nc" id="L2874">						};</span>
					}
<span class="nc" id="L2876">					return super.getValueAbstractFormValidationJob(field, object, objectType);</span>
				}

				@Override
				protected IValidationJob getReturnValueAbstractFormValidationJob(IMethodInfo method, Object object,
						Object returnValue, ITypeInfo objectType) {
<span class="pc bpc" id="L2882" title="1 of 2 branches missed.">					if (returnValue instanceof Activator) {</span>
<span class="fc" id="L2883">						return (session) -&gt; {</span>
<span class="fc" id="L2884">							Plan plan = getCurrentPlan(session);</span>
<span class="fc" id="L2885">							((Activator) returnValue).validate(true, plan);</span>
<span class="fc" id="L2886">						};</span>
					}
<span class="nc" id="L2888">					return super.getReturnValueAbstractFormValidationJob(method, object, returnValue, objectType);</span>
				}

				@Override
				protected IValidationJob getListItemAbstractFormValidationJob(IListTypeInfo listType,
						ItemPosition itemPosition) {
<span class="fc" id="L2894">					Object item = itemPosition.getItem();</span>
<span class="fc bfc" id="L2895" title="All 2 branches covered.">					if (item instanceof Asset) {</span>
<span class="fc" id="L2896">						return (session) -&gt; {</span>
<span class="fc bfc" id="L2897" title="All 2 branches covered.">							if (item instanceof Folder) {</span>
<span class="fc" id="L2898">								((Folder) item).validate(false);</span>
<span class="fc" id="L2899">							} else {</span>
<span class="pc bpc" id="L2900" title="1 of 2 branches missed.">								if (Log.isVerbose()) {</span>
<span class="nc" id="L2901">									Log.get().information(&quot;Validating '&quot; + ((Asset) item).getFullName() + &quot;'...&quot;);</span>
								}
<span class="fc" id="L2903">								((Asset) item).validate(true);</span>
							}
<span class="fc" id="L2905">						};</span>
<span class="fc bfc" id="L2906" title="All 2 branches covered.">					} else if (item instanceof Facade) {</span>
<span class="fc" id="L2907">						return (session) -&gt; {</span>
<span class="fc" id="L2908">							RootInstanceBuilderFacade rootInstanceBuilderFacade = (RootInstanceBuilderFacade) Facade</span>
<span class="fc" id="L2909">									.getRoot((Facade) item);</span>
<span class="pc bpc" id="L2910" title="1 of 2 branches missed.">							if (isConstantInstanceBuilder(rootInstanceBuilderFacade)) {</span>
<span class="nc" id="L2911">								((Facade) item).validate(false, Collections.emptyList());</span>
<span class="nc" id="L2912">								return;</span>
							}
<span class="fc" id="L2914">							Step step = getCurrentStep(session);</span>
<span class="fc" id="L2915">							Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L2916" title="1 of 2 branches missed.">							step = (plan.getOutputBuilder() == rootInstanceBuilderFacade.getUnderlying()) ? null : step;</span>
<span class="fc" id="L2917">							((Facade) item).validate(false, plan.getValidationContext(step).getVariableDeclarations());</span>
<span class="fc" id="L2918">						};</span>
<span class="fc bfc" id="L2919" title="All 2 branches covered.">					} else if (item instanceof FacadeOutline) {</span>
<span class="fc" id="L2920">						return (session) -&gt; {</span>
<span class="fc" id="L2921">							RootInstanceBuilderFacade rootInstanceBuilderFacade = (RootInstanceBuilderFacade) Facade</span>
<span class="fc" id="L2922">									.getRoot(((FacadeOutline) item).getFacade());</span>
<span class="fc bfc" id="L2923" title="All 2 branches covered.">							if (isConstantInstanceBuilder(rootInstanceBuilderFacade)) {</span>
<span class="fc" id="L2924">								(((FacadeOutline) item).getFacade()).validate(false, Collections.emptyList());</span>
<span class="fc" id="L2925">								return;</span>
							}
<span class="fc" id="L2927">							Step step = getCurrentStep(session);</span>
<span class="fc" id="L2928">							Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L2929" title="1 of 2 branches missed.">							step = (plan.getOutputBuilder() == rootInstanceBuilderFacade.getUnderlying()) ? null : step;</span>
<span class="fc" id="L2930">							(((FacadeOutline) item).getFacade()).validate(false,</span>
<span class="fc" id="L2931">									plan.getValidationContext(step).getVariableDeclarations());</span>
<span class="fc" id="L2932">						};</span>
					}
<span class="fc" id="L2934">					return super.getListItemAbstractFormValidationJob(listType, itemPosition);</span>
				}

			};
		}

		@Override
		protected ValidationErrorRegistry createValidationErrorRegistry() {
<span class="fc" id="L2942">			return new ValidationErrorRegistry() {</span>

				@Override
				public Exception getValidationError(Object object, ValidationSession session) {
					try {
<span class="fc" id="L2947">						return super.getValidationError(object, session);</span>
<span class="nc" id="L2948">					} catch (Throwable t) {</span>
<span class="nc" id="L2949">						return new Exception(&quot;Failed to retrieve the validation error&quot;, t);</span>
					}
				}

				@Override
				public Object getValidationErrorMapKey(Object object, ValidationSession session) {
<span class="fc bfc" id="L2955" title="All 2 branches covered.">					if (object instanceof Step) {</span>
<span class="fc" id="L2956">						Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L2957" title="1 of 2 branches missed.">						if (plan == null) {</span>
<span class="nc" id="L2958">							throw new UnexpectedError();</span>
						}
<span class="fc" id="L2960">						return Arrays.asList(object, plan);</span>
<span class="fc bfc" id="L2961" title="All 2 branches covered.">					} else if (object instanceof Transition) {</span>
<span class="fc" id="L2962">						Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L2963" title="1 of 2 branches missed.">						if (plan == null) {</span>
<span class="nc" id="L2964">							throw new UnexpectedError();</span>
						}
<span class="fc" id="L2966">						return Arrays.asList(object, plan);</span>
<span class="pc bpc" id="L2967" title="1 of 2 branches missed.">					} else if (object instanceof Transition.Condition) {</span>
<span class="nc" id="L2968">						Plan plan = getCurrentPlan(session);</span>
<span class="nc bnc" id="L2969" title="All 2 branches missed.">						if (plan == null) {</span>
<span class="nc" id="L2970">							throw new UnexpectedError();</span>
						}
<span class="nc" id="L2972">						Transition transition = getCurrentTransition(session);</span>
<span class="nc bnc" id="L2973" title="All 2 branches missed.">						if (transition == null) {</span>
<span class="nc" id="L2974">							throw new UnexpectedError();</span>
						}
<span class="nc" id="L2976">						return Arrays.asList(object, plan, transition);</span>
<span class="fc bfc" id="L2977" title="All 2 branches covered.">					} else if (object instanceof OperationStructureBuilder) {</span>
<span class="fc" id="L2978">						Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L2979" title="1 of 2 branches missed.">						if (plan == null) {</span>
<span class="nc" id="L2980">							throw new UnexpectedError();</span>
						}
<span class="fc" id="L2982">						Step step = getCurrentStep(session);</span>
<span class="pc bpc" id="L2983" title="1 of 2 branches missed.">						if (step == null) {</span>
<span class="nc" id="L2984">							throw new UnexpectedError();</span>
						}
<span class="fc" id="L2986">						return Arrays.asList(object, plan, step);</span>
<span class="fc bfc" id="L2987" title="All 2 branches covered.">					} else if (object instanceof Facade) {</span>
<span class="fc" id="L2988">						RootInstanceBuilderFacade rootInstanceBuilderFacade = (RootInstanceBuilderFacade) Facade</span>
<span class="fc" id="L2989">								.getRoot((Facade) object);</span>
<span class="pc bpc" id="L2990" title="1 of 2 branches missed.">						if (isConstantInstanceBuilder(rootInstanceBuilderFacade)) {</span>
<span class="nc" id="L2991">							return Arrays.asList(object, rootInstanceBuilderFacade);</span>
						}
<span class="fc" id="L2993">						Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L2994" title="1 of 2 branches missed.">						if (plan == null) {</span>
<span class="nc" id="L2995">							throw new UnexpectedError();</span>
						}
<span class="pc bpc" id="L2997" title="1 of 2 branches missed.">						Step step = (plan.getOutputBuilder() == rootInstanceBuilderFacade.getUnderlying()) ? null</span>
<span class="fc" id="L2998">								: getCurrentStep(session);</span>
<span class="fc" id="L2999">						return Arrays.asList(object, plan, step, rootInstanceBuilderFacade);</span>
<span class="pc bpc" id="L3000" title="1 of 2 branches missed.">					} else if (object instanceof ListItemReplicationFacade) {</span>
<span class="nc" id="L3001">						RootInstanceBuilderFacade rootInstanceBuilderFacade = (RootInstanceBuilderFacade) Facade</span>
<span class="nc" id="L3002">								.getRoot(((ListItemReplicationFacade) object).getListItemInitializerFacade());</span>
<span class="nc bnc" id="L3003" title="All 2 branches missed.">						if (isConstantInstanceBuilder(rootInstanceBuilderFacade)) {</span>
<span class="nc" id="L3004">							return Arrays.asList(object, rootInstanceBuilderFacade);</span>
						}
<span class="nc" id="L3006">						Plan plan = getCurrentPlan(session);</span>
<span class="nc bnc" id="L3007" title="All 2 branches missed.">						if (plan == null) {</span>
<span class="nc" id="L3008">							throw new UnexpectedError();</span>
						}
<span class="nc bnc" id="L3010" title="All 2 branches missed.">						Step step = (plan.getOutputBuilder() == rootInstanceBuilderFacade.getUnderlying()) ? null</span>
<span class="nc" id="L3011">								: getCurrentStep(session);</span>
<span class="nc" id="L3012">						return Arrays.asList(object, plan, step, rootInstanceBuilderFacade);</span>
<span class="fc bfc" id="L3013" title="All 2 branches covered.">					} else if (object instanceof ActivatorStructure) {</span>
<span class="fc" id="L3014">						Plan plan = getCurrentPlan(session);</span>
<span class="pc bpc" id="L3015" title="1 of 2 branches missed.">						if (plan == null) {</span>
<span class="nc" id="L3016">							throw new UnexpectedError();</span>
						}
<span class="fc" id="L3018">						return Arrays.asList(object, plan);</span>
<span class="pc bpc" id="L3019" title="1 of 2 branches missed.">					} else if (object instanceof HTTPServer.RequestHandler) {</span>
<span class="nc" id="L3020">						Asset asset = getCurrentAsset(session);</span>
<span class="nc" id="L3021">						HTTPServer server = null;</span>
<span class="nc bnc" id="L3022" title="All 2 branches missed.">						if (asset instanceof HTTPServer) {</span>
<span class="nc" id="L3023">							server = (HTTPServer) asset;</span>
<span class="nc" id="L3024">						} else {</span>
<span class="nc" id="L3025">							Activator activator = getCurrentActivator(session);</span>
<span class="nc bnc" id="L3026" title="All 2 branches missed.">							if (activator instanceof HTTPRequestReceiver) {</span>
<span class="nc" id="L3027">								server = ((HTTPRequestReceiver) activator).getServerReference().resolve();</span>
							}
						}
<span class="nc bnc" id="L3030" title="All 2 branches missed.">						if (server == null) {</span>
<span class="nc" id="L3031">							throw new UnexpectedError();</span>
						}
<span class="nc" id="L3033">						return Arrays.asList(object, server);</span>
					} else {
<span class="fc" id="L3035">						return super.getValidationErrorMapKey(object, session);</span>
					}
				}

			};
		}

		private Asset getCurrentAsset(ValidationSession session) {
<span class="fc bfc" id="L3043" title="All 2 branches covered.">			Asset result = (session == null) ? null : (Asset) session.get(CURRENT_ASSET_KEY);</span>
<span class="fc bfc" id="L3044" title="All 2 branches covered.">			if (result == null) {</span>
<span class="fc" id="L3045">				result = stackOfCurrentAssets.peek();</span>
			}
<span class="fc" id="L3047">			return result;</span>
		}

		private PlanElement getCurrentPlanElement(ValidationSession session) {
<span class="fc bfc" id="L3051" title="All 2 branches covered.">			PlanElement result = (session == null) ? null : (PlanElement) session.get(CURRENT_PLAN_ELEMENT_KEY);</span>
<span class="fc bfc" id="L3052" title="All 2 branches covered.">			if (result == null) {</span>
<span class="fc" id="L3053">				result = stackOfCurrentPlanElements.peek();</span>
			}
<span class="fc" id="L3055">			return result;</span>
		}

		private Facade getCurrentInstantiationFacade(ValidationSession session) {
<span class="pc bpc" id="L3059" title="1 of 2 branches missed.">			Facade result = (session == null) ? null : (Facade) session.get(CURRENT_INSTANTIATION_FACADE_KEY);</span>
<span class="pc bpc" id="L3060" title="1 of 2 branches missed.">			if (result == null) {</span>
<span class="fc" id="L3061">				result = stackOfCurrentInstantiationFacades.peek();</span>
			}
<span class="fc" id="L3063">			return result;</span>
		}

		private Activator getCurrentActivator(ValidationSession session) {
<span class="nc bnc" id="L3067" title="All 2 branches missed.">			Activator result = (session == null) ? null : (Activator) session.get(CURRENT_ACTIVATOR_KEY);</span>
<span class="nc bnc" id="L3068" title="All 2 branches missed.">			if (result == null) {</span>
<span class="nc" id="L3069">				result = stackOfCurrentActivators.peek();</span>
			}
<span class="nc" id="L3071">			return result;</span>
		}

		private Plan getCurrentPlan(ValidationSession session) {
<span class="fc" id="L3075">			Asset current = getCurrentAsset(session);</span>
<span class="pc bpc" id="L3076" title="1 of 2 branches missed.">			if (current instanceof Plan) {</span>
<span class="fc" id="L3077">				return (Plan) current;</span>
			}
<span class="nc" id="L3079">			Plan result = (Plan) stackOfCurrentAssets.stream().filter(Plan.class::isInstance).findFirst().orElse(null);</span>
<span class="nc" id="L3080">			return result;</span>
		}

		private Step getCurrentStep(ValidationSession session) {
<span class="fc" id="L3084">			PlanElement current = getCurrentPlanElement(session);</span>
<span class="pc bpc" id="L3085" title="1 of 2 branches missed.">			if (current instanceof Step) {</span>
<span class="fc" id="L3086">				return (Step) current;</span>
			}
<span class="nc" id="L3088">			Step result = (Step) stackOfCurrentPlanElements.stream().filter(Step.class::isInstance).findFirst()</span>
<span class="nc" id="L3089">					.orElse(null);</span>
<span class="nc" id="L3090">			return result;</span>
		}

		private Transition getCurrentTransition(ValidationSession session) {
<span class="fc" id="L3094">			PlanElement current = getCurrentPlanElement(session);</span>
<span class="pc bpc" id="L3095" title="1 of 2 branches missed.">			if (current instanceof Transition) {</span>
<span class="nc" id="L3096">				return (Transition) current;</span>
			}
<span class="fc" id="L3098">			Transition result = (Transition) stackOfCurrentPlanElements.stream().filter(Transition.class::isInstance)</span>
<span class="fc" id="L3099">					.findFirst().orElse(null);</span>
<span class="fc" id="L3100">			return result;</span>
		}

		private RootInstanceBuilderFacade getCurrentRootInstanceBuilderFacade(ValidationSession session) {
<span class="fc" id="L3104">			Facade current = getCurrentInstantiationFacade(session);</span>
<span class="pc bpc" id="L3105" title="1 of 2 branches missed.">			if (current instanceof RootInstanceBuilderFacade) {</span>
<span class="nc" id="L3106">				return (RootInstanceBuilderFacade) current;</span>
			}
<span class="fc" id="L3108">			RootInstanceBuilderFacade result = (RootInstanceBuilderFacade) stackOfCurrentInstantiationFacades.stream()</span>
<span class="fc" id="L3109">					.filter(RootInstanceBuilderFacade.class::isInstance).findFirst().orElse(null);</span>
<span class="fc" id="L3110">			return result;</span>
		}
	}

<span class="fc" id="L3114">	protected static class JESDDatePickerPlugin extends DatePickerPlugin {</span>

		@Override
		protected boolean handles(Class&lt;?&gt; javaType) {
<span class="pc bpc" id="L3118" title="1 of 2 branches missed.">			return javaType == Date.class;</span>
		}

		@Override
		public DatePicker createControl(Object renderer, IFieldControlInput input) {
<span class="nc" id="L3123">			return super.createControl(renderer, new FieldControlInputProxy(input) {</span>

				@Override
				public IFieldControlData getControlData() {
<span class="nc" id="L3127">					return new FieldControlDataProxy(super.getControlData()) {</span>

						@Override
						public Object getValue() {
<span class="nc" id="L3131">							Date value = (Date) super.getValue();</span>
<span class="nc bnc" id="L3132" title="All 2 branches missed.">							if (value == null) {</span>
<span class="nc" id="L3133">								return null;</span>
							}
<span class="nc" id="L3135">							return value.toJavaUtilDate();</span>
						}

						@Override
						public void setValue(Object value) {
<span class="nc bnc" id="L3140" title="All 2 branches missed.">							if (value != null) {</span>
<span class="nc" id="L3141">								value = Date.fromJavaUtilDate((java.util.Date) value);</span>
							}
<span class="nc" id="L3143">							super.setValue(value);</span>
<span class="nc" id="L3144">						}</span>

						@Override
						public ITypeInfo getType() {
<span class="nc" id="L3148">							ReflectionUI reflectionUI = ((SwingRenderer) renderer).getReflectionUI();</span>
<span class="nc" id="L3149">							return reflectionUI.getTypeInfo(new JavaTypeInfoSource(java.util.Date.class, null));</span>
						}
					};
				}
			});
		}

	}

<span class="fc" id="L3158">	protected static class JESDDateTimePickerPlugin extends DateTimePickerPlugin {</span>

		@Override
		protected boolean handles(Class&lt;?&gt; javaType) {
<span class="pc bpc" id="L3162" title="1 of 2 branches missed.">			return javaType == DateTime.class;</span>
		}

		@Override
		public DateTimePicker createControl(Object renderer, IFieldControlInput input) {
<span class="nc" id="L3167">			return super.createControl(renderer, new FieldControlInputProxy(input) {</span>

				@Override
				public IFieldControlData getControlData() {
<span class="nc" id="L3171">					return new FieldControlDataProxy(super.getControlData()) {</span>

						@Override
						public Object getValue() {
<span class="nc" id="L3175">							DateTime value = (DateTime) super.getValue();</span>
<span class="nc bnc" id="L3176" title="All 2 branches missed.">							if (value == null) {</span>
<span class="nc" id="L3177">								return null;</span>
							}
<span class="nc" id="L3179">							return value.toJavaUtilDate();</span>
						}

						@Override
						public void setValue(Object value) {
<span class="nc bnc" id="L3184" title="All 2 branches missed.">							if (value != null) {</span>
<span class="nc" id="L3185">								value = DateTime.fromJavaUtilDate((java.util.Date) value);</span>
							}
<span class="nc" id="L3187">							super.setValue(value);</span>
<span class="nc" id="L3188">						}</span>

						@Override
						public ITypeInfo getType() {
<span class="nc" id="L3192">							ReflectionUI reflectionUI = ((SwingRenderer) renderer).getReflectionUI();</span>
<span class="nc" id="L3193">							return reflectionUI.getTypeInfo(new JavaTypeInfoSource(java.util.Date.class, null));</span>
						}
					};
				}
			});
		}

	}

<span class="nc" id="L3202">	public static class VariantCustomizations {</span>

		public static boolean isVariantField(IFieldInfo field) {
<span class="fc" id="L3205">			return field.getType().getName().equals(Variant.class.getName());</span>
		}

		public static String getAdapterTypeName(String objectTypeName, String variantFieldName) {
<span class="fc" id="L3209">			return objectTypeName + &quot;.&quot; + variantFieldName.substring(0, 1).toUpperCase() + variantFieldName.substring(1)</span>
<span class="fc" id="L3210">					+ &quot;AdapterType&quot;;</span>
		}

		public static String getConstantValueFieldName(String variantFieldName) {
<span class="fc" id="L3214">			return variantFieldName + &quot;Value&quot;;</span>
		}

		public static String getVariableReferenceBoxTypeName(String objectTypeName, String variantFieldName) {
<span class="fc" id="L3218">			return objectTypeName + &quot;.&quot; + variantFieldName.substring(0, 1).toUpperCase() + variantFieldName.substring(1)</span>
<span class="fc" id="L3219">					+ &quot;ReferenceBoxType&quot;;</span>
		}

		public static String getVariableReferenceFieldName(String variantFieldName) {
<span class="fc" id="L3223">			return variantFieldName + &quot;Reference&quot;;</span>
		}

		public static IFieldInfo adaptVariantField(ReflectionUI reflectionUI, IFieldInfo variantField,
				ITypeInfo objectType) {
<span class="fc" id="L3228">			return new FieldInfoProxy(variantField) {</span>
				String valueCaption;
				{
<span class="fc" id="L3231">					valueCaption = variantField.getCaption();</span>
<span class="pc bpc" id="L3232" title="1 of 2 branches missed.">					if (valueCaption.endsWith(&quot; Variant&quot;)) {</span>
<span class="fc" id="L3233">						valueCaption = valueCaption.substring(0, valueCaption.length() - &quot; Variant&quot;.length());</span>
					}

				}

				@Override
				public String getCaption() {
<span class="fc" id="L3240">					return valueCaption;</span>
				}

				@Override
				public boolean isControlValueValiditionEnabled() {
<span class="fc" id="L3245">					return true;</span>
				}

				@Override
				public boolean isFormControlEmbedded() {
<span class="fc" id="L3250">					return true;</span>
				}

				@Override
				public Object getValue(Object object) {
<span class="fc" id="L3255">					return new PrecomputedTypeInstanceWrapper(super.getValue(object), precomputeAdapterType());</span>
				}

				@Override
				public void setValue(Object object, Object value) {
<span class="fc" id="L3260">					super.setValue(object, ((PrecomputedTypeInstanceWrapper) value).getInstance());</span>
<span class="fc" id="L3261">				}</span>

				@Override
				public ITypeInfo getType() {
<span class="fc" id="L3265">					return reflectionUI.getTypeInfo(precomputeAdapterType().getSource());</span>
				}

				ITypeInfo precomputeAdapterType() {
<span class="fc" id="L3269">					return new InfoProxyFactory() {</span>

<span class="fc" id="L3271">						String adapterTypeName = objectType.getName() + &quot;.&quot;</span>
<span class="fc" id="L3272">								+ variantField.getName().substring(0, 1).toUpperCase()</span>
<span class="fc" id="L3273">								+ variantField.getName().substring(1) + &quot;AdapterWrapperType&quot;;</span>

<span class="fc" id="L3275">						IFieldInfo variableStatusField = new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

							@Override
							public String getName() {
<span class="fc" id="L3279">								return variantField.getName() + &quot;VariableStatus&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="fc" id="L3284">								return &quot;&quot;;</span>
							}

							@Override
							public double getDisplayAreaHorizontalWeight() {
<span class="fc" id="L3289">								return 0.0;</span>
							}

							@Override
							public boolean isGetOnly() {
<span class="fc" id="L3294">								return false;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="fc" id="L3299">								return ((Variant&lt;?&gt;) object).isVariable();</span>
							}

							@Override
							public void setValue(Object object, Object value) {
<span class="fc" id="L3304">								((Variant&lt;?&gt;) object).setVariable((boolean) value);</span>
<span class="fc" id="L3305">							}</span>

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L3309">								return new InfoProxyFactory() {</span>
<span class="fc" id="L3310">									ToggleButtonPlugin plugin = new ToggleButtonPlugin();</span>
<span class="fc" id="L3311">									ToggleButtonConfiguration pluginConfiguration = new ToggleButtonConfiguration();</span>
									{
<span class="fc" id="L3313">										pluginConfiguration.iconImagePath = new ResourcePath(GUI.class,</span>
<span class="fc" id="L3314">												&quot;environment.png&quot;);</span>
									}

									@Override
									protected Map&lt;String, Object&gt; getSpecificProperties(ITypeInfo type) {
<span class="fc" id="L3319">										Map&lt;String, Object&gt; result = new HashMap&lt;String, Object&gt;(</span>
<span class="fc" id="L3320">												super.getSpecificProperties(type));</span>
<span class="fc" id="L3321">										ReflectionUIUtils.setFieldControlPluginIdentifier(result,</span>
<span class="fc" id="L3322">												plugin.getIdentifier());</span>
<span class="fc" id="L3323">										ReflectionUIUtils.setFieldControlPluginConfiguration(result,</span>
<span class="fc" id="L3324">												plugin.getIdentifier(), pluginConfiguration);</span>
<span class="fc" id="L3325">										return result;</span>
									}
<span class="fc" id="L3327">								}.wrapTypeInfo(reflectionUI.getTypeInfo(new JavaTypeInfoSource(boolean.class,</span>
<span class="fc" id="L3328">										new SpecificitiesIdentifier(adapterTypeName, getName()))));</span>
							}

						};

						IFieldInfo getConstantValueField(String parentTypeName, String caption) {
<span class="fc" id="L3334">							return new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

								@Override
								public String getName() {
<span class="fc" id="L3338">									return getConstantValueFieldName(variantField.getName());</span>
								}

								@Override
								public String getCaption() {
<span class="fc" id="L3343">									return caption;</span>
								}

								@Override
								public double getDisplayAreaHorizontalWeight() {
<span class="fc" id="L3348">									return 1.0;</span>
								}

								@Override
								public boolean isGetOnly() {
<span class="fc" id="L3353">									return false;</span>
								}

								@Override
								public boolean isRelevant(Object object) {
<span class="fc" id="L3358">									return Boolean.FALSE.equals(variableStatusField.getValue(object));</span>
								}

								@SuppressWarnings({ &quot;rawtypes&quot; })
								@Override
								public Object getValue(Object object) {
<span class="fc" id="L3364">									return ((Variant) object).getValue();</span>
								}

								@SuppressWarnings({ &quot;rawtypes&quot; })
								@Override
								public void setValue(Object object, Object value) {
<span class="fc" id="L3370">									((Variant) object).setConstantValue(value);</span>
<span class="fc" id="L3371">								}</span>

								@Override
								public ITypeInfo getType() {
<span class="fc" id="L3375">									return reflectionUI.getTypeInfo(new JavaTypeInfoSource(</span>
<span class="fc" id="L3376">											((JavaTypeInfoSource) variantField.getType().getSource())</span>
<span class="fc" id="L3377">													.guessGenericTypeParameters(Variant.class, 0),</span>
<span class="fc" id="L3378">											new SpecificitiesIdentifier(parentTypeName, getName())));</span>
								}

							};
						}

						IFieldInfo getVariableReferenceField(String parentTypeName, String caption) {
<span class="fc" id="L3385">							return new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

<span class="fc" id="L3387">								GenericEnumerationFactory optionsFactory = new GenericEnumerationFactory(reflectionUI,</span>
<span class="fc" id="L3388">										new EnvironmentVariableOptionCollector(),</span>
<span class="fc" id="L3389">										EnvironmentVariable.class.getName() + &quot;Option&quot;, &quot;Environment Variable Option&quot;,</span>
<span class="fc" id="L3390">										true, false);</span>

								@Override
								public String getName() {
<span class="fc" id="L3394">									return getVariableReferenceFieldName(variantField.getName());</span>
								}

								@Override
								public String getCaption() {
<span class="fc" id="L3399">									return caption;</span>
								}

								@Override
								public double getDisplayAreaHorizontalWeight() {
<span class="fc" id="L3404">									return 1.0;</span>
								}

								@Override
								public boolean isGetOnly() {
<span class="fc" id="L3409">									return false;</span>
								}

								@Override
								public boolean isRelevant(Object object) {
<span class="fc" id="L3414">									return Boolean.TRUE.equals(variableStatusField.getValue(object));</span>
								}

								@Override
								public Object getValue(Object object) {
<span class="fc" id="L3419">									return optionsFactory</span>
<span class="fc" id="L3420">											.getItemInstance(((Variant&lt;?&gt;) object).getVariableReferenceExpression());</span>
								}

								@SuppressWarnings(&quot;unchecked&quot;)
								@Override
								public void setValue(Object object, Object value) {
<span class="fc" id="L3426">									((Variant&lt;?&gt;) object).setVariableReferenceExpression(</span>
<span class="fc" id="L3427">											(Expression&lt;String&gt;) optionsFactory.getInstanceItem(value));</span>
<span class="fc" id="L3428">								}</span>

								@Override
								public ITypeInfo getType() {
<span class="fc" id="L3432">									return reflectionUI.getTypeInfo(optionsFactory.getInstanceTypeInfoSource(</span>
<span class="fc" id="L3433">											new SpecificitiesIdentifier(parentTypeName, getName())));</span>
								}

							};
						}

<span class="fc" id="L3439">						IFieldInfo valuesField = new FieldInfoProxy(IFieldInfo.NULL_FIELD_INFO) {</span>

							@Override
							public String getName() {
<span class="fc" id="L3443">								return variantField.getName() + &quot;Values&quot;;</span>
							}

							@Override
							public String getCaption() {
<span class="fc" id="L3448">								return &quot;&quot;;</span>
							}

							@Override
							public double getDisplayAreaHorizontalWeight() {
<span class="fc" id="L3453">								return 1.0;</span>
							}

							@Override
							public boolean isFormControlEmbedded() {
<span class="fc" id="L3458">								return true;</span>
							}

							@Override
							public Object getValue(Object object) {
<span class="fc" id="L3463">								return new PrecomputedTypeInstanceWrapper(object, precomputeValuesType());</span>
							}

							@Override
							public ITypeInfo getType() {
<span class="fc" id="L3468">								return reflectionUI.getTypeInfo(precomputeValuesType().getSource());</span>
							}

							ITypeInfo precomputeValuesType() {
<span class="fc" id="L3472">								return new InfoProxyFactory() {</span>

<span class="fc" id="L3474">									String valuesTypeName = getAdapterTypeName(objectType.getName(),</span>
<span class="fc" id="L3475">											variantField.getName());</span>

<span class="fc" id="L3477">									private IFieldInfo constantValueField = getConstantValueField(valuesTypeName, &quot;&quot;);</span>
<span class="fc" id="L3478">									private IFieldInfo variableReferenceBoxField = new FieldInfoProxy(</span>
<span class="fc" id="L3479">											IFieldInfo.NULL_FIELD_INFO) {</span>
										@Override
										public String getName() {
<span class="fc" id="L3482">											return variantField.getName() + &quot;Reference&quot;;</span>
										}

										@Override
										public String getCaption() {
<span class="fc" id="L3487">											return &quot;&quot;;</span>
										}

										@Override
										public double getDisplayAreaHorizontalWeight() {
<span class="fc" id="L3492">											return 1.0;</span>
										}

										@Override
										public boolean isFormControlEmbedded() {
<span class="fc" id="L3497">											return true;</span>
										}

										@Override
										public boolean isRelevant(Object object) {
<span class="fc" id="L3502">											return Boolean.TRUE.equals(variableStatusField.getValue(object));</span>
										}

										@Override
										public Object getValue(Object object) {
<span class="fc" id="L3507">											return new PrecomputedTypeInstanceWrapper(object,</span>
<span class="fc" id="L3508">													precomputeVariableReferenceBoxType());</span>
										}

										@Override
										public ITypeInfo getType() {
<span class="fc" id="L3513">											return reflectionUI</span>
<span class="fc" id="L3514">													.getTypeInfo(precomputeVariableReferenceBoxType().getSource());</span>
										}

										ITypeInfo precomputeVariableReferenceBoxType() {
<span class="fc" id="L3518">											return new InfoProxyFactory() {</span>

<span class="fc" id="L3520">												String variableReferenceBoxTypeName = getVariableReferenceBoxTypeName(</span>
<span class="fc" id="L3521">														objectType.getName(), variantField.getName());</span>

<span class="fc" id="L3523">												private IFieldInfo variableReferenceField = getVariableReferenceField(</span>
<span class="fc" id="L3524">														variableReferenceBoxTypeName, &quot;&quot;);</span>

												@Override
												protected String getName(ITypeInfo type) {
<span class="fc" id="L3528">													return variableReferenceBoxTypeName;</span>
												}

												@Override
												protected int getFormSpacing(ITypeInfo type) {
<span class="fc" id="L3533">													return 0;</span>
												}

												@Override
												protected ITypeInfoSource getSource(ITypeInfo type) {
<span class="fc" id="L3538">													return new PrecomputedTypeInfoSource(</span>
<span class="fc" id="L3539">															precomputeVariableReferenceBoxType(),</span>
<span class="fc" id="L3540">															new SpecificitiesIdentifier(valuesTypeName,</span>
<span class="fc" id="L3541">																	variableReferenceBoxField.getName()));</span>
												}

												@Override
												protected List&lt;IFieldInfo&gt; getFields(ITypeInfo type) {
<span class="fc" id="L3546">													return Arrays.asList(variableReferenceField);</span>
												}

												@Override
												protected String toString(ITypeInfo type, Object object) {
<span class="nc" id="L3551">													return Objects.toString(object);</span>
												}

												@Override
												public String getIdentifier() {
<span class="fc" id="L3556">													return VariantCustomizations.class.getName()</span>
<span class="fc" id="L3557">															+ &quot;VariableReferenceBoxFactory [objectType=&quot;</span>
<span class="fc" id="L3558">															+ objectType.getName() + &quot;, field=&quot; + variantField.getName()</span>
<span class="fc" id="L3559">															+ &quot;]&quot;;</span>
												}
<span class="fc" id="L3561">											}.wrapTypeInfo(ITypeInfo.NULL_BASIC_TYPE_INFO);</span>
										}

									};

									@Override
									protected String getName(ITypeInfo type) {
<span class="fc" id="L3568">										return valuesTypeName;</span>
									}

									@Override
									protected int getFormSpacing(ITypeInfo type) {
<span class="fc" id="L3573">										return 0;</span>
									}

									@Override
									protected ITypeInfoSource getSource(ITypeInfo type) {
<span class="fc" id="L3578">										return new PrecomputedTypeInfoSource(precomputeValuesType(),</span>
<span class="fc" id="L3579">												new SpecificitiesIdentifier(adapterTypeName, valuesField.getName()));</span>
									}

									@Override
									protected List&lt;IFieldInfo&gt; getFields(ITypeInfo type) {
<span class="fc" id="L3584">										return Arrays.asList(constantValueField, variableReferenceBoxField);</span>
									}

									@Override
									protected String toString(ITypeInfo type, Object object) {
<span class="nc" id="L3589">										return Objects.toString(object);</span>
									}

									@Override
									public String getIdentifier() {
<span class="fc" id="L3594">										return VariantCustomizations.class.getName() + &quot;ValuesFactory [objectType=&quot;</span>
<span class="fc" id="L3595">												+ objectType.getName() + &quot;, field=&quot; + variantField.getName() + &quot;]&quot;;</span>
									}

<span class="fc" id="L3598">								}.wrapTypeInfo(ITypeInfo.NULL_BASIC_TYPE_INFO);</span>
							}

						};

						@Override
						protected String getName(ITypeInfo type) {
<span class="fc" id="L3605">							return adapterTypeName;</span>
						}

						@Override
						protected FieldsLayout getFieldsLayout(ITypeInfo type) {
<span class="fc" id="L3610">							return FieldsLayout.HORIZONTAL_FLOW;</span>
						}

						@Override
						protected int getFormSpacing(ITypeInfo type) {
<span class="fc" id="L3615">							return 5;</span>
						}

						@Override
						protected ITypeInfoSource getSource(ITypeInfo type) {
<span class="fc" id="L3620">							return new PrecomputedTypeInfoSource(precomputeAdapterType(),</span>
<span class="fc" id="L3621">									new SpecificitiesIdentifier(objectType.getName(), variantField.getName()));</span>
						}

						@Override
						protected List&lt;IFieldInfo&gt; getFields(ITypeInfo type) {
<span class="fc" id="L3626">							return Arrays.asList(variableStatusField, valuesField);</span>
						}

						@Override
						protected String toString(ITypeInfo type, Object object) {
<span class="nc" id="L3631">							return Objects.toString(object);</span>
						}

						@Override
						protected void validate(ITypeInfo type, Object object, ValidationSession session)
								throws Exception {
<span class="fc" id="L3637">							((Variant&lt;?&gt;) object).validate();</span>
<span class="fc" id="L3638">						}</span>

						@Override
						public String getIdentifier() {
<span class="fc" id="L3642">							return VariantCustomizations.class.getName() + &quot;Factory [objectType=&quot; + objectType.getName()</span>
<span class="fc" id="L3643">									+ &quot;, field=&quot; + variantField.getName() + &quot;]&quot;;</span>
						}

<span class="fc" id="L3646">					}.wrapTypeInfo(ITypeInfo.NULL_BASIC_TYPE_INFO);</span>
				}

			};
		}
	}

	private static class EnvironmentVariableOptionCollector implements Iterable&lt;Expression&lt;String&gt;&gt; {

		@Override
		public Iterator&lt;Expression&lt;String&gt;&gt; iterator() {
<span class="fc" id="L3657">			return new Variant&lt;Object&gt;(Object.class).getVariableReferenceExpressionOptions().iterator();</span>
		}

		@Override
		public int hashCode() {
<span class="fc" id="L3662">			return 1;</span>
		}

		@Override
		public boolean equals(Object obj) {
<span class="nc bnc" id="L3667" title="All 2 branches missed.">			if (this == obj)</span>
<span class="nc" id="L3668">				return true;</span>
<span class="nc bnc" id="L3669" title="All 2 branches missed.">			if (obj == null)</span>
<span class="nc" id="L3670">				return false;</span>
<span class="nc bnc" id="L3671" title="All 2 branches missed.">			if (getClass() != obj.getClass())</span>
<span class="nc" id="L3672">				return false;</span>
<span class="nc" id="L3673">			return true;</span>
		}

		@Override
		public String toString() {
<span class="nc" id="L3678">			return &quot;EnvironmentVariableOptionCollector []&quot;;</span>
		}

	}

<span class="fc" id="L3683">	public enum SidePaneValueName {</span>
<span class="fc" id="L3684">		ENVIRONMENT_SETTINGS</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span>j-enterprise-service-bus (java8) (Dec 1, 2025 10:13:41 AM)</div></body></html>