<com.otk.jesb.PluginBuilder>
  <packageName>com.otk.jesb.activation.builtin</packageName>
  <resources/>
  <operations/>
  <activators>
    <com.otk.jesb.PluginBuilder_-ActivatorDescriptor>
      <activatorIconImageData>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</activatorIconImageData>
      <activatorTypeCaption>Schedule</activatorTypeCaption>
      <activatorTypeName>Schedule</activatorTypeName>
      <additionalFieldDeclarationsSourceCode>private ScheduledExecutorService scheduler;
</additionalFieldDeclarationsSourceCode>
      <additionalMethodDeclarationsSourceCode>private ScheduledFuture&lt;?&gt; prepare(Runnable task, java.util.Date start, boolean repeating, long periodLength,
		ChronoUnit periodUnit, java.util.Date end) {
	java.util.Date now = new java.util.Date();
	java.util.Date next;
	if (repeating) {
		next = computeNextOccurrence(start, periodLength, periodUnit, now);
		if (end != null) {
			if (end.before(next)) {
				return null;
			}
		}
	} else {
		next = start;
	}
	long nowMilliseconds = now.getTime();
	long nextMilliseconds = next.getTime();
	long delayMilliseconds = nextMilliseconds - nowMilliseconds;
	return scheduler.schedule(() -&gt; {
		if (repeating) {
			prepare(task, start, repeating, periodLength, periodUnit, end);
		}
		task.run();
	}, delayMilliseconds, TimeUnit.MILLISECONDS);
}

private java.util.Date computeNextOccurrence(java.util.Date start, long periodLength, ChronoUnit periodUnit,
		java.util.Date now) {
	if (start.after(now)) {
		return start;
	}
	ZoneId timeZone = ZoneId.of(timeZoneIdentifierVariant.getValue());
	ZonedDateTime startZonedDateTime = start.toInstant().atZone(timeZone);
	ZonedDateTime nowZonedDateTime = now.toInstant().atZone(timeZone);
	long elapsed = periodUnit.between(startZonedDateTime, nowZonedDateTime);
	long missed = (elapsed / periodLength) + 1;
	return java.util.Date.from(startZonedDateTime.plus(missed * periodLength, periodUnit).toInstant());
}
</additionalMethodDeclarationsSourceCode>
      <additionalValidationStatements>if(repeatingVariant.getValue()){
    if(repetitionSettings.periodLengthVariant.getValue() &lt;= 0){
        throw new com.otk.jesb.ValidationError(&quot;Invalid repetition period length: &quot; + repetitionSettings.periodLengthVariant.getValue() + &quot; (positive number expected)&quot;);
    }
    if(repetitionSettings.endDateTimeVariant.getValue() != null){
        if(!repetitionSettings.endDateTimeVariant.getValue().toJavaUtilDate().after(startDateTimeVariant.getValue().toJavaUtilDate())){
            throw new com.otk.jesb.ValidationError(&quot;Invalid schedule end date/time: It is not after the schedule start date/time&quot;);
        }
        if(!repetitionSettings.endDateTimeVariant.getValue().toJavaUtilDate().after(new java.util.Date())){
            throw new com.otk.jesb.ValidationError(&quot;Invalid schedule end date/time: It has passed&quot;);
        }
    }
}else{
    if(!startDateTimeVariant.getValue().toJavaUtilDate().after(new java.util.Date())){
        throw new com.otk.jesb.ValidationError(&quot;Invalid schedule start date/time: It has passed&quot;);
    }
}
if (!ZoneId.getAvailableZoneIds().contains(timeZoneIdentifierVariant.getValue())) {
	throw new ValidationError(&quot;Invalid time zone: &apos;&quot; + timeZoneIdentifierVariant.getValue() + &quot;&apos;: Expected &quot;
			+ ZoneId.getAvailableZoneIds());
}
</additionalValidationStatements>
      <attributes>
        <com.otk.jesb.PluginBuilder_-AttributeDescriptor>
          <caption>Start At</caption>
          <name>startDateTime</name>
          <nature class="com.otk.jesb.PluginBuilder$SimpleAttributeNature">
            <controlPluginConfiguration class="xy.reflect.ui.control.swing.plugin.DateTimePickerPlugin$DateTimePickerConfiguration">
              <dateFormat>yyyy-MM-dd</dateFormat>
              <timeFormat>HH:mm:ss</timeFormat>
            </controlPluginConfiguration>
            <controlPluginIdentifier>com.otk.jesb.ui.GUI$JESDDateTimePickerPlugin</controlPluginIdentifier>
            <defaultValueExpression>com.otk.jesb.meta.DateTime.now()</defaultValueExpression>
            <nullable>false</nullable>
            <typeNameOrAlias>com.otk.jesb.meta.DateTime</typeNameOrAlias>
            <variant>true</variant>
          </nature>
        </com.otk.jesb.PluginBuilder_-AttributeDescriptor>
        <com.otk.jesb.PluginBuilder_-AttributeDescriptor>
          <caption>Repeat</caption>
          <name>repeating</name>
          <nature class="com.otk.jesb.PluginBuilder$SimpleAttributeNature">
            <controlPluginConfiguration class="null"/>
            <controlPluginIdentifier class="null"/>
            <defaultValueExpression>false</defaultValueExpression>
            <nullable>false</nullable>
            <typeNameOrAlias>boolean</typeNameOrAlias>
            <variant>true</variant>
          </nature>
        </com.otk.jesb.PluginBuilder_-AttributeDescriptor>
        <com.otk.jesb.PluginBuilder_-AttributeDescriptor>
          <caption>Repetition Settings</caption>
          <name>repetitionSettings</name>
          <nature class="com.otk.jesb.PluginBuilder$GroupAttributeNature">
            <attributes>
              <com.otk.jesb.PluginBuilder_-AttributeDescriptor>
                <caption>Period Unit</caption>
                <name>periodUnit</name>
                <nature class="com.otk.jesb.PluginBuilder$EnumerationAttributeNature">
                  <controlPluginConfiguration class="null"/>
                  <controlPluginIdentifier class="null"/>
                  <defaultValueExpression>RepetitionSettingsStructurePeriodUnitStructure.DAYS</defaultValueExpression>
                  <nullable>false</nullable>
                  <structure>
                    <items>
                      <com.otk.jesb.Structure_-EnumerationItem>
                        <name>MILLISECONDS</name>
                      </com.otk.jesb.Structure_-EnumerationItem>
                      <com.otk.jesb.Structure_-EnumerationItem>
                        <name>SECONDS</name>
                      </com.otk.jesb.Structure_-EnumerationItem>
                      <com.otk.jesb.Structure_-EnumerationItem>
                        <name>MINUTES</name>
                      </com.otk.jesb.Structure_-EnumerationItem>
                      <com.otk.jesb.Structure_-EnumerationItem>
                        <name>HOURS</name>
                      </com.otk.jesb.Structure_-EnumerationItem>
                      <com.otk.jesb.Structure_-EnumerationItem>
                        <name>DAYS</name>
                      </com.otk.jesb.Structure_-EnumerationItem>
                      <com.otk.jesb.Structure_-EnumerationItem>
                        <name>MONTHS</name>
                      </com.otk.jesb.Structure_-EnumerationItem>
                      <com.otk.jesb.Structure_-EnumerationItem>
                        <name>YEARS</name>
                      </com.otk.jesb.Structure_-EnumerationItem>
                    </items>
                  </structure>
                  <variant>true</variant>
                </nature>
              </com.otk.jesb.PluginBuilder_-AttributeDescriptor>
              <com.otk.jesb.PluginBuilder_-AttributeDescriptor>
                <caption>Period Length</caption>
                <name>periodLength</name>
                <nature class="com.otk.jesb.PluginBuilder$SimpleAttributeNature">
                  <controlPluginConfiguration class="null"/>
                  <controlPluginIdentifier class="null"/>
                  <defaultValueExpression>1l</defaultValueExpression>
                  <nullable>false</nullable>
                  <typeNameOrAlias>long</typeNameOrAlias>
                  <variant>true</variant>
                </nature>
              </com.otk.jesb.PluginBuilder_-AttributeDescriptor>
              <com.otk.jesb.PluginBuilder_-AttributeDescriptor>
                <caption>End At</caption>
                <name>endDateTime</name>
                <nature class="com.otk.jesb.PluginBuilder$SimpleAttributeNature">
                  <controlPluginConfiguration class="xy.reflect.ui.control.swing.plugin.DateTimePickerPlugin$DateTimePickerConfiguration">
                    <dateFormat>yyyy-MM-dd</dateFormat>
                    <timeFormat>HH:mm:ss</timeFormat>
                  </controlPluginConfiguration>
                  <controlPluginIdentifier>com.otk.jesb.ui.GUI$JESDDateTimePickerPlugin</controlPluginIdentifier>
                  <defaultValueExpression>null</defaultValueExpression>
                  <nullable>true</nullable>
                  <typeNameOrAlias>com.otk.jesb.meta.DateTime</typeNameOrAlias>
                  <variant>true</variant>
                </nature>
              </com.otk.jesb.PluginBuilder_-AttributeDescriptor>
            </attributes>
            <nullable>false</nullable>
          </nature>
        </com.otk.jesb.PluginBuilder_-AttributeDescriptor>
        <com.otk.jesb.PluginBuilder_-AttributeDescriptor>
          <caption>Time Zone</caption>
          <name>timeZoneIdentifier</name>
          <nature class="com.otk.jesb.PluginBuilder$SimpleAttributeNature">
            <controlPluginConfiguration class="null"/>
            <controlPluginIdentifier class="null"/>
            <defaultValueExpression>ZoneId.systemDefault().getId()</defaultValueExpression>
            <nullable>false</nullable>
            <typeNameOrAlias>java.lang.String</typeNameOrAlias>
            <variant>true</variant>
          </nature>
        </com.otk.jesb.PluginBuilder_-AttributeDescriptor>
      </attributes>
      <handlerFinalizationStatements>scheduler.shutdownNow();
scheduler.awaitTermination(Long.MAX_VALUE, TimeUnit.DAYS);
scheduler = null;</handlerFinalizationStatements>
      <handlerInitializationStatements>scheduler = Executors.newScheduledThreadPool(1);
Runnable task = new Runnable() {
	@Override
	public void run() {
		activationHandler.trigger(new InputClassStructure(com.otk.jesb.meta.DateTime.now()));
	}
};
ChronoUnit chronUnit = Arrays.stream(ChronoUnit.class.getEnumConstants())
		.filter(constant -&gt; repetitionSettings.periodUnitVariant.getValue().name().startsWith(constant.name()))
		.findFirst().get();
prepare(task, startDateTimeVariant.getValue().toJavaUtilDate(), repeatingVariant.getValue(),
		repetitionSettings.periodLengthVariant.getValue(), chronUnit,
		(repetitionSettings.getEndDateTimeVariant().getValue() == null) ? null
				: repetitionSettings.getEndDateTimeVariant().getValue().toJavaUtilDate());
this.activationHandler = activationHandler;
</handlerInitializationStatements>
      <importedClassNames>
        <string>java.util.Arrays</string>
        <string>java.util.concurrent.Executors</string>
        <string>java.util.concurrent.ScheduledExecutorService</string>
        <string>java.util.concurrent.ScheduledFuture</string>
        <string>java.util.concurrent.TimeUnit</string>
        <string>java.time.ZoneId</string>
        <string>java.time.ZonedDateTime</string>
        <string>java.time.temporal.ChronoUnit</string>
      </importedClassNames>
      <inputClassOption>
        <concreteStructureAlternatives class="null"/>
        <structure class="com.otk.jesb.Structure$ClassicStructure">
          <elements>
            <com.otk.jesb.Structure_-SimpleElement>
              <multiple>false</multiple>
              <name>activationMoment</name>
              <optionality class="null"/>
              <typeNameOrAlias>com.otk.jesb.meta.DateTime</typeNameOrAlias>
            </com.otk.jesb.Structure_-SimpleElement>
          </elements>
        </structure>
      </inputClassOption>
      <outputClassOption class="null"/>
    </com.otk.jesb.PluginBuilder_-ActivatorDescriptor>
  </activators>
</com.otk.jesb.PluginBuilder>